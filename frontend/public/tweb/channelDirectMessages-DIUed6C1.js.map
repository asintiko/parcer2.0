{"version":3,"file":"channelDirectMessages-DIUed6C1.js","sources":["../src/components/sidebarRight/tabs/channelDirectMessages.tsx"],"sourcesContent":["import {createEffect, createSignal, Show} from 'solid-js';\r\nimport {Portal} from 'solid-js/web';\r\nimport {Transition} from 'solid-transition-group';\r\nimport throttle from '../../../helpers/schedulers/throttle';\r\nimport {i18n} from '../../../lib/langPack';\r\nimport {useHotReloadGuard} from '../../../lib/solidjs/hotReloadGuard';\r\nimport Row from '../../rowTsx';\r\nimport Section from '../../section';\r\nimport SaveButton from '../../sidebarLeft/tabs/privacy/messages/saveButton';\r\nimport StarRangeInput from '../../sidebarLeft/tabs/privacy/messages/starsRangeInput';\r\nimport useIsConfirmationNeededOnClose from '../../sidebarLeft/tabs/privacy/messages/useIsConfirmationNeededOnClose';\r\nimport useStarsCommissionAndWithdrawalPrice from '../../sidebarLeft/tabs/privacy/messages/useStarsCommissionAndWithdrawalPrice';\r\nimport type {AppDirectMessagesTab} from '../../solidJsTabs';\r\nimport {useSuperTab} from '../../solidJsTabs/superTabProvider';\r\nimport StaticSwitch from '../../staticSwitch';\r\n\r\n\r\nconst ChannelDirectMessages = () => {\r\n  const [tab] = useSuperTab<typeof AppDirectMessagesTab>();\r\n  const {apiManagerProxy, rootScope} = useHotReloadGuard();\r\n\r\n  const chat = tab.payload.chat;\r\n  if(!chat) return <></>;\r\n\r\n  const linkedChat = chat.linked_monoforum_id ? apiManagerProxy.getChat(chat.linked_monoforum_id) : undefined;\r\n\r\n  const initialEnabled = !!linkedChat;\r\n  const initialStars = linkedChat?._ === 'channel' ? +linkedChat.send_paid_messages_stars || 0 : 0\r\n\r\n  const [enabled, setEnabled] = createSignal(initialEnabled);\r\n  const [stars, setStars] = createSignal(initialStars);\r\n\r\n  const [hasChanges, setHasChanges] = createSignal(false);\r\n\r\n  const {commissionPercents, willReceiveDollars} = useStarsCommissionAndWithdrawalPrice(stars);\r\n\r\n  const throttledSetHasChanges = throttle(setHasChanges, 200);\r\n\r\n  createEffect(() => {\r\n    throttledSetHasChanges(initialEnabled !== enabled() || (enabled() && initialStars !== stars()));\r\n  });\r\n\r\n  let isSaving = false;\r\n\r\n  async function saveSettings() {\r\n    if(isSaving) return;\r\n    isSaving = true;\r\n\r\n    try {\r\n      await rootScope.managers.appChatsManager.updateChannelPaidMessagesPrice(\r\n        chat.id,\r\n        enabled() ? stars() : 0,\r\n        enabled()\r\n      );\r\n      tab.close();\r\n    } finally {\r\n      isSaving = false;\r\n    }\r\n  }\r\n\r\n  tab.isConfirmationNeededOnClose = useIsConfirmationNeededOnClose({\r\n    saveAllSettings: saveSettings,\r\n    hasChanges,\r\n    descriptionLangKey: 'UnsavedChangesDescription.Channel'\r\n  });\r\n\r\n  return <>\r\n    <Portal mount={tab.header}>\r\n      <SaveButton hasChanges={hasChanges()} onClick={() => void saveSettings()} />\r\n    </Portal>\r\n\r\n    <Section caption='ChannelDirectMessages.Settings.SwitchLabelCaption'>\r\n      <Row clickable={() => {setEnabled(!enabled())}}>\r\n        <Row.Title>\r\n          {i18n('ChannelDirectMessages.Settings.SwitchLabel')}\r\n        </Row.Title>\r\n        <Row.RightContent>\r\n          <StaticSwitch checked={enabled()} />\r\n        </Row.RightContent>\r\n      </Row>\r\n    </Section>\r\n\r\n    <Transition name='fade'>\r\n      <Show when={enabled()}>\r\n        <Section\r\n          name='PaidMessages.SetPrice'\r\n          class='overflow-hidden'\r\n          caption='PaidMessages.SetPriceChannelDescription'\r\n          captionArgs={[commissionPercents(), willReceiveDollars()]}\r\n        >\r\n          <StarRangeInput value={stars()} onChange={setStars} startFromZero />\r\n        </Section>\r\n      </Show>\r\n    </Transition>\r\n  </>;\r\n};\r\n\r\nexport default ChannelDirectMessages;\r\n"],"names":["ChannelDirectMessages","tab","useSuperTab","apiManagerProxy","rootScope","useHotReloadGuard","chat","payload","linkedChat","linked_monoforum_id","getChat","undefined","initialEnabled","initialStars","_","send_paid_messages_stars","enabled","setEnabled","createSignal","stars","setStars","hasChanges","setHasChanges","commissionPercents","willReceiveDollars","useStarsCommissionAndWithdrawalPrice","throttledSetHasChanges","throttle","createEffect","isSaving","saveSettings","managers","appChatsManager","updateChannelPaidMessagesPrice","id","close","isConfirmationNeededOnClose","useIsConfirmationNeededOnClose","saveAllSettings","descriptionLangKey","_$createComponent","Portal","mount","header","children","SaveButton","onClick","Section","caption","Row","clickable","Title","i18n","RightContent","StaticSwitch","checked","Transition","name","Show","when","captionArgs","StarRangeInput","value","onChange","startFromZero"],"mappings":"27BAiBMA,MAAAA,GAAwBA,IAAM,CAClC,KAAM,CAACC,CAAG,EAAIC,IACR,CAACC,gBAAAA,EAAiBC,UAAAA,CAAU,EAAGC,EAAiB,EAEhDC,EAAOL,EAAIM,QAAQD,KACzB,GAAG,CAACA,EAAM,MAAA,GAEV,MAAME,EAAaF,EAAKG,oBAAsBN,EAAgBO,QAAQJ,EAAKG,mBAAmB,EAAIE,OAE5FC,EAAiB,CAAC,CAACJ,EACnBK,EAAeL,GAAYM,IAAM,WAAY,CAACN,EAAWO,0BAA4B,EAErF,CAACC,EAASC,CAAU,EAAIC,EAAaN,CAAc,EACnD,CAACO,EAAOC,CAAQ,EAAIF,EAAaL,CAAY,EAE7C,CAACQ,EAAYC,CAAa,EAAIJ,EAAa,EAAK,EAEhD,CAACK,mBAAAA,EAAoBC,mBAAAA,CAAkB,EAAIC,EAAqCN,CAAK,EAErFO,EAAyBC,EAASL,EAAe,GAAG,EAE1DM,EAAa,IAAM,CACjBF,EAAuBd,IAAmBI,EAAS,GAAKA,EAAO,GAAMH,IAAiBM,EAAK,CAAG,CAChG,CAAC,EAED,IAAIU,EAAW,GAEf,eAAeC,GAAe,CAC5B,GAAGD,CAAAA,EACHA,CAAAA,EAAW,GAEX,GAAI,CACF,MAAMzB,EAAU2B,SAASC,gBAAgBC,+BACvC3B,EAAK4B,GACLlB,EAAO,EAAKG,EAAO,EAAG,EACtBH,EACF,CAAA,EACAf,EAAIkC,MAAK,CACX,QAAU,CACRN,EAAW,EACb,EACF,CAEA5B,OAAAA,EAAImC,4BAA8BC,EAA+B,CAC/DC,gBAAiBR,EACjBT,WAAAA,EACAkB,mBAAoB,mCACtB,CAAC,EAEDC,CAAAA,EACGC,EAAM,CAAA,IAACC,OAAK,CAAA,OAAEzC,EAAI0C,MAAM,EAAA,IAAAC,UAAA,CAAA,OAAAJ,EACtBK,EAAU,CAAA,IAACxB,YAAU,CAAA,OAAEA,EAAU,CAAE,EAAEyB,QAASA,IAAM,KAAKhB,EAAa,CAAC,CAAA,CAAA,EAAAU,EAAAA,EAGzEO,EAAO,CAACC,QAAO,oDAAA,IAAAJ,UAAA,CAAA,OAAAJ,EACbS,EAAG,CAACC,UAAWA,IAAM,CAACjC,EAAW,CAACD,EAAO,CAAE,CAAE,EAAA,IAAA4B,UAAA,CAAA,MAAA,CAAAJ,EAC3CS,EAAIE,MAAK,CAAA,IAAAP,UAAA,CAAA,OACPQ,EAAK,4CAA4C,CAAC,CAAA,CAAA,EAAAZ,EAEpDS,EAAII,aAAY,CAAA,IAAAT,UAAA,CAAA,OAAAJ,EACdc,EAAY,CAAA,IAACC,SAAO,CAAA,OAAEvC,EAAO,CAAE,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAAwB,EAAAA,EAKrCgB,EAAU,CAACC,KAAI,OAAA,IAAAb,UAAA,CAAA,OAAAJ,EACbkB,EAAI,CAAA,IAACC,MAAI,CAAA,OAAE3C,EAAO,CAAE,EAAA,IAAA4B,UAAA,CAAA,OAAAJ,EAClBO,EAAO,CACNU,KAAI,wBAAA,MAAA,kBAEJT,QAAO,0CAAA,IACPY,aAAW,CAAA,MAAE,CAACrC,EAAkB,EAAIC,EAAkB,CAAE,CAAC,EAAA,IAAAoB,UAAA,CAAA,OAAAJ,EAExDqB,EAAc,CAAA,IAACC,OAAK,CAAA,OAAE3C,EAAK,CAAE,EAAE4C,SAAU3C,EAAU4C,cAAa,EAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAK3E"}