{"version":3,"file":"suggestedPostActionContent-DPakJjBJ.js","sources":["../src/components/chat/bubbleParts/suggestedPostActionContent.tsx"],"sourcesContent":["import {Match, onCleanup, Show, Switch} from 'solid-js';\r\nimport {formatFullSentTime} from '../../../helpers/date';\r\nimport {numberThousandSplitterForStars} from '../../../helpers/number/numberThousandSplitter';\r\nimport {I18nTsx} from '../../../helpers/solid/i18n';\r\nimport {Message, MessageAction} from '../../../layer';\r\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport defineSolidElement, {PassedProps} from '../../../lib/solidjs/defineSolidElement';\r\nimport {PeerTitleTsx} from '../../peerTitleTsx';\r\nimport styles from './suggestedPostActionContent.module.scss';\r\nimport {SUGGESTED_POST_WAIT_FOR_REWARD_HOURS} from '../../../lib/mtproto/mtproto_config';\r\n\r\nif(import.meta.hot) import.meta.hot.accept();\r\n\r\n\r\nconst LIMIT_SYMBOLS = 20;\r\n\r\ntype PossibleAction = MessageAction.messageActionSuggestedPostApproval | MessageAction.messageActionSuggestedPostSuccess | MessageAction.messageActionSuggestedPostRefund;\r\n\r\ntype Props = {\r\n  message: Message.message | Message.messageService;\r\n  canManageDirectMessages: boolean;\r\n\r\n  action?: PossibleAction;\r\n  fromPeerTitle?: HTMLElement;\r\n};\r\n\r\nconst SuggestedPostActionContent = defineSolidElement({\r\n  name: 'suggested-post-action-content',\r\n  component: (props: PassedProps<Props>) => {\r\n    props.element.classList.add(styles.Container);\r\n    if(import.meta.hot) onCleanup(() => props.element.classList.remove(styles.Container));\r\n\r\n    const suggestedPost = () => props.message._ === 'message' ?\r\n      props.message.suggested_post :\r\n      undefined;\r\n\r\n    const isChangeSuggestion = () => !!props.message.reply_to;\r\n\r\n    const wasPublished = () => props.action?._ === 'messageActionSuggestedPostApproval' && props.action?.schedule_date && props.action.schedule_date * 1000 <= Date.now()\r\n\r\n    const savedPeerId = () => props.message.saved_peer_id && getPeerId(props.message.saved_peer_id);\r\n    const chargedPeerId = () => savedPeerId() !== rootScope.myId ? savedPeerId() : undefined;\r\n\r\n    const awardedStars = () => props.action?._ === 'messageActionSuggestedPostSuccess' && props.action.price.amount;\r\n\r\n    const chargedPrice = () => props.action?._ === 'messageActionSuggestedPostApproval' && props.action.price ?\r\n      <I18nTsx\r\n        key={props.action.price._ === 'starsTonAmount' ? 'SuggestedPosts.TONAmount' : 'Stars'}\r\n        args={[numberThousandSplitterForStars(props.action.price.amount)]}\r\n      /> :\r\n      undefined;\r\n\r\n    const makeEmoji = (text: string) => <span>{wrapEmojiText(text)}</span>;\r\n\r\n    return <>\r\n      <div class={styles.Label}>\r\n        <Switch>\r\n          <Match when={suggestedPost() && isChangeSuggestion()}>\r\n            <I18nTsx\r\n              key={props.fromPeerTitle ? 'SuggestedPosts.SuggestedAChange' : 'SuggestedPosts.YouSuggestedAChange'}\r\n              args={props.fromPeerTitle ? [props.fromPeerTitle] : undefined}\r\n            />\r\n          </Match>\r\n          <Match when={suggestedPost()}>\r\n            <I18nTsx\r\n              key={props.fromPeerTitle ? 'SuggestedPosts.SuggestedAPost' : 'SuggestedPosts.YouSuggestedAPost'}\r\n              args={props.fromPeerTitle ? [props.fromPeerTitle] : undefined}\r\n            />\r\n          </Match>\r\n          <Match when={props.action?._ === 'messageActionSuggestedPostRefund'}>\r\n            <I18nTsx\r\n              key='SuggestedPosts.Refund'\r\n              args={[<PeerTitleTsx peerId={savedPeerId()} onlyFirstName limitSymbols={LIMIT_SYMBOLS} />]}\r\n            />\r\n          </Match>\r\n          <Match when={props.action?._ === 'messageActionSuggestedPostApproval' && props.action?.pFlags?.balance_too_low}>\r\n            <I18nTsx key='SuggestedPosts.BalanceTooLow' args={[wrapEmojiText('âŒ')]} />\r\n          </Match>\r\n          <Match when={props.action?._ === 'messageActionSuggestedPostApproval' && props.action?.pFlags?.rejected}>\r\n            <I18nTsx\r\n              key={props.fromPeerTitle ? 'SuggestedPosts.RejectedAPost' : 'SuggestedPosts.YouRejectedAPost'}\r\n              args={props.fromPeerTitle ? [wrapEmojiText('âŒ'), props.fromPeerTitle] : [wrapEmojiText('âŒ')]}\r\n            />\r\n          </Match>\r\n          <Match when={props.action?._ === 'messageActionSuggestedPostApproval'}>\r\n            <I18nTsx key='SuggestedPosts.AgreementReached' args={[makeEmoji('ðŸ¤')]} />\r\n          </Match>\r\n          <Match when={props.action?._ === 'messageActionSuggestedPostSuccess'}>\r\n            <I18nTsx\r\n              key='SuggestedPosts.PostSuccess'\r\n              args={[\r\n                makeEmoji('âœ…'),\r\n                <I18nTsx key='Stars' args={[numberThousandSplitterForStars(awardedStars())]} />\r\n              ]}\r\n            />\r\n          </Match>\r\n        </Switch>\r\n      </div>\r\n\r\n      <Show when={suggestedPost()?.price || suggestedPost()?.schedule_date}>\r\n        <div class={styles.Grid}>\r\n          <Show when={suggestedPost().price}>\r\n            <div class={styles.GridLabel}><I18nTsx key='SuggestedPosts.Price' /></div>\r\n            <div class={styles.GridValue}>\r\n              <I18nTsx\r\n                key={suggestedPost().price._ === 'starsTonAmount' ? 'SuggestedPosts.TONAmount' : 'Stars'}\r\n                args={[numberThousandSplitterForStars(suggestedPost().price.amount)]}\r\n              />\r\n            </div>\r\n          </Show>\r\n          <Show when={suggestedPost().schedule_date}>\r\n            <div class={styles.GridLabel}><I18nTsx key='SuggestedPosts.Time' /></div>\r\n            <div class={styles.GridValue}>{formatFullSentTime(suggestedPost().schedule_date)}</div>\r\n          </Show>\r\n        </div>\r\n      </Show>\r\n\r\n      {props.action?._ === 'messageActionSuggestedPostApproval' && props.action.reject_comment && (\r\n        <div class={`${styles.Subtitle} ${styles.center}`}>\r\n          \"{props.action.reject_comment}\"\r\n        </div>\r\n      )}\r\n\r\n      {props.action?._ === 'messageActionSuggestedPostApproval' && !props.action?.pFlags?.balance_too_low && !props.action?.pFlags?.rejected &&\r\n        <>\r\n          <I18nTsx\r\n            class={styles.Subtitle}\r\n            key={wasPublished() ? 'SuggestedPosts.AgreementReached.Published' : 'SuggestedPosts.AgreementReached.ToBePublished'}\r\n            args={[makeEmoji('ðŸ“…'), formatFullSentTime(props.action.schedule_date)]}\r\n          />\r\n\r\n          <Show when={props.action.price}>\r\n            <I18nTsx\r\n              class={styles.Subtitle}\r\n              key={chargedPeerId() ? 'SuggestedPosts.AgreementReached.HasBeenCharged' : 'SuggestedPosts.AgreementReached.YouHaveBeenCharged'}\r\n              args={chargedPeerId() ?\r\n                [makeEmoji('ðŸ’°'), <PeerTitleTsx peerId={chargedPeerId()} onlyFirstName limitSymbols={LIMIT_SYMBOLS} />, chargedPrice()] :\r\n                [makeEmoji('ðŸ’°'), chargedPrice()]}\r\n            />\r\n\r\n            <I18nTsx\r\n              class={styles.Subtitle}\r\n              key='SuggestedPosts.AgreementReached.WillReceive'\r\n              args={[makeEmoji('â³'), <PeerTitleTsx peerId={props.message.peerId} limitSymbols={LIMIT_SYMBOLS} />, '' + SUGGESTED_POST_WAIT_FOR_REWARD_HOURS]}\r\n            />\r\n\r\n            <I18nTsx\r\n              class={styles.Subtitle}\r\n              key='SuggestedPosts.AgreementReached.WillBeRefunded'\r\n              args={[makeEmoji('ðŸ”„'), <PeerTitleTsx peerId={props.message.peerId} limitSymbols={LIMIT_SYMBOLS} />, '' + SUGGESTED_POST_WAIT_FOR_REWARD_HOURS]}\r\n            />\r\n          </Show>\r\n        </>\r\n      }\r\n    </>;\r\n  }\r\n});\r\n\r\nexport default SuggestedPostActionContent;\r\n"],"names":["LIMIT_SYMBOLS","SuggestedPostActionContent","defineSolidElement","name","component","props","element","classList","add","styles","Container","suggestedPost","message","_","suggested_post","undefined","isChangeSuggestion","reply_to","wasPublished","action","schedule_date","Date","now","savedPeerId","saved_peer_id","getPeerId","chargedPeerId","rootScope","myId","awardedStars","price","amount","chargedPrice","_$createComponent","I18nTsx","key","args","numberThousandSplitterForStars","makeEmoji","_el$","_tmpl$","_$insert","wrapEmojiText","text","_el$2","_tmpl$2","Switch","children","Match","when","_$memo","fromPeerTitle","PeerTitleTsx","peerId","onlyFirstName","limitSymbols","pFlags","balance_too_low","rejected","_$effect","_$className","Label","Show","_el$3","_el$4","GridLabel","_el$5","GridValue","_el$6","_el$7","formatFullSentTime","Grid","_c$","reject_comment","_el$8","_tmpl$3","_el$9","firstChild","_el$11","nextSibling","Subtitle","center","_c$2","SUGGESTED_POST_WAIT_FOR_REWARD_HOURS"],"mappings":"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"}