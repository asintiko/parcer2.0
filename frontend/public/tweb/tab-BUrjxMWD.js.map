{"version":3,"file":"tab-BUrjxMWD.js","sources":["../src/components/sidebarLeft/tabs/privacy/messages/config.ts","../src/components/sidebarLeft/tabs/privacy/messages/paidSettingsSection.tsx","../src/components/sidebarLeft/tabs/privacy/messages/useSaveSettings.ts","../src/components/staticRadio.tsx","../src/components/sidebarLeft/tabs/privacy/messages/useIsPremium.tsx","../src/components/sidebarLeft/tabs/privacy/messages/optionsSection.tsx","../src/components/sidebarLeft/tabs/privacy/messages/useStateStore.ts","../src/components/sidebarLeft/tabs/privacy/messages/utils.ts","../src/components/sidebarLeft/tabs/privacy/messages/useSettings.ts","../src/components/sidebarLeft/tabs/privacy/messages/tab.tsx"],"sourcesContent":["import {InputPrivacyKey, InputPrivacyRule} from '../../../../../layer';\r\n\r\nexport enum MessagesPrivacyOption {\r\n  Everybody = 1,\r\n  ContactsAndPremium,\r\n  Paid\r\n};\r\n\r\nexport type MessagesTabStateStore = {\r\n  option?: MessagesPrivacyOption;\r\n  stars?: number;\r\n  chosenPeers?: PeerId[];\r\n};\r\n\r\nexport const privacyRulesInputKey = 'inputPrivacyKeyNoPaidMessages' satisfies InputPrivacyKey['_'];\r\n\r\nexport const defaultPrivacyRules: InputPrivacyRule[] = [\r\n  // This is set by default on the server, there's an error thrown if we try to set it ourselves\r\n  // {\r\n  //   _: 'inputPrivacyValueDisallowAll'\r\n  // },\r\n  {\r\n    _: 'inputPrivacyValueAllowContacts'\r\n  }\r\n];\r\n\r\nexport const TRANSITION_TIME = 120;\r\n","import {Component, Show} from 'solid-js';\r\nimport {SetStoreFunction} from 'solid-js/store';\r\nimport {Transition} from 'solid-transition-group';\r\n\r\nimport {i18n, join} from '../../../../../lib/langPack';\r\n\r\nimport {useSuperTab} from '../../../../solidJsTabs/superTabProvider';\r\nimport Section from '../../../../section';\r\nimport Row from '../../../../rowTsx';\r\n\r\nimport useStarsCommissionAndWithdrawalPrice from './useStarsCommissionAndWithdrawalPrice';\r\nimport {MessagesTabStateStore, TRANSITION_TIME} from './config';\r\nimport {ChosenPeersByType} from './useStateStore';\r\nimport StarRangeInput from './starsRangeInput';\r\n\r\n\r\nconst PaidSettingsSection: Component<{\r\n  store: MessagesTabStateStore;\r\n  setStore: SetStoreFunction<MessagesTabStateStore>;\r\n  chosenPeersByType: ChosenPeersByType;\r\n  isPaid: boolean;\r\n  exitAnimationPromise: Promise<any>;\r\n}> = (props) => {\r\n  const [tab, {AppAddMembersTab}] = useSuperTab();\r\n\r\n  const {commissionPercents, willReceiveDollars} = useStarsCommissionAndWithdrawalPrice(() => props.store.stars);\r\n\r\n  const onExceptionsClick = () => {\r\n    tab.slider.createTab(AppAddMembersTab).open({\r\n      type: 'privacy',\r\n      skippable: true,\r\n      title: 'PaidMessages.RemoveFee',\r\n      placeholder: 'PrivacyModal.Search.Placeholder',\r\n      takeOut: (newPeerIds) => {\r\n        props.setStore('chosenPeers', newPeerIds);\r\n      },\r\n      selectedPeerIds: [...props.store.chosenPeers]\r\n    });\r\n  };\r\n\r\n\r\n  const chosenPeersLabel = () => {\r\n    if(!props.store.chosenPeers.length) return i18n('PrivacySettingsController.AddUsers');\r\n\r\n    const {users, chats} = props.chosenPeersByType;\r\n\r\n    return join([\r\n      users.length ? i18n('Users', [users.length]) : null,\r\n      chats.length ? i18n('Chats', [chats.length]) : null\r\n    ].filter(Boolean), false);\r\n  };\r\n\r\n  return (\r\n    <Transition\r\n      onEnter={async(_el, done) => {\r\n        const el = _el as HTMLElement;\r\n        el.style.opacity = '0';\r\n        await props.exitAnimationPromise;\r\n        await el.animate({opacity: [0, 1]}, {duration: TRANSITION_TIME}).finished;\r\n        el.style.removeProperty('opacity');\r\n        done();\r\n      }}\r\n      onExit={async(el, done) => {\r\n        await el.animate({opacity: [1, 0]}, {duration: TRANSITION_TIME}).finished;\r\n        done();\r\n      }}\r\n    >\r\n      <Show when={props.isPaid}>\r\n        <div>\r\n          <Section\r\n            name=\"PaidMessages.SetPrice\"\r\n            caption=\"PaidMessages.SetPriceDescription\"\r\n            captionArgs={[\r\n              commissionPercents(),\r\n              willReceiveDollars()\r\n            ]}\r\n          >\r\n            <StarRangeInput value={props.store.stars} onChange={props.setStore.bind(null, 'stars')} />\r\n          </Section>\r\n\r\n          <Section name=\"PrivacyExceptions\" caption=\"PaidMessages.RemoveFeeDescription\">\r\n            <Row clickable={onExceptionsClick}>\r\n              <Row.Title>{i18n('PaidMessages.RemoveFee')}</Row.Title>\r\n              <Row.RightContent><span class=\"primary\">{chosenPeersLabel()}</span></Row.RightContent>\r\n            </Row>\r\n          </Section>\r\n        </div>\r\n      </Show>\r\n    </Transition>\r\n  );\r\n};\r\n\r\nexport default PaidSettingsSection;\r\n","import {Accessor} from 'solid-js';\r\n\r\nimport {GlobalPrivacySettings, InputPrivacyRule} from '../../../../../layer';\r\nimport {useHotReloadGuard} from '../../../../../lib/solidjs/hotReloadGuard';\r\nimport setBooleanFlag from '../../../../../helpers/object/setBooleanFlag';\r\nimport {logger} from '../../../../../lib/logger';\r\n\r\nimport {useSuperTab} from '../../../../solidJsTabs/superTabProvider';\r\nimport type {AppPrivacyMessagesTab} from '../../../../solidJsTabs';\r\n\r\nimport {MessagesTabStateStore, MessagesPrivacyOption, defaultPrivacyRules, privacyRulesInputKey} from './config';\r\nimport {ChosenPeersByType} from './useStateStore';\r\n\r\n\r\nconst log = logger('useSaveSettings');\r\n\r\ntype AppPrivacyMessagesTabType = typeof AppPrivacyMessagesTab;\r\n\r\ntype UseSaveSettingsArgs = {\r\n  store: MessagesTabStateStore;\r\n  globalPrivacy: Accessor<GlobalPrivacySettings>;\r\n  isPaid: Accessor<boolean>;\r\n  hasChanges: Accessor<boolean>;\r\n  chosenPeersByType: Accessor<ChosenPeersByType>;\r\n};\r\n\r\nconst useSaveSettings = ({store, globalPrivacy, isPaid, hasChanges, chosenPeersByType}: UseSaveSettingsArgs) => {\r\n  const {rootScope} = useHotReloadGuard();\r\n  const [tab] = useSuperTab<AppPrivacyMessagesTabType>();\r\n\r\n  const saveGlobalSettings = () => {\r\n    const settings = structuredClone(globalPrivacy());\r\n\r\n    settings.noncontact_peers_paid_stars = isPaid() ? store.stars : 0;\r\n\r\n    settings.pFlags ??= {};\r\n    setBooleanFlag(settings.pFlags, 'new_noncontact_peers_require_premium', store.option === MessagesPrivacyOption.ContactsAndPremium);\r\n\r\n\r\n    log('saving settings :>> ', settings);\r\n\r\n    const promise = rootScope.managers.appPrivacyManager.setGlobalPrivacySettings(settings);\r\n\r\n    tab.payload.onSaved(promise);\r\n\r\n    return promise;\r\n  };\r\n\r\n  const savePrivacyRules = async() => {\r\n    const rules: InputPrivacyRule[] = [];\r\n\r\n    const {chats, users} = chosenPeersByType();\r\n\r\n    rules.push(...defaultPrivacyRules);\r\n\r\n    if(chats.length) rules.push({\r\n      _: 'inputPrivacyValueAllowChatParticipants',\r\n      chats\r\n    });\r\n    if(users.length) rules.push({\r\n      _: 'inputPrivacyValueAllowUsers',\r\n      users: await Promise.all(users.map((id) => rootScope.managers.appUsersManager.getUserInput(id)))\r\n    });\r\n\r\n\r\n    log('saving rules :>> ', rules);\r\n\r\n    return rootScope.managers.appPrivacyManager.setPrivacy(privacyRulesInputKey, rules);\r\n  };\r\n\r\n\r\n  let isSaving = false;\r\n\r\n  const saveAllSettings = async() => {\r\n    if(isSaving || !hasChanges()) return;\r\n    isSaving = true;\r\n\r\n    try {\r\n      await Promise.all([\r\n        saveGlobalSettings(),\r\n        isPaid() ? savePrivacyRules() : undefined\r\n      ]);\r\n      tab.close();\r\n    } finally {\r\n      isSaving = false; // Idk let the user retry if it somewhy fails)\r\n    }\r\n  };\r\n\r\n  return saveAllSettings;\r\n};\r\n\r\nexport default useSaveSettings;\r\n","import {Component, splitProps, JSX} from 'solid-js';\r\n\r\nimport styles from './staticRadio.module.scss';\r\n\r\nconst StaticRadio: Component<{\r\n  checked: boolean;\r\n  floating?: boolean;\r\n  class?: string;\r\n} & JSX.HTMLAttributes<HTMLSpanElement>> = (inProps) => {\r\n  const [props, spanProps] = splitProps(inProps, ['checked', 'floating', 'class', 'classList']);\r\n\r\n  return <span\r\n    class={styles.Radio}\r\n    classList={{\r\n      [props.class]: !!props.class,\r\n      [styles.checked]: props.checked,\r\n      [styles.floating]: props.floating,\r\n      'offset-left': props.floating,\r\n      ...props.classList\r\n    }}\r\n    {...spanProps}\r\n  />;\r\n};\r\n\r\nexport default StaticRadio;\r\n","import {createSignal, onCleanup} from 'solid-js';\r\n\r\nimport {useHotReloadGuard} from '../../../../../lib/solidjs/hotReloadGuard';\r\nimport ListenerSetter from '../../../../../helpers/listenerSetter';\r\n\r\n\r\nconst useIsPremium = () => {\r\n  const {rootScope} = useHotReloadGuard();\r\n\r\n  const [isPremium, setIsPremium] = createSignal(rootScope.premium);\r\n\r\n  // (window as any).setIsPremium = setIsPremium;\r\n\r\n  const listenerSetter = new ListenerSetter();\r\n\r\n  listenerSetter.add(rootScope)('premium_toggle', (newValue) => {\r\n    setIsPremium(newValue);\r\n  });\r\n\r\n  onCleanup(() => {\r\n    listenerSetter.removeAll();\r\n  });\r\n\r\n  return isPremium;\r\n};\r\n\r\nexport default useIsPremium;\r\n","import {Component} from 'solid-js';\r\nimport {SetStoreFunction} from 'solid-js/store';\r\nimport {Transition} from 'solid-transition-group';\r\n\r\nimport {useHotReloadGuard} from '../../../../../lib/solidjs/hotReloadGuard';\r\nimport anchorCallback from '../../../../../helpers/dom/anchorCallback';\r\nimport {i18n} from '../../../../../lib/langPack';\r\n\r\nimport {hideToast, toastNew} from '../../../../toast';\r\nimport StaticRadio from '../../../../staticRadio';\r\nimport Section from '../../../../section';\r\nimport Row from '../../../../rowTsx';\r\n\r\nimport {MessagesPrivacyOption, MessagesTabStateStore, TRANSITION_TIME} from './config';\r\nimport useIsPremium from './useIsPremium';\r\n\r\n\r\nconst DEFAULT_STARS_AMOUNT = 10;\r\n\r\nconst OptionsSection: Component<{\r\n  store: MessagesTabStateStore;\r\n  setStore: SetStoreFunction<MessagesTabStateStore>;\r\n  isPaid: boolean;\r\n  onExitAnimationPromise: (promise: Promise<any>) => void;\r\n}> = (props) => {\r\n  const {PopupPremium} = useHotReloadGuard();\r\n\r\n  const isPremium = useIsPremium();\r\n\r\n\r\n  const handlePremiumOptionClick = (callback: () => void) => () => {\r\n    if(isPremium()) return callback();\r\n\r\n    toastNew({\r\n      langPackKey: 'PrivacySettings.Messages.PremiumError',\r\n      langPackArguments: [\r\n        anchorCallback(() => {\r\n          hideToast();\r\n          PopupPremium.show({\r\n            feature: 'message_privacy'\r\n          });\r\n        })\r\n      ]\r\n    });\r\n  };\r\n\r\n  const caption = (\r\n    <Transition\r\n      mode=\"outin\"\r\n      onEnter={async(el, done) => {\r\n        await el.animate({opacity: [0, 1]}, {duration: TRANSITION_TIME}).finished;\r\n        done();\r\n      }}\r\n      onExit={async(el, done) => {\r\n        const promise = el.animate({opacity: [1, 0]}, {duration: TRANSITION_TIME}).finished;\r\n        props.onExitAnimationPromise(promise);\r\n        await promise;\r\n        done();\r\n      }}\r\n    >\r\n      {\r\n        !props.isPaid ?\r\n          i18n('Privacy.MessagesInfo', [anchorCallback(() => void PopupPremium.show())]) :\r\n          i18n('PaidMessages.ChargeForMessagesDescription')\r\n      }\r\n    </Transition>\r\n  );\r\n\r\n  return (\r\n    <Section\r\n      name=\"PrivacyMessagesTitle\"\r\n      caption={caption as any}\r\n    >\r\n      <Row\r\n        clickable={() => {\r\n          props.setStore('option', MessagesPrivacyOption.Everybody);\r\n        }}\r\n      >\r\n        <Row.CheckboxField>\r\n          <StaticRadio\r\n            floating\r\n            checked={props.store.option === MessagesPrivacyOption.Everybody}\r\n          />\r\n        </Row.CheckboxField>\r\n        <Row.Title>{i18n('PrivacySettingsController.Everbody')}</Row.Title>\r\n      </Row>\r\n      <Row\r\n        clickable={handlePremiumOptionClick(() => {\r\n          props.setStore('option', MessagesPrivacyOption.ContactsAndPremium);\r\n        })}\r\n      >\r\n        {isPremium() && (\r\n          <Row.CheckboxField>\r\n            <StaticRadio\r\n              floating\r\n              checked={props.store.option === MessagesPrivacyOption.ContactsAndPremium}\r\n            />\r\n          </Row.CheckboxField>\r\n        )}\r\n        {!isPremium() && <Row.Icon icon=\"premium_lock\" />}\r\n        <Row.Title>{i18n('Privacy.ContactsAndPremium')}</Row.Title>\r\n      </Row>\r\n      <Row\r\n        clickable={handlePremiumOptionClick(() => {\r\n          props.setStore(prev => ({\r\n            option: MessagesPrivacyOption.Paid,\r\n            stars: prev.stars || DEFAULT_STARS_AMOUNT\r\n          }));\r\n        })}\r\n      >\r\n        {isPremium() && (\r\n          <Row.CheckboxField>\r\n            <StaticRadio floating checked={props.isPaid} />\r\n          </Row.CheckboxField>\r\n        )}\r\n        {!isPremium() && <Row.Icon icon=\"premium_lock\" />}\r\n        <Row.Title>{i18n('PaidMessages.ChargeForMessages')}</Row.Title>\r\n      </Row>\r\n    </Section>\r\n  );\r\n};\r\n\r\nexport default OptionsSection;\r\n","import {Accessor, createComputed, createSignal, createEffect, createMemo} from 'solid-js';\r\nimport {createStore, reconcile} from 'solid-js/store';\r\n\r\nimport throttle from '../../../../../helpers/schedulers/throttle';\r\nimport deepEqual from '../../../../../helpers/object/deepEqual';\r\nimport {GlobalPrivacySettings} from '../../../../../layer';\r\n\r\nimport {MessagesPrivacyOption, MessagesTabStateStore} from './config';\r\n\r\n\r\ntype UseStateStoreArgs = {\r\n  isReady: Accessor<boolean>;\r\n  globalPrivacy: Accessor<GlobalPrivacySettings>;\r\n  currentOption: Accessor<MessagesPrivacyOption>;\r\n  currentAllowedUsers: Accessor<PeerId[]>;\r\n  currentAllowedChats: Accessor<PeerId[]>;\r\n};\r\n\r\nexport type ChosenPeersByType = {\r\n  chats: (string | number)[];\r\n  users: PeerId[];\r\n};\r\n\r\nconst useStateStore = ({\r\n  isReady,\r\n  globalPrivacy,\r\n  currentOption, currentAllowedChats, currentAllowedUsers\r\n}: UseStateStoreArgs) => {\r\n  let initialState: MessagesTabStateStore = {};\r\n  const [store, setStore] = createStore<MessagesTabStateStore>({});\r\n\r\n  createComputed(() => {\r\n    if(!isReady()) return;\r\n\r\n    initialState = {\r\n      option: currentOption(),\r\n      stars: Number(globalPrivacy().noncontact_peers_paid_stars) || undefined,\r\n      chosenPeers: [...currentAllowedUsers(), ...currentAllowedChats()]\r\n    };\r\n\r\n    setStore(reconcile(structuredClone(initialState)));\r\n  });\r\n\r\n\r\n  const [hasChanges, setHasChanges] = createSignal(false);\r\n  const throttledSetHasChanges = throttle(setHasChanges, 200, true);\r\n\r\n  // The header is jerking if updating the hasChanges too quickly WTF\r\n  createEffect(() => {\r\n    const ignoreKeys: (keyof MessagesTabStateStore)[] = !!!isPaid() ? ['chosenPeers', 'stars'] : [];\r\n\r\n    throttledSetHasChanges(!deepEqual(store, initialState, ignoreKeys));\r\n  });\r\n\r\n\r\n  const isPaid = createMemo(() => store.option === MessagesPrivacyOption.Paid);\r\n\r\n  const chosenPeersByType = (): ChosenPeersByType => ({\r\n    chats: store.chosenPeers.filter(peer => peer.isAnyChat()).map(peer => peer.toChatId()),\r\n    users: store.chosenPeers.filter(peer => peer.isUser())\r\n  });\r\n\r\n\r\n  return [\r\n    store,\r\n    setStore,\r\n    {hasChanges, isPaid, chosenPeersByType}\r\n  ] as const;\r\n};\r\n\r\n\r\nexport default useStateStore;\r\n","import {InputUser} from '../../../../../layer';\r\n\r\n// Note: after saving privacy rules, the cached users are objects instead of being numbers\r\nexport const getUserId = (user: InputUser.inputUser | string | number) => {\r\n  if(user instanceof Object) return user.user_id?.toPeerId(true);\r\n  return user.toPeerId(true);\r\n};\r\n","import {createResource} from 'solid-js';\r\n\r\nimport {useHotReloadGuard} from '../../../../../lib/solidjs/hotReloadGuard';\r\n\r\nimport {usePromiseCollector} from '../../../../solidJsTabs/promiseCollector';\r\n\r\nimport {privacyRulesInputKey, MessagesPrivacyOption} from './config';\r\nimport useIsPremium from './useIsPremium';\r\nimport {getUserId} from './utils';\r\n\r\n\r\nconst useSettings = () => {\r\n  const {rootScope} = useHotReloadGuard();\r\n  const promiseCollector = usePromiseCollector();\r\n\r\n  const isPremium = useIsPremium();\r\n\r\n\r\n  const [privacyRules] = createResource(() => {\r\n    const promise = rootScope.managers.appPrivacyManager.getPrivacy(privacyRulesInputKey);\r\n    promiseCollector.collect(promise);\r\n    return promise;\r\n  });\r\n\r\n  const [globalPrivacy] = createResource(() => {\r\n    const promise = rootScope.managers.appPrivacyManager.getGlobalPrivacySettings();\r\n    promiseCollector.collect(promise);\r\n    return promise;\r\n  });\r\n\r\n\r\n  const isReady = () => privacyRules.state === 'ready' && globalPrivacy.state === 'ready';\r\n\r\n  const currentOption = () => {\r\n    if(!isPremium()) return MessagesPrivacyOption.Everybody;\r\n\r\n    if(globalPrivacy().noncontact_peers_paid_stars) return MessagesPrivacyOption.Paid;\r\n\r\n    if(globalPrivacy().pFlags.new_noncontact_peers_require_premium) return MessagesPrivacyOption.ContactsAndPremium;\r\n\r\n    return MessagesPrivacyOption.Everybody;\r\n  };\r\n\r\n  const currentAllowedUsers = () =>\r\n    privacyRules()\r\n    ?.filter((rule) => rule._ === 'privacyValueAllowUsers')\r\n    ?.map(rule => rule?.users).flat()\r\n    ?.map(user => user.toPeerId()) || [];\r\n\r\n  const currentAllowedChats = () =>\r\n    privacyRules()\r\n    ?.find((rule) => rule._ === 'privacyValueAllowChatParticipants')?.chats\r\n    ?.map(getUserId)\r\n    ?.filter((v) => v !== undefined) || [];\r\n\r\n\r\n  return {\r\n    isReady,\r\n\r\n    globalPrivacy,\r\n    privacyRules,\r\n\r\n    currentOption,\r\n    currentAllowedUsers,\r\n    currentAllowedChats\r\n  };\r\n};\r\n\r\nexport default useSettings;\r\n","import {createEffect, createSignal, Show} from 'solid-js';\r\nimport {Portal} from 'solid-js/web';\r\n\r\nimport {logger} from '../../../../../lib/logger';\r\nimport DEBUG from '../../../../../config/debug';\r\n\r\nimport {useSuperTab} from '../../../../solidJsTabs/superTabProvider';\r\nimport {IconTsx} from '../../../../iconTsx';\r\n\r\nimport useIsConfirmationNeededOnClose from './useIsConfirmationNeededOnClose';\r\nimport AppearZoomTransition from './appearZoomTransition';\r\nimport PaidSettingsSection from './paidSettingsSection';\r\nimport useSaveSettings from './useSaveSettings';\r\nimport OptionsSection from './optionsSection';\r\nimport useStateStore from './useStateStore';\r\nimport useSettings from './useSettings';\r\nimport SaveButton from './saveButton';\r\n\r\n\r\nconst log = logger('MessagesPrivacyTab');\r\n\r\n\r\nconst MessagesTab = () => {\r\n  const [tab] = useSuperTab();\r\n\r\n  const {\r\n    isReady,\r\n    globalPrivacy, privacyRules,\r\n    currentOption, currentAllowedUsers, currentAllowedChats\r\n  } = useSettings();\r\n\r\n  const [store, setStore, {isPaid, hasChanges, chosenPeersByType}] = useStateStore({\r\n    isReady,\r\n    globalPrivacy,\r\n    currentOption, currentAllowedChats, currentAllowedUsers\r\n  });\r\n\r\n  const saveAllSettings = useSaveSettings({\r\n    store,\r\n    globalPrivacy,\r\n    isPaid,\r\n    hasChanges,\r\n    chosenPeersByType\r\n  });\r\n\r\n  tab.isConfirmationNeededOnClose = useIsConfirmationNeededOnClose({hasChanges, saveAllSettings, descriptionLangKey: 'UnsavedChangesDescription.Privacy'});\r\n\r\n\r\n  const [exitAnimationPromise, setExitAnimationPromise] = createSignal<Promise<any>>();\r\n\r\n  if(DEBUG) createEffect(() => {\r\n    log('privacyRules() :>> ', privacyRules());\r\n    log('globalPrivacy() :>> ', globalPrivacy());\r\n  });\r\n\r\n\r\n  return (\r\n    <Show when={isReady()}>\r\n      <Portal mount={tab.header}>\r\n        <SaveButton hasChanges={hasChanges()} onClick={() => void saveAllSettings()} />\r\n      </Portal>\r\n\r\n      <OptionsSection\r\n        isPaid={isPaid()}\r\n        store={store}\r\n        setStore={setStore}\r\n        onExitAnimationPromise={setExitAnimationPromise}\r\n      />\r\n\r\n      <PaidSettingsSection\r\n        isPaid={isPaid()}\r\n        store={store}\r\n        setStore={setStore}\r\n        chosenPeersByType={chosenPeersByType()}\r\n        exitAnimationPromise={exitAnimationPromise()}\r\n      />\r\n    </Show>\r\n  );\r\n};\r\n\r\nexport default MessagesTab;\r\n"],"names":["MessagesPrivacyOption","MessagesPrivacyOption2","privacyRulesInputKey","defaultPrivacyRules","TRANSITION_TIME","PaidSettingsSection","props","tab","AppAddMembersTab","useSuperTab","commissionPercents","willReceiveDollars","useStarsCommissionAndWithdrawalPrice","store","stars","onExceptionsClick","slider","createTab","open","type","skippable","title","placeholder","takeOut","newPeerIds","setStore","selectedPeerIds","chosenPeers","chosenPeersLabel","length","i18n","users","chats","chosenPeersByType","join","filter","Boolean","_$createComponent","Transition","onEnter","_el","done","el","style","opacity","exitAnimationPromise","animate","duration","finished","removeProperty","onExit","children","Show","when","isPaid","_el$","_tmpl$2","_$insert","Section","name","caption","captionArgs","StarRangeInput","value","onChange","bind","Row","clickable","Title","RightContent","_el$2","_tmpl$","log","logger","useSaveSettings","globalPrivacy","hasChanges","rootScope","useHotReloadGuard","saveGlobalSettings","settings","setBooleanFlag","promise","savePrivacyRules","rules","id","isSaving","StaticRadio","inProps","spanProps","splitProps","_$spread","_$mergeProps","styles","Radio","classList","class","checked","floating","useIsPremium","isPremium","setIsPremium","createSignal","premium","listenerSetter","ListenerSetter","add","newValue","onCleanup","removeAll","DEFAULT_STARS_AMOUNT","OptionsSection","PopupPremium","handlePremiumOptionClick","callback","toastNew","langPackKey","langPackArguments","anchorCallback","hideToast","show","feature","mode","onExitAnimationPromise","_$memo","Everybody","CheckboxField","option","ContactsAndPremium","Icon","icon","prev","Paid","useStateStore","isReady","currentOption","currentAllowedChats","currentAllowedUsers","initialState","createStore","createComputed","reconcile","setHasChanges","throttledSetHasChanges","throttle","createEffect","ignoreKeys","deepEqual","createMemo","peer","getUserId","user","useSettings","promiseCollector","usePromiseCollector","privacyRules","createResource","rule","v","MessagesTab","saveAllSettings","isConfirmationNeededOnClose","useIsConfirmationNeededOnClose","descriptionLangKey","setExitAnimationPromise","DEBUG","Portal","mount","header","SaveButton","onClick"],"mappings":"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"}