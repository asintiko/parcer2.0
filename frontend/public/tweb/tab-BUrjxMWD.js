import{b as r,a5 as x,i as _,k as y,t as k,bd as L,bx as F,dI as S,bO as O,bi as K,a0 as V,c as R,a3 as G,bs as q,a9 as P,aS as H,c0 as j,aU as Q,ag as W,ah as B,c7 as z,aQ as J,af as E,bv as X,ab as Y}from"./index-DNvt0VUm.js";import{I as T,T as w,R as m,V as Z,K as ee}from"./appDialogsManager-JE2O85JE.js";import{u as te,S as re}from"./saveButton-lC1v9m6O.js";import{T as N}from"./transition-qPC8kRQm.js";import{u as se}from"./useStarsCommissionAndWithdrawalPrice-D8xWpwu8.js";import{S as ne}from"./starsRangeInput-Der-4lvr.js";import{a as I}from"./wrapDuration-DnGWRe13.js";import{t as ae,h as oe}from"./toast-CMapwa_u.js";import"./page-S-X_ggs-.js";import"./putPreloader-DLTVOHHP.js";import"./countryInputField-b3Xa2lwJ.js";import"./classNames-CN4lTu6a.js";import"./htmlToSpan-DhAls8qz.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./iconTsx-DxfvgGPs.js";import"./fastBlur-Co-79rP4.js";import"./emailSetup-Cy3zqLGq.js";import"./scrollable2-Brn4mNam.js";import"./avatar-B1UK_utf.js";import"./chatBackground-BpQJw_LL.js";import"./tracking-vNsAFP5Y.js";import"./useAppConfig-BpTjhdEP.js";var p=(e=>(e[e.Everybody=1]="Everybody",e[e.ContactsAndPremium=2]="ContactsAndPremium",e[e.Paid=3]="Paid",e))(p||{});const $="inputPrivacyKeyNoPaidMessages",ie=[{_:"inputPrivacyValueAllowContacts"}],f=120,ce=k("<span class=primary>"),le=k("<div>"),ue=e=>{const[n,{AppAddMembersTab:a}]=T(),{commissionPercents:o,willReceiveDollars:d}=se(()=>e.store.stars),i=()=>{n.slider.createTab(a).open({type:"privacy",skippable:!0,title:"PaidMessages.RemoveFee",placeholder:"PrivacyModal.Search.Placeholder",takeOut:s=>{e.setStore("chosenPeers",s)},selectedPeerIds:[...e.store.chosenPeers]})},l=()=>{if(!e.store.chosenPeers.length)return y("PrivacySettingsController.AddUsers");const{users:s,chats:u}=e.chosenPeersByType;return L([s.length?y("Users",[s.length]):null,u.length?y("Chats",[u.length]):null].filter(Boolean),!1)};return r(N,{onEnter:async(s,u)=>{const t=s;t.style.opacity="0",await e.exitAnimationPromise,await t.animate({opacity:[0,1]},{duration:f}).finished,t.style.removeProperty("opacity"),u()},onExit:async(s,u)=>{await s.animate({opacity:[1,0]},{duration:f}).finished,u()},get children(){return r(x,{get when(){return e.isPaid},get children(){const s=le();return _(s,r(w,{name:"PaidMessages.SetPrice",caption:"PaidMessages.SetPriceDescription",get captionArgs(){return[o(),d()]},get children(){return r(ne,{get value(){return e.store.stars},get onChange(){return e.setStore.bind(null,"stars")}})}}),null),_(s,r(w,{name:"PrivacyExceptions",caption:"PaidMessages.RemoveFeeDescription",get children(){return r(m,{clickable:i,get children(){return[r(m.Title,{get children(){return y("PaidMessages.RemoveFee")}}),r(m.RightContent,{get children(){const u=ce();return _(u,l),u}})]}})}}),null),s}})}})},M=F("useSaveSettings"),de=({store:e,globalPrivacy:n,isPaid:a,hasChanges:o,chosenPeersByType:d})=>{const{rootScope:i}=S(),[l]=T(),s=()=>{const c=structuredClone(n());c.noncontact_peers_paid_stars=a()?e.stars:0,c.pFlags??(c.pFlags={}),Z(c.pFlags,"new_noncontact_peers_require_premium",e.option===p.ContactsAndPremium),M("saving settings :>> ",c);const h=i.managers.appPrivacyManager.setGlobalPrivacySettings(c);return l.payload.onSaved(h),h},u=async()=>{const c=[],{chats:h,users:g}=d();return c.push(...ie),h.length&&c.push({_:"inputPrivacyValueAllowChatParticipants",chats:h}),g.length&&c.push({_:"inputPrivacyValueAllowUsers",users:await Promise.all(g.map(C=>i.managers.appUsersManager.getUserInput(C)))}),M("saving rules :>> ",c),i.managers.appPrivacyManager.setPrivacy($,c)};let t=!1;return async()=>{if(!(t||!o())){t=!0;try{await Promise.all([s(),a()?u():void 0]),l.close()}finally{t=!1}}}},me="_Radio_8rde5_36",ge="_floating_8rde5_62",pe="_checked_8rde5_66",b={Radio:me,floating:ge,checked:pe},he=k("<span>"),A=e=>{const[n,a]=O(e,["checked","floating","class","classList"]);return(()=>{const o=he();return K(o,V({get class(){return b.Radio},get classList(){return{[n.class]:!!n.class,[b.checked]:n.checked,[b.floating]:n.floating,"offset-left":n.floating,...n.classList}}},a),!1,!1),o})()},D=()=>{const{rootScope:e}=S(),[n,a]=R(e.premium),o=new q;return o.add(e)("premium_toggle",d=>{a(d)}),G(()=>{o.removeAll()}),n},Pe=10,ye=e=>{const{PopupPremium:n}=S(),a=D(),o=i=>()=>{if(a())return i();ae({langPackKey:"PrivacySettings.Messages.PremiumError",langPackArguments:[I(()=>{oe(),n.show({feature:"message_privacy"})})]})},d=r(N,{mode:"outin",onEnter:async(i,l)=>{await i.animate({opacity:[0,1]},{duration:f}).finished,l()},onExit:async(i,l)=>{const s=i.animate({opacity:[1,0]},{duration:f}).finished;e.onExitAnimationPromise(s),await s,l()},get children(){return P(()=>!e.isPaid)()?y("Privacy.MessagesInfo",[I(()=>void n.show())]):y("PaidMessages.ChargeForMessagesDescription")}});return r(w,{name:"PrivacyMessagesTitle",caption:d,get children(){return[r(m,{clickable:()=>{e.setStore("option",p.Everybody)},get children(){return[r(m.CheckboxField,{get children(){return r(A,{floating:!0,get checked(){return e.store.option===p.Everybody}})}}),r(m.Title,{get children(){return y("PrivacySettingsController.Everbody")}})]}}),r(m,{get clickable(){return o(()=>{e.setStore("option",p.ContactsAndPremium)})},get children(){return[P(()=>P(()=>!!a())()&&r(m.CheckboxField,{get children(){return r(A,{floating:!0,get checked(){return e.store.option===p.ContactsAndPremium}})}})),P(()=>P(()=>!a())()&&r(m.Icon,{icon:"premium_lock"})),r(m.Title,{get children(){return y("Privacy.ContactsAndPremium")}})]}}),r(m,{get clickable(){return o(()=>{e.setStore(i=>({option:p.Paid,stars:i.stars||Pe}))})},get children(){return[P(()=>P(()=>!!a())()&&r(m.CheckboxField,{get children(){return r(A,{floating:!0,get checked(){return e.isPaid}})}})),P(()=>P(()=>!a())()&&r(m.Icon,{icon:"premium_lock"})),r(m.Title,{get children(){return y("PaidMessages.ChargeForMessages")}})]}})]}})},ve=({isReady:e,globalPrivacy:n,currentOption:a,currentAllowedChats:o,currentAllowedUsers:d})=>{let i={};const[l,s]=H({});j(()=>{e()&&(i={option:a(),stars:Number(n().noncontact_peers_paid_stars)||void 0,chosenPeers:[...d(),...o()]},s(Q(structuredClone(i))))});const[u,t]=R(!1),v=W(t,200,!0);B(()=>{const g=c()?[]:["chosenPeers","stars"];v(!z(l,i,g))});const c=J(()=>l.option===p.Paid);return[l,s,{hasChanges:u,isPaid:c,chosenPeersByType:()=>({chats:l.chosenPeers.filter(g=>g.isAnyChat()).map(g=>g.toChatId()),users:l.chosenPeers.filter(g=>g.isUser())})}]},fe=e=>e instanceof Object?e.user_id?.toPeerId(!0):e.toPeerId(!0),Se=()=>{const{rootScope:e}=S(),n=ee(),a=D(),[o]=E(()=>{const t=e.managers.appPrivacyManager.getPrivacy($);return n.collect(t),t}),[d]=E(()=>{const t=e.managers.appPrivacyManager.getGlobalPrivacySettings();return n.collect(t),t});return{isReady:()=>o.state==="ready"&&d.state==="ready",globalPrivacy:d,privacyRules:o,currentOption:()=>a()?d().noncontact_peers_paid_stars?p.Paid:d().pFlags.new_noncontact_peers_require_premium?p.ContactsAndPremium:p.Everybody:p.Everybody,currentAllowedUsers:()=>o()?.filter(t=>t._==="privacyValueAllowUsers")?.map(t=>t?.users).flat()?.map(t=>t.toPeerId())||[],currentAllowedChats:()=>o()?.find(t=>t._==="privacyValueAllowChatParticipants")?.chats?.map(fe)?.filter(t=>t!==void 0)||[]}},U=F("MessagesPrivacyTab"),Ge=()=>{const[e]=T(),{isReady:n,globalPrivacy:a,privacyRules:o,currentOption:d,currentAllowedUsers:i,currentAllowedChats:l}=Se(),[s,u,{isPaid:t,hasChanges:v,chosenPeersByType:c}]=ve({isReady:n,globalPrivacy:a,currentOption:d,currentAllowedChats:l,currentAllowedUsers:i}),h=de({store:s,globalPrivacy:a,isPaid:t,hasChanges:v,chosenPeersByType:c});e.isConfirmationNeededOnClose=te({hasChanges:v,saveAllSettings:h,descriptionLangKey:"UnsavedChangesDescription.Privacy"});const[g,C]=R();return X&&B(()=>{U("privacyRules() :>> ",o()),U("globalPrivacy() :>> ",a())}),r(x,{get when(){return n()},get children(){return[r(Y,{get mount(){return e.header},get children(){return r(re,{get hasChanges(){return v()},onClick:()=>void h()})}}),r(ye,{get isPaid(){return t()},store:s,setStore:u,onExitAnimationPromise:C}),r(ue,{get isPaid(){return t()},store:s,setStore:u,get chosenPeersByType(){return c()},get exitAnimationPromise(){return g()}})]}})};export{Ge as default};
//# sourceMappingURL=tab-BUrjxMWD.js.map
