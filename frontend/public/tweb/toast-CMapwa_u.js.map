{"version":3,"file":"toast-CMapwa_u.js","sources":["../src/helpers/fixBase64String.ts","../src/helpers/bytes/bytesCmp.ts","../src/helpers/textToSvgURL.ts","../src/environment/webAuthn.ts","../src/helpers/string/base64ToBytes.ts","../src/lib/appManagers/utils/account/getInputPasskeyResponse.ts","../src/helpers/overlayClickHandler.ts","../src/components/toast.ts"],"sourcesContent":["export default function fixBase64String(str: string, toUrl: boolean) {\r\n  if(toUrl) {\r\n    return str.replace(/\\+/g, '-').replace(/\\//g, '_').replace(/\\=+$/, '');\r\n  } else {\r\n    return str.replace(/-/g, '+').replace(/_/g, '/');\r\n  }\r\n}\r\n","export default function bytesCmp(bytes1: number[] | Uint8Array, bytes2: number[] | Uint8Array) {\r\n  const len = bytes1.length;\r\n  if(len !== bytes2.length) {\r\n    return false;\r\n  }\r\n\r\n  for(let i = 0; i < len; ++i) {\r\n    if(bytes1[i] !== bytes2[i]) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n","export default function textToSvgURL(text: string) {\r\n  const blob = new Blob([text], {type: 'image/svg+xml;charset=utf-8'});\r\n\r\n  // * because iOS Safari doesn't want to eat objectURL\r\n  return new Promise<string>((resolve) => {\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      resolve(e.target.result as string);\r\n    };\r\n    reader.readAsDataURL(blob);\r\n  });\r\n  // return URL.createObjectURL(blob);\r\n}\r\n","const IS_WEB_AUTHN_SUPPORTED = navigator.credentials &&\r\n  typeof(PublicKeyCredential) !== 'undefined' &&\r\n  'parseCreationOptionsFromJSON' in PublicKeyCredential;\r\n\r\nexport default IS_WEB_AUTHN_SUPPORTED;\r\n","import {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport fixBase64String from '../fixBase64String';\r\n\r\nexport default function base64ToBytes(base64: string) {\r\n  const bytesStr = atob(fixBase64String(base64, false));\r\n  const bytes = new Uint8Array(bytesStr.length);\r\n  for(let i = 0, length = bytes.length; i < length; ++i) {\r\n    bytes[i] = bytesStr[i].charCodeAt(0);\r\n  }\r\n\r\n  return bytes;\r\n}\r\n\r\nMOUNT_CLASS_TO.base64ToBytes = base64ToBytes;\r\n","import base64ToBytes from '../../../../helpers/string/base64ToBytes';\r\nimport {InputPasskeyCredential, InputPasskeyResponse} from '../../../../layer';\r\n\r\nexport default function getInputPasskey(credential: PublicKeyCredential): InputPasskeyResponse {\r\n  const json: PublicKeyCredentialJSON = credential.toJSON();\r\n  const clientData = atob(json.response.clientDataJSON);\r\n  let ret: InputPasskeyResponse;\r\n  if(json.response.attestationObject) {\r\n    ret = {\r\n      _: 'inputPasskeyResponseRegister',\r\n      client_data: {_: 'dataJSON', data: clientData},\r\n      attestation_data: base64ToBytes(json.response.attestationObject)\r\n    };\r\n  } else {\r\n    ret = {\r\n      _: 'inputPasskeyResponseLogin',\r\n      client_data: {_: 'dataJSON', data: clientData},\r\n      authenticator_data: base64ToBytes(json.response.authenticatorData),\r\n      signature: base64ToBytes(json.response.signature),\r\n      user_handle: atob(json.response.userHandle)\r\n    };\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function getInputPasskeyCredential(credential: PublicKeyCredential): InputPasskeyCredential {\r\n  const response = getInputPasskey(credential);\r\n  const json = credential.toJSON();\r\n  return {\r\n    _: 'inputPasskeyCredentialPublicKey',\r\n    id: json.id,\r\n    raw_id: json.rawId,\r\n    response\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appNavigationController, {NavigationItem} from '../components/appNavigationController';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport {IS_MOBILE_SAFARI} from '../environment/userAgent';\r\nimport cancelEvent from './dom/cancelEvent';\r\nimport {CLICK_EVENT_NAME, hasMouseMovedSinceDown} from './dom/clickEvent';\r\nimport findUpAsChild from './dom/findUpAsChild';\r\nimport EventListenerBase from './eventListenerBase';\r\n\r\nexport default class OverlayClickHandler extends EventListenerBase<{\r\n  toggle: (open: boolean) => void\r\n}> {\r\n  protected element: HTMLElement;\r\n  protected overlay: HTMLElement;\r\n  protected listenerOptions: AddEventListenerOptions;\r\n\r\n  constructor(\r\n    protected navigationType?: NavigationItem['type'],\r\n    protected withOverlay?: boolean\r\n  ) {\r\n    super(false);\r\n    this.listenerOptions = withOverlay ? {} : {capture: true};\r\n  }\r\n\r\n  protected onClick = (e: MouseEvent | TouchEvent) => {\r\n    if(hasMouseMovedSinceDown(e)) {\r\n      return;\r\n    }\r\n\r\n    if(this.element) {\r\n      const isRoot = this.element === document.body;\r\n      if(!isRoot && findUpAsChild(e.target as HTMLElement, this.element)) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(this.listenerOptions?.capture) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    this.close();\r\n  };\r\n\r\n  public close() {\r\n    if(this.element) {\r\n      this.overlay?.remove();\r\n      this.element = undefined;\r\n      this.dispatchEvent('toggle', false);\r\n    }\r\n\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      // window.removeEventListener('keydown', onKeyDown, {capture: true});\r\n      window.removeEventListener('contextmenu', this.onClick, this.listenerOptions);\r\n    }\r\n\r\n    document.removeEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\r\n\r\n    if(!IS_MOBILE_SAFARI && this.navigationType) {\r\n      appNavigationController.removeByType(this.navigationType);\r\n    }\r\n  }\r\n\r\n  public open(element = document.body) {\r\n    this.close();\r\n\r\n    if(!IS_MOBILE_SAFARI && this.navigationType) {\r\n      appNavigationController.pushItem({\r\n        type: this.navigationType,\r\n        onPop: (canAnimate) => {\r\n          this.close();\r\n        }\r\n      });\r\n    }\r\n\r\n    this.element = element;\r\n\r\n    if(!this.overlay && this.withOverlay) {\r\n      this.overlay = document.createElement('div');\r\n      this.overlay.classList.add('btn-menu-overlay');\r\n\r\n      // ! because this event must be canceled, and can't cancel on menu click (below)\r\n      this.overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\r\n        cancelEvent(e);\r\n        this.onClick(e);\r\n      });\r\n    }\r\n\r\n    const isRoot = this.element === document.body;\r\n    if(this.overlay) {\r\n      if(isRoot) {\r\n        this.element.append(this.overlay);\r\n      } else {\r\n        this.element.parentElement.insertBefore(this.overlay, this.element);\r\n      }\r\n    }\r\n\r\n    // document.body.classList.add('disable-hover');\r\n\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      // window.addEventListener('keydown', onKeyDown, {capture: true});\r\n      window.addEventListener('contextmenu', this.onClick, {...this.listenerOptions, once: true});\r\n    }\r\n\r\n    /* // ! because this event must be canceled, and can't cancel on menu click (below)\r\n    overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\r\n      cancelEvent(e);\r\n      onClick(e);\r\n    }); */\r\n\r\n    // ! safari iOS doesn't handle window click event on overlay, idk why\r\n    document.addEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\r\n\r\n    this.dispatchEvent('toggle', true);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport OverlayClickHandler from '../helpers/overlayClickHandler';\r\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\r\n\r\nconst toastsContainer = document.createElement('div');\r\ntoastsContainer.classList.add('toasts-container');\r\n\r\nconst toastEl = document.createElement('div');\r\ntoastEl.classList.add('toast');\r\nlet timeout: number;\r\n\r\nconst x = new OverlayClickHandler('toast');\r\nx.addEventListener('toggle', (open) => {\r\n  if(!open) {\r\n    hideToast();\r\n  }\r\n});\r\n\r\nexport function hideToast() {\r\n  x.close();\r\n\r\n  toastEl.classList.remove('is-visible');\r\n  timeout && clearTimeout(+timeout);\r\n\r\n  timeout = window.setTimeout(() => {\r\n    toastEl.remove();\r\n    timeout = undefined;\r\n  }, 200);\r\n}\r\n\r\nexport function toast(content: string | Node, onClose?: () => void) {\r\n  x.close();\r\n\r\n  replaceContent(toastEl, content);\r\n\r\n  if(!toastEl.parentElement) {\r\n    if(!toastsContainer.parentNode) {\r\n      document.body.append(toastsContainer);\r\n    }\r\n\r\n    toastsContainer.append(toastEl);\r\n    void toastEl.offsetLeft; // reflow\r\n  }\r\n\r\n  toastEl.classList.add('is-visible');\r\n\r\n  timeout && clearTimeout(+timeout);\r\n  x.open(toastEl);\r\n\r\n  timeout = window.setTimeout(hideToast, 3000);\r\n\r\n  if(onClose) {\r\n    x.addEventListener('toggle', onClose, {once: true});\r\n  }\r\n}\r\n\r\nexport function toastNew(options: Partial<{\r\n  langPackKey: LangPackKey,\r\n  langPackArguments: FormatterArguments,\r\n  onClose: () => void\r\n}>) {\r\n  toast(i18n(options.langPackKey, options.langPackArguments), options.onClose);\r\n}\r\n"],"names":["fixBase64String","str","toUrl","bytesCmp","bytes1","bytes2","len","i","textToSvgURL","text","blob","resolve","reader","e","IS_WEB_AUTHN_SUPPORTED","base64ToBytes","base64","bytesStr","bytes","length","MOUNT_CLASS_TO","getInputPasskey","credential","json","clientData","ret","getInputPasskeyCredential","response","OverlayClickHandler","EventListenerBase","navigationType","withOverlay","hasMouseMovedSinceDown","findUpAsChild","cancelEvent","IS_TOUCH_SUPPORTED","CLICK_EVENT_NAME","IS_MOBILE_SAFARI","appNavigationController","element","canAnimate","isRoot","toastsContainer","toastEl","timeout","x","open","hideToast","toast","content","onClose","replaceContent","toastNew","options","i18n"],"mappings":"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"}