{"version":3,"file":"passkeys-Ww4gRw3T.js","sources":["../src/components/sidebarLeft/tabs/passkeys.tsx"],"sourcesContent":["import Section from '../../section';\r\nimport {useSuperTab} from '../../solidJsTabs/superTabProvider';\r\nimport type {AppPasskeysTab} from '../../solidJsTabs';\r\nimport anchorCallback from '../../../helpers/dom/anchorCallback';\r\nimport StickerAndTitle from '../../stickerAndTitle';\r\nimport {createEffect, createSignal, For, Show} from 'solid-js';\r\nimport {formatFullSentTime} from '../../../helpers/date';\r\nimport createMiddleware from '../../../helpers/solid/createMiddleware';\r\nimport styles from './passkeys.module.scss';\r\nimport {Passkey} from '../../../layer';\r\nimport showPasskeyPopup, {createPasskey} from '../../popups/passkey';\r\nimport IS_WEB_AUTHN_SUPPORTED from '../../../environment/webAuthn';\r\nimport Button from '../../buttonTsx';\r\nimport {useHotReloadGuard} from '../../../lib/solidjs/hotReloadGuard';\r\nimport findAndSplice from '../../../helpers/array/findAndSplice';\r\nimport {useAppConfig} from '../../../stores/appState';\r\n\r\ntype AppPasskeysTabClass = typeof AppPasskeysTab;\r\n\r\nconst PasskeyItem = (passkey: Passkey) => {\r\n  const [tab] = useSuperTab<AppPasskeysTabClass>();\r\n  const {rootScope, wrapEmojiText, wrapAdaptiveCustomEmoji, Row, i18n, confirmationPopup, formatDate} = useHotReloadGuard();\r\n  const [disabled, setDisabled] = createSignal(false);\r\n  const subtitle = () => {\r\n    const created = i18n('Privacy.Passkey.Created', [formatDate(new Date(passkey.date * 1000), {withTime: true})]);\r\n    if(!passkey.last_usage_date) return created;\r\n    const lastUsed = i18n('Privacy.Passkey.LastUsage', [formatDate(new Date(passkey.last_usage_date * 1000), {withTime: true})]);\r\n    return [created, ' â€¢ ', lastUsed];\r\n  };\r\n  return (\r\n    <Row\r\n      disabled={disabled()}\r\n      contextMenu={{\r\n        buttons: [{\r\n          icon: 'delete',\r\n          text: 'Delete',\r\n          onClick: async() => {\r\n            await confirmationPopup({\r\n              titleLangKey: 'Passkey.Deletion.Title',\r\n              descriptionLangKey: 'Passkey.Deletion.Text',\r\n              button: {\r\n                langKey: 'Delete',\r\n                isDanger: true\r\n              }\r\n            });\r\n\r\n            setDisabled(true);\r\n            rootScope.managers.appAccountManager.deletePasskey(passkey.id).finally(() => {\r\n              tab.payload.setPasskeys((passkeys) => {\r\n                const arr = [...passkeys];\r\n                findAndSplice(arr, (item) => item.id === passkey.id);\r\n                return arr;\r\n              });\r\n            });\r\n          },\r\n          danger: true\r\n        }]\r\n      }}\r\n    >\r\n      <Show when={!passkey.software_emoji_id}>\r\n        <Row.Icon icon=\"key\" />\r\n      </Show>\r\n      <Row.Title class=\"text-bold\">{wrapEmojiText(passkey.name)}</Row.Title>\r\n      <Row.Subtitle>{subtitle()}</Row.Subtitle>\r\n      <Show when={passkey.software_emoji_id}>\r\n        <Row.Media size=\"abitbigger\">\r\n          {wrapAdaptiveCustomEmoji({\r\n            docId: passkey.software_emoji_id,\r\n            size: 42,\r\n            wrapOptions: {\r\n              middleware: createMiddleware().get()\r\n            }\r\n          }).container}\r\n        </Row.Media>\r\n      </Show>\r\n    </Row>\r\n  );\r\n};\r\n\r\nconst PasskeysTab = () => {\r\n  const [tab] = useSuperTab<AppPasskeysTabClass>();\r\n  const {i18n} = useHotReloadGuard();\r\n  const appConfig = useAppConfig();\r\n\r\n  const onCreation = (passkey: Passkey) => {\r\n    tab.payload.setPasskeys((passkeys) => {\r\n      const arr = [...passkeys];\r\n      arr.unshift(passkey);\r\n      return arr;\r\n    });\r\n  };\r\n\r\n  createEffect(() => {\r\n    if(!tab.payload.passkeys.length && !IS_WEB_AUTHN_SUPPORTED) {\r\n      tab.close();\r\n    }\r\n  });\r\n\r\n  return (\r\n    <Section\r\n      class={styles.container}\r\n      caption=\"Privacy.Passkeys.Caption\"\r\n      captionArgs={[anchorCallback(() => showPasskeyPopup(onCreation))]}\r\n    >\r\n      <StickerAndTitle\r\n        sticker={{name: 'key', size: 100}}\r\n        subtitle={i18n('Passkey.Subtitle')}\r\n        subtitleSecondary\r\n      />\r\n      <div class={styles.items}>\r\n        <For each={tab.payload.passkeys}>\r\n          {PasskeyItem}\r\n        </For>\r\n        <Show\r\n          when={\r\n            IS_WEB_AUTHN_SUPPORTED &&\r\n            tab.payload.passkeys.length < appConfig.passkeys_account_passkeys_max\r\n          }\r\n        >\r\n          <Button\r\n            text=\"Privacy.Passkey.Create\"\r\n            primaryTransparent\r\n            icon=\"add\"\r\n            onClick={() => createPasskey().then(onCreation)}\r\n          />\r\n        </Show>\r\n      </div>\r\n    </Section>\r\n  );\r\n};\r\n\r\nexport default PasskeysTab;\r\n"],"names":["PasskeyItem","passkey","tab","useSuperTab","rootScope","wrapEmojiText","wrapAdaptiveCustomEmoji","Row","i18n","confirmationPopup","formatDate","useHotReloadGuard","disabled","setDisabled","createSignal","subtitle","created","Date","date","withTime","last_usage_date","lastUsed","_$createComponent","contextMenu","buttons","icon","text","onClick","titleLangKey","descriptionLangKey","button","langKey","isDanger","managers","appAccountManager","deletePasskey","id","finally","payload","setPasskeys","passkeys","arr","findAndSplice","item","danger","children","Show","when","software_emoji_id","Icon","Title","name","Subtitle","Media","size","docId","wrapOptions","middleware","createMiddleware","get","container","PasskeysTab","appConfig","useAppConfig","onCreation","unshift","createEffect","length","IS_WEB_AUTHN_SUPPORTED","close","Section","styles","caption","captionArgs","anchorCallback","showPasskeyPopup","StickerAndTitle","sticker","subtitleSecondary","_el$","_tmpl$","_$insert","For","each","passkeys_account_passkeys_max","Button","primaryTransparent","createPasskey","then","_$effect","_$className","items"],"mappings":"g2BAmBMA,EAAeC,GAAqB,CACxC,KAAM,CAACC,CAAG,EAAIC,IACR,CAACC,UAAAA,EAAWC,cAAAA,EAAeC,wBAAAA,EAAyBC,IAAAA,EAAKC,KAAAA,EAAMC,kBAAAA,EAAmBC,WAAAA,CAAW,EAAGC,EAAiB,EACjH,CAACC,EAAUC,CAAW,EAAIC,EAAa,EAAK,EAC5CC,EAAWA,IAAM,CACrB,MAAMC,EAAUR,EAAK,0BAA2B,CAACE,EAAW,IAAIO,KAAKhB,EAAQiB,KAAO,GAAI,EAAG,CAACC,SAAU,EAAK,CAAA,CAAC,CAAC,EAC7G,GAAG,CAAClB,EAAQmB,gBAAiB,OAAOJ,EACpC,MAAMK,EAAWb,EAAK,4BAA6B,CAACE,EAAW,IAAIO,KAAKhB,EAAQmB,gBAAkB,GAAI,EAAG,CAACD,SAAU,EAAK,CAAA,CAAC,CAAC,EAC3H,MAAO,CAACH,EAAS,MAAOK,CAAQ,GAElC,OAAAC,EACGf,EAAG,CAAA,IACFK,UAAQ,CAAA,OAAEA,EAAQ,CAAE,EACpBW,YAAa,CACXC,QAAS,CAAC,CACRC,KAAM,SACNC,KAAM,SACNC,QAAS,SAAW,CAClB,MAAMlB,EAAkB,CACtBmB,aAAc,yBACdC,mBAAoB,wBACpBC,OAAQ,CACNC,QAAS,SACTC,SAAU,EACZ,CACF,CAAC,EAEDnB,EAAY,EAAI,EAChBT,EAAU6B,SAASC,kBAAkBC,cAAclC,EAAQmC,EAAE,EAAEC,QAAQ,IAAM,CAC3EnC,EAAIoC,QAAQC,YAAaC,GAAa,CACpC,MAAMC,EAAM,CAAC,GAAGD,CAAQ,EACxBE,OAAAA,EAAcD,EAAME,GAASA,EAAKP,KAAOnC,EAAQmC,EAAE,EAC5CK,CACT,CAAC,CACH,CAAC,CACF,EACDG,OAAQ,GACT,CACF,EAAA,IAAAC,UAAA,CAAA,MAAAvB,CAAAA,EAEAwB,EAAI,CAAA,IAACC,MAAI,CAAA,MAAE,CAAC9C,EAAQ+C,iBAAiB,EAAA,IAAAH,UAAA,CAAA,OAAAvB,EACnCf,EAAI0C,KAAI,CAACxB,KAAI,KAAA,CAAA,CAAA,CAAA,CAAA,EAAAH,EAEff,EAAI2C,MAAK,CAAA,MAAA,YAAA,IAAAL,UAAA,CAAA,OAAoBxC,EAAcJ,EAAQkD,IAAI,CAAC,CAAA,CAAA,EAAA7B,EACxDf,EAAI6C,SAAQ,CAAA,IAAAP,UAAA,CAAA,OAAE9B,EAAQ,CAAE,EAAAO,EAAAA,EACxBwB,EAAI,CAAA,IAACC,MAAI,CAAA,OAAE9C,EAAQ+C,iBAAiB,EAAA,IAAAH,UAAA,CAAA,OAAAvB,EAClCf,EAAI8C,MAAK,CAACC,KAAI,aAAA,IAAAT,UAAA,CAAA,OACZvC,EAAwB,CACvBiD,MAAOtD,EAAQ+C,kBACfM,KAAM,GACNE,YAAa,CACXC,WAAYC,EAAkB,EAACC,IAAI,CACrC,CACD,CAAA,EAAEC,SAAS,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAKtB,EAEMC,GAAcA,IAAM,CACxB,KAAM,CAAC3D,CAAG,EAAIC,IACR,CAACK,KAAAA,CAAK,EAAGG,EAAiB,EAC1BmD,EAAYC,IAEZC,EAAc/D,GAAqB,CACvCC,EAAIoC,QAAQC,YAAaC,GAAa,CACpC,MAAMC,EAAM,CAAC,GAAGD,CAAQ,EACxBC,OAAAA,EAAIwB,QAAQhE,CAAO,EACZwC,CACT,CAAC,GAGHyB,OAAAA,EAAa,IAAM,CACd,CAAChE,EAAIoC,QAAQE,SAAS2B,QAAU,CAACC,GAClClE,EAAImE,MAAK,CAEb,CAAC,EAED/C,EACGgD,EAAO,CAAA,IAAA,OAAA,CAAA,OACCC,EAAOX,SAAS,EACvBY,QAAO,2BAAA,IACPC,aAAW,CAAA,MAAE,CAACC,EAAe,IAAMC,EAAiBX,CAAU,CAAC,CAAC,CAAC,EAAA,IAAAnB,UAAA,CAAA,MAAAvB,CAAAA,EAEhEsD,EAAe,CACdC,QAAS,CAAC1B,KAAM,MAAOG,KAAM,GAAI,EAAA,IACjCvC,UAAQ,CAAA,OAAEP,EAAK,kBAAkB,CAAC,EAClCsE,kBAAiB,EAAA,CAAA,GAAA,IAAA,CAAA,MAAAC,EAAAC,IAAAC,OAAAA,EAAAF,EAAAzD,EAGhB4D,EAAG,CAAA,IAACC,MAAI,CAAA,OAAEjF,EAAIoC,QAAQE,QAAQ,EAAAK,SAC5B7C,CAAW,CAAA,EAAA,IAAA,EAAAiF,EAAAF,EAAAzD,EAEbwB,EAAI,CAAA,IACHC,MAAI,CAAA,OACFqB,GACAlE,EAAIoC,QAAQE,SAAS2B,OAASL,EAAUsB,6BAA6B,EAAA,IAAAvC,UAAA,CAAA,OAAAvB,EAGtE+D,EAAM,CACL3D,KAAI,yBACJ4D,mBAAkB,GAClB7D,KAAI,MACJE,QAASA,IAAM4D,IAAgBC,KAAKxB,CAAU,CAAC,CAAA,CAAA,CAAA,CAAA,EAAA,IAAA,EAAAyB,MAAAC,EAAAX,EAdzCR,EAAOoB,KAAK,CAAA,EAAAZ,CAAA,GAAA,CAAA,CAAA,CAAA,CAAA,CAoB9B"}