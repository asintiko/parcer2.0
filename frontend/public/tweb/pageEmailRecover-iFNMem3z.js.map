{"version":3,"mappings":";qmBAsBA,IAAIA,EACAC,EACAC,EACAC,EAEJ,MAAMC,EAAU,IAAM,CACpB,WAAW,IAAM,CACfD,GAAQ,OAAO,EACfF,GAAgB,QAAQ,GACvB,GAAG,CACR,EAEMI,EAAe,IAAM,CACnBC,QAAO,IAAIC,EAAU,CACzB,UAAW,oBACX,iBAAkB,GAClB,aAAc,4BACf,EAEKC,EAAOC,EAAW,SAAW,IAAM,IACzCC,EAAa,qBAAqB,CAChC,UAAWJ,EAAK,SAChB,KAAM,GACN,SAAU,GACV,MAAOE,EACP,OAAQA,CACP,WAAS,EAAE,KAAMG,IACTR,EAAAQ,EACFD,EAAa,kBAAkBC,CAAS,EAChD,EAEmBX,MAAA,IAAIY,EAAK,aAC7BN,EAAK,SAAS,YAAYN,EAAgB,OAAO,EAEjDC,EAAiB,IAAIY,EAAqB,CACxC,OAAQ,EACR,SAAU,IAAM,CACdZ,EAAe,MAAQ,GACvBa,EAAeZ,EAAqB,EAAE,CACxC,EACA,OAASa,GAAS,CAChBC,EAAU,SAAS,gBAAgB,0BAA0BD,CAAI,EAAE,KAAME,GAAQ,CAC/EC,EAAA,WAAO,sBAAU,8CAAE,KAAMC,GAAM,CAC7BA,EAAE,QAAQ,OAAM,CACjB,EACOf,GAAA,CACT,EAAE,MAAOgB,GAAkB,CAC1BnB,EAAe,MAAQ,GACvBA,EAAe,MAAQ,GAEpBmB,EAAI,OAAS,eACCN,EAAAZ,EAAqBmB,EAAK,oBAAoB,CAAC,GAEtD,YAAI,QAASD,CAAG,EACTN,EAAAZ,EAAqBmB,EAAK,eAAe,CAAC,EAC3D,CACD,CACH,EACD,EACqBnB,EAAA,SAAS,cAAc,KAAK,EAC9BA,EAAA,UAAU,IAAI,aAAa,EAEzC,MAAAoB,EAAYC,EAAO,2DAA2D,EAC1ED,EAAA,OAAOD,EAAK,4BAA4B,CAAC,EACnDG,EAAiBF,EAAW,IAAM,CAChCG,EAAa,MAAM,EACpB,EAEDnB,EAAK,aAAa,OAAOL,EAAe,UAAWC,EAAqBoB,CAAS,CACnF,EAGMhB,EAAO,IAAIoB,EAAK,oBAAqB,GAAMrB,EAAesB,GAAmC,CAC7E3B,MAAA,IAAIY,EAAK,aAC7BZ,EAAgB,OAAO,CACrB,IAAK,+BACL,KAAM,CAAC4B,EAAiBD,EAAS,aAAa,CAAC,EAChD,CACH,EAAG,IAAM,CACPxB,GAAQ,cAAc,EACtB0B,EAAQ,IAAM,CACZ5B,GAAgB,MAAM,OAAM,CAC7B,CACH,CAAC","names":["subtitleElement","codeInputField","codeInputErrorLabel","player","cleanup","onFirstMount","page","LoginPage","size","mediaSizes","lottieLoader","animation","I18n","CodeInputFieldCompat","replaceContent","code","rootScope","res","__vitePreload","m","err","i18n","cancelBtn","Button","attachClickEvent","pagePassword","Page","sentCode","wrapEmailPattern","fastRaf"],"ignoreList":[],"sources":["../src/pages/pageEmailRecover.ts"],"sourcesContent":["/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {AccountSentEmailCode} from '../layer';\r\nimport Page from './page';\r\nimport CodeInputFieldCompat from '../components/codeInputField';\r\nimport I18n, {i18n} from '../lib/langPack';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport rootScope from '../lib/rootScope';\r\nimport lottieLoader from '../lib/rlottie/lottieLoader';\r\nimport RLottiePlayer from '../lib/rlottie/rlottiePlayer';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport {wrapEmailPattern} from '../components/popups/emailSetup';\r\nimport mediaSizes from '../helpers/mediaSizes';\r\nimport LoginPage from './loginPage';\r\nimport Button from '../components/button';\r\nimport pagePassword from './pagePassword';\r\n\r\nlet subtitleElement: I18n.IntlElement;\r\nlet codeInputField: CodeInputFieldCompat;\r\nlet codeInputErrorLabel: HTMLElement;\r\nlet player: RLottiePlayer;\r\n\r\nconst cleanup = () => {\r\n  setTimeout(() => {\r\n    player?.remove();\r\n    codeInputField?.cleanup()\r\n  }, 300);\r\n};\r\n\r\nconst onFirstMount = () => {\r\n  const page = new LoginPage({\r\n    className: 'page-emailRecover',\r\n    withInputWrapper: true,\r\n    titleLangKey: 'Login.ResetPassword.Title'\r\n  });\r\n\r\n  const size = mediaSizes.isMobile ? 100 : 166;\r\n  lottieLoader.loadAnimationAsAsset({\r\n    container: page.imageDiv,\r\n    loop: false,\r\n    autoplay: true,\r\n    width: size,\r\n    height: size\r\n  }, 'Mailbox').then((animation) => {\r\n    player = animation;\r\n    return lottieLoader.waitForFirstFrame(animation);\r\n  })\r\n\r\n  subtitleElement ??= new I18n.IntlElement();\r\n  page.subtitle.appendChild(subtitleElement.element);\r\n\r\n  codeInputField = new CodeInputFieldCompat({\r\n    length: 6,\r\n    onChange: () => {\r\n      codeInputField.error = false;\r\n      replaceContent(codeInputErrorLabel, '');\r\n    },\r\n    onFill: (code) => {\r\n      rootScope.managers.passwordManager.confirmPasswordResetEmail(code).then((res) => {\r\n        import('./pageIm').then((m) => {\r\n          m.default.mount();\r\n        });\r\n        cleanup();\r\n      }).catch((err: ApiError) => {\r\n        codeInputField.error = true;\r\n        codeInputField.value = '';\r\n\r\n        if(err.type === 'CODE_INVALID') {\r\n          replaceContent(codeInputErrorLabel, i18n('PHONE_CODE_INVALID'));\r\n        } else {\r\n          console.log('error', err);\r\n          replaceContent(codeInputErrorLabel, i18n('Error.AnError'));\r\n        }\r\n      });\r\n    }\r\n  });\r\n  codeInputErrorLabel = document.createElement('div');\r\n  codeInputErrorLabel.classList.add('error-label');\r\n\r\n  const cancelBtn = Button('btn-primary btn-secondary btn-primary-transparent primary');\r\n  cancelBtn.append(i18n('Login.ResetPassword.Cancel'));\r\n  attachClickEvent(cancelBtn, () => {\r\n    pagePassword.mount()\r\n  });\r\n\r\n  page.inputWrapper.append(codeInputField.container, codeInputErrorLabel, cancelBtn);\r\n};\r\n\r\n\r\nconst page = new Page('page-emailRecover', true, onFirstMount, (sentCode: AccountSentEmailCode) => {\r\n  subtitleElement ??= new I18n.IntlElement();\r\n  subtitleElement.update({\r\n    key: 'Login.ResetPassword.Subtitle',\r\n    args: [wrapEmailPattern(sentCode.email_pattern)]\r\n  })\r\n}, () => {\r\n  player?.playOrRestart();\r\n  fastRaf(() => {\r\n    codeInputField?.input.focus();\r\n  })\r\n});\r\n\r\nexport default page;\r\n"],"file":"pageEmailRecover-iFNMem3z.js"}