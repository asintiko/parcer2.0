{"version":3,"file":"index-CLCKi-UH.js","sources":["../src/components/addToFolderDropdownMenu/kindaFuzzyFinder.ts","../src/components/addToFolderDropdownMenu/utils.ts","../src/components/addToFolderDropdownMenu/hooks.tsx","../src/components/addToFolderDropdownMenu/index.tsx"],"sourcesContent":["export default function kindaFuzzyFinder(str: string, toFind: string) {\r\n  return kindaFuzzyFinderImpl(str.toLowerCase(), toFind.toLowerCase(), toFind.length);\r\n}\r\n\r\nfunction kindaFuzzyFinderImpl(str: string, toFind: string, fm: number) {\r\n  let bestIndicies: number[] = [], bestScore = 0;\r\n\r\n  const n = str.length;\r\n  const m = toFind.length;\r\n\r\n  for(let j = 0; j < m; j++) {\r\n    for(let i = 0; i < n; i++) {\r\n      if(str[i] !== toFind[j]) continue;\r\n\r\n      const {found} = kindaFuzzyFinderImpl(str.slice(i + 1), toFind.slice(j + 1), fm);\r\n      const newIndicies = [i, ...found.map(fi => fi + i + 1)];\r\n\r\n      const s = score(str, toFind, newIndicies, fm, true) - punishments.missing(fm) * j;\r\n      if(s > bestScore) {\r\n        bestScore = s;\r\n        bestIndicies = newIndicies;\r\n      }\r\n    }\r\n  }\r\n\r\n  return {found: bestIndicies, score: score(str, toFind, bestIndicies, fm, true)};\r\n}\r\n\r\nconst punishments = {\r\n  missing: (length: number) => 1 / length,\r\n  gap: (length: number, gap: number) => 0.25 / length * gap\r\n};\r\n\r\nfunction score(str: string, toFind: string, indicies: number[], fm: number, punishLastMissing: boolean) {\r\n  const n = str.length, m = toFind.length, k = indicies.length;\r\n  if(!k) return 0;\r\n\r\n  let result = 1;\r\n\r\n  let fi = 0, prevsi = -1;\r\n  for(let i = 0; i < k && fi < m; i++) {\r\n    const si = indicies[i];\r\n    if(!(si < n)) break;\r\n\r\n    while(str[si] !== toFind[fi] && fi < m) {\r\n      fi++;\r\n      result -= punishments.missing(fm);\r\n    }\r\n    fi++;\r\n\r\n    if(prevsi != -1 && si - prevsi > 1) {\r\n      result -= punishments.gap(m, si - prevsi - 1);\r\n    }\r\n\r\n    prevsi = si;\r\n  }\r\n\r\n  if(punishLastMissing) result -= (fm - fi) * punishments.missing(fm);\r\n\r\n  return result;\r\n}\r\n\r\nif(false) {\r\n  const testCases = [\r\n    ['hello world', ['hlo', 'hew', 'wld', 'world', 'xyz']],\r\n    ['fuzzy finder', ['fzy', 'fin', 'fndr', 'zzi', 'der']],\r\n    ['JavaScript', ['jvs', 'scr', 'java', 'script', 'pt']],\r\n    ['keyboard', ['key', 'kbd', 'brd', 'board', 'z']],\r\n    ['console.log', ['cl', 'csl', 'log', 'con', 'x']],\r\n    ['performance', ['perf', 'mance', 'form', 'xyz', 'per']],\r\n    ['stack overflow', ['stov', 'sov', 'flow', 'ovr', 'ack']],\r\n    ['regex match', ['rx', 'mat', 'rmt', 'match', 'gg']],\r\n    ['autocomplete', ['auto', 'cmp', 'complete', 'lete', 'ct']],\r\n    ['developer tools', ['dev', 'tools', 'dvlp', 'dt', 'tl']],\r\n    ['machine learning', ['ml', 'mach', 'learn', 'mle', 'xyz']],\r\n    ['artificial intelligence', ['ai', 'art', 'intel', 'bficial', 'ce']],\r\n    ['data structures', ['ds', 'str', 'data', 'stru', 'zzz']],\r\n    ['frontend backend', ['fb', 'fe', 'be', 'front', 'back']],\r\n    ['react components', ['rc', 'cmp', 'comp', 'reac', 'ents']],\r\n    ['node.js server', ['nd', 'srv', 'node', 'js', 'ser']],\r\n    ['web development', ['web', 'dev', 'wdev', 'lop', 'zzz']],\r\n    ['browser history', ['bh', 'hist', 'browse', 'his', 'story']],\r\n    ['terminal command', ['term', 'cmd', 'com', 'tc', 'mand']]\r\n  ] as const;\r\n\r\n  for(const [source, terms] of testCases) {\r\n    console.log(`\\nSource: \"${source}\"`);\r\n    for(const term of terms) {\r\n      const {found, score} = kindaFuzzyFinder(source, term);\r\n      const arr = new Array(source.length).fill('^').map((_, i) => found.includes(i) ? source[i] : _);\r\n      console.log(`  Search: \"${term}\" -> (${score.toFixed(2)}) ${arr.join('')}`);\r\n    }\r\n  }\r\n}\r\n","import {onCleanup} from 'solid-js';\r\nimport {Middleware} from '../../helpers/middleware';\r\nimport {TextWithEntities} from '../../layer';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport {CustomEmojiRendererElement} from '../../lib/customEmoji/renderer';\r\nimport {logger, LogTypes} from '../../lib/logger';\r\nimport {FOLDER_ID_ALL, FOLDER_ID_ARCHIVE} from '../../lib/mtproto/mtproto_config';\r\nimport rootScope from '../../lib/rootScope';\r\nimport {MyDialogFilter} from '../../lib/storages/filters';\r\nimport wrapFolderTitle from '../wrappers/folderTitle';\r\nimport styles from './styles.module.scss';\r\n\r\n\r\nexport const log = logger('AddToFolderDropdownMenu', LogTypes.Debug);\r\n\r\nexport async function fetchDialogFilters() {\r\n  const filters = await rootScope.managers.filtersStorage.getDialogFilters();\r\n\r\n  return filters\r\n  .filter(filter => filter.id !== FOLDER_ID_ARCHIVE && filter.id !== FOLDER_ID_ALL)\r\n  .sort((a, b) => {\r\n    if(!a.id || !b.id) return 0;\r\n    return a?.localId - b?.localId;\r\n  });\r\n}\r\n\r\nconst p = (p: PeerId) => Math.abs(p);\r\n\r\nexport async function addToFilter(filter: MyDialogFilter, peerId: PeerId) {\r\n  log.debug('addToFilter before', filter);\r\n  filter = {...filter};\r\n\r\n  if(filter._ === 'dialogFilter') {\r\n    filter.excludePeerIds = filter.excludePeerIds?.filter(excludedPeerId => p(excludedPeerId) !== p(peerId));\r\n    filter.exclude_peers = filter.exclude_peers?.filter(inputPeer => p(getPeerId(inputPeer)) !== p(peerId));\r\n  }\r\n\r\n  const hasPinned = filter.pinnedPeerIds.find(pinnedPeerId => p(pinnedPeerId) === p(peerId));\r\n\r\n  if(!hasPinned) {\r\n    filter.includePeerIds = [...(filter.includePeerIds || []).filter(includedPeerId => p(includedPeerId) !== p(peerId)), peerId];\r\n    filter.include_peers = [...(filter.include_peers || []).filter(inputPeer => p(getPeerId(inputPeer)) !== p(peerId)), await rootScope.managers.appPeersManager.getInputPeerById(peerId)];\r\n  }\r\n\r\n  log.debug('addToFilter after', filter);\r\n\r\n  await rootScope.managers.filtersStorage.updateDialogFilter(filter);\r\n}\r\n\r\nexport async function removeFromFilter(filter: MyDialogFilter, peerId: PeerId) {\r\n  log.debug('removeFromFilter before', filter);\r\n  filter = {...filter};\r\n\r\n  filter.includePeerIds = filter.includePeerIds?.filter(includedPeerId => p(peerId) !== p(includedPeerId));\r\n  filter.include_peers = filter.include_peers?.filter(inputPeer => p(getPeerId(inputPeer)) !== p(peerId));\r\n\r\n  filter.pinnedPeerIds = filter.pinnedPeerIds?.filter(pinnedPeerId => p(peerId) !== p(pinnedPeerId));\r\n  filter.pinned_peers = filter.pinned_peers?.filter(inputPeer => p(getPeerId(inputPeer)) !== p(peerId));\r\n\r\n  if(filter._ === 'dialogFilter') {\r\n    filter.excludePeerIds = [...(filter.excludePeerIds || []).filter(excludedPeerId => p(excludedPeerId) !== p(peerId)), peerId];\r\n    filter.exclude_peers = [...(filter.exclude_peers || []).filter(inputPeer => p(getPeerId(inputPeer)) !== p(peerId)), await rootScope.managers.appPeersManager.getInputPeerById(peerId)];\r\n  }\r\n\r\n  log.debug('removeFromFilter after', filter);\r\n\r\n  await rootScope.managers.filtersStorage.updateDialogFilter(filter);\r\n}\r\n\r\nexport function wrapFolderTitleInSpan(title: TextWithEntities.textWithEntities, middleware: Middleware) {\r\n  const span: HTMLSpanElement = document.createElement('span');\r\n  const fragment = wrapFolderTitle(title, middleware, true);\r\n\r\n  span.append(fragment);\r\n\r\n  const renderer: CustomEmojiRendererElement = span.querySelector('custom-emoji-renderer-element');\r\n  renderer?.setTextColor('primary-text-color');\r\n\r\n  const treeWalker = document.createTreeWalker(span, NodeFilter.SHOW_TEXT);\r\n\r\n  const nodes: Node[] = [];\r\n  const charSpansGroups: HTMLElement[][] = [];\r\n\r\n  while(treeWalker.nextNode()) {\r\n    nodes.push(treeWalker.currentNode);\r\n  }\r\n\r\n  for(const node of nodes) {\r\n    const fragment = document.createDocumentFragment();\r\n\r\n    const charSpans = node.nodeValue.split('').map(char => {\r\n      const charSpan = document.createElement('span');\r\n      charSpan.innerText = char;\r\n      return charSpan;\r\n    });\r\n\r\n    charSpansGroups.push(charSpans);\r\n    fragment.append(...charSpans);\r\n\r\n    node.parentNode.replaceChild(fragment, node);\r\n  }\r\n\r\n  return {\r\n    span,\r\n    charSpansGroups\r\n  };\r\n}\r\n\r\nexport function highlightTextNodes(nodeGroups: HTMLElement[][], indicies: number[]) {\r\n  let acc = 0;\r\n\r\n  const toCleanup: HTMLElement[] = [];\r\n\r\n  for(const nodeGroup of nodeGroups) {\r\n    const n = nodeGroup.length;\r\n\r\n    const localIndicies = indicies.filter(i => i >= acc && i < acc + n).map(i => i - acc);\r\n    const m = localIndicies.length;\r\n\r\n    acc += n;\r\n\r\n    for(let i = 0; i < m; i++) {\r\n      let j = i;\r\n      while(j < m - 1 && localIndicies[j + 1] - 1 === localIndicies[j]) j++;\r\n\r\n      if(j === i) {\r\n        const li = localIndicies[i];\r\n        const nodeSingle = nodeGroup[li];\r\n        nodeSingle.classList.add(styles.Char, styles.single);\r\n        toCleanup.push(nodeSingle);\r\n        continue;\r\n      }\r\n\r\n      const nodeStart = nodeGroup[localIndicies[i]];\r\n      const nodeEnd = nodeGroup[localIndicies[j]];\r\n\r\n      nodeStart.classList.add(styles.Char, styles.start);\r\n      nodeEnd.classList.add(styles.Char, styles.end);\r\n\r\n      toCleanup.push(nodeStart, nodeEnd);\r\n\r\n      for(let k = i + 1; k < j; k++) {\r\n        const nodeMiddle = nodeGroup[localIndicies[k]];\r\n        nodeMiddle.classList.add(styles.Char, styles.middle);\r\n        toCleanup.push(nodeMiddle);\r\n      }\r\n\r\n      i = j;\r\n    }\r\n  }\r\n\r\n  onCleanup(() => {\r\n    toCleanup.forEach(el => {\r\n      el.className = '';\r\n    });\r\n  });\r\n}\r\n","import {Accessor, createEffect, createMemo, createSignal, JSX, onCleanup, Setter, Show} from 'solid-js';\r\nimport {unwrap} from 'solid-js/store';\r\nimport {Transition} from 'solid-transition-group';\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {CLICK_EVENT_NAME} from '../../helpers/dom/clickEvent';\r\nimport noop from '../../helpers/noop';\r\nimport createMiddleware from '../../helpers/solid/createMiddleware';\r\nimport {Dialog} from '../../layer';\r\nimport {isDialog} from '../../lib/appManagers/utils/dialogs/isDialog';\r\nimport {i18n} from '../../lib/langPack';\r\nimport rootScope from '../../lib/rootScope';\r\nimport {MyDialogFilter} from '../../lib/storages/filters';\r\nimport {ButtonMenuItem, ButtonMenuItemOptions} from '../buttonMenu';\r\nimport {IconTsx} from '../iconTsx';\r\nimport extractEmojiFromFilterTitle from '../sidebarLeft/foldersSidebarContent/extractEmojiFromFilterTitle';\r\nimport FolderAnimatedIcon from '../sidebarLeft/foldersSidebarContent/folderAnimatedIcon';\r\nimport {getIconForFilter} from '../sidebarLeft/foldersSidebarContent/utils';\r\nimport showTooltip from '../tooltip';\r\nimport kindaFuzzyFinder from './kindaFuzzyFinder';\r\nimport styles from './styles.module.scss';\r\nimport {addToFilter, highlightTextNodes, log, removeFromFilter, wrapFolderTitleInSpan} from './utils';\r\n\r\n\r\nconst MIN_FUZZY_SCORE = 0.25;\r\n\r\n\r\ntype CreateButtonMenuIconArgs = {\r\n  filter: MyDialogFilter;\r\n  isChecked: Accessor<boolean>;\r\n  docId?: DocId;\r\n  emoji?: string;\r\n}\r\n\r\nexport const createButtonMenuIcon = ({filter, isChecked, docId, emoji}: CreateButtonMenuIconArgs) => {\r\n  const [failedToFetchIcon, setFailedToFetchIcon] = createSignal(false);\r\n\r\n  return (\r\n    <span class={`btn-menu-item-icon ${styles.ItemIcon}`}>\r\n      <Show\r\n        when={(docId || emoji) && !failedToFetchIcon()}\r\n        fallback={<IconTsx icon={getIconForFilter(filter)} />}\r\n      >\r\n        <FolderAnimatedIcon\r\n          managers={rootScope.managers}\r\n          color='primary-text-color'\r\n          docId={docId}\r\n          emoji={emoji}\r\n          size={20}\r\n          onFail={() => setFailedToFetchIcon(true)}\r\n          dontAnimate={filter.pFlags?.title_noanimate}\r\n        />\r\n      </Show>\r\n      <Transition\r\n        enterActiveClass={styles.AppearZoomEnterActive}\r\n        exitActiveClass={styles.AppearZoomEnterActive}\r\n        enterClass={styles.AppearZoomEnter}\r\n        exitToClass={styles.AppearZoomExitTo}\r\n      >\r\n        <Show when={isChecked()}>\r\n          <span class={styles.ItemIconCheck}>\r\n            <IconTsx icon='check' />\r\n          </span>\r\n        </Show>\r\n      </Transition>\r\n    </span>\r\n  ) as HTMLSpanElement\r\n};\r\n\r\n\r\ntype CreateButtonMenuLabelArgs = {\r\n  label: JSX.Element;\r\n  isSelected: Accessor<boolean>;\r\n};\r\n\r\nexport const createButtonMenuLabel = ({label, isSelected}: CreateButtonMenuLabelArgs) => (\r\n  <span class={styles.ItemLabel}>\r\n    {label}\r\n    <Show when={isSelected()}>\r\n      <IconTsx icon='enter' class={styles.ItemLabelEnter} />\r\n    </Show>\r\n  </span>\r\n) as HTMLSpanElement;\r\n\r\n\r\ntype CreateFolderItemsArgs = {\r\n  filters: Accessor<MyDialogFilter[]>;\r\n  currentFilter: Accessor<number>;\r\n  isInFilter: (filter: MyDialogFilter) => boolean;\r\n  isSelected: (filterId: number) => boolean;\r\n  onToggle: (filter: MyDialogFilter) => void;\r\n};\r\n\r\nexport type FolderItem = ReturnType<ReturnType<typeof createFolderItems>>[number];\r\n\r\nexport const createFolderItems = ({filters, isInFilter, isSelected, onToggle, currentFilter}: CreateFolderItemsArgs) => createMemo(() => {\r\n  const middleware = createMiddleware();\r\n  log.debug('creating folder items');\r\n\r\n  onCleanup(() => {\r\n    log.debug('destroying folder items middleware');\r\n    middleware.destroy();\r\n  });\r\n\r\n  return filters().map((filter) => {\r\n    const extractedTitle = extractEmojiFromFilterTitle(filter.title);\r\n    const {span, charSpansGroups} = wrapFolderTitleInSpan(extractedTitle.text, middleware.get());\r\n    span.classList.add(styles.ItemLabelText);\r\n\r\n    const options: ButtonMenuItemOptions = {\r\n      iconElement: createButtonMenuIcon({filter, isChecked: () => isInFilter(filter), docId: extractedTitle.docId, emoji: extractedTitle.emoji}),\r\n      textElement: createButtonMenuLabel({label: span, isSelected: () => isSelected(filter.id)}),\r\n      onClick: noop\r\n    };\r\n\r\n    const buttonMenuItem = ButtonMenuItem(options);\r\n\r\n    options.element?.addEventListener(CLICK_EVENT_NAME, async(e) => {\r\n      if(e.shiftKey && currentFilter() !== filter.id) e.stopPropagation();\r\n      onToggle(filter);\r\n    }, true);\r\n    options.element?.classList.add(styles.Item);\r\n\r\n    createEffect(() => {\r\n      if(!isSelected(filter.id)) return;\r\n      options.element?.classList.add(styles.selected);\r\n      onCleanup(() => void options.element?.classList.remove(styles.selected));\r\n    });\r\n\r\n    return {\r\n      filter,\r\n      textContent: span.textContent,\r\n      buttonMenuItem,\r\n      element: options.element,\r\n      charSpansGroups\r\n    };\r\n  });\r\n});\r\n\r\n\r\ntype UseToggleDialogInFilterArgs = {\r\n  dialog: Accessor<Dialog.dialog>;\r\n  isInFilter: (filter: MyDialogFilter) => boolean;\r\n  onNewDialog: (dialog: Dialog.dialog) => void;\r\n};\r\n\r\nexport const useToggleDialogInFilter = ({dialog, onNewDialog, isInFilter}: UseToggleDialogInFilterArgs) => {\r\n  let hasRequestInProgress = false;\r\n\r\n  return async(filter: MyDialogFilter) => {\r\n    if(hasRequestInProgress || !filter) return;\r\n\r\n    const unwrapped = unwrap(filter);\r\n\r\n    hasRequestInProgress = true;\r\n\r\n    try {\r\n      await (isInFilter(filter) ? removeFromFilter(unwrapped, dialog().peerId) : addToFilter(unwrapped, dialog().peerId));\r\n      const newDialog = await rootScope.managers.dialogsStorage.getAnyDialog(dialog().peerId);\r\n      if(!isDialog(newDialog)) return;\r\n      onNewDialog(newDialog);\r\n    } catch{} finally {\r\n      hasRequestInProgress = false;\r\n    }\r\n  }\r\n};\r\n\r\n\r\ntype CreateSearchableFoldersArgs = {\r\n  folderItems: Accessor<FolderItem[]>;\r\n  search: Accessor<string>;\r\n  isSelected: (filterId: number) => boolean;\r\n  setSelected: (idx?: number) => void;\r\n};\r\n\r\nexport const createSearchableFolders = ({folderItems, search, isSelected, setSelected}: CreateSearchableFoldersArgs) => createMemo(() => {\r\n  if(!search()) return {\r\n    folders: folderItems(),\r\n    visibleFoldersCount: folderItems().length\r\n  };\r\n\r\n  const fuzziedFolders = folderItems().map((src) => ({\r\n    finderResult: kindaFuzzyFinder(src.textContent, search()),\r\n    src\r\n  }));\r\n\r\n  const sortedFolders = fuzziedFolders\r\n  .sort(({finderResult: {found: found1, score: score1}}, {finderResult: {found: found2, score: score2}}) =>\r\n    score1 === score2 ? (found1[0] || 0) - (found2[0] || 0) : score2 - score1\r\n  );\r\n\r\n  setSelected(0);\r\n  onCleanup(() => void setSelected());\r\n\r\n  const visibleFoldersCount = sortedFolders.filter(({src, finderResult}) => {\r\n    if(finderResult.score >= MIN_FUZZY_SCORE) {\r\n      createEffect(() => {\r\n        if(isSelected(src.filter.id)) src.element.scrollIntoView({block: 'center'});\r\n      });\r\n\r\n      highlightTextNodes(src.charSpansGroups, finderResult.found);\r\n\r\n      return true;\r\n    }\r\n\r\n    src.buttonMenuItem.forEach(el => el.classList.add(styles.Hidden));\r\n    onCleanup(() => void src.buttonMenuItem.forEach(el => el.classList.remove(styles.Hidden)))\r\n  }).length;\r\n\r\n  return {\r\n    folders: sortedFolders.map(({src}) => src),\r\n    visibleFoldersCount\r\n  };\r\n});\r\n\r\n\r\ntype UseTooltipHintArgs = {\r\n  pivot: Accessor<HTMLElement>;\r\n};\r\n\r\nexport const useTooltipHint = ({pivot}: UseTooltipHintArgs) => {\r\n  let closeTooltip = noop;\r\n\r\n  setTimeout(() => {\r\n    closeTooltip = undefined;\r\n  }, 200); // wait opening animation\r\n\r\n  onCleanup(() => {\r\n    closeTooltip?.();\r\n  });\r\n\r\n  const showHint = () => {\r\n    if(closeTooltip) return;\r\n    closeTooltip = showTooltip({\r\n      element: pivot(),\r\n      vertical: 'top',\r\n      textElement: i18n('AddToFolderTip'),\r\n      lighter: true,\r\n      auto: true,\r\n      useOverlay: false,\r\n      onClose: () => {\r\n        closeTooltip = undefined;\r\n      }\r\n    }).close;\r\n  };\r\n\r\n  const closeAndDisableTooltip = () => {\r\n    closeTooltip?.();\r\n    closeTooltip = noop; // prevent further opening of the tooltip\r\n  };\r\n\r\n  return {\r\n    showHint,\r\n    closeAndDisableTooltip\r\n  }\r\n};\r\n\r\n\r\ntype UseInputKeydownArgs = {\r\n  search: Accessor<string>;\r\n  setSearch: Setter<string>\r\n  selected: Accessor<number>;\r\n  setSelected: Setter<number>;\r\n  selectedFilter: Accessor<MyDialogFilter>;\r\n  currentFilter: Accessor<number>;\r\n  onToggle: (filter: MyDialogFilter) => void;\r\n  visibleFoldersCount: Accessor<number>;\r\n};\r\n\r\nexport const useInputKeydown = ({search, setSearch, selected, setSelected, selectedFilter, currentFilter, onToggle, visibleFoldersCount}: UseInputKeydownArgs) => {\r\n  return (e: KeyboardEvent) => {\r\n    if(['ArrowUp', 'ArrowLeft', 'ArrowDown', 'ArrowRight', 'Enter'].includes(e.code)) e.preventDefault();\r\n\r\n    if(e.code === 'Escape') {\r\n      if(search()) setSearch('');\r\n      else contextMenuController.close();\r\n    }\r\n\r\n    if(e.code === 'Enter' && selectedFilter()) {\r\n      onToggle(selectedFilter());\r\n      if(!e.shiftKey || currentFilter() === selectedFilter().id) contextMenuController.close();\r\n      return;\r\n    }\r\n\r\n    if(typeof selected() !== 'number') return;\r\n\r\n    const increment = ['ArrowUp', 'ArrowLeft'].includes(e.code) ? -1 : ['ArrowDown', 'ArrowRight'].includes(e.code) ? 1 : 0;\r\n    setSelected(prev => (prev + increment + visibleFoldersCount()) % visibleFoldersCount())\r\n  };\r\n};\r\n","import {createComputed, createEffect, createMemo, createSelector, createSignal, For, onCleanup, onMount, Show} from 'solid-js';\r\nimport {IS_MOBILE} from '../../environment/userAgent';\r\nimport {CLICK_EVENT_NAME} from '../../helpers/dom/clickEvent';\r\nimport {Dialog} from '../../layer';\r\nimport {i18n} from '../../lib/langPack';\r\nimport defineSolidElement, {PassedProps} from '../../lib/solidjs/defineSolidElement';\r\nimport {MyDialogFilter} from '../../lib/storages/filters';\r\nimport appNavigationController from '../appNavigationController';\r\nimport {IconTsx} from '../iconTsx';\r\nimport Scrollable from '../scrollable2';\r\nimport {createFolderItems, createSearchableFolders, FolderItem, useInputKeydown, useToggleDialogInFilter, useTooltipHint} from './hooks';\r\nimport styles from './styles.module.scss';\r\nimport {fetchDialogFilters} from './utils';\r\n\r\nif(import.meta.hot) import.meta.hot.accept();\r\n\r\n\r\nconst MAX_VISIBLE_SCROLL_ITEMS = 6;\r\nconst HAVE_SCROLL_WHEN_ABOVE = 8; // and search too\r\n\r\n\r\ntype Props = {\r\n  dialog: Dialog.dialog;\r\n  filters: MyDialogFilter[];\r\n  currentFilter: () => number;\r\n  onCleanup?: () => void;\r\n  onNewDialog?: (dialog: Dialog.dialog) => void;\r\n};\r\n\r\n\r\nconst AddToFolderDropdownMenu = defineSolidElement({\r\n  name: 'add-to-folder-dropdown-menu',\r\n  component: (props: PassedProps<Props>, _, controls: {closeTooltip: () => void}) => {\r\n    //\r\n    props.element.classList.add('btn-menu', styles.Container);\r\n\r\n    let infoIcon: HTMLElement, label: HTMLDivElement, thumb: HTMLDivElement;\r\n\r\n    const [search, setSearch] = createSignal('');\r\n    const [selected, setSelected] = createSignal<number>();\r\n    const [selectableFolders, setSelectableFolders] = createSignal<FolderItem[]>([]);\r\n\r\n    const isInFilter = createSelector(\r\n      () => props.dialog,\r\n      (filter: MyDialogFilter, dialog) => !!dialog?.[`index_${filter.localId}`]\r\n    );\r\n\r\n    const selectedFilter = createMemo(() => selectableFolders()[selected()]?.filter);\r\n    const isSelected = createSelector(() => selectedFilter()?.id);\r\n\r\n    const renderAsScrollable = createMemo(() => props.filters.length > HAVE_SCROLL_WHEN_ABOVE);\r\n\r\n    const toggleDialogInFilter = useToggleDialogInFilter({\r\n      dialog: () => props.dialog,\r\n      onNewDialog: (newDialog) => {\r\n        props.dialog = newDialog;\r\n        props.onNewDialog?.(newDialog);\r\n      },\r\n      isInFilter\r\n    });\r\n\r\n    const folderItems = createFolderItems({\r\n      filters: () => props.filters,\r\n      isInFilter,\r\n      isSelected,\r\n      onToggle: toggleDialogInFilter,\r\n      currentFilter: props.currentFilter\r\n    });\r\n\r\n    const searchableFolders = createSearchableFolders({\r\n      folderItems,\r\n      search,\r\n      isSelected,\r\n      setSelected\r\n    });\r\n\r\n    const {showHint, closeAndDisableTooltip} = useTooltipHint({pivot: () => infoIcon});\r\n    controls.closeTooltip = closeAndDisableTooltip;\r\n\r\n    const onInputKeyDown = useInputKeydown({\r\n      search,\r\n      setSearch,\r\n      selected,\r\n      setSelected,\r\n      selectedFilter,\r\n      currentFilter: props.currentFilter,\r\n      onToggle: toggleDialogInFilter,\r\n      visibleFoldersCount: () => searchableFolders().visibleFoldersCount\r\n    });\r\n\r\n    onMount(() => {\r\n      thumb?.addEventListener(CLICK_EVENT_NAME, e => {\r\n        e.stopPropagation();\r\n      }, true);\r\n    });\r\n\r\n    // Prevent calling renderedFolders before initialization\r\n    createComputed(() => {\r\n      setSelectableFolders(searchableFolders().folders);\r\n    });\r\n\r\n    createEffect(() => {\r\n      if(typeof selected() !== 'number') label?.scrollIntoView({block: 'center'});\r\n    });\r\n\r\n    createEffect(() => {\r\n      props.element.classList.toggle(styles.withScrollable, renderAsScrollable());\r\n    });\r\n\r\n    const cleanupEscapeHandler = appNavigationController.registerEscapeHandler(() => !search());\r\n\r\n    onCleanup(() => {\r\n      props.onCleanup?.();\r\n      cleanupEscapeHandler();\r\n    });\r\n\r\n    const Items = () => (\r\n      <For each={searchableFolders().folders}>\r\n        {(folder) => folder.buttonMenuItem}\r\n      </For>\r\n    );\r\n\r\n    return (\r\n      <Show when={renderAsScrollable()} fallback={<Items />}>\r\n        <div\r\n          class={styles.ScrollableContainer}\r\n          classList={{\r\n            [styles.mobile]: IS_MOBILE\r\n          }}\r\n          style={{'--max-visible-items': MAX_VISIBLE_SCROLL_ITEMS}}\r\n        >\r\n          <Show when={!IS_MOBILE}>\r\n            <input\r\n              class={styles.Input}\r\n              value={search()}\r\n              onInput={e => void setSearch(e.target.value)}\r\n              onBlur={(e) => {\r\n                e.target.focus();\r\n              }}\r\n              onKeyDown={onInputKeyDown}\r\n              ref={el => void setTimeout(() => void el.focus(), 100)}\r\n            />\r\n          </Show>\r\n          <Show when={!searchableFolders().visibleFoldersCount}>\r\n            {(() => {\r\n              const el = i18n('AddToFolderEmptySearchResult');\r\n              el.classList.add(styles.EmptySearchTip);\r\n              return el;\r\n            })()}\r\n          </Show>\r\n          <Scrollable class={styles.Scrollable} thumbRef={(el) => void (thumb = el)}>\r\n            <Show when={!IS_MOBILE}>\r\n              <div ref={label} class={styles.Label} onPointerEnter={showHint}>\r\n                {(() => {\r\n                  const el = i18n('AddToFolderSearch');\r\n                  el.classList.add(styles.LabelText);\r\n                  return el;\r\n                })()}\r\n                <IconTsx ref={infoIcon} icon='info' />\r\n              </div>\r\n            </Show>\r\n\r\n            <Items />\r\n          </Scrollable>\r\n        </div>\r\n      </Show>\r\n    );\r\n  }\r\n});\r\n\r\nexport {fetchDialogFilters};\r\nexport default AddToFolderDropdownMenu;\r\n"],"names":["kindaFuzzyFinder","str","toFind","kindaFuzzyFinderImpl","fm","bestIndicies","bestScore","n","m","j","i","found","newIndicies","fi","s","score","punishments","length","gap","indicies","punishLastMissing","k","result","prevsi","si","log","logger","LogTypes","fetchDialogFilters","rootScope","filter","FOLDER_ID_ARCHIVE","FOLDER_ID_ALL","a","b","p","addToFilter","peerId","excludedPeerId","inputPeer","getPeerId","pinnedPeerId","includedPeerId","removeFromFilter","wrapFolderTitleInSpan","title","middleware","span","fragment","wrapFolderTitle","treeWalker","nodes","charSpansGroups","node","charSpans","char","charSpan","highlightTextNodes","nodeGroups","acc","toCleanup","nodeGroup","localIndicies","li","nodeSingle","styles","nodeStart","nodeEnd","nodeMiddle","onCleanup","el","MIN_FUZZY_SCORE","createButtonMenuIcon","isChecked","docId","emoji","failedToFetchIcon","setFailedToFetchIcon","createSignal","_el$","_tmpl$","_$insert","_$createComponent","Show","when","fallback","IconTsx","icon","getIconForFilter","children","FolderAnimatedIcon","managers","color","size","onFail","dontAnimate","pFlags","title_noanimate","Transition","enterActiveClass","AppearZoomEnterActive","exitActiveClass","enterClass","AppearZoomEnter","exitToClass","AppearZoomExitTo","_el$2","_$effect","_$className","ItemIconCheck","ItemIcon","createButtonMenuLabel","label","isSelected","_el$3","ItemLabelEnter","ItemLabel","createFolderItems","filters","isInFilter","onToggle","currentFilter","createMemo","createMiddleware","debug","destroy","map","extractedTitle","extractEmojiFromFilterTitle","text","get","classList","add","ItemLabelText","options","iconElement","textElement","id","onClick","noop","buttonMenuItem","ButtonMenuItem","element","addEventListener","CLICK_EVENT_NAME","e","shiftKey","stopPropagation","Item","createEffect","selected","remove","textContent","useToggleDialogInFilter","dialog","onNewDialog","hasRequestInProgress","unwrapped","unwrap","newDialog","dialogsStorage","getAnyDialog","isDialog","createSearchableFolders","folderItems","search","setSelected","folders","visibleFoldersCount","sortedFolders","src","finderResult","sort","found1","score1","found2","score2","scrollIntoView","block","forEach","Hidden","useTooltipHint","pivot","closeTooltip","setTimeout","undefined","showHint","showTooltip","vertical","i18n","lighter","auto","useOverlay","onClose","close","closeAndDisableTooltip","useInputKeydown","setSearch","selectedFilter","includes","code","preventDefault","contextMenuController","increment","prev","HAVE_SCROLL_WHEN_ABOVE","AddToFolderDropdownMenu","defineSolidElement","name","component","props","_","controls","Container","infoIcon","thumb","selectableFolders","setSelectableFolders","createSelector","localId","renderAsScrollable","toggleDialogInFilter","searchableFolders","onInputKeyDown","onMount","createComputed","toggle","withScrollable","cleanupEscapeHandler","appNavigationController","registerEscapeHandler","Items","For","each","folder","_tmpl$2","style","setProperty","IS_MOBILE","focus","target","$$input","value","Input","EmptySearchTip","Scrollable","thumbRef","_ref$","_$use","LabelText","ref","r$","_ref$2","Label","_p$","_v$","ScrollableContainer","_v$2","mobile","_$classList","_$delegateEvents"],"mappings":"u8BAAwB,SAAAA,GAAiBC,EAAaC,EAAgB,CAC7D,OAAAC,EAAqBF,EAAI,YAAY,EAAGC,EAAO,YAAY,EAAGA,EAAO,MAAM,CACpF,CAEA,SAASC,EAAqBF,EAAaC,EAAgBE,EAAY,CACjE,IAAAC,EAAyB,CAAA,EAAIC,EAAY,EAE7C,MAAMC,EAAIN,EAAI,OACRO,EAAIN,EAAO,OAEjB,QAAQO,EAAI,EAAGA,EAAID,EAAGC,IACpB,QAAQC,EAAI,EAAGA,EAAIH,EAAGG,IAAK,CACzB,GAAGT,EAAIS,CAAC,IAAMR,EAAOO,CAAC,EAAG,SAEzB,KAAM,CAAC,MAAAE,CAAS,EAAAR,EAAqBF,EAAI,MAAMS,EAAI,CAAC,EAAGR,EAAO,MAAMO,EAAI,CAAC,EAAGL,CAAE,EACxEQ,EAAc,CAACF,EAAG,GAAGC,EAAM,IAAUE,GAAAA,EAAKH,EAAI,CAAC,CAAC,EAEhDI,EAAIC,EAAMd,EAAKC,EAAQU,EAAaR,CAAQ,EAAIY,EAAY,QAAQZ,CAAE,EAAIK,EAC7EK,EAAIR,IACOA,EAAAQ,EACGT,EAAAO,EAEnB,CAGK,MAAA,CAAC,MAAOP,EAAc,MAAOU,EAAMd,EAAKC,EAAQG,EAAcD,CAAQ,EAC/E,CAEA,MAAMY,EAAc,CAClB,QAAUC,GAAmB,EAAIA,EACjC,IAAK,CAACA,EAAgBC,IAAgB,IAAOD,EAASC,CACxD,EAEA,SAASH,EAAMd,EAAaC,EAAgBiB,EAAoBf,EAAYgB,EAA4B,CACtG,MAAMb,EAAIN,EAAI,OAAQO,EAAIN,EAAO,OAAQmB,EAAIF,EAAS,OACtD,GAAG,CAACE,EAAU,MAAA,GAEd,IAAIC,EAAS,EAETT,EAAK,EAAGU,EAAS,GACrB,QAAQb,EAAI,EAAGA,EAAIW,GAAKR,EAAKL,EAAGE,IAAK,CAC7B,MAAAc,EAAKL,EAAST,CAAC,EACrB,GAAG,EAAEc,EAAKjB,GAAI,MAEd,KAAMN,EAAIuB,CAAE,IAAMtB,EAAOW,CAAE,GAAKA,EAAKL,GACnCK,IACUS,GAAAN,EAAY,QAAQZ,CAAE,EAElCS,IAEGU,GAAU,IAAMC,EAAKD,EAAS,IAC/BD,GAAUN,EAAY,IAAIR,EAAGgB,EAAKD,EAAS,CAAC,GAGrCA,EAAAC,CACX,CAEsB,OAAAF,IAAWlB,EAAKS,GAAMG,EAAY,QAAQZ,CAAE,EAE3DkB,CACT,gjCC/CaG,EAAMC,GAAO,0BAA2BC,GAAS,KAAK,EAEnE,eAAsBC,IAAqB,CAGzC,OAFgB,MAAMC,EAAU,SAAS,eAAe,iBAAiB,GAGxE,OAAiBC,GAAAA,EAAO,KAAOC,IAAqBD,EAAO,KAAOE,EAAa,EAC/E,KAAK,CAACC,EAAGC,IACL,CAACD,EAAE,IAAM,CAACC,EAAE,GAAW,EACnBD,GAAG,QAAUC,GAAG,OACxB,CACH,CAEA,MAAMC,EAAKA,GAAc,KAAK,IAAIA,CAAC,EAEb,eAAAC,GAAYN,EAAwBO,EAAgB,CACpEZ,EAAA,MAAM,qBAAsBK,CAAM,EAC7BA,EAAA,CAAC,GAAGA,GAEVA,EAAO,IAAM,iBACPA,EAAA,eAAiBA,EAAO,gBAAgB,OAAOQ,GAAkBH,EAAEG,CAAc,IAAMH,EAAEE,CAAM,CAAC,EACvGP,EAAO,cAAgBA,EAAO,eAAe,OAAoBS,GAAAJ,EAAEK,EAAUD,CAAS,CAAC,IAAMJ,EAAEE,CAAM,CAAC,GAGtFP,EAAO,cAAc,KAAKW,GAAgBN,EAAEM,CAAY,IAAMN,EAAEE,CAAM,CAAC,IAGvFP,EAAO,eAAiB,CAAC,IAAIA,EAAO,gBAAkB,CAAA,GAAI,OAAyBY,GAAAP,EAAEO,CAAc,IAAMP,EAAEE,CAAM,CAAC,EAAGA,CAAM,EACpHP,EAAA,cAAgB,CAAC,IAAIA,EAAO,eAAiB,CAAI,GAAA,OAAoBS,GAAAJ,EAAEK,EAAUD,CAAS,CAAC,IAAMJ,EAAEE,CAAM,CAAC,EAAG,MAAMR,EAAU,SAAS,gBAAgB,iBAAiBQ,CAAM,CAAC,GAGnLZ,EAAA,MAAM,oBAAqBK,CAAM,EAErC,MAAMD,EAAU,SAAS,eAAe,mBAAmBC,CAAM,CACnE,CAEsB,eAAAa,GAAiBb,EAAwBO,EAAgB,CACzEZ,EAAA,MAAM,0BAA2BK,CAAM,EAClCA,EAAA,CAAC,GAAGA,GAENA,EAAA,eAAiBA,EAAO,gBAAgB,OAAOY,GAAkBP,EAAEE,CAAM,IAAMF,EAAEO,CAAc,CAAC,EACvGZ,EAAO,cAAgBA,EAAO,eAAe,OAAoBS,GAAAJ,EAAEK,EAAUD,CAAS,CAAC,IAAMJ,EAAEE,CAAM,CAAC,EAE/FP,EAAA,cAAgBA,EAAO,eAAe,OAAOW,GAAgBN,EAAEE,CAAM,IAAMF,EAAEM,CAAY,CAAC,EACjGX,EAAO,aAAeA,EAAO,cAAc,OAAoBS,GAAAJ,EAAEK,EAAUD,CAAS,CAAC,IAAMJ,EAAEE,CAAM,CAAC,EAEjGP,EAAO,IAAM,iBACdA,EAAO,eAAiB,CAAC,IAAIA,EAAO,gBAAkB,CAAA,GAAI,OAAyBQ,GAAAH,EAAEG,CAAc,IAAMH,EAAEE,CAAM,CAAC,EAAGA,CAAM,EACpHP,EAAA,cAAgB,CAAC,IAAIA,EAAO,eAAiB,CAAI,GAAA,OAAoBS,GAAAJ,EAAEK,EAAUD,CAAS,CAAC,IAAMJ,EAAEE,CAAM,CAAC,EAAG,MAAMR,EAAU,SAAS,gBAAgB,iBAAiBQ,CAAM,CAAC,GAGnLZ,EAAA,MAAM,yBAA0BK,CAAM,EAE1C,MAAMD,EAAU,SAAS,eAAe,mBAAmBC,CAAM,CACnE,CAEgB,SAAAc,GAAsBC,EAA0CC,EAAwB,CAChG,MAAAC,EAAwB,SAAS,cAAc,MAAM,EACrDC,EAAWC,GAAgBJ,EAAOC,EAAY,EAAI,EAExDC,EAAK,OAAOC,CAAQ,EAEyBD,EAAK,cAAc,+BAA+B,GACrF,aAAa,oBAAoB,EAE3C,MAAMG,EAAa,SAAS,iBAAiBH,EAAM,WAAW,SAAS,EAEjEI,EAAgB,CAAA,EAChBC,EAAmC,CAAA,EAEnC,KAAAF,EAAW,YACTC,EAAA,KAAKD,EAAW,WAAW,EAGnC,UAAUG,KAAQF,EAAO,CACjBH,MAAAA,EAAW,SAAS,yBAEpBM,EAAYD,EAAK,UAAU,MAAM,EAAE,EAAE,IAAYE,GAAA,CAC/C,MAAAC,EAAW,SAAS,cAAc,MAAM,EAC9C,OAAAA,EAAS,UAAYD,EACdC,CAAA,CACR,EAEDJ,EAAgB,KAAKE,CAAS,EAC9BN,EAAS,OAAO,GAAGM,CAAS,EAEvBD,EAAA,WAAW,aAAaL,EAAUK,CAAI,CAC7C,CAEO,MAAA,CACL,KAAAN,EACA,gBAAAK,CAAA,CAEJ,CAEgB,SAAAK,GAAmBC,EAA6BvC,EAAoB,CAClF,IAAIwC,EAAM,EAEV,MAAMC,EAA2B,CAAA,EAEjC,UAAUC,KAAaH,EAAY,CACjC,MAAMnD,EAAIsD,EAAU,OAEdC,EAAgB3C,EAAS,OAAOT,GAAKA,GAAKiD,GAAOjD,EAAIiD,EAAMpD,CAAC,EAAE,IAAIG,GAAKA,EAAIiD,CAAG,EAC9EnD,EAAIsD,EAAc,OAEjBH,GAAApD,EAEP,QAAQG,EAAI,EAAGA,EAAIF,EAAGE,IAAK,CACzB,IAAID,EAAIC,EACF,KAAAD,EAAID,EAAI,GAAKsD,EAAcrD,EAAI,CAAC,EAAI,IAAMqD,EAAcrD,CAAC,GAAGA,IAElE,GAAGA,IAAMC,EAAG,CACJ,MAAAqD,EAAKD,EAAcpD,CAAC,EACpBsD,EAAaH,EAAUE,CAAE,EAC/BC,EAAW,UAAU,IAAIC,EAAO,KAAMA,EAAO,MAAM,EACnDL,EAAU,KAAKI,CAAU,EACzB,QACF,CAEA,MAAME,EAAYL,EAAUC,EAAcpD,CAAC,CAAC,EACtCyD,EAAUN,EAAUC,EAAcrD,CAAC,CAAC,EAE1CyD,EAAU,UAAU,IAAID,EAAO,KAAMA,EAAO,KAAK,EACjDE,EAAQ,UAAU,IAAIF,EAAO,KAAMA,EAAO,GAAG,EAEnCL,EAAA,KAAKM,EAAWC,CAAO,EAEjC,QAAQ9C,EAAIX,EAAI,EAAGW,EAAIZ,EAAGY,IAAK,CAC7B,MAAM+C,EAAaP,EAAUC,EAAczC,CAAC,CAAC,EAC7C+C,EAAW,UAAU,IAAIH,EAAO,KAAMA,EAAO,MAAM,EACnDL,EAAU,KAAKQ,CAAU,CAC3B,CAEI1D,EAAAD,CACN,CACF,CAEA4D,EAAU,IAAM,CACdT,EAAU,QAAcU,GAAA,CACtBA,EAAG,UAAY,EAAA,CAChB,CAAA,CACF,CACH,qBCrIMC,GAAkB,IAUXC,GAAuBA,CAAC,CAAC1C,OAAAA,EAAQ2C,UAAAA,EAAWC,MAAAA,EAAOC,MAAAA,CAA+B,IAAM,CACnG,KAAM,CAACC,EAAmBC,CAAoB,EAAIC,EAAa,EAAK,EAEpE,OAAA,IAAA,CAAA,MAAAC,EAAAC,IAAAC,OAAAA,EAAAF,EAAAG,EAEKC,EAAI,CAAA,IACHC,MAAI,CAAA,OAAGV,GAASC,IAAU,CAACC,EAAiB,CAAE,EAAA,IAC9CS,UAAQ,CAAA,OAAAH,EAAGI,EAAO,CAAA,IAACC,MAAI,CAAA,OAAEC,GAAiB1D,CAAM,CAAC,CAAA,CAAA,CAAA,EAAA,IAAA2D,UAAA,CAAA,OAAAP,EAEhDQ,GAAkB,CAAA,IACjBC,UAAQ,CAAA,OAAE9D,EAAU8D,QAAQ,EAC5BC,MAAK,qBACLlB,MAAOA,EACPC,MAAOA,EACPkB,KAAM,GACNC,OAAQA,IAAMjB,EAAqB,EAAI,EAAC,IACxCkB,aAAW,CAAA,OAAEjE,EAAOkE,QAAQC,eAAe,CAAA,CAAA,CAAA,CAAA,CAAA,EAAA,IAAA,EAAAhB,EAAAF,EAAAG,EAG9CgB,GAAU,CAAA,IACTC,kBAAgB,CAAA,OAAElC,EAAOmC,qBAAqB,EAAA,IAC9CC,iBAAe,CAAA,OAAEpC,EAAOmC,qBAAqB,EAAA,IAC7CE,YAAU,CAAA,OAAErC,EAAOsC,eAAe,EAAA,IAClCC,aAAW,CAAA,OAAEvC,EAAOwC,gBAAgB,EAAA,IAAAhB,UAAA,CAAA,OAAAP,EAEnCC,EAAI,CAAA,IAACC,MAAI,CAAA,OAAEX,EAAS,CAAE,EAAA,IAAAgB,UAAA,CAAA,MAAAiB,EAAA1B,IAAAC,OAAAA,EAAAyB,EAAAxB,EAElBI,EAAO,CAACC,KAAI,OAAA,CAAA,CAAA,EAAAoB,MAAAC,EAAAF,EADFzC,EAAO4C,aAAa,CAAA,EAAAH,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAA,IAAA,EAAAC,EAAA,IAAAC,EAAA7B,EAtBzB,sBAAqBd,EAAO6C,QAAS,EAAC,CAAA,EAAA/B,CAAA,IA6BxD,EAQagC,GAAwBA,CAAC,CAACC,MAAAA,EAAOC,WAAAA,CAAqC,KAAC,IAAA,CAAA,MAAAC,EAAAlC,IAAAC,OAAAA,EAAAiC,EAE/EF,EAAK,IAAA,EAAA/B,EAAAiC,EAAAhC,EACLC,EAAI,CAAA,IAACC,MAAI,CAAA,OAAE6B,EAAU,CAAE,EAAA,IAAAxB,UAAA,CAAA,OAAAP,EACrBI,EAAO,CAACC,KAAI,QAAA,IAAA,OAAA,CAAA,OAAgBtB,EAAOkD,cAAc,CAAA,CAAA,CAAA,CAAA,CAAA,EAAA,IAAA,EAAAR,MAAAC,EAAAM,EAHzCjD,EAAOmD,SAAS,CAAA,EAAAF,CAAA,KAmBlBG,GAAoBA,CAAC,CAACC,QAAAA,EAASC,WAAAA,EAAYN,WAAAA,EAAYO,SAAAA,EAAUC,cAAAA,CAAoC,IAAMC,EAAW,IAAM,CACvI,MAAM5E,EAAa6E,KACnBlG,OAAAA,EAAImG,MAAM,uBAAuB,EAEjCvD,EAAU,IAAM,CACd5C,EAAImG,MAAM,oCAAoC,EAC9C9E,EAAW+E,QAAO,CACpB,CAAC,EAEMP,EAAO,EAAGQ,IAAKhG,GAAW,CAC/B,MAAMiG,EAAiBC,GAA4BlG,EAAOe,KAAK,EACzD,CAACE,KAAAA,EAAMK,gBAAAA,CAAe,EAAIR,GAAsBmF,EAAeE,KAAMnF,EAAWoF,IAAK,CAAA,EAC3FnF,EAAKoF,UAAUC,IAAInE,EAAOoE,aAAa,EAEvC,MAAMC,EAAiC,CACrCC,YAAa/D,GAAqB,CAAC1C,OAAAA,EAAQ2C,UAAWA,IAAM8C,EAAWzF,CAAM,EAAG4C,MAAOqD,EAAerD,MAAOC,MAAOoD,EAAepD,KAAK,CAAC,EACzI6D,YAAazB,GAAsB,CAACC,MAAOjE,EAAMkE,WAAYA,IAAMA,EAAWnF,EAAO2G,EAAE,CAAC,CAAC,EACzFC,QAASC,GAGLC,EAAiBC,GAAeP,CAAO,EAE7CA,OAAAA,EAAQQ,SAASC,iBAAiBC,EAAkB,MAAMC,GAAM,CAC3DA,EAAEC,UAAYzB,EAAe,IAAK3F,EAAO2G,IAAIQ,EAAEE,kBAClD3B,EAAS1F,CAAM,CAChB,EAAE,EAAI,EACPwG,EAAQQ,SAASX,UAAUC,IAAInE,EAAOmF,IAAI,EAE1CC,EAAa,IAAM,CACbpC,EAAWnF,EAAO2G,EAAE,IACxBH,EAAQQ,SAASX,UAAUC,IAAInE,EAAOqF,QAAQ,EAC9CjF,EAAU,IAAM,KAAKiE,EAAQQ,SAASX,UAAUoB,OAAOtF,EAAOqF,QAAQ,CAAC,EACzE,CAAC,EAEM,CACLxH,OAAAA,EACA0H,YAAazG,EAAKyG,YAClBZ,eAAAA,EACAE,QAASR,EAAQQ,QACjB1F,gBAAAA,EAEJ,CAAC,CACH,CAAC,EASYqG,GAA0BA,CAAC,CAACC,OAAAA,EAAQC,YAAAA,EAAapC,WAAAA,CAAuC,IAAM,CACzG,IAAIqC,EAAuB,GAE3B,MAAO,OAAM9H,GAA2B,CACtC,GAAG8H,GAAwB,CAAC9H,EAAQ,OAEpC,MAAM+H,EAAYC,GAAOhI,CAAM,EAE/B8H,EAAuB,GAEvB,GAAI,CACF,MAAOrC,EAAWzF,CAAM,EAAIa,GAAiBkH,EAAWH,EAAQ,EAACrH,MAAM,EAAID,GAAYyH,EAAWH,EAAM,EAAGrH,MAAM,GACjH,MAAM0H,EAAY,MAAMlI,EAAU8D,SAASqE,eAAeC,aAAaP,IAASrH,MAAM,EACtF,GAAG,CAAC6H,GAASH,CAAS,EAAG,OACzBJ,EAAYI,CAAS,CACtB,MAAM,CAAA,QAAW,CAChBH,EAAuB,EACzB,EAEJ,EAUaO,GAA0BA,CAAC,CAACC,YAAAA,EAAaC,OAAAA,EAAQpD,WAAAA,EAAYqD,YAAAA,CAAwC,IAAM5C,EAAW,IAAM,CACvI,GAAG,CAAC2C,EAAM,EAAI,MAAO,CACnBE,QAASH,EAAa,EACtBI,oBAAqBJ,EAAW,EAAGnJ,QAQrC,MAAMwJ,EALiBL,IAActC,IAAK4C,IAAS,CACjDC,aAAc3K,GAAiB0K,EAAIlB,YAAaa,EAAM,CAAE,EACxDK,IAAAA,CACD,EAAC,EAGDE,KAAK,CAAC,CAACD,aAAc,CAAChK,MAAOkK,EAAQ9J,MAAO+J,CAAM,CAAC,EAAG,CAACH,aAAc,CAAChK,MAAOoK,EAAQhK,MAAOiK,CAAM,CAAE,IACnGF,IAAWE,GAAUH,EAAO,CAAC,GAAK,IAAME,EAAO,CAAC,GAAK,GAAKC,EAASF,CACrE,EAEAR,EAAY,CAAC,EACbjG,EAAU,IAAM,KAAKiG,EAAW,CAAE,EAElC,MAAME,EAAsBC,EAAc3I,OAAO,CAAC,CAAC4I,IAAAA,EAAKC,aAAAA,CAAY,IAAM,CACxE,GAAGA,EAAa5J,OAASwD,GACvB8E,OAAAA,EAAa,IAAM,CACdpC,EAAWyD,EAAI5I,OAAO2G,EAAE,GAAGiC,EAAI5B,QAAQmC,eAAe,CAACC,MAAO,QAAQ,CAAC,CAC5E,CAAC,EAEDzH,GAAmBiH,EAAItH,gBAAiBuH,EAAahK,KAAK,EAEnD,GAGT+J,EAAI9B,eAAeuC,QAAQ7G,GAAMA,EAAG6D,UAAUC,IAAInE,EAAOmH,MAAM,CAAC,EAChE/G,EAAU,IAAM,KAAKqG,EAAI9B,eAAeuC,QAAQ7G,GAAMA,EAAG6D,UAAUoB,OAAOtF,EAAOmH,MAAM,CAAC,CAAC,CAC1F,CAAA,EAAEnK,OAEH,MAAO,CACLsJ,QAASE,EAAc3C,IAAI,CAAC,CAAC4C,IAAAA,CAAI,IAAKA,CAAG,EACzCF,oBAAAA,EAEJ,CAAC,EAOYa,GAAiBA,CAAC,CAACC,MAAAA,CAAyB,IAAM,CAC7D,IAAIC,EAAe5C,EAEnB6C,kBAAW,IAAM,CACfD,EAAeE,MAChB,EAAE,GAAG,EAENpH,EAAU,IAAM,CACdkH,KACF,CAAC,EAsBM,CACLG,SArBeA,IAAM,CAClBH,IACHA,EAAeI,GAAY,CACzB7C,QAASwC,EAAO,EAChBM,SAAU,MACVpD,YAAaqD,EAAK,gBAAgB,EAClCC,QAAS,GACTC,KAAM,GACNC,WAAY,GACZC,QAASA,IAAM,CACbV,EAAeE,MACjB,CACD,CAAA,EAAES,QAUHC,uBAP6BA,IAAM,CACnCZ,MACAA,EAAe5C,GAOnB,EAcayD,GAAkBA,CAAC,CAAC/B,OAAAA,EAAQgC,UAAAA,EAAW/C,SAAAA,EAAUgB,YAAAA,EAAagC,eAAAA,EAAgB7E,cAAAA,EAAeD,SAAAA,EAAUgD,oBAAAA,CAAwC,IAClJvB,GAAqB,CAQ3B,GAPG,CAAC,UAAW,YAAa,YAAa,aAAc,OAAO,EAAEsD,SAAStD,EAAEuD,IAAI,GAAGvD,EAAEwD,eAAc,EAE/FxD,EAAEuD,OAAS,WACTnC,EAAQ,EAAEgC,EAAU,EAAE,EACpBK,EAAsBR,SAG1BjD,EAAEuD,OAAS,SAAWF,EAAc,EAAI,CACzC9E,EAAS8E,EAAc,CAAE,GACtB,CAACrD,EAAEC,UAAYzB,EAAe,IAAK6E,EAAc,EAAG7D,KAAIiE,EAAsBR,QACjF,MACF,CAEA,GAAG,OAAO5C,KAAe,SAAU,OAEnC,MAAMqD,EAAY,CAAC,UAAW,WAAW,EAAEJ,SAAStD,EAAEuD,IAAI,EAAI,GAAK,CAAC,YAAa,YAAY,EAAED,SAAStD,EAAEuD,IAAI,EAAI,EAAI,EACtHlC,EAAYsC,IAASA,EAAOD,EAAYnC,EAAqB,GAAIA,EAAmB,CAAE,gCC5QpFqC,GAAyB,EAYzBC,GAA0BC,GAAmB,CACjDC,KAAM,8BACNC,UAAWA,CAACC,EAA2BC,EAAGC,IAAyC,CAEjFF,EAAMpE,QAAQX,UAAUC,IAAI,WAAYnE,EAAOoJ,SAAS,EAExD,IAAIC,EAAuBtG,EAAuBuG,EAElD,KAAM,CAAClD,EAAQgC,CAAS,EAAIvH,EAAa,EAAE,EACrC,CAACwE,EAAUgB,CAAW,EAAIxF,EAAqB,EAC/C,CAAC0I,EAAmBC,CAAoB,EAAI3I,EAA2B,CAAE,CAAA,EAEzEyC,EAAamG,EACjB,IAAMR,EAAMxD,OACZ,CAAC5H,EAAwB4H,IAAW,CAAC,CAACA,IAAU,SAAQ5H,EAAO6L,OAAQ,EAAC,CAC1E,EAEMrB,EAAiB5E,EAAW,IAAM8F,IAAoBlE,EAAU,CAAA,GAAGxH,MAAM,EACzEmF,EAAayG,EAAe,IAAMpB,KAAkB7D,EAAE,EAEtDmF,EAAqBlG,EAAW,IAAMwF,EAAM5F,QAAQrG,OAAS4L,EAAsB,EAEnFgB,EAAuBpE,GAAwB,CACnDC,OAAQA,IAAMwD,EAAMxD,OACpBC,YAA4BI,GAAA,CAC1BmD,EAAMxD,OAASK,EACfmD,EAAMvD,cAAcI,CAAS,CAC/B,EACAxC,WAAAA,CAAAA,CACD,EAEK6C,EAAc/C,GAAkB,CACpCC,QAASA,IAAM4F,EAAM5F,QACrBC,WAAAA,EACAN,WAAAA,EACAO,SAAUqG,EACVpG,cAAeyF,EAAMzF,aAAAA,CACtB,EAEKqG,EAAoB3D,GAAwB,CAChDC,YAAAA,EACAC,OAAAA,EACApD,WAAAA,EACAqD,YAAAA,CAAAA,CACD,EAEK,CAACoB,SAAAA,GAAUS,uBAAAA,IAA0Bd,GAAe,CAACC,MAAOA,IAAMgC,CAAAA,CAAS,EACjFF,EAAS7B,aAAeY,GAExB,MAAM4B,GAAiB3B,GAAgB,CACrC/B,OAAAA,EACAgC,UAAAA,EACA/C,SAAAA,EACAgB,YAAAA,EACAgC,eAAAA,EACA7E,cAAeyF,EAAMzF,cACrBD,SAAUqG,EACVrD,oBAAqBA,IAAMsD,EAAAA,EAAoBtD,mBAAAA,CAChD,EAEDwD,GAAQ,IAAM,CACLjF,GAAAA,iBAAiBC,EAAuBC,GAAA,CAC7CA,EAAEE,gBAAgB,GACjB,EAAI,CAAA,CACR,EAGD8E,GAAe,IAAM,CACEH,EAAAA,IAAoBvD,OAAO,CAAA,CACjD,EAEDlB,EAAa,IAAM,CACd,OAAOC,KAAe,UAAUtC,GAAOiE,eAAe,CAACC,MAAO,QAAA,CAAS,CAAA,CAC3E,EAED7B,EAAa,IAAM,CACjB6D,EAAMpE,QAAQX,UAAU+F,OAAOjK,EAAOkK,eAAgBP,GAAoB,CAAA,CAC3E,EAED,MAAMQ,GAAuBC,GAAwBC,sBAAsB,IAAM,CAACjE,EAAQ,CAAA,EAE1FhG,EAAU,IAAM,CACd6I,EAAM7I,YAAY,EACG+J,IAAA,CACtB,EAEKG,MAAAA,EAAQA,IAAArJ,EACXsJ,GAAG,CAAA,IAACC,MAAI,CAAA,OAAEX,EAAoBvD,EAAAA,OAAO,EAAA9E,YACvBiJ,EAAO9F,cAAAA,CAEvB,EAED,OAAA1D,EACGC,EAAI,CAAA,IAACC,MAAI,CAAA,OAAEwI,EAAmB,CAAC,EAAA,IAAEvI,UAAQ,CAAAH,OAAAA,EAAGqJ,EAAK,CAAA,CAAA,CAAA,EAAA,IAAA9I,UAAA,CAAA,MAAAV,EAAA4J,IAAAC,OAAAA,EAAAA,MAAAC,YAAA,sBAAA,GAAA,EAAA9J,EAAAA,EAAAG,EAQ7CC,EAAI,CAACC,KAAM,CAAC0J,EAAS,IAAArJ,UAAA,CAAA,MAAAiB,EAAA1B,KASbV,OAAAA,EAAAA,GAAM,KAAKkH,WAAW,IAAM,KAAKlH,EAAGyK,QAAS,GAAG,EAACrI,CAAA,EAAAA,EAAAA,EAAA,UAD3CqH,GAAc,EAAA,EAAAhF,EAAAA,iBAHhBE,OAAMA,GAAA,CACbA,EAAE+F,OAAOD,OAAM,CAChB,EAAArI,EAAAuI,QAHahG,GAAA,KAAKoD,EAAUpD,EAAE+F,OAAOE,KAAK,EAACvI,MAAAC,EAAAF,EAFrCzC,EAAOkL,KAAK,CAAA,EAAAxI,MAAAD,EAAAwI,MACZ7E,EAAQ,CAAA,EAAA3D,CAAA,CAAA,CAAA,EAAA,IAAA,EAAA3B,EAAAA,EAAAG,EASlBC,EAAI,CAAA,IAACC,MAAI,CAAE,MAAA,CAAC0I,EAAoBtD,EAAAA,mBAAmB,EAAA,IAAA/E,UAAA,CAAA,OAChD,IAAM,CACAnB,MAAAA,EAAKuH,EAAK,8BAA8B,EAC3C1D,OAAAA,EAAAA,UAAUC,IAAInE,EAAOmL,cAAc,EAC/B9K,CAAAA,IACL,CAAA,CAAA,EAAA,IAAA,EAAAS,EAAAA,EAAAG,EAELmK,GAAU,CAAA,IAAA,OAAA,CAAA,OAAQpL,EAAOoL,UAAU,EAAEC,SAAkBhL,GAAA,KAAMiJ,EAAQjJ,GAAG,IAAAmB,UAAA,CAAAP,MAAAA,CAAAA,EACtEC,EAAI,CAACC,KAAM,CAAC0J,EAAS,IAAArJ,UAAA,CAAA,MAAAyB,EAAAyH,IAAAzH,EAAAA,EAAA,eACkCwE,EAAQ,EAAA,MAAA6D,EAApDvI,EAAK,cAAAuI,GAAAC,WAAAA,EAAAD,EAAArI,CAAA,EAALF,EAAKE,EAAAjC,EAAAiC,EACX,IAAM,CACA5C,MAAAA,EAAKuH,EAAK,mBAAmB,EAChC1D,OAAAA,EAAAA,UAAUC,IAAInE,EAAOwL,SAAS,EAC1BnL,GACR,IAAA,EAAA4C,EAAAA,EAAAhC,EACAI,EAAO,CAAAoK,IAAAC,EAAA,CAAA,MAAAC,EAAMtC,EAAQ,OAAAsC,cAAAA,EAAAD,CAAA,EAARrC,EAAQqC,CAAA,EAAEpK,KAAI,MAAA,CAAA,EAAA,IAAA,EAAAoB,MAAAC,EAAAM,EANNjD,EAAO4L,KAAK,CAAA,EAAA3I,CAAA,CAAAhC,CAAAA,EAAAA,EAUrCqJ,EAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAA,IAAA,EAAA5H,EAAAmJ,GAAA,CAAAC,MAAAA,EArCD9L,EAAO+L,oBAAmBC,EACtB,CACT,CAAChM,EAAOiM,MAAM,EAAGpB,CAAAA,EAClBiB,OAAAA,IAAAD,EAAAC,KAAAnJ,EAAA7B,EAAA+K,EAAAC,IAAAA,CAAA,EAAAD,EAAAG,KAAAE,GAAApL,EAAAkL,EAAAH,EAAAG,IAAA,EAAAH,CAAAA,EAAA,CAAAC,IAAAtE,OAAAwE,KAAAxE,MAAAA,CAAA,EAAA1G,CAAA,CAAA,CAAA,CAuCT,CACF,CAAC,EAGsCqL,GAAA,CAAA,QAAA,SAAA,CAAA"}