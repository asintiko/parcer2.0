{"version":3,"mappings":"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","names":["draw","gl","payload","parameters","initPositionBuffer","width","height","positionBuffer","positions","initTextureBuffer","textureCoordBuffer","textureCoordinates","initShaderProgram","vsSource","fsSource","vertexShader","loadShader","fragmentShader","shaderProgram","log","type","source","shader","weakRefs","r","createVideoForDrawing","mediaSrc","options","currentTime","waitToSeek","muted","video","createVideo","timeout","promise","onMediaLoad","handleVideoLeak","deferred","deferredPromise","e","loadTexture","mediaType","videoTime","middleware","texture","media","image","initWebGL","vertexShaderSource","fragmentShaderSource","__vitePreload","buffers","adjustmentsConfig","uniform","_BrushPainter","targetCanvas","imageCanvas","blurAmount","line","ctx","shouldFinish","points","hexaToRgba","w","h","pointsX","p","pointsY","minX","maxX","minY","maxY","brushFn","i","cx","cy","arrowLength","i2","distance","angle","angle1","angle2","vec1","vec2","animateValue","length","BrushPainter","useNormalizePoint","editorState","useMediaEditorContext","size","createMemo","x","point","transform","useProcessPoint","densityAware","drawAdjustedImage","mediaState","flip","rotation","scale","translation","imageSize","Object","fromEntries","map","key","to100","value","adjustments","BrushCanvas","actions","fullImageGLPayload","setFullImageGLPayload","createSignal","normalizePoint","processPoint","processLine","finalTransform","processedLines","brushDrawnLines","lastLine","setLastLine","canvas","_el$","_tmpl$","_$effect","_p$","_v$","currentTab","_v$2","isAdjusting","_v$3","canvasSize","pixelRatio","_v$4","classList","toggle","style","setProperty","removeProperty","_$setAttribute","undefined","getContext","brushCanvas","fullImageMultiplier","Math","min","fullImageCanvas","_el$2","_tmpl$2","_v$5","_v$6","preserveDrawingBuffer","fullBrushesCanvas","_el$3","_v$7","_v$8","brushPainter","fullBrushPainter","onMount","createMiddleware","get","onCleanup","cleanupWebGl","createEffect","on","setTimeout","redrawFull","redraw","resetLastLine","color","currentBrush","brush","isMoving","clearRect","save","translate","rotate","drawImage","restore","clear","saveLastLine","forEach","drawLine","processLineForFullImage","defaultBlurAmount","redrawBrushes","initialPosition","builtUpDistance","push","pushToHistory","path","newValue","oldValue","HistoryItem","RemoveArrayItem","updateBlurredImage","startSwipe","y","bcr","getBoundingClientRect","left","top","prev","previewLine","selectedResizableLayer","endSwipe","addEventListener","clientX","clientY","touches","swipeHandler","SwipeHandler","element","cursor","onSwipe","xDiff","yDiff","_e","lastPoint","onReset","animateArrowBrush","removeListeners","useCropOffset","getConvenientPositioning","extendCrop","cropOffset","imageWidth","imageHeight","snapToViewport","imageLeftTop","imagePoints","sin","cos","r2","cropWidth","cropHeight","currentImageRatio","cropLeftTop","cropPoints","cropPointsX","cropPointsY","cropMinX","cropMaxX","max","cropMinY","cropMaxY","imageMinX","imageMaxX","imageMinY","imageMaxY","MAX_SCALE","CropHandles","isCropping","leftTop","setLeftTop","leftTopDiff","setLeftTopDiff","setSize","diff","setDiff","withCurrentOwner","_getConvenientPositioning","getNewLeftTopAndSize","cancelSizeAnimation","resetSizeWithAnimation","initialDiff","initialLeftTopDiff","initialLeftTop","initialSize","targetDiff","targetLeftTopDiff","targetLeftTop","targetSize","progress","batch","lerpArray","multipliers","el","leftTopHandle","rightTopHandle","leftBottomHandle","rightBottomHandle","leftHandle","topHandle","rightHandle","bottomHandle","boundDiff","initialScale","initialTranslation","firstTarget","resizeSwipeHandlers","setCursorTo","document","body","onStart","add","target","fixed","fixedImageRatioKey","ratio","minW","minH","xd","Number","halfImageWidth","halfImageHeight","imageCenter","additionalScaleX","additionalScaleY","additionalScale","newWidth","newHeight","newRatio","upScale","targetScale","targetTranslation","modifyMutable","produce","state","lerp","onEnd","remove","translationSwipeHandler","cropArea","resistance","prevTranslation","handler","right","bottom","croppedSizeFull","cw","ch","coverAnimatedStyle","controlsAnimatedStyle","_$p","_$style","background","position","_el$4","_el$5","_el$6","firstChild","_el$7","nextSibling","_el$8","_el$9","_el$10","_el$11","_el$12","_el$13","_el$14","_el$15","_el$16","_el$17","_el$18","_el$19","_ref$","_$use","_ref$2","_ref$3","_ref$4","_ref$5","_ref$6","_ref$7","_ref$8","_ref$9","overflow","initVideoPlayback","renderingPayload","pendingSeek","time","flags","SetVideoTimeFlags","seekListener","listener","event","frameCallbackId","playing","skip","frameCallback","animate","clamp","ImageCanvas","ownedDrawAdjustedImage","ownedInitVideoPlayback","init","currentVideoTime","setInitialImageRatio","isReady","createReaction","PreviewBrushSize","_$createComponent","Show","when","previewBrushSize","children","includes","hexToRgb","join","useMediaQuery","query","isMatch","setIsMatch","updateMatch","mediaQueryList","useIsMobile","StickerLayerContent","props","container","wrapSticker","div","doc","layer","sticker","group","play","loop","withThumb","stickersLayersInfo","id","destroy","ResizableContainer","TextLayerContent","textInfo","onFocus","currentTextLayerInfo","fontInfo","fontInfoMap","font","deleteThisLayer","layers","resizableLayers","idx","findIndex","deletedLayer","splice","textRenderingInfo","findBy","updateBackground","contentEditable","childNodes","childNode","HTMLDivElement","hasAttributes","querySelectorAll","node","createTextNode","textContent","replaceWith","createElement","innerHTML","child","range","createRange","sel","window","getSelection","setStart","collapse","removeAllRanges","addRange","selection","rangeCount","getRangeAt","startContainer","startOffset","innerDiv","innerDivRange","selectNodeContents","querySelector","lines","getLinesRenderingInfo","alignment","createTextBackgroundPath","updateBackgroundStyle","updateOutlineStyle","clientWidth","clientHeight","selectAll","isThisLayerSelected","innerText","trim","preventDefault","getContrastColor","intialContent","layerInfo","_$insert","content","i18n","$$input","fontFamily","fontWeight","flexAlignMap","linesContainer","Array","from","_child","offset","first","rounding","arcParams","s","prevPosition","prevY","diffSign","abs","currentRounding","last","info","svg","createElementFromMarkup","prepend","updateSvg","stretch","baseline","bgDiv","center","_$delegateEvents","ResizableLayers","context","isTextTab","canClick","moveSelectedLayerOnTop","addLayer","newResizableLayer","resizableLayersSeed","_$addEventListener","For","each","isMobile","handleTyping","store","createMutable","containerWidth","containerHeight","leftTopEl","rightTopEl","leftBottomEl","rightBottomEl","circleOffset","canShowHandles","resizeHandlesContainer","processedLayer","useResizeHandles","useContextMenu","unobserve","observeResize","$$click","_c$","_$memo","Portal","mount","_tmpl$3","_v$9","_v$10","_v$11","_v$12","PI","_v$13","_v$14","_v$15","_v$16","_v$17","_v$18","_v$19","_v$20","swipeStarted","_","__","getEvent","initialVector","resizedVector","rotationFromHorizon","atan2","hypot","moveHandler","find","onClick","otherLayer","contextMenu","createContextMenu","buttons","icon","className","text","listenTo","onElementReady","animateToNewRotationOrRatio","newRotation","snappedRotation90","isReversedRatio","snappedRotation","parts","originalRatio","w1","h1","w2","h2","initialRotation","targetRotation","DEGREE_DIST_PX","DEGREE_STEP","TOTAL_DEGREES_SIDE","MAX_DEGREES_DIST_PX","SNAP_DIST_PX","rotationFromMove","amount","RotationWheel","moved","setMoved","movedDiff","setMovedDiff","swiperEl","round","prevRotation","currentDiff","prevShouldSnap","getShouldSnap","isAnimating","isSnapped","cancelAnimation","timeoutId","handleDiffChange","removeSnapAfterTimeout","shouldSnap","clearTimeout","newMoved","rotationFromSwiper","rotationDiff","resetWheelWithAnimation","values","resetRotationWheel","isFirstEffect","rotateLeft","flipImage","snapTo1","targetFlip","toFixed","replace","ButtonIconTsx","fill","ArrowUp","_tmpl$4","useFinalTransform","cropTabAnimationProgress","setCropTabAnimationProgress","cancel","prevCanvasSize","setPrevCanvasSize","prevCropTranslation","setPrevCropTranslation","prevAdditionalScale","setPrevAdditionalScale","additionalImageScales","imageRatio","toCropScale","getSnappedViewportsScale","fromCroppedScale","snappedImageScale","cropTrnsl","cropTranslation","prevScale","updatePrevValues","prevSize","currentSize","currentAdditionalScale","scaleToChange","counterScale","totalScale","v","t","eventsMap","registerGlobalDocumentEvent","eventName","callback","clb","useGlobalDocumentEvent","cleanup","swipe","args","isDragging","initialX","initialY","getDiffPointer","getDiffTouch","handleStart","globalCursor","handleMove","onMove","handleEnd","useVideoControlsCanvas","getCanvas","cleaned","chunkWidth","chunkHeight","fade","styles","HANDLE_WIDTH_PX","MOVE_ACTIVATION_THRESHOLD_PX","VideoControls","cropper","setCropper","isDraggingSomething","setIsDraggingSomething","cropperSize","useElementSize","strippedWidth","shouldShowTime","swiping","formattedResultingTime","totalSeconds","videoCropLength","duration","ts","hh","floor","padStart","mm","ss","decimal","minLength","initialStart","initialLength","leftHandleSwipeArgs","videoCropStart","isPlaying","setVideoTime","rightHandleSwipeArgs","maxLength","canMove","middleSwipeArgs","handleCursorMove","startDiff","self","cursorSwipeArgs","getPositionInCropper","onMiddlePartClick","showMutedTooltip","showTooltip","mountOn","parentElement","vertical","textElement","lighter","auto","closeTooltip","videoMuted","currentTarget","close","ripple","IconTsx","TimeStick","ThumbnailTrack","hidden","PausePlay","paused","Container","changed","InnerContainer","IconButton","MuteButton","Frames","Cropper","Images","CropperBg","CropperBgLeft","CropperBgRight","CropperHorizontalBorder","dragging","CropperHandle","CropperHandleLeft","CropperHandleRight","CroppedTime","_v$21","visible","_v$22","PlayButton","_v$23","PlayButtonInner","_$className","_$classList","ghostThumbnailPosition","setGhostThumbnailPosition","setIsDragging","isGhostThumbnailVisible","isNaN","videoThumbnailPosition","canPreviewFrame","previewFrameTimeout","onPointerMove","UpdateVideo","Redraw","onPointerOut","swipeArgs","ThumbnailMark","withTransition","ghost","$$touchend","$$pointerout","$$touchmove","$$pointermove","_v$24","_v$25","disabled","_v$26","_v$27","_v$28","_tmpl$5","_el$20","_el$21","_el$22","_el$23","_el$24","_v$29","PausePlaySvg","_v$30","_v$31","PausePlaySvgPlay","_v$32","PausePlaySvgPause","_v$33","PausePlaySvgPauseLeft","_v$34","PausePlaySvgPauseRight","TouchEvent","changedTouches","pos","MainCanvas","removeEventListener","SIDE_MAX","SIDE_MIN","getResultSize","videoType","quality","scaledWidth","scaledHeight","willResultInVideo","defaultCodec","highResCodec","getResultTransform","initialCanvasWidth","initialCanvasHeight","canvasRatio","snappedCanvasWidth","snappedCanvasHeight","getScaledLayersAndLines","scaledLines","scaledLayers","layerStore","unwrap","FRAMES_PER_SECOND","STICKER_SIZE","drawStickerLayer","drawTextLayer","renderingInfo","multiply","newPath","part","boxLeft","yOffset","xOffset","generateVideoPreview","previewWidth","previewHeight","mirrorCanvas","previewCanvas","previewCtx","mirrorCtx","stickerChild","resolve","ImageStickerFrameByFrameRenderer","blob","appDownloadManager","LottieStickerFrameByFrameRenderer","animation","lottieLoader","frame","VideoStickerFrameByFrameRenderer","getMiddleware","apiManagerProxy","delay","IS_FIREFOX","EXPECTED_FPS","VIDEO_COMPARISON_ERROR","THUMBNAIL_MAX_SIZE","logger","renderToActualVideo","hasAnimatedStickers","drawToImageCanvas","resultCanvas","mediaBlob","owner","getOwner","startTime","endTime","creationProgress","createRoot","dispose","setProgress","renderers","thumbnailCanvas","thumbnailCtx","thumbnailTime","currentVideoFrameDeferred","encodingPausedDeferred","lastTime","drewThumbnail","canceled","progressRAF","listenerSetter","ListenerSetter","initMuxerAndEncoder","Muxer","ArrayBufferTarget","audioBuffer","supportsAudioEncoding","extractAudioFragment","muxer","encoder","chunk","meta","calcCodecAndBitrate","BITRATE_TARGET_FPS","drawToTexture","initStickerRenderers","stickerType","renderer","StickerType","ThrowReason","ThrowReason2","prepareAndRenderFrame","frameNo","mediaTime","untilFrame","renderFrame","timestamp","appendToMuxer","promises","videoFrame","updateProgress","targetProgress","currentProgress","delta","preview","runWithOwner","resultPromise","reject","firstFrameSeekDeferred","done","encodeAndMuxAudio","buffer","thumbBlob","MediaSize","result","noop","audioContext","arrayBuffer","fullAudioBuffer","sampleRate","startSample","endSample","frameCount","numChannels","fragmentBuffer","fullData","onChunk","totalFrames","interleaved","channelData","audioData","renderToImage","renderToVideoGIF","maxFrames","spawnAnimatedPreview","previewBlob","animatedImg","createFinalResult","checkIfHasAnimatedStickers","maxHeight","maxQuality","snapToAvailableQuality","renderResult","animatedPreview","FinishButton","hasModifications","RangeInput","normalizedValue","nMap","mappedCenter","brightShadow","hexaToHsla","l","prevValue","ref","label","onChangeFinish","valueAsNumber","onChange","passiveLabel","StepInput","stepIndex","steps","step","isActive","createSelector","a","b","isSelected","index","ADJUST_TIMEOUT","AdjustmentsTab","mediaSize","removeIsAdjusting","resultingSize","debugResultingSize","console","maxVideoQuality","availableQualityHeights","filter","canShowQualityInput","Space","videoQuality","item","setContainer","showGhost","setShowGhost","setValue","append","removeGhost","currentValue","config","mediaEditorTabsOrder","Tabs","underline","tabs","onTabClick","tab","containerBR","targetBR","TabContentContext","createContext","TabContent","scrollAmount","setScrollAmount","prevElement","prevTab","scrollable","toRight","indexOf","newElement","Provider","setScrollable","cls","action","modifier","doubleRaf","initialTab","Scrollable","setListeners","onScroll","scrollTop","onContainer","StickersTab","wrapStickerSetThumb","EmoticonsSearch","useHotReloadGuard","useContext","managers","recentStickers","createResource","appStickersManager","getRecentStickersStickers","stickerSets","getAllStickers","filteredStickers","setFilteredStickers","search","setSearch","setGroup","activeSet","setActiveSet","scrolling","setScrolling","intersectionObserver","setIntersectionObserver","recentLabel","setRecentLabel","lazyLoadQueue","LazyLoadQueue","stickerRenderer","SuperStickerRenderer","regularLazyLoadQueue","intersectionObserverInit","root","withLock","onStickerSetThumbClick","String","scrollIntoView","behavior","block","StickerSetThumb","renderContainer","autoplay","set","textColor","Sticker","renderSticker","observeAnimated","newLayer","StickerSetLabel","observe","wrapEmojiText","title","StickerSetSection","stickers","getStickerSet","documents","ThumbList","thumbsListScrollable","ScrollableX","_tmpl$6","sets","IntersectionObserver","entries","entry","isIntersecting","dataset","setId","rootMargin","disconnect","searchStickers","g","getPremiumStickers","getStickersByEmoticon","emoticon","emoticons","includeServerStickers","_tmpl$7","onValue","onGroup","categoryColor","animatedItemGroup","_tmpl$8","PenBrush","ArrowBrush","MarkerBrush","NeonBrush","EraserBrush","BlurBrush","colorPickerSwatches","PICKER_WIDTH_PX","PICKER_HEIGHT_PX","SLIDER_WIDTH_PX","DEFAULT_SIZE_PX","ColorPicker","collapsed","setCollapsed","collapsing","setCollapsing","containerSize","setContainerSize","sizeContainer","swatch","hexColor","onCollapseToggle","previousColor","colorPicker","_ColorPicker","buildLayout","slider","pickerBox","hexInput","rgbInput","pickerBoxWidth","pickerBoxHeight","sliderWidth","thickSlider","hex","abortDrawerSlide","observer","ResizeObserver","colorKey","newCollapsed","then","getCurrentColor","setColor","createStoredColor","defaultColor","savedColor","setSavedColor","fallback","LargeButton","_$spread","_$mergeProps","active","class","BrushTab","savedBrushColors","pen","arrow","neon","savedBrushSignal","updateCurrentBrush","brushButton","brushSvg","hasColor","removeSizePreview","previous","transition","ratioRects","1x1","3x2","4x3","5x4","7x5","16x9","ratioIcon","rotated","Item","inProps","buttonProps","splitProps","CropTab","what","onRatioClick","_tmpl$9","TextTab","untrack","setAlignment","setStyle","toggleButton","fontButton","textFont","Topbar","doneButton","processHistory","history","otherHistory","pop","processHistoryItem","onUndo","redoHistory","onRedo","removeListener","addShortcutListener","combo","onClose","onFinish","Toolbar","toolbar","move","setMove","isCollapsed","setIsCollapsed","setContainerHeight","extraMove","setExtraMove","shouldHide","setShouldHide","startY","isAborted","isResetting","resetMove","startDrag","dragMove","dragEnd","initialMove","initialExtraMove","targetExtraMove","totalMove","crop","MediaEditor","contextValue","createContextValue","overlay","navigationItem","onPop","handleClose","appNavigationController","pushItem","focus","removeItem","onCanvasReady","onImageRendered","performClose","hasGif","finished","confirmationPopup","description","button","isFinishing","MediaEditorContext","handleFinish","finally","onEditFinish","isVideo","openMediaEditor","HotReloadGuardProvider","render","openMediaEditorFromMedia","editingMediaState","animatedCanvas","sourceWidth","sourceHeight","canvasBcr","leftDiff","topDiff","SolidJSHotReloadGuardProvider"],"ignoreList":[],"sources":["../src/components/mediaEditor/webgl/draw.ts","../src/components/mediaEditor/webgl/initBuffers.ts","../src/components/mediaEditor/webgl/initShaderProgram.ts","../src/components/mediaEditor/canvas/createVideoForDrawing.ts","../src/components/mediaEditor/webgl/loadTexture.ts","../src/components/mediaEditor/webgl/initWebGL.ts","../src/components/mediaEditor/canvas/brushPainter.ts","../src/components/mediaEditor/canvas/useNormalizePoint.ts","../src/components/mediaEditor/canvas/useProcessPoint.ts","../src/components/mediaEditor/canvas/brushCanvas.tsx","../src/components/mediaEditor/canvas/useCropOffset.ts","../src/components/mediaEditor/canvas/getConvenientPositioning.tsx","../src/components/mediaEditor/canvas/cropHandles.tsx","../src/components/mediaEditor/canvas/initVideoPlayback.ts","../src/components/mediaEditor/canvas/imageCanvas.tsx","../src/components/mediaEditor/canvas/previewBrushSize.tsx","../src/components/mediaEditor/useIsMobile.ts","../src/components/mediaEditor/canvas/stickerLayerContent.tsx","../src/components/mediaEditor/canvas/textLayerContent.tsx","../src/components/mediaEditor/canvas/resizableLayers.tsx","../src/components/mediaEditor/canvas/animateToNewRotationOrRatio.ts","../src/components/mediaEditor/canvas/rotationWheel.tsx","../src/components/mediaEditor/canvas/useFinalTransform.ts","../src/helpers/useGlobalDocumentEvent.ts","../src/helpers/useSwipe.ts","../src/components/mediaEditor/canvas/useVideoControlsCanvas.ts","../src/components/mediaEditor/canvas/videoControls.tsx","../src/components/mediaEditor/canvas/mainCanvas.tsx","../src/components/mediaEditor/finalRender/getResultSize.ts","../src/components/mediaEditor/finalRender/getResultTransform.ts","../src/components/mediaEditor/finalRender/getScaledLayersAndLines.ts","../src/components/mediaEditor/finalRender/constants.ts","../src/components/mediaEditor/finalRender/drawStickerLayer.ts","../src/components/mediaEditor/finalRender/drawTextLayer.ts","../src/components/mediaEditor/finalRender/generateVideoPreview.ts","../src/components/mediaEditor/finalRender/imageStickerFrameByFrameRenderer.ts","../src/components/mediaEditor/finalRender/lottieStickerFrameByFrameRenderer.ts","../src/components/mediaEditor/finalRender/videoStickerFrameByFrameRenderer.ts","../src/components/mediaEditor/finalRender/renderToActualVideo.ts","../src/components/mediaEditor/finalRender/renderToImage.ts","../src/components/mediaEditor/finalRender/renderToVideoGIF.ts","../src/components/mediaEditor/finalRender/spawnAnimatedPreview.ts","../src/components/mediaEditor/finalRender/createFinalResult.ts","../src/components/mediaEditor/finishButton.tsx","../src/components/mediaEditor/rangeInput.tsx","../src/components/mediaEditor/stepInput.tsx","../src/components/mediaEditor/tabs/adjustmentsTab.tsx","../src/components/mediaEditor/tabs/tabs.tsx","../src/components/mediaEditor/tabs/tabContent.tsx","../src/components/mediaEditor/tabs/stickersTab.tsx","../src/components/mediaEditor/brushesSvg.tsx","../src/components/mediaEditor/colorPicker.tsx","../src/components/mediaEditor/createStoredColor.ts","../src/components/mediaEditor/largeButton.tsx","../src/components/mediaEditor/tabs/brushTab.tsx","../src/components/mediaEditor/tabs/cropTab.tsx","../src/components/mediaEditor/tabs/textTab.tsx","../src/components/mediaEditor/topbar.tsx","../src/components/mediaEditor/toolbar.tsx","../src/components/mediaEditor/mediaEditor.tsx","../src/components/mediaEditor/index.ts"],"sourcesContent":["import {AdjustmentKey} from '../adjustments';\r\nimport {NumberPair} from '../types';\r\n\r\nimport {RenderingPayload} from './initWebGL';\r\n\r\n\r\ntype DrawingParameters = {\r\n  rotation: number;\r\n  scale: number;\r\n  translation: NumberPair;\r\n  imageSize: NumberPair;\r\n  flip: NumberPair;\r\n} & Record<AdjustmentKey, number>;\r\n\r\nexport function draw(gl: WebGLRenderingContext, payload: RenderingPayload, parameters: DrawingParameters) {\r\n  gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n  gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n  gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n  gl.bindBuffer(gl.ARRAY_BUFFER, payload.buffers.position);\r\n  gl.vertexAttribPointer(payload.attribs.vertexPosition, 2, gl.FLOAT, false, 0, 0);\r\n  gl.enableVertexAttribArray(payload.attribs.vertexPosition);\r\n\r\n  gl.bindBuffer(gl.ARRAY_BUFFER, payload.buffers.texture);\r\n  gl.vertexAttribPointer(payload.attribs.textureCoord, 2, gl.FLOAT, false, 0, 0);\r\n  gl.enableVertexAttribArray(payload.attribs.textureCoord);\r\n\r\n  gl.useProgram(payload.program);\r\n\r\n  gl.activeTexture(gl.TEXTURE0);\r\n  gl.bindTexture(gl.TEXTURE_2D, payload.texture);\r\n  gl.uniform1i(payload.uniforms.uSampler, 0);\r\n\r\n  gl.uniform1f(payload.uniforms.uAngle, -parameters.rotation);\r\n  gl.uniform2f(payload.uniforms.uResolution, gl.canvas.width, gl.canvas.height);\r\n  gl.uniform1f(payload.uniforms.uScale, parameters.scale);\r\n  gl.uniform2fv(payload.uniforms.uTranslation, parameters.translation);\r\n  gl.uniform2fv(payload.uniforms.uImageSize, parameters.imageSize);\r\n  gl.uniform2fv(payload.uniforms.uFlip, parameters.flip);\r\n\r\n  gl.uniform1f(payload.uniforms.uSaturation, parameters.saturation);\r\n  gl.uniform1f(payload.uniforms.uBrightness, parameters.brightness);\r\n  gl.uniform1f(payload.uniforms.uContrast, parameters.contrast);\r\n  gl.uniform1f(payload.uniforms.uWarmth, parameters.warmth);\r\n  gl.uniform1f(payload.uniforms.uFade, parameters.fade);\r\n  gl.uniform1f(payload.uniforms.uShadows, parameters.shadows);\r\n  gl.uniform1f(payload.uniforms.uHighlights, parameters.highlights);\r\n  gl.uniform1f(payload.uniforms.uVignette, parameters.vignette);\r\n  gl.uniform1f(payload.uniforms.uGrain, parameters.grain);\r\n  gl.uniform1f(payload.uniforms.uSharpen, parameters.sharpen);\r\n  gl.uniform1f(payload.uniforms.uEnhance, parameters.enhance);\r\n\r\n  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n}\r\n","export function initPositionBuffer(gl: WebGLRenderingContext, width: number, height: number) {\r\n  const positionBuffer = gl.createBuffer();\r\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\r\n\r\n  const positions = [0, 0, width, 0, 0, height, width, height];\r\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);\r\n\r\n  return positionBuffer;\r\n}\r\n\r\nexport function initTextureBuffer(gl: WebGLRenderingContext) {\r\n  const textureCoordBuffer = gl.createBuffer();\r\n  gl.bindBuffer(gl.ARRAY_BUFFER, textureCoordBuffer);\r\n\r\n  const textureCoordinates = [0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0];\r\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(textureCoordinates), gl.STATIC_DRAW);\r\n\r\n  return textureCoordBuffer;\r\n}\r\n","import {log} from '../utils';\r\n\r\nexport function initShaderProgram(gl: WebGLRenderingContext, vsSource: string, fsSource: string) {\r\n  const vertexShader = loadShader(gl, gl.VERTEX_SHADER, vsSource);\r\n  const fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fsSource);\r\n\r\n  const shaderProgram = gl.createProgram();\r\n  gl.attachShader(shaderProgram, vertexShader);\r\n  gl.attachShader(shaderProgram, fragmentShader);\r\n  gl.linkProgram(shaderProgram);\r\n\r\n  if(!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\r\n    log.error(`Unable to initialize the shader program: ${gl.getProgramInfoLog(shaderProgram)}`);\r\n    return null;\r\n  }\r\n\r\n  return shaderProgram;\r\n}\r\n\r\nfunction loadShader(gl: WebGLRenderingContext, type: GLenum, source: string) {\r\n  const shader = gl.createShader(type);\r\n\r\n  gl.shaderSource(shader, source);\r\n  gl.compileShader(shader);\r\n\r\n  if(!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n    log.error(`An error occurred compiling the shaders: ${gl.getShaderInfoLog(shader)}`);\r\n    gl.deleteShader(shader);\r\n    return null;\r\n  }\r\n\r\n  return shader;\r\n}\r\n","import deferredPromise from '../../../helpers/cancellablePromise';\r\nimport createVideo from '../../../helpers/dom/createVideo';\r\nimport handleVideoLeak from '../../../helpers/dom/handleVideoLeak';\r\nimport {Middleware} from '../../../helpers/middleware';\r\nimport onMediaLoad from '../../../helpers/onMediaLoad';\r\n\r\n\r\ntype Options = {\r\n  /**\r\n   * [0, 1] will be multiplied by duration\r\n   */\r\n  currentTime?: number;\r\n  muted?: boolean;\r\n  waitToSeek?: boolean;\r\n  middleware?: Middleware;\r\n};\r\n\r\nconst weakRefs: WeakRef<any>[] = [];\r\n\r\n\r\n// TODO: The video nodes themselves remain references somewhere, but they're src is cleaned up WTF\r\n(window as any).derefMediaEditorVideos = () => {\r\n  console.log('Dereffed weak refs ::>> ', weakRefs.map(r => r.deref()));\r\n}\r\n\r\nexport default async function createVideoForDrawing(mediaSrc: string, options: Options = {}) {\r\n  const currentTime = options.currentTime ?? 0;\r\n  const waitToSeek = options.waitToSeek ?? true;\r\n  const muted = options.muted ?? true;\r\n\r\n  const video = createVideo({pip: false, middleware: options.middleware});\r\n  video.src = mediaSrc;\r\n  video.autoplay = true;\r\n  video.controls = false;\r\n  video.muted = true; // prevent sound playing while we're waiting for metadata\r\n\r\n  weakRefs.push(new WeakRef(video));\r\n\r\n  let timeout: number;\r\n\r\n  video.addEventListener('timeupdate', () => {\r\n    video.pause();\r\n  }, {once: true});\r\n\r\n  // Theoretically we should not have any errors here as this is handled in the media popup\r\n  try {\r\n    const promise = onMediaLoad(video);\r\n    await handleVideoLeak(video, promise);\r\n\r\n    if(waitToSeek) {\r\n      const deferred = deferredPromise<void>();\r\n      video.addEventListener('seeked', () => void deferred.resolve(), {once: true});\r\n      timeout = self.setTimeout(() => deferred.resolve(), 500); // just in case\r\n\r\n      video.currentTime = video.duration * currentTime;\r\n\r\n      await deferred;\r\n      self.clearTimeout(timeout);\r\n    }\r\n  } catch(e) {\r\n    console.error(e);\r\n  }\r\n\r\n\r\n  if(!muted) video.muted = false;\r\n\r\n  return video;\r\n}\r\n","import deferredPromise from '../../../helpers/cancellablePromise';\r\nimport {Middleware} from '../../../helpers/middleware';\r\nimport createVideoForDrawing from '../canvas/createVideoForDrawing';\r\nimport {MediaType} from '../types';\r\n\r\n\r\ntype LoadTextureArgs = {\r\n  gl: WebGLRenderingContext;\r\n  mediaSrc: string;\r\n  mediaType: MediaType;\r\n  videoTime: number;\r\n  waitToSeek?: boolean;\r\n\r\n  middleware?: Middleware;\r\n};\r\n\r\ntype LoadTextureMedia = {\r\n  width: number;\r\n  height: number;\r\n  image?: HTMLImageElement;\r\n  video?: HTMLVideoElement;\r\n};\r\n\r\ntype LoadTextureResult = {\r\n  texture: WebGLTexture;\r\n  media: LoadTextureMedia;\r\n};\r\n\r\nexport async function loadTexture({gl, mediaSrc, mediaType, videoTime, waitToSeek, middleware}: LoadTextureArgs): Promise<LoadTextureResult> {\r\n  const texture = gl.createTexture();\r\n  gl.bindTexture(gl.TEXTURE_2D, texture);\r\n\r\n  let media: LoadTextureMedia;\r\n\r\n  if(mediaType === 'image') {\r\n    const image = new Image();\r\n    image.src = mediaSrc;\r\n\r\n    const deferred = deferredPromise<void>();\r\n    image.addEventListener('load', () => void deferred.resolve());\r\n    await deferred;\r\n\r\n    media = {\r\n      image,\r\n      width: image.naturalWidth,\r\n      height: image.naturalHeight\r\n    };\r\n  } else {\r\n    const video = await createVideoForDrawing(mediaSrc, {currentTime: videoTime, waitToSeek, middleware});\r\n\r\n    media = {\r\n      video,\r\n      width: video.videoWidth,\r\n      height: video.videoHeight\r\n    };\r\n  }\r\n\r\n  gl.bindTexture(gl.TEXTURE_2D, texture);\r\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, media.video || media.image);\r\n\r\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n\r\n  return {media, texture};\r\n}\r\n","import {Middleware} from '../../../helpers/middleware';\r\nimport {adjustmentsConfig, AdjustmentsConfig} from '../adjustments';\r\nimport {MediaType} from '../types';\r\n\r\nimport {initPositionBuffer, initTextureBuffer} from './initBuffers';\r\nimport {initShaderProgram} from './initShaderProgram';\r\nimport {loadTexture} from './loadTexture';\r\n\r\nexport type RenderingPayload = Awaited<ReturnType<typeof initWebGL>>;\r\n\r\ntype InitWebGLArgs = {\r\n  gl: WebGLRenderingContext;\r\n  mediaSrc: string;\r\n  mediaType: MediaType;\r\n  videoTime: number;\r\n  waitToSeek?: boolean;\r\n\r\n  middleware?: Middleware;\r\n};\r\n\r\nexport async function initWebGL({gl, mediaSrc, mediaType, videoTime, waitToSeek, middleware}: InitWebGLArgs) {\r\n  const [{vertexShaderSource, fragmentShaderSource}, {texture, media}] = await Promise.all([\r\n    import('./shaderSources'),\r\n    loadTexture({gl, mediaSrc, mediaType, videoTime, waitToSeek, middleware})\r\n  ]);\r\n\r\n  const shaderProgram = initShaderProgram(gl, vertexShaderSource, fragmentShaderSource);\r\n\r\n  const buffers = {\r\n    position: initPositionBuffer(gl, media.width, media.height),\r\n    texture: initTextureBuffer(gl)\r\n  };\r\n\r\n  return {\r\n    program: shaderProgram,\r\n    buffers,\r\n    media,\r\n    texture,\r\n    attribs: {\r\n      vertexPosition: gl.getAttribLocation(shaderProgram, 'aVertexPosition'),\r\n      textureCoord: gl.getAttribLocation(shaderProgram, 'aTextureCoord')\r\n    },\r\n    uniforms: {\r\n      uSampler: gl.getUniformLocation(shaderProgram, 'uSampler'),\r\n      uFlip: gl.getUniformLocation(shaderProgram, 'uFlip'),\r\n      uAngle: gl.getUniformLocation(shaderProgram, 'uAngle'),\r\n      uResolution: gl.getUniformLocation(shaderProgram, 'uResolution'),\r\n      uTranslation: gl.getUniformLocation(shaderProgram, 'uTranslation'),\r\n      uScale: gl.getUniformLocation(shaderProgram, 'uScale'),\r\n      uImageSize: gl.getUniformLocation(shaderProgram, 'uImageSize'),\r\n      ...(Object.fromEntries(\r\n        adjustmentsConfig.map(({uniform}) => [uniform, gl.getUniformLocation(shaderProgram, uniform)])\r\n      ) as Record<AdjustmentsConfig[number]['uniform'], WebGLUniformLocation>)\r\n    }\r\n  };\r\n}\r\n","import deferredPromise from '../../../helpers/cancellablePromise';\r\nimport {hexaToRgba} from '../../../helpers/color';\r\n\r\nimport {NumberPair} from '../types';\r\nimport {animateValue, delay, distance} from '../utils';\r\n\r\nexport type BrushDrawnLine = {\r\n  color: string;\r\n  brush: string;\r\n  size: number;\r\n  points: NumberPair[];\r\n};\r\n\r\ntype BrushPainterOptions = {\r\n  targetCanvas: HTMLCanvasElement;\r\n  imageCanvas: HTMLCanvasElement;\r\n  blurAmount?: number;\r\n};\r\n\r\nexport default class BrushPainter {\r\n  private imageCanvas: HTMLCanvasElement;\r\n  private cacheCanvas: HTMLCanvasElement;\r\n  private blurredImageCanvas: HTMLCanvasElement;\r\n  private blurredLineCanvas: HTMLCanvasElement;\r\n\r\n  private targetCtx: CanvasRenderingContext2D;\r\n  private cacheCtx: CanvasRenderingContext2D;\r\n  private blurredImageCtx: CanvasRenderingContext2D;\r\n  private blurredLineCtx: CanvasRenderingContext2D;\r\n\r\n  private width: number;\r\n  private height: number;\r\n\r\n  private blurAmount: number;\r\n\r\n  static defaultBlurAmount = 10;\r\n\r\n  constructor({targetCanvas, imageCanvas, blurAmount = BrushPainter.defaultBlurAmount}: BrushPainterOptions) {\r\n    this.targetCtx = targetCanvas.getContext('2d');\r\n    this.imageCanvas = imageCanvas;\r\n    this.blurAmount = blurAmount;\r\n\r\n    this.cacheCanvas = document.createElement('canvas');\r\n    this.blurredImageCanvas = document.createElement('canvas');\r\n    this.blurredLineCanvas = document.createElement('canvas');\r\n\r\n    this.width =\r\n      this.cacheCanvas.width =\r\n      this.blurredImageCanvas.width =\r\n      this.blurredLineCanvas.width =\r\n        targetCanvas.width;\r\n    this.height =\r\n      this.cacheCanvas.height =\r\n      this.blurredImageCanvas.height =\r\n      this.blurredLineCanvas.height =\r\n        targetCanvas.height;\r\n\r\n    this.cacheCtx = this.cacheCanvas.getContext('2d');\r\n    this.blurredImageCtx = this.blurredImageCanvas.getContext('2d');\r\n    this.blurredLineCtx = this.blurredLineCanvas.getContext('2d');\r\n  }\r\n\r\n  previewLine(line: BrushDrawnLine, shouldFinish = false) {\r\n    this.targetCtx.clearRect(0, 0, this.width, this.height);\r\n\r\n    this.targetCtx.drawImage(this.cacheCanvas, 0, 0);\r\n    const brushFn = this.brushes[line.brush];\r\n    this.targetCtx.save();\r\n    brushFn(line, this.targetCtx, shouldFinish);\r\n    this.targetCtx.restore();\r\n  }\r\n\r\n  saveLastLine() {\r\n    this.cacheCtx.clearRect(0, 0, this.width, this.height);\r\n    this.cacheCtx.drawImage(this.targetCtx.canvas, 0, 0);\r\n    this.updateBlurredImage();\r\n  }\r\n\r\n  updateBlurredImage() {\r\n    this.blurredImageCtx.clearRect(0, 0, this.width, this.height);\r\n    this.blurredImageCtx.filter = `blur(${this.blurAmount}px)`;\r\n    this.blurredImageCtx.drawImage(this.imageCanvas, 0, 0, this.width, this.height);\r\n\r\n    this.blurredImageCtx.drawImage(this.cacheCanvas, 0, 0);\r\n  }\r\n\r\n  drawLine(line: BrushDrawnLine) {\r\n    this.previewLine(line, true);\r\n    this.saveLastLine();\r\n  }\r\n\r\n  clear() {\r\n    this.targetCtx.clearRect(0, 0, this.width, this.height);\r\n    this.cacheCtx.clearRect(0, 0, this.width, this.height);\r\n  }\r\n\r\n  private drawLinePath(line: BrushDrawnLine, ctx: CanvasRenderingContext2D) {\r\n    const {points} = line;\r\n    if(!points.length) return;\r\n\r\n    if(points.length === 1) {\r\n      ctx.fillStyle = ctx.strokeStyle;\r\n      ctx.beginPath();\r\n      ctx.arc(points[0][0], points[0][1], line.size / 2, 0, 2 * Math.PI);\r\n      ctx.fill();\r\n      return;\r\n    }\r\n\r\n    ctx.lineWidth = line.size;\r\n    ctx.lineCap = 'round';\r\n    ctx.lineJoin = 'round';\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(points[0][0], points[0][1]);\r\n\r\n    for(let i = 1; i < points.length - 2; i++) {\r\n      const cx = (points[i][0] + points[i + 1][0]) / 2;\r\n      const cy = (points[i][1] + points[i + 1][1]) / 2;\r\n      ctx.quadraticCurveTo(points[i][0], points[i][1], cx, cy);\r\n    }\r\n\r\n    const i = points.length - 1;\r\n    ctx.quadraticCurveTo(points[i - 1][0], points[i - 1][1], points[i][0], points[i][1]);\r\n\r\n    ctx.stroke();\r\n  }\r\n\r\n  private getArrowHeadLength(line: BrushDrawnLine) {\r\n    return Math.sqrt(line.size) + line.size * 2.5;\r\n  }\r\n\r\n  private drawArrowHead(ctx: CanvasRenderingContext2D, line: BrushDrawnLine, arrowLength: number) {\r\n    const {points} = line;\r\n    if(points.length < 2) return;\r\n\r\n    const i = points.length - 1;\r\n\r\n    let i2 = i;\r\n    for(; i2 > 0; i2--) {\r\n      if(distance(points[i], points[i2]) > line.size * 0.5) break;\r\n    }\r\n\r\n    const angle = Math.atan2(points[i][0] - points[i2][0], points[i][1] - points[i2][1]) + Math.PI;\r\n\r\n    const angle1 = angle + Math.PI / 4;\r\n    const angle2 = angle - Math.PI / 4;\r\n\r\n    const vec1 = [arrowLength * Math.sin(angle1), arrowLength * Math.cos(angle1)];\r\n    const vec2 = [arrowLength * Math.sin(angle2), arrowLength * Math.cos(angle2)];\r\n\r\n    ctx.strokeStyle = line.color;\r\n    ctx.lineWidth = line.size;\r\n    ctx.lineCap = 'round';\r\n    ctx.lineJoin = 'round';\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(points[i][0], points[i][1]);\r\n    ctx.lineTo(points[i][0] + vec1[0], points[i][1] + vec1[1]);\r\n    ctx.moveTo(points[i][0], points[i][1]);\r\n    ctx.lineTo(points[i][0] + vec2[0], points[i][1] + vec2[1]);\r\n    ctx.stroke();\r\n  }\r\n\r\n  async animateArrowBrush(line: BrushDrawnLine) {\r\n    const {points} = line;\r\n    if(points.length < 2) return;\r\n\r\n    const ctx = this.targetCtx;\r\n\r\n    const arrowLength = this.getArrowHeadLength(line);\r\n\r\n    const deferred = deferredPromise<void>();\r\n    animateValue(0.1, arrowLength, 120, (length) => this.drawArrowHead(ctx, line, length), {\r\n      onEnd: () => deferred.resolve()\r\n    });\r\n    await deferred;\r\n  }\r\n\r\n  private brushes: Record<\r\n    string,\r\n    (line: BrushDrawnLine, ctx: CanvasRenderingContext2D, shouldFinish: boolean) => void\r\n  > = {\r\n      pen: (line, ctx) => {\r\n        ctx.strokeStyle = line.color;\r\n        this.drawLinePath(line, ctx);\r\n      },\r\n      arrow: (line, ctx, shouldFinish) => {\r\n        const {points} = line;\r\n\r\n        ctx.strokeStyle = line.color;\r\n        this.drawLinePath(line, ctx);\r\n\r\n        if(!shouldFinish) return;\r\n        if(points.length < 2) return;\r\n\r\n        this.drawArrowHead(ctx, line, this.getArrowHeadLength(line));\r\n      },\r\n      brush: (line, ctx) => {\r\n        ctx.strokeStyle = `rgba(${hexaToRgba(line.color).join(',')},0.4)`;\r\n        this.drawLinePath(line, ctx);\r\n      },\r\n      neon: (line, ctx) => {\r\n        ctx.strokeStyle = '#ffffff';\r\n        ctx.shadowBlur = line.size;\r\n        ctx.shadowColor = line.color;\r\n        this.drawLinePath(line, ctx);\r\n      },\r\n      blur: (line, ctx) => {\r\n        const w = ctx.canvas.width,\r\n          h = ctx.canvas.height;\r\n\r\n        this.blurredLineCtx.clearRect(0, 0, w, h);\r\n\r\n        const {points} = line;\r\n        const pointsX = points.map((p) => p[0]);\r\n        const pointsY = points.map((p) => p[1]);\r\n        const minX = Math.max(Math.min(...pointsX) - line.size, 0),\r\n          maxX = Math.max(...pointsX) + line.size,\r\n          minY = Math.max(Math.min(...pointsY) - line.size, 0),\r\n          maxY = Math.max(...pointsY) + line.size;\r\n\r\n        this.blurredLineCtx.strokeStyle = 'white';\r\n        this.drawLinePath(line, this.blurredLineCtx);\r\n\r\n        this.blurredLineCtx.globalCompositeOperation = 'source-in';\r\n        this.blurredLineCtx.drawImage(this.blurredImageCanvas, 0, 0);\r\n\r\n        ctx.drawImage(this.blurredLineCanvas, minX, minY, maxX, maxY, minX, minY, maxX, maxY);\r\n        this.blurredLineCtx.globalCompositeOperation = 'source-over';\r\n      },\r\n      eraser: (line, ctx) => {\r\n        ctx.strokeStyle = 'white';\r\n        ctx.globalCompositeOperation = 'destination-out';\r\n        this.drawLinePath(line, ctx);\r\n        ctx.stroke();\r\n        ctx.globalCompositeOperation = 'source-over';\r\n      }\r\n    };\r\n}\r\n","import {createMemo} from 'solid-js';\r\n\r\nimport {useMediaEditorContext} from '../context';\r\nimport {NumberPair} from '../types';\r\n\r\n\r\nexport default function useNormalizePoint() {\r\n  const {editorState} = useMediaEditorContext();\r\n\r\n  const size = createMemo(() => editorState.canvasSize.map((x) => x * editorState.pixelRatio));\r\n\r\n  return (point: NumberPair) => {\r\n    const transform = editorState.finalTransform;\r\n    const [w, h] = size();\r\n\r\n    point = point.map((x) => x * editorState.pixelRatio) as NumberPair;\r\n\r\n    point = [\r\n      (point[0] - transform.translation[0] - w / 2) / transform.scale,\r\n      (point[1] - transform.translation[1] - h / 2) / transform.scale\r\n    ];\r\n    const r = [Math.sin(transform.rotation), Math.cos(transform.rotation)];\r\n    point = [point[0] * r[1] + point[1] * r[0], point[1] * r[1] - point[0] * r[0]];\r\n    return point;\r\n  };\r\n}\r\n","import {createMemo} from 'solid-js';\r\n\r\nimport {useMediaEditorContext} from '../context';\r\nimport {NumberPair} from '../types';\r\n\r\nexport default function useProcessPoint(densityAware = true) {\r\n  const {editorState} = useMediaEditorContext();\r\n\r\n  const size = createMemo(() => editorState.canvasSize.map((x) => x * editorState.pixelRatio));\r\n\r\n  return (point: NumberPair) => {\r\n    const [w, h] = size();\r\n\r\n    const transform = editorState.finalTransform;\r\n    const r = [Math.sin(-transform.rotation), Math.cos(-transform.rotation)];\r\n    point = [point[0] * r[1] + point[1] * r[0], point[1] * r[1] - point[0] * r[0]];\r\n    point = [\r\n      (point[0] * transform.scale + w / 2 + transform.translation[0]) / (densityAware ? 1 : editorState.pixelRatio),\r\n      (point[1] * transform.scale + h / 2 + transform.translation[1]) / (densityAware ? 1 : editorState.pixelRatio)\r\n    ];\r\n    return point;\r\n  };\r\n}\r\n","import {createEffect, createMemo, createSignal, on, onCleanup, onMount} from 'solid-js';\r\nimport createMiddleware from '../../../helpers/solid/createMiddleware';\r\nimport SwipeHandler from '../../swipeHandler';\r\nimport {adjustmentsConfig, AdjustmentsConfig} from '../adjustments';\r\nimport {HistoryItem, useMediaEditorContext} from '../context';\r\nimport {NumberPair} from '../types';\r\nimport {cleanupWebGl, distance} from '../utils';\r\nimport {draw} from '../webgl/draw';\r\nimport {initWebGL, RenderingPayload} from '../webgl/initWebGL';\r\nimport BrushPainter, {BrushDrawnLine} from './brushPainter';\r\nimport useNormalizePoint from './useNormalizePoint';\r\nimport useProcessPoint from './useProcessPoint';\r\n\r\n\r\nfunction drawAdjustedImage(gl: WebGLRenderingContext, payload: RenderingPayload) {\r\n  const {mediaState} = useMediaEditorContext();\r\n\r\n  if(!payload) return;\r\n\r\n  draw(gl, payload, {\r\n    flip: mediaState.flip,\r\n    rotation: 0,\r\n    scale: 1,\r\n    translation: [0, 0],\r\n    imageSize: [payload.media.width, payload.media.height],\r\n    ...(Object.fromEntries(\r\n      adjustmentsConfig.map(({key, to100}) => {\r\n        const value = mediaState.adjustments[key];\r\n        return [key, value / (to100 ? 100 : 50)];\r\n      })\r\n    ) as Record<AdjustmentsConfig[number]['key'], number>)\r\n  });\r\n}\r\n\r\nexport default function BrushCanvas() {\r\n  const {editorState, mediaState, actions, mediaSrc, mediaType} = useMediaEditorContext();\r\n\r\n  const [fullImageGLPayload, setFullImageGLPayload] = createSignal<RenderingPayload>();\r\n\r\n  const normalizePoint = useNormalizePoint();\r\n  const processPoint = useProcessPoint();\r\n\r\n  function processLine(line: BrushDrawnLine): BrushDrawnLine {\r\n    const transform = editorState.finalTransform;\r\n    return {\r\n      ...line,\r\n      size: line.size * transform.scale,\r\n      points: line.points.map(processPoint)\r\n    };\r\n  }\r\n\r\n  const processedLines = createMemo(() => mediaState.brushDrawnLines.map(processLine));\r\n\r\n  const [lastLine, setLastLine] = createSignal<BrushDrawnLine>();\r\n\r\n  const canvas = (\r\n    <canvas\r\n      class=\"media-editor__brush-canvas\"\r\n      classList={{\r\n        'media-editor__brush-canvas--active': editorState.currentTab === 'brush'\r\n      }}\r\n      style={{\r\n        'opacity': editorState.isAdjusting ? 0 : 1\r\n      }}\r\n      width={editorState.canvasSize?.[0] * editorState.pixelRatio}\r\n      height={editorState.canvasSize?.[1] * editorState.pixelRatio}\r\n    ></canvas>\r\n  ) as HTMLCanvasElement;\r\n  const ctx = canvas.getContext('2d');\r\n\r\n  editorState.brushCanvas = canvas;\r\n\r\n  const fullImageMultiplier = () =>\r\n    Math.min(\r\n      editorState.canvasSize?.[0] / editorState.imageSize?.[0],\r\n      editorState.canvasSize?.[1] / editorState.imageSize?.[1]\r\n    ) * 2 * editorState.pixelRatio;\r\n\r\n  const fullImageCanvas = (<canvas width={editorState.imageSize?.[0]} height={editorState.imageSize?.[1]} />) as HTMLCanvasElement;\r\n  const gl = fullImageCanvas.getContext('webgl', {\r\n    preserveDrawingBuffer: true\r\n  });\r\n\r\n  const fullBrushesCanvas = (\r\n    <canvas width={editorState.imageSize?.[0] * fullImageMultiplier()} height={editorState.imageSize?.[1] * fullImageMultiplier()} />\r\n  ) as HTMLCanvasElement;\r\n\r\n  let brushPainter = new BrushPainter({\r\n    imageCanvas: editorState.imageCanvas,\r\n    targetCanvas: canvas\r\n  });\r\n\r\n  let fullBrushPainter: BrushPainter;\r\n\r\n  onMount(async() => {\r\n    if(mediaType !== 'image') return;\r\n    const middleware = createMiddleware().get();\r\n    setFullImageGLPayload(await initWebGL({gl, mediaSrc, mediaType, videoTime: 0, middleware}));\r\n  });\r\n\r\n  onCleanup(() => {\r\n    cleanupWebGl(gl);\r\n  });\r\n\r\n  createEffect(() => {\r\n    const payload = fullImageGLPayload();\r\n    drawAdjustedImage(gl, payload);\r\n  });\r\n\r\n  createEffect(on(fullImageGLPayload, () => {\r\n    const payload = fullImageGLPayload();\r\n    if(payload) setTimeout(() => redrawFull(), 100);\r\n  }));\r\n\r\n  createEffect(\r\n    on(() => editorState.canvasSize, () => {\r\n      brushPainter = new BrushPainter({\r\n        imageCanvas: editorState.imageCanvas,\r\n        targetCanvas: canvas\r\n      });\r\n      redraw();\r\n    })\r\n  );\r\n\r\n  function resetLastLine() {\r\n    setLastLine({\r\n      color: editorState.currentBrush.color,\r\n      brush: editorState.currentBrush.brush,\r\n      size: (editorState.currentBrush.size * editorState.pixelRatio) / editorState.finalTransform.scale,\r\n      points: []\r\n    });\r\n  }\r\n\r\n  createEffect(() => {\r\n    resetLastLine();\r\n  });\r\n\r\n  createEffect(() => {\r\n    if(editorState.isMoving) {\r\n      const transform = editorState.finalTransform;\r\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n      ctx.save();\r\n\r\n      ctx.translate(transform.translation[0] + canvas.width / 2, transform.translation[1] + canvas.height / 2);\r\n      ctx.rotate(transform.rotation);\r\n      ctx.scale(transform.scale, transform.scale);\r\n\r\n      const [w, h] = editorState.imageSize;\r\n      ctx.drawImage(fullBrushesCanvas, -(w / 2), -(h / 2), w, h);\r\n\r\n      ctx.restore();\r\n    } else {\r\n      redraw();\r\n      redrawFull();\r\n    }\r\n  });\r\n\r\n  function redraw() {\r\n    brushPainter.clear();\r\n    brushPainter.saveLastLine();\r\n    processedLines().forEach((line) => brushPainter.drawLine(line));\r\n  }\r\n\r\n  function processLineForFullImage(line: BrushDrawnLine) {\r\n    return {\r\n      ...line,\r\n      size: line.size * fullImageMultiplier(),\r\n      points: line.points.map(\r\n        (point) =>\r\n          [\r\n            (point[0] + editorState.imageSize?.[0] / 2) * fullImageMultiplier(),\r\n            (point[1] + editorState.imageSize?.[1] / 2) * fullImageMultiplier()\r\n          ] as NumberPair\r\n      )\r\n    };\r\n  }\r\n\r\n  function redrawFull() {\r\n    if(!fullBrushPainter) return;\r\n\r\n    fullBrushPainter.clear();\r\n    fullBrushPainter.saveLastLine();\r\n\r\n    mediaState.brushDrawnLines.forEach((line) => fullBrushPainter.drawLine(processLineForFullImage(line)));\r\n  }\r\n\r\n  createEffect(\r\n    on(() => editorState.imageSize, () => {\r\n      if(!editorState.imageSize?.[0]) return;\r\n      fullBrushPainter = new BrushPainter({\r\n        imageCanvas: fullImageCanvas,\r\n        targetCanvas: fullBrushesCanvas,\r\n        blurAmount: BrushPainter.defaultBlurAmount * fullImageMultiplier()\r\n      });\r\n\r\n      redraw();\r\n      redrawFull();\r\n    })\r\n  );\r\n\r\n  createEffect(() => {\r\n    if(editorState.isAdjusting) {\r\n      onCleanup(() => {\r\n        redraw();\r\n        redrawFull();\r\n      });\r\n    }\r\n  });\r\n\r\n  actions.redrawBrushes = () => {\r\n    redraw();\r\n    redrawFull();\r\n  };\r\n  onCleanup(() => {\r\n    actions.redrawBrushes = () => {};\r\n  });\r\n\r\n  onMount(() => {\r\n    let initialPosition: NumberPair;\r\n    let points: NumberPair[] = [];\r\n\r\n    let builtUpDistance = 0;\r\n\r\n    function saveLastLine() {\r\n      mediaState.brushDrawnLines.push(lastLine());\r\n      actions.pushToHistory({\r\n        path: ['brushDrawnLines', mediaState.brushDrawnLines.length - 1],\r\n        newValue: lastLine(),\r\n        oldValue: HistoryItem.RemoveArrayItem\r\n      });\r\n\r\n      fullBrushPainter.updateBlurredImage();\r\n      fullBrushPainter.drawLine(processLineForFullImage(lastLine()));\r\n      resetLastLine();\r\n      brushPainter.saveLastLine();\r\n\r\n      points = [];\r\n      initialPosition = undefined;\r\n    }\r\n\r\n    function startSwipe(x: number, y: number) {\r\n      const bcr = canvas.getBoundingClientRect();\r\n\r\n      initialPosition = [x - bcr.left, y - bcr.top];\r\n      const point = normalizePoint(initialPosition);\r\n      points = [point];\r\n\r\n      setLastLine((prev) => ({...prev, points}));\r\n      brushPainter.updateBlurredImage();\r\n      brushPainter.previewLine(processLine(lastLine()));\r\n\r\n      editorState.selectedResizableLayer = undefined;\r\n    }\r\n\r\n    function endSwipe() {\r\n      if(points.length === 1) {\r\n        saveLastLine();\r\n      }\r\n    }\r\n\r\n    canvas.addEventListener('mousedown', (e) => {\r\n      startSwipe(e.clientX, e.clientY);\r\n    });\r\n    canvas.addEventListener('touchstart', (e) => {\r\n      startSwipe(e.touches[0].clientX, e.touches[0].clientY);\r\n    });\r\n\r\n    canvas.addEventListener('mouseup', () => {\r\n      endSwipe();\r\n    });\r\n    canvas.addEventListener('touchend', () => {\r\n      endSwipe();\r\n    });\r\n\r\n    const swipeHandler = new SwipeHandler({\r\n      element: canvas,\r\n      cursor: '',\r\n      onSwipe: (xDiff, yDiff, _e) => {\r\n        const point = normalizePoint([initialPosition[0] + xDiff, initialPosition[1] + yDiff]);\r\n\r\n        if(points.length > 0) {\r\n          const lastPoint = points[points.length - 1];\r\n          builtUpDistance += distance(processPoint(lastPoint), processPoint(point));\r\n        }\r\n        if(builtUpDistance < Math.min(lastLine().size, 12) * editorState.pixelRatio && points.length > 1) {\r\n          points[points.length - 1] = point;\r\n        } else {\r\n          points.push(point);\r\n          builtUpDistance = 0;\r\n        }\r\n\r\n        setLastLine((prev) => ({...prev, points}));\r\n        brushPainter.previewLine(processLine(lastLine()));\r\n      },\r\n      onReset() {\r\n        (async() => {\r\n          builtUpDistance = 0;\r\n          if(lastLine().brush === 'arrow') {\r\n            await brushPainter.animateArrowBrush(processLine(lastLine()));\r\n          }\r\n          saveLastLine();\r\n        })();\r\n      }\r\n    });\r\n\r\n    onCleanup(() => {\r\n      swipeHandler.removeListeners();\r\n    })\r\n  });\r\n\r\n  return <>{canvas}</>;\r\n}\r\n","import {useMediaEditorContext} from '../context';\r\n\r\nexport function useCropOffset() {\r\n  const {editorState} = useMediaEditorContext();\r\n\r\n  return () => {\r\n    const {canvasSize} = editorState;\r\n    if(!canvasSize) return {left: 0, top: 0, width: 0, height: 0};\r\n\r\n    const w = canvasSize[0],\r\n      h = canvasSize[1];\r\n\r\n    return {\r\n      left: 60,\r\n      top: 60,\r\n      width: w - 120,\r\n      height: h - 180\r\n    };\r\n  };\r\n}\r\n","import {useMediaEditorContext} from '../context';\r\nimport {snapToViewport} from '../utils';\r\nimport {NumberPair} from '../types';\r\n\r\nimport {useCropOffset} from './useCropOffset';\r\n\r\ntype Options = {\r\n  rotation: number;\r\n  translation: NumberPair;\r\n  scale: number;\r\n  extendCrop?: [NumberPair, NumberPair];\r\n};\r\n\r\nexport default function getConvenientPositioning({\r\n  scale,\r\n  translation,\r\n  rotation,\r\n  extendCrop = [\r\n    [0, 0],\r\n    [0, 0]\r\n  ]\r\n}: Options) {\r\n  const {editorState, mediaState} = useMediaEditorContext();\r\n\r\n  const cropOffset = useCropOffset();\r\n\r\n  const [w, h] = editorState.imageSize;\r\n  const [imageWidth, imageHeight] = snapToViewport(w / h, cropOffset().width, cropOffset().height);\r\n\r\n  const imageLeftTop = [-imageWidth / 2, imageHeight / 2];\r\n\r\n  const imagePoints = [\r\n    [imageLeftTop[0], imageLeftTop[1]],\r\n    [imageLeftTop[0] + imageWidth, imageLeftTop[1]],\r\n    [imageLeftTop[0] + imageWidth, imageLeftTop[1] - imageHeight],\r\n    [imageLeftTop[0], imageLeftTop[1] - imageHeight]\r\n  ].map((point) => {\r\n    const r = [Math.sin(rotation), Math.cos(rotation)];\r\n    point = [point[0] * r[1] - point[1] * r[0], point[1] * r[1] + point[0] * r[0]].map((x) => x * scale);\r\n    point = [point[0] + translation[0], point[1] + translation[1]];\r\n    const r2 = [Math.sin(-rotation), Math.cos(-rotation)];\r\n    point = [point[0] * r2[1] - point[1] * r2[0], point[1] * r2[1] + point[0] * r2[0]];\r\n    return point;\r\n  });\r\n\r\n  const [cropWidth, cropHeight] = snapToViewport(mediaState.currentImageRatio, cropOffset().width, cropOffset().height);\r\n\r\n  const cropLeftTop = [-cropWidth / 2, cropHeight / 2];\r\n  const cropPoints = [\r\n    [cropLeftTop[0] + extendCrop[0][0], cropLeftTop[1] + extendCrop[0][1]],\r\n    [cropLeftTop[0] + cropWidth + extendCrop[1][0], cropLeftTop[1] + extendCrop[0][1]],\r\n    [cropLeftTop[0] + cropWidth + extendCrop[1][0], cropLeftTop[1] - cropHeight + extendCrop[1][1]],\r\n    [cropLeftTop[0] + extendCrop[0][0], cropLeftTop[1] - cropHeight + extendCrop[1][1]]\r\n  ].map((point) => {\r\n    const r = [Math.sin(-rotation), Math.cos(-rotation)];\r\n    return [point[0] * r[1] - point[1] * r[0], point[1] * r[1] + point[0] * r[0]];\r\n  });\r\n  const cropPointsX = cropPoints.map((p) => p[0]);\r\n  const cropPointsY = cropPoints.map((p) => p[1]);\r\n\r\n  return {\r\n    cropMinX: Math.min(...cropPointsX),\r\n    cropMaxX: Math.max(...cropPointsX),\r\n    cropMinY: Math.min(...cropPointsY),\r\n    cropMaxY: Math.max(...cropPointsY),\r\n    imageMinX: imagePoints[0][0],\r\n    imageMaxX: imagePoints[2][0],\r\n    imageMinY: imagePoints[2][1],\r\n    imageMaxY: imagePoints[0][1]\r\n  };\r\n}\r\n","import {batch, createEffect, createSignal, on, onCleanup, onMount} from 'solid-js';\r\nimport {modifyMutable, produce} from 'solid-js/store';\r\n\r\nimport SwipeHandler from '../../swipeHandler';\r\n\r\nimport {animateValue, lerp, lerpArray, snapToViewport} from '../utils';\r\nimport {useMediaEditorContext} from '../context';\r\nimport {withCurrentOwner} from '../utils';\r\nimport {NumberPair} from '../types';\r\n\r\nimport {useCropOffset} from './useCropOffset';\r\nimport _getConvenientPositioning from './getConvenientPositioning';\r\n\r\nconst MAX_SCALE = 20;\r\n\r\nexport default function CropHandles() {\r\n  const {editorState, mediaState} = useMediaEditorContext();\r\n\r\n  const isCropping = () => editorState.currentTab === 'crop';\r\n\r\n  const cropOffset = useCropOffset();\r\n\r\n  const [leftTop, setLeftTop] = createSignal([0, 0]);\r\n  const [leftTopDiff, setLeftTopDiff] = createSignal([0, 0]);\r\n  const [size, setSize] = createSignal([0, 0]);\r\n  const [diff, setDiff] = createSignal([0, 0]);\r\n\r\n  const getConvenientPositioning = withCurrentOwner(_getConvenientPositioning);\r\n\r\n  const getNewLeftTopAndSize = () => {\r\n    const [width, height] = snapToViewport(mediaState.currentImageRatio, cropOffset().width, cropOffset().height);\r\n\r\n    return {\r\n      leftTop: [\r\n        cropOffset().left + (cropOffset().width - width) / 2,\r\n        cropOffset().top + (cropOffset().height - height) / 2\r\n      ],\r\n      size: [width, height]\r\n    };\r\n  };\r\n\r\n  createEffect(\r\n    on(cropOffset, () => {\r\n      const {leftTop, size} = getNewLeftTopAndSize();\r\n      setLeftTop(leftTop);\r\n      setSize(size);\r\n    })\r\n  );\r\n\r\n  let cancelSizeAnimation: () => void;\r\n\r\n  function resetSizeWithAnimation() {\r\n    const initialDiff = diff();\r\n    const initialLeftTopDiff = leftTopDiff();\r\n    const initialLeftTop = leftTop();\r\n    const initialSize = size();\r\n\r\n    const targetDiff = [0, 0];\r\n    const targetLeftTopDiff = [0, 0];\r\n    const {leftTop: targetLeftTop, size: targetSize} = getNewLeftTopAndSize();\r\n\r\n    cancelSizeAnimation?.();\r\n\r\n    cancelSizeAnimation = animateValue(0, 1, 200, (progress) => {\r\n      batch(() => {\r\n        setDiff(lerpArray(initialDiff, targetDiff, progress) as NumberPair);\r\n        setLeftTopDiff(lerpArray(initialLeftTopDiff, targetLeftTopDiff, progress) as NumberPair);\r\n        setLeftTop(lerpArray(initialLeftTop, targetLeftTop, progress) as NumberPair);\r\n        setSize(lerpArray(initialSize, targetSize, progress) as NumberPair);\r\n      });\r\n    });\r\n  }\r\n\r\n  createEffect(\r\n    on(() => mediaState.currentImageRatio, () => {\r\n      resetSizeWithAnimation();\r\n    })\r\n  );\r\n\r\n  onMount(() => {\r\n    const multipliers = [\r\n      {el: leftTopHandle, left: -1, top: -1},\r\n      {el: rightTopHandle, left: 1, top: -1},\r\n      {el: leftBottomHandle, left: -1, top: 1},\r\n      {el: rightBottomHandle, left: 1, top: 1},\r\n\r\n      {el: leftHandle, left: -1, top: 0},\r\n      {el: topHandle, left: 0, top: -1},\r\n      {el: rightHandle, left: 1, top: 0},\r\n      {el: bottomHandle, left: 0, top: 1}\r\n    ];\r\n\r\n    let boundDiff: NumberPair;\r\n    let initialScale: number;\r\n    let initialTranslation: NumberPair;\r\n    let firstTarget: EventTarget;\r\n\r\n    const resizeSwipeHandlers = multipliers.map(({el, left, top}) => {\r\n      return new SwipeHandler({\r\n        element: el,\r\n        setCursorTo: document.body,\r\n        onStart() {\r\n          initialScale = mediaState.scale;\r\n          initialTranslation = mediaState.translation;\r\n          editorState.isMoving = true;\r\n\r\n          el.classList.add('media-editor__crop-handles-circle--anti-flicker');\r\n        },\r\n        onSwipe(xDiff, yDiff, e) {\r\n          if(!firstTarget) firstTarget = e.target;\r\n          if(firstTarget !== el) return;\r\n\r\n          const fixed = editorState.fixedImageRatioKey;\r\n          let ratio = mediaState.currentImageRatio;\r\n          if(left < 0) {\r\n            ratio = -ratio;\r\n          }\r\n          if(top < 0) {\r\n            ratio = -ratio;\r\n          }\r\n\r\n          const [w, h] = size();\r\n          const minW = Math.min(w, (cropOffset().width / MAX_SCALE) * Math.min(MAX_SCALE, initialScale));\r\n          const minH = Math.min(h, (cropOffset().height / MAX_SCALE) * Math.min(MAX_SCALE, initialScale));\r\n          xDiff = Math.max(xDiff * left, minW - w) * left;\r\n          yDiff = Math.max(yDiff * top, minH - h) * top;\r\n\r\n          if(fixed) {\r\n            if(top === 0) {\r\n              yDiff = xDiff / ratio;\r\n            } else if(left === 0) {\r\n              xDiff = yDiff * ratio;\r\n            } else {\r\n              const xd = xDiff;\r\n              xDiff = (xDiff + yDiff * ratio) / 2;\r\n              yDiff = (xd / ratio + yDiff) / 2;\r\n            }\r\n          }\r\n\r\n          if(fixed && top === 0) {\r\n            setDiff([left * xDiff, yDiff]);\r\n          } else if(fixed && left === 0) {\r\n            setDiff([xDiff, top * yDiff]);\r\n          } else {\r\n            setDiff([xDiff * left, yDiff * top]);\r\n          }\r\n\r\n          setLeftTopDiff([\r\n            fixed && left === 0 ? -xDiff / 2 : Number(left < 0) * xDiff,\r\n            fixed && top === 0 ? -yDiff / 2 : Number(top < 0) * yDiff\r\n          ]);\r\n          const {cropMinX, cropMaxX, cropMinY, cropMaxY, imageMinX, imageMaxX, imageMinY, imageMaxY} =\r\n            getConvenientPositioning({\r\n              scale: initialScale,\r\n              rotation: mediaState.rotation,\r\n              translation: initialTranslation,\r\n              extendCrop: [\r\n                [\r\n                  fixed && left === 0 ? -xDiff / 2 : left === -1 ? xDiff : 0,\r\n                  fixed && top === 0 ? yDiff / 2 : top === 1 ? yDiff : 0\r\n                ],\r\n                [\r\n                  fixed && left === 0 ? xDiff / 2 : left === 1 ? xDiff : 0,\r\n                  fixed && top === 0 ? -yDiff / 2 : top === -1 ? yDiff : 0\r\n                ]\r\n              ]\r\n            });\r\n          const halfImageWidth = (imageMaxX - imageMinX) / 2,\r\n            halfImageHeight = (imageMaxY - imageMinY) / 2;\r\n          const imageCenter = [imageMinX + halfImageWidth, imageMinY + halfImageHeight];\r\n\r\n          let additionalScaleX = 1;\r\n          let additionalScaleY = 1;\r\n\r\n          if(imageMinX > cropMinX) additionalScaleX *= 1 + ((imageCenter[0] - cropMinX) / halfImageWidth - 1) / 2;\r\n          if(imageMaxX < cropMaxX) additionalScaleX *= 1 + ((cropMaxX - imageCenter[0]) / halfImageWidth - 1) / 2;\r\n          if(imageMinY > cropMinY) additionalScaleY *= 1 + ((imageCenter[1] - cropMinY) / halfImageHeight - 1) / 2;\r\n          if(imageMaxY < cropMaxY) additionalScaleY *= 1 + ((cropMaxY - imageCenter[1]) / halfImageHeight - 1) / 2;\r\n\r\n          const additionalScale = Math.max(additionalScaleX, additionalScaleY);\r\n          if(additionalScale > 1) {\r\n            mediaState.scale = initialScale * additionalScale;\r\n          }\r\n\r\n          let boundDiff = [0, 0];\r\n\r\n          if(imageMinX > cropMinX) boundDiff[0] += imageMinX - cropMinX;\r\n          if(imageMaxX < cropMaxX) boundDiff[0] += imageMaxX - cropMaxX;\r\n          if(imageMinY > cropMinY) boundDiff[1] += imageMinY - cropMinY;\r\n          if(imageMaxY < cropMaxY) boundDiff[1] += imageMaxY - cropMaxY;\r\n\r\n          const r = [Math.sin(mediaState.rotation), Math.cos(mediaState.rotation)];\r\n\r\n          boundDiff = [boundDiff[0] * r[1] - boundDiff[1] * r[0], boundDiff[1] * r[1] + boundDiff[0] * r[0]];\r\n\r\n          mediaState.translation = [initialTranslation[0] - boundDiff[0] / 2, initialTranslation[1] - boundDiff[1] / 2];\r\n        },\r\n        onReset() {\r\n          if(firstTarget !== el) return (firstTarget = undefined);\r\n          firstTarget = undefined;\r\n\r\n          const newWidth = size()[0] + diff()[0],\r\n            newHeight = size()[1] + diff()[1];\r\n          const newRatio = newWidth / newHeight;\r\n\r\n          const upScale = Math.min(cropOffset().width / newWidth, cropOffset().height / newHeight);\r\n          mediaState.currentImageRatio = newRatio;\r\n          resetSizeWithAnimation();\r\n\r\n          const initialScale = mediaState.scale;\r\n          const initialTranslation = mediaState.translation;\r\n\r\n          const targetScale = mediaState.scale * upScale;\r\n          const targetTranslation = [\r\n            upScale * (mediaState.translation[0] + -diff()[0] * left * 0.5),\r\n            upScale * (mediaState.translation[1] + -diff()[1] * top * 0.5)\r\n          ];\r\n\r\n          animateValue(\r\n            0,\r\n            1,\r\n            200,\r\n            (progress) => {\r\n              modifyMutable(mediaState, produce((state) => {\r\n                state.scale = lerp(initialScale, targetScale, progress);\r\n                state.translation = lerpArray(initialTranslation, targetTranslation, progress) as NumberPair;\r\n              }));\r\n            },\r\n            {\r\n              onEnd: () => editorState.isMoving = false\r\n            }\r\n          );\r\n\r\n          el.classList.remove('media-editor__crop-handles-circle--anti-flicker');\r\n        }\r\n      });\r\n    });\r\n\r\n    const translationSwipeHandler = new SwipeHandler({\r\n      element: cropArea,\r\n      onStart() {\r\n        initialTranslation = mediaState.translation;\r\n        editorState.isMoving = true;\r\n      },\r\n      onSwipe(xDiff, yDiff, e) {\r\n        if(!firstTarget) firstTarget = e.target;\r\n        if(firstTarget !== cropArea) return;\r\n\r\n        const {cropMinX, cropMaxX, cropMinY, cropMaxY, imageMinX, imageMaxX, imageMinY, imageMaxY} =\r\n          getConvenientPositioning({\r\n            scale: mediaState.scale,\r\n            rotation: mediaState.rotation,\r\n            translation: [initialTranslation[0] + xDiff, initialTranslation[1] + yDiff]\r\n          });\r\n\r\n        boundDiff = [0, 0];\r\n\r\n        if(imageMinX > cropMinX) boundDiff[0] = imageMinX - cropMinX;\r\n        if(imageMaxX < cropMaxX) boundDiff[0] = imageMaxX - cropMaxX;\r\n        if(imageMinY > cropMinY) boundDiff[1] = imageMinY - cropMinY;\r\n        if(imageMaxY < cropMaxY) boundDiff[1] = imageMaxY - cropMaxY;\r\n\r\n        const r = [Math.sin(mediaState.rotation), Math.cos(mediaState.rotation)];\r\n\r\n        boundDiff = [boundDiff[0] * r[1] - boundDiff[1] * r[0], boundDiff[1] * r[1] + boundDiff[0] * r[0]];\r\n\r\n        const resistance = 4;\r\n        mediaState.translation = [\r\n          initialTranslation[0] + xDiff - (boundDiff[0] - boundDiff[0] / resistance),\r\n          initialTranslation[1] + yDiff - (boundDiff[1] - boundDiff[1] / resistance)\r\n        ]\r\n        boundDiff = [boundDiff[0] / resistance, boundDiff[1] / resistance];\r\n      },\r\n      onReset() {\r\n        if(firstTarget !== cropArea) return (firstTarget = undefined);\r\n        firstTarget = undefined;\r\n\r\n        const prevTranslation = mediaState.translation;\r\n        animateValue(\r\n          prevTranslation,\r\n          [prevTranslation[0] - boundDiff[0], prevTranslation[1] - boundDiff[1]] as const,\r\n          120,\r\n          (value) => mediaState.translation = value,\r\n          {\r\n            onEnd: () => editorState.isMoving = false\r\n          }\r\n        );\r\n      }\r\n    });\r\n\r\n    onCleanup(() => {\r\n      resizeSwipeHandlers.forEach((handler) => handler.removeListeners());\r\n      translationSwipeHandler.removeListeners();\r\n    });\r\n  });\r\n\r\n  const left = () => leftTop()[0] + leftTopDiff()[0];\r\n  const top = () => leftTop()[1] + leftTopDiff()[1];\r\n  const width = () => size()[0] + diff()[0];\r\n  const height = () => size()[1] + diff()[1];\r\n  const right = () => left() + width();\r\n  const bottom = () => top() + height();\r\n\r\n  const croppedSizeFull = () => {\r\n    const [cw, ch] = editorState.canvasSize;\r\n    let [w, h] = [cw, ch];\r\n    const ratio = mediaState.currentImageRatio;\r\n\r\n    if(w / ratio > h) w = h * ratio;\r\n    else h = w / ratio;\r\n\r\n    return [(cw - w) / 2, (ch - h) / 2];\r\n  };\r\n\r\n  let cropArea: HTMLDivElement;\r\n\r\n  let leftTopHandle: HTMLDivElement;\r\n  let rightTopHandle: HTMLDivElement;\r\n  let leftBottomHandle: HTMLDivElement;\r\n  let rightBottomHandle: HTMLDivElement;\r\n\r\n  let leftHandle: HTMLDivElement;\r\n  let topHandle: HTMLDivElement;\r\n  let rightHandle: HTMLDivElement;\r\n  let bottomHandle: HTMLDivElement;\r\n\r\n  const coverAnimatedStyle = () =>\r\n    ({\r\n      'transition': 'opacity 0.2s',\r\n      'transition-timing-function': isCropping() ? 'ease-in' : 'ease-out',\r\n      'pointer-events': isCropping() ? 'none' : undefined,\r\n      'opacity': isCropping() ? 0 : 1\r\n    }) as const;\r\n\r\n  const controlsAnimatedStyle = () =>\r\n    ({\r\n      'transition': 'transform 0.2s, opacity 0.2s',\r\n      'transition-timing-function': isCropping() ? 'ease-out' : 'ease-in',\r\n      'pointer-events': isCropping() ? undefined : 'none',\r\n      'opacity': isCropping() ? 1 : 0,\r\n      'transform': isCropping() ? undefined : 'scale(1.05)'\r\n    }) as const;\r\n\r\n  return (\r\n    <>\r\n      <div\r\n        style={{\r\n          background: 'black',\r\n          position: 'absolute',\r\n          left: '0px',\r\n          top: '0px',\r\n          width: '100%',\r\n          height: croppedSizeFull()[1] + 'px',\r\n          ...coverAnimatedStyle()\r\n        }}\r\n      ></div>\r\n      <div\r\n        style={{\r\n          background: 'black',\r\n          position: 'absolute',\r\n          left: '0px',\r\n          bottom: '0px',\r\n          width: '100%',\r\n          height: croppedSizeFull()[1] + 'px',\r\n          ...coverAnimatedStyle()\r\n        }}\r\n      ></div>\r\n      <div\r\n        style={{\r\n          background: 'black',\r\n          position: 'absolute',\r\n          left: '0px',\r\n          top: '0px',\r\n          height: '100%',\r\n          width: croppedSizeFull()[0] + 'px',\r\n          ...coverAnimatedStyle()\r\n        }}\r\n      ></div>\r\n      <div\r\n        style={{\r\n          background: 'black',\r\n          position: 'absolute',\r\n          right: '0px',\r\n          top: '0px',\r\n          height: '100%',\r\n          width: croppedSizeFull()[0] + 'px',\r\n          ...coverAnimatedStyle()\r\n        }}\r\n      ></div>\r\n      <div\r\n        style={{\r\n          position: 'absolute',\r\n          right: '0px',\r\n          top: '0px',\r\n          height: '100%',\r\n          width: '100%',\r\n          overflow: 'hidden',\r\n          ...controlsAnimatedStyle()\r\n        }}\r\n      >\r\n        <div\r\n          class=\"media-editor__crop-handles-backdrop\"\r\n          style={{\r\n            ['clip-path']: `polygon(\r\n              0 0, 0 100%,\r\n              ${left()}px 100%, ${left()}px ${top()}px, ${right()}px ${top()}px,\r\n              ${right()}px ${bottom()}px, ${left()}px ${bottom()}px, ${left()}px 100%,\r\n              100% 100%, 100% 0%\r\n            )`\r\n          }}\r\n        />\r\n        <div\r\n          ref={cropArea}\r\n          class=\"media-editor__crop-handles\"\r\n          style={{\r\n            left: left() + 'px',\r\n            top: top() + 'px',\r\n            width: width() + 'px',\r\n            height: height() + 'px'\r\n          }}\r\n        >\r\n          <div class=\"media-editor__crop-handles-line-h\" style={{top: '33%'}} />\r\n          <div class=\"media-editor__crop-handles-line-h\" style={{top: '66%'}} />\r\n          <div class=\"media-editor__crop-handles-line-v\" style={{left: '33%'}} />\r\n          <div class=\"media-editor__crop-handles-line-v\" style={{left: '66%'}} />\r\n\r\n          <div ref={leftHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--w\" />\r\n          <div ref={topHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--n\" />\r\n          <div ref={rightHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--e\" />\r\n          <div ref={bottomHandle} class=\"media-editor__crop-handles-side media-editor__crop-handles-side--s\" />\r\n\r\n          <div ref={leftTopHandle} class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--nw\" />\r\n          <div ref={rightTopHandle} class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--ne\" />\r\n          <div ref={leftBottomHandle} class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--sw\" />\r\n          <div\r\n            ref={rightBottomHandle}\r\n            class=\"media-editor__crop-handles-circle media-editor__crop-handles-circle--se\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import {createEffect, onCleanup} from 'solid-js';\r\nimport {animate} from '../../../helpers/animation';\r\nimport clamp from '../../../helpers/number/clamp';\r\nimport {SetVideoTimeFlags, useMediaEditorContext} from '../context';\r\n\r\n\r\ntype Args = {\r\n  gl: WebGLRenderingContext;\r\n  drawAdjustedImage: () => void;\r\n};\r\n\r\nexport default function initVideoPlayback({gl, drawAdjustedImage}: Args) {\r\n  const {editorState, mediaState, actions} = useMediaEditorContext();\r\n  const {renderingPayload} = editorState;\r\n  const video = renderingPayload.media.video;\r\n\r\n  if(!video) return;\r\n\r\n  // We don't want this 'seeked' event to be fired when generating the final result\r\n  let pendingSeek = false;\r\n\r\n  actions.setVideoTime = (time: number, flags = SetVideoTimeFlags.Redraw | SetVideoTimeFlags.UpdateVideo | SetVideoTimeFlags.UpdateCursor) => {\r\n    if(flags & SetVideoTimeFlags.UpdateCursor) mediaState.currentVideoTime = time;\r\n    if(flags & SetVideoTimeFlags.UpdateVideo) video.currentTime = time * video.duration;\r\n    if(flags & SetVideoTimeFlags.Redraw) pendingSeek = true;\r\n  };\r\n\r\n  const seekListener = () => {\r\n    if(!pendingSeek) return;\r\n    pendingSeek = false;\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, renderingPayload.texture);\r\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, video);\r\n\r\n    drawAdjustedImage();\r\n  };\r\n\r\n  video.addEventListener('seeked', seekListener);\r\n  onCleanup(() => {\r\n    video.removeEventListener('seeked', seekListener);\r\n  });\r\n\r\n\r\n  createEffect(() => {\r\n    if(editorState.currentTab !== 'adjustments') return;\r\n\r\n    const listener = (event: KeyboardEvent) => {\r\n      const el = (event.target as HTMLElement);\r\n\r\n      if(event.code === 'Space' && !el.isContentEditable) {\r\n        event.preventDefault(); // stop page from scrolling, idk if needed\r\n        editorState.isPlaying = !editorState.isPlaying;\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', listener);\r\n\r\n    onCleanup(() => {\r\n      editorState.isPlaying = false;\r\n      document.removeEventListener('keydown', listener);\r\n    });\r\n  });\r\n\r\n  createEffect(() => {\r\n    video.muted = mediaState.videoMuted;\r\n  });\r\n\r\n  createEffect(() => {\r\n    if(!editorState.isPlaying) return;\r\n\r\n    let\r\n      frameCallbackId: number,\r\n      playing = true,\r\n      skip = 0\r\n    ;\r\n\r\n    function frameCallback() {\r\n      gl.bindTexture(gl.TEXTURE_2D, renderingPayload.texture);\r\n      gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, video);\r\n\r\n      drawAdjustedImage();\r\n\r\n      frameCallbackId = video.requestVideoFrameCallback(() => frameCallback());\r\n    }\r\n\r\n    const timeout = self.setTimeout(() => {\r\n      if(mediaState.currentVideoTime >= mediaState.videoCropStart + mediaState.videoCropLength)\r\n        actions.setVideoTime(mediaState.videoCropStart);\r\n\r\n      frameCallbackId = video.requestVideoFrameCallback(frameCallback);\r\n      video.play();\r\n\r\n      animate(() => {\r\n        skip = (skip + 1) % 3;\r\n\r\n        if(skip) return true;\r\n        if(!playing) return false;\r\n\r\n        mediaState.currentVideoTime = video.currentTime / video.duration || 0;\r\n\r\n        if(video.ended || video.paused || mediaState.currentVideoTime >= mediaState.videoCropStart + mediaState.videoCropLength) {\r\n          playing = false;\r\n          editorState.isPlaying = false;\r\n          mediaState.currentVideoTime = clamp(mediaState.currentVideoTime, mediaState.videoCropStart, mediaState.videoCropStart + mediaState.videoCropLength);\r\n        }\r\n\r\n        return playing;\r\n      });\r\n    }, 200); // Let the pause/play icon animation finish as it might lag without this\r\n\r\n    onCleanup(() => {\r\n      playing = false;\r\n      self.clearTimeout(timeout);\r\n      video.cancelVideoFrameCallback(frameCallbackId);\r\n      video.pause();\r\n    });\r\n  });\r\n};\r\n","import {createEffect, createReaction, onCleanup, onMount} from 'solid-js';\r\nimport {modifyMutable, produce} from 'solid-js/store';\r\nimport createMiddleware from '../../../helpers/solid/createMiddleware';\r\nimport {adjustmentsConfig, AdjustmentsConfig} from '../adjustments';\r\nimport {useMediaEditorContext} from '../context';\r\nimport {cleanupWebGl, withCurrentOwner} from '../utils';\r\nimport {draw} from '../webgl/draw';\r\nimport {initWebGL} from '../webgl/initWebGL';\r\nimport initVideoPlayback from './initVideoPlayback';\r\n\r\n\r\nfunction drawAdjustedImage(gl: WebGLRenderingContext) {\r\n  const {editorState, mediaState} = useMediaEditorContext();\r\n\r\n  const payload = editorState.renderingPayload;\r\n  if(!payload) return;\r\n\r\n  draw(gl, payload, {\r\n    ...editorState.finalTransform,\r\n    imageSize: [payload.media.width, payload.media.height],\r\n    ...(Object.fromEntries(\r\n      adjustmentsConfig.map(({key, to100}) => {\r\n        const value = mediaState.adjustments[key];\r\n        return [key, value / (to100 ? 100 : 50)];\r\n      })\r\n    ) as Record<AdjustmentsConfig[number]['key'], number>)\r\n  });\r\n}\r\n\r\nexport default function ImageCanvas() {\r\n  const {editorState, mediaState, mediaSrc, mediaType, actions} = useMediaEditorContext();\r\n\r\n  const canvas = (\r\n    <canvas width={editorState.canvasSize[0] * editorState.pixelRatio} height={editorState.canvasSize[1] * editorState.pixelRatio} />\r\n  ) as HTMLCanvasElement;\r\n\r\n  const gl = canvas.getContext('webgl', {\r\n    preserveDrawingBuffer: true\r\n  });\r\n\r\n  editorState.imageCanvas = canvas;\r\n\r\n  const ownedDrawAdjustedImage = withCurrentOwner(() => drawAdjustedImage(gl));\r\n\r\n  const ownedInitVideoPlayback = withCurrentOwner(() =>\r\n    initVideoPlayback({gl, drawAdjustedImage: ownedDrawAdjustedImage})\r\n  );\r\n\r\n  const middleware = createMiddleware().get();\r\n\r\n  async function init() {\r\n    const payload = await initWebGL({gl, mediaSrc, mediaType, videoTime: mediaState.currentVideoTime, middleware});\r\n\r\n    modifyMutable(editorState, produce(state => {\r\n      state.renderingPayload = payload;\r\n      state.imageSize = [payload.media.width, payload.media.height];\r\n    }));\r\n\r\n    if(!mediaState.currentImageRatio) {\r\n      const ratio = payload.media.width / payload.media.height;\r\n      actions.setInitialImageRatio(ratio)\r\n      mediaState.currentImageRatio = ratio;\r\n    }\r\n\r\n    ownedInitVideoPlayback();\r\n  }\r\n\r\n  onMount(() => {\r\n    if(editorState.isReady) init(); // When hot reloading\r\n    else {\r\n      const track = createReaction(() => {\r\n        init();\r\n      });\r\n\r\n      track(() => editorState.isReady);\r\n    }\r\n  });\r\n\r\n  createEffect(() => {\r\n    drawAdjustedImage(gl);\r\n  });\r\n\r\n  onCleanup(() => {\r\n    cleanupWebGl(gl);\r\n  });\r\n\r\n  return <>{canvas}</>;\r\n}\r\n","import {Show} from 'solid-js';\r\n\r\nimport {hexToRgb} from '../../../helpers/color';\r\n\r\nimport {useMediaEditorContext} from '../context';\r\n\r\n\r\nconst PreviewBrushSize = () => {\r\n  const {editorState} = useMediaEditorContext();\r\n\r\n  return (\r\n    <Show when={editorState.previewBrushSize}>\r\n      <div\r\n        class=\"media-editor__preview-brush-size\"\r\n        style={{\r\n          '--color': !['blur', 'eraser'].includes(editorState.currentBrush.brush) ?\r\n            hexToRgb(editorState.currentBrush.color).join(',') :\r\n            undefined,\r\n          'width': editorState.previewBrushSize + 'px',\r\n          'height': editorState.previewBrushSize + 'px'\r\n        }}\r\n      />\r\n    </Show>\r\n  );\r\n};\r\n\r\nexport default PreviewBrushSize;\r\n","import {createSignal, onCleanup} from 'solid-js';\r\n\r\nfunction useMediaQuery(query: string) {\r\n  const [isMatch, setIsMatch] = createSignal(false);\r\n\r\n  const updateMatch = () => {\r\n    setIsMatch(window.matchMedia(query).matches);\r\n  };\r\n\r\n  const mediaQueryList = window.matchMedia(query);\r\n  setIsMatch(mediaQueryList.matches);\r\n\r\n  mediaQueryList.addEventListener('change', updateMatch);\r\n  onCleanup(() => {\r\n    mediaQueryList.removeEventListener('change', updateMatch);\r\n  });\r\n\r\n  return isMatch;\r\n}\r\n\r\nexport default function useIsMobile() {\r\n  const isMobile = useMediaQuery('(max-width: 800px');\r\n  return isMobile;\r\n}\r\n","import {onCleanup, onMount} from 'solid-js';\r\n\r\nimport createMiddleware from '../../../helpers/solid/createMiddleware';\r\nimport wrapSticker from '../../wrappers/sticker';\r\n\r\nimport {useMediaEditorContext} from '../context';\r\nimport {ResizableLayerProps} from '../types';\r\n\r\nimport {ResizableContainer} from './resizableLayers';\r\n\r\nexport default function StickerLayerContent(props: ResizableLayerProps) {\r\n  const {editorState} = useMediaEditorContext();\r\n\r\n  let container: HTMLDivElement;\r\n\r\n  onMount(() => {\r\n    const middleware = createMiddleware();\r\n\r\n    wrapSticker({\r\n      div: container,\r\n      doc: props.layer.sticker,\r\n      group: 'none',\r\n      width: 500,\r\n      height: 500,\r\n      play: true,\r\n      loop: true,\r\n      withThumb: false,\r\n      middleware: middleware.get()\r\n    });\r\n\r\n    editorState.stickersLayersInfo[props.layer.id] = {container};\r\n\r\n    onCleanup(() => {\r\n      middleware.destroy();\r\n    });\r\n  });\r\n\r\n  const children = (\r\n    <div ref={container} class=\"media-editor__sticker-layer-content\" />\r\n  ); // Needs to be rendered here for hot reload to work properly\r\n\r\n  return (\r\n    <ResizableContainer layer={props.layer}>\r\n      {children}\r\n    </ResizableContainer>\r\n  );\r\n}\r\n","import {batch, createEffect, createMemo, on, onCleanup, onMount} from 'solid-js';\r\n\r\nimport createElementFromMarkup from '../../../helpers/createElementFromMarkup';\r\nimport {i18n} from '../../../lib/langPack';\r\n\r\nimport {ResizableLayerProps, TextLayerInfo, TextRenderingInfoLine} from '../types';\r\nimport {fontInfoMap, getContrastColor, log} from '../utils';\r\nimport {HistoryItem, useMediaEditorContext} from '../context';\r\n\r\nimport {ResizableContainer} from './resizableLayers';\r\n\r\nexport default function TextLayerContent(props: ResizableLayerProps) {\r\n  const {editorState, mediaState, actions} = useMediaEditorContext();\r\n\r\n  if(!props.layer.textInfo) return;\r\n\r\n  const onFocus = () => {\r\n    batch(() => {\r\n      editorState.selectedResizableLayer = props.layer.id;\r\n      editorState.currentTextLayerInfo = {...props.layer.textInfo};\r\n    });\r\n  };\r\n\r\n  const fontInfo = () => fontInfoMap[props.layer.textInfo.font];\r\n\r\n  function deleteThisLayer() {\r\n    const layers = mediaState.resizableLayers;\r\n    const idx = layers.findIndex(layer => layer.id === props.layer.id);\r\n    if(idx < 0) return;\r\n    const deletedLayer = layers.splice(idx, 1)[0];\r\n    deletedLayer.textRenderingInfo = undefined;\r\n\r\n    actions.pushToHistory({\r\n      path: ['resizableLayers', idx],\r\n      newValue: HistoryItem.RemoveArrayItem,\r\n      oldValue: deletedLayer,\r\n      findBy: {\r\n        id: deletedLayer.id\r\n      }\r\n    });\r\n  }\r\n\r\n  function updateBackground() {\r\n    contentEditable.childNodes.forEach((childNode) => {\r\n      if(childNode instanceof HTMLDivElement && !childNode.hasAttributes()) {\r\n        childNode.querySelectorAll('*').forEach((element) => {\r\n          const node = document.createTextNode(element.textContent);\r\n          element.replaceWith(node);\r\n        });\r\n      } else {\r\n        const div = document.createElement('div');\r\n        div.textContent = childNode.textContent;\r\n        childNode.replaceWith(div);\r\n      }\r\n    });\r\n    if(!contentEditable.textContent) {\r\n      contentEditable.innerHTML = '<div></div>';\r\n\r\n      // Firefox cursor reset\r\n      const child = contentEditable.children[0];\r\n      const range = document.createRange();\r\n      const sel = window.getSelection();\r\n\r\n      range.setStart(child, 0);\r\n      range.collapse(true);\r\n\r\n      sel.removeAllRanges();\r\n      sel.addRange(range);\r\n    }\r\n\r\n    // Firefox puts the cursor outside the inner divs and messes up everything\r\n    const selection = window.getSelection();\r\n    if(selection.rangeCount > 0) {\r\n      const range = selection.getRangeAt(0);\r\n      if(range.startContainer === contentEditable && range.startOffset === 0) {\r\n        const innerDiv = contentEditable.children[0];\r\n        const innerDivRange = document.createRange();\r\n        innerDivRange.selectNodeContents(innerDiv);\r\n        innerDivRange.collapse(false); // Collapse to the end of the inner div\r\n\r\n        selection.removeAllRanges();\r\n        selection.addRange(innerDivRange);\r\n      }\r\n    }\r\n\r\n    container.querySelector('.media-editor__text-layer-background')?.remove();\r\n    const lines = getLinesRenderingInfo(contentEditable, props.layer.textInfo.alignment);\r\n    const path = createTextBackgroundPath(lines);\r\n\r\n    if(props.layer.textInfo.style === 'background') updateBackgroundStyle(container, path.join(' '), props.layer.textInfo);\r\n    if(props.layer.textInfo.style === 'outline') updateOutlineStyle(container, contentEditable, props.layer.textInfo);\r\n\r\n    props.layer.textRenderingInfo =  {\r\n      width: container.clientWidth,\r\n      height: container.clientHeight,\r\n      path,\r\n      lines\r\n    };\r\n  }\r\n\r\n  function selectAll() {\r\n    const range = document.createRange();\r\n    range.selectNodeContents(contentEditable.children[0]);\r\n    const selection = window.getSelection();\r\n    selection.removeAllRanges();\r\n    selection.addRange(range);\r\n  }\r\n\r\n  createEffect(() => {\r\n    updateBackground();\r\n  });\r\n\r\n  const isThisLayerSelected = createMemo(() => props.layer.id === editorState.selectedResizableLayer);\r\n\r\n  onMount(() => {\r\n    if(isThisLayerSelected()) selectAll();\r\n  });\r\n\r\n\r\n  createEffect(() => {\r\n    if(isThisLayerSelected()) {\r\n      onCleanup(() => {\r\n        if(!contentEditable.innerText.trim()) {\r\n          deleteThisLayer();\r\n        }\r\n      })\r\n    }\r\n  });\r\n\r\n  createEffect(\r\n    on(() => ({...editorState.currentTextLayerInfo}), () => {\r\n      if(editorState.selectedResizableLayer !== props.layer.id) return;\r\n      props.layer.textInfo = {...editorState.currentTextLayerInfo};\r\n    })\r\n  );\r\n\r\n  onMount(() => {\r\n    container.addEventListener('dragstart', (e: Event) => {\r\n      e.preventDefault();\r\n    });\r\n  });\r\n\r\n  let container: HTMLDivElement;\r\n  let contentEditable: HTMLDivElement;\r\n\r\n  const color = () => {\r\n    if(props.layer.textInfo.style === 'normal') return props.layer.textInfo.color;\r\n    return getContrastColor(props.layer.textInfo.color);\r\n  };\r\n\r\n  const intialContent = (() => {\r\n    const layerInfo = props.layer.textRenderingInfo;\r\n    if(!layerInfo) return <div>{i18n('MediaEditor.TypeSomething')}</div>;\r\n    return layerInfo.lines.map((line) => <div>{line.content}</div>);\r\n  })();\r\n\r\n  const children = (\r\n    <div\r\n      ref={container}\r\n      class=\"media-editor__text-layer\"\r\n      classList={{\r\n        'media-editor__text-layer--with-bg': props.layer.textInfo.style === 'background'\r\n      }}\r\n      style={{\r\n        'color': color(),\r\n        'font-size': props.layer.textInfo.size + 'px',\r\n        'font-family': fontInfo().fontFamily,\r\n        'font-weight': fontInfo().fontWeight,\r\n        '--align-items': flexAlignMap[props.layer.textInfo.alignment]\r\n      }}\r\n    >\r\n      <div\r\n        ref={contentEditable}\r\n        class=\"media-editor__text-layer-layout\"\r\n        contenteditable\r\n        onInput={() => updateBackground()}\r\n        onFocus={onFocus}\r\n      >\r\n        {intialContent}\r\n      </div>\r\n    </div>\r\n  ); // Needs to be rendered here for hot reload to work properly\r\n\r\n  return (\r\n    <ResizableContainer layer={props.layer}>\r\n      {children}\r\n    </ResizableContainer>\r\n  );\r\n}\r\n\r\nfunction getLinesRenderingInfo(linesContainer: HTMLDivElement, alignment: string): TextRenderingInfoLine[] {\r\n  return Array.from(linesContainer.children).map((_child) => {\r\n    const child = _child as HTMLElement;\r\n    let offset = 0;\r\n    if(alignment === 'left') {\r\n      offset = 0;\r\n    } else if(alignment === 'center') {\r\n      offset = (linesContainer.clientWidth - child.clientWidth) / 2;\r\n    } else {\r\n      offset = linesContainer.clientWidth - child.clientWidth;\r\n    }\r\n    return {\r\n      left: offset,\r\n      right: offset + child.clientWidth,\r\n      content: child.innerText,\r\n      height: child.clientHeight\r\n    };\r\n  });\r\n}\r\n\r\nfunction createTextBackgroundPath(lines: TextRenderingInfoLine[]) {\r\n  const first = lines[0];\r\n\r\n  const rounding = first.height * 0.3;\r\n\r\n  const arcParams = (r: number, s: number = 1) => [r, r, 0, 0, s];\r\n\r\n  const path = [];\r\n  path.push('M', first.left, rounding);\r\n\r\n  path.push('A', ...arcParams(rounding), first.left + rounding, 0);\r\n  path.push('L', first.right - rounding, 0);\r\n  path.push('A', ...arcParams(rounding), first.right, rounding);\r\n\r\n  let prevPosition = first;\r\n  let prevY = first.height;\r\n\r\n  for(let i = 1; i < lines.length; i++) {\r\n    const position = lines[i];\r\n\r\n    const diffSign = position.right > prevPosition.right ? 1 : -1;\r\n    const diff = Math.min(Math.abs((position.right - prevPosition.right) / 2), rounding) * diffSign;\r\n    const currentRounding = Math.abs(diff);\r\n\r\n    path.push('L', prevPosition.right, prevY - currentRounding);\r\n    path.push('A', ...arcParams(currentRounding, diffSign === 1 ? 0 : 1), prevPosition.right + diff, prevY);\r\n    path.push('L', position.right - diff, prevY);\r\n    path.push('A', ...arcParams(currentRounding, diffSign === 1 ? 1 : 0), position.right, prevY + currentRounding);\r\n\r\n    prevY += position.height;\r\n    prevPosition = position;\r\n  }\r\n\r\n  path.push('L', prevPosition.right, prevY - rounding);\r\n  path.push('A', ...arcParams(rounding), prevPosition.right - rounding, prevY);\r\n  path.push('L', prevPosition.left + rounding, prevY);\r\n  path.push('A', ...arcParams(rounding), prevPosition.left, prevY - rounding);\r\n\r\n  const last = lines[lines.length - 1];\r\n  prevY -= last.height;\r\n  for(let i = lines.length - 2; i >= 0; i--) {\r\n    const position = lines[i];\r\n\r\n    const diffSign = position.left > prevPosition.left ? 1 : -1;\r\n    const diff = Math.min(Math.abs((position.left - prevPosition.left) / 2), rounding) * diffSign;\r\n    const currentRounding = Math.abs(diff);\r\n\r\n    path.push('L', prevPosition.left, prevY + currentRounding);\r\n    path.push('A', ...arcParams(currentRounding, diffSign !== 1 ? 0 : 1), prevPosition.left + diff, prevY);\r\n    path.push('L', position.left - diff, prevY);\r\n    path.push('A', ...arcParams(currentRounding, diffSign !== 1 ? 1 : 0), position.left, prevY - currentRounding);\r\n\r\n    prevY -= position.height;\r\n    prevPosition = position;\r\n  }\r\n\r\n  return path;\r\n}\r\n\r\nfunction updateBackgroundStyle(container: HTMLDivElement, path: string, info: TextLayerInfo) {\r\n  const svg = createElementFromMarkup(`\r\n    <svg width=\"${container.clientWidth}\" height=\"${container.clientHeight}\" viewBox=\"0 0 ${container.clientWidth} ${container.clientHeight}\">\r\n      <path d=\"${path}\" fill=\"${info.color}\" />\r\n    </svg>\r\n  `);\r\n  svg.classList.add('media-editor__text-layer-background');\r\n  container.prepend(svg);\r\n\r\n  return path;\r\n}\r\n\r\nfunction updateOutlineStyle(container: HTMLDivElement, contentEditable: HTMLDivElement, info: TextLayerInfo) {\r\n  const fontInfo = fontInfoMap[info.font];\r\n  function updateSvg(div: HTMLDivElement) {\r\n    div.querySelector('.media-editor__text-layer-svg-outline')?.remove();\r\n    const stretch = info.size * 0.5;\r\n    const w = div.clientWidth + stretch;\r\n    const h = div.clientHeight + stretch;\r\n    const svg = createElementFromMarkup(`\r\n      <div class=\"media-editor__text-layer-svg-outline\" style=\"width: ${w}px; height: ${h}px;\">\r\n        <svg style=\"width: ${w}px; height: ${h}px;\" viewBox=\"${-stretch / 2} 0 ${div.clientWidth + stretch / 2} ${div.clientHeight + stretch}\">\r\n          <text\r\n            x=\"${info.size * 0.2}\"\r\n            y=\"${info.size * 1.33 * fontInfo.baseline}\"\r\n            style=\"font-size:${info.size}px;stroke:${info.color};stroke-width:${div.clientHeight * 0.15}px;font-family:${fontInfo.fontFamily};font-weight:${fontInfo.fontWeight};\">\r\n            ${div.innerText}\r\n          </text>\r\n        </svg>\r\n      </div>\r\n    `);\r\n    div.prepend(svg);\r\n  }\r\n\r\n  const bgDiv = document.createElement('div');\r\n  bgDiv.classList.add('media-editor__text-layer-background', 'media-editor__text-layer-background--as-layout');\r\n  bgDiv.innerHTML = contentEditable.innerHTML;\r\n  container.prepend(bgDiv);\r\n  Array.from(bgDiv.children).forEach((line) => {\r\n    if(line instanceof HTMLDivElement) updateSvg(line);\r\n  });\r\n}\r\n\r\nconst flexAlignMap: Record<string, string> = {\r\n  left: 'start',\r\n  center: 'center',\r\n  right: 'end'\r\n};\r\n","import {Accessor, batch, createEffect, createMemo, For, on, onCleanup, onMount, ParentProps, Show} from 'solid-js';\r\nimport {createMutable, modifyMutable, produce} from 'solid-js/store';\r\nimport {Portal} from 'solid-js/web';\r\n\r\nimport createContextMenu from '../../../helpers/dom/createContextMenu';\r\n\r\nimport SwipeHandler, {getEvent} from '../../swipeHandler';\r\nimport {observeResize} from '../../resizeObserver';\r\n\r\nimport {NumberPair, ResizableLayer, ResizableLayerProps} from '../types';\r\nimport {HistoryItem, useMediaEditorContext} from '../context';\r\nimport {withCurrentOwner} from '../utils';\r\nimport useIsMobile from '../useIsMobile';\r\n\r\nimport StickerLayerContent from './stickerLayerContent';\r\nimport useNormalizePoint from './useNormalizePoint';\r\nimport TextLayerContent from './textLayerContent';\r\nimport useProcessPoint from './useProcessPoint';\r\n\r\n\r\ntype ProcessedLayer = {\r\n  position: NumberPair;\r\n  rotation: number;\r\n  scale: number;\r\n}\r\n\r\nexport default function ResizableLayers() {\r\n  const context = useMediaEditorContext();\r\n  const {editorState, mediaState, actions} = context;\r\n  const isTextTab = () => editorState.currentTab === 'text';\r\n  const canClick = () => ['stickers', 'text', 'adjustments'].includes(editorState.currentTab);\r\n\r\n\r\n  function moveSelectedLayerOnTop() {\r\n    const layers = mediaState.resizableLayers;\r\n    const idx = layers.findIndex(layer => layer.id === editorState.selectedResizableLayer);\r\n    if(idx < 0) return;\r\n    const layer = layers.splice(idx, 1)[0];\r\n    layer && layers.push(layer);\r\n  }\r\n\r\n  createEffect(\r\n    on(() => editorState.selectedResizableLayer, () => {\r\n      moveSelectedLayerOnTop();\r\n    })\r\n  );\r\n\r\n  createEffect(() => {\r\n    editorState.currentTab;\r\n    onCleanup(() => {\r\n      editorState.selectedResizableLayer = undefined;\r\n    });\r\n  });\r\n\r\n  let container: HTMLDivElement;\r\n\r\n  const normalizePoint = useNormalizePoint();\r\n\r\n  function addLayer(e: MouseEvent) {\r\n    if(e.target !== container) return;\r\n    if(editorState.selectedResizableLayer) {\r\n      editorState.selectedResizableLayer = undefined;\r\n      return;\r\n    }\r\n\r\n    if(!isTextTab()) return;\r\n\r\n    const bcr = container.getBoundingClientRect();\r\n    const transform = editorState.finalTransform;\r\n\r\n    const newResizableLayer = {\r\n      id: context.resizableLayersSeed++,\r\n      position: normalizePoint([e.clientX - bcr.left, e.clientY - bcr.top]),\r\n      rotation: -transform.rotation,\r\n      scale: 1 / transform.scale,\r\n      type: 'text',\r\n      textInfo: {...editorState.currentTextLayerInfo}\r\n    } as ResizableLayer;\r\n\r\n    batch(() => {\r\n      mediaState.resizableLayers.push(newResizableLayer);\r\n      editorState.selectedResizableLayer = newResizableLayer.id;\r\n\r\n      actions.pushToHistory({\r\n        path: ['resizableLayers', mediaState.resizableLayers.length - 1],\r\n        newValue: newResizableLayer,\r\n        oldValue: HistoryItem.RemoveArrayItem,\r\n        findBy: {\r\n          id: newResizableLayer.id\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div\r\n      class=\"media-editor__resizable-layers\"\r\n      classList={{\r\n        'media-editor__resizable-layers--active': canClick()\r\n      }}\r\n      style={{\r\n        cursor: !editorState.selectedResizableLayer && isTextTab() ? 'text' : undefined\r\n      }}\r\n    >\r\n      <div\r\n        ref={container}\r\n        class=\"media-editor__resizable-layers-inner\"\r\n        onClick={withCurrentOwner(addLayer)}\r\n        style={{\r\n          'opacity': editorState.isAdjusting ? 0 : 1\r\n        }}\r\n      >\r\n        <For each={mediaState.resizableLayers}>\r\n          {(layer) => (\r\n            <>\r\n              <Show when={layer.type === 'text'}>\r\n                <TextLayerContent layer={layer} />\r\n              </Show>\r\n              <Show when={layer.type === 'sticker'}>\r\n                <StickerLayerContent layer={layer} />\r\n              </Show>\r\n            </>\r\n          )}\r\n        </For>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function ResizableContainer(props: ParentProps<ResizableLayerProps>) {\r\n  const {editorState, mediaState} = useMediaEditorContext();\r\n\r\n  const isMobile = useIsMobile();\r\n  const processPoint = useProcessPoint(false);\r\n\r\n\r\n  const handleTyping = (): HTMLDivElement | undefined => undefined;\r\n\r\n  const store = createMutable({\r\n    diff: [0, 0] as NumberPair,\r\n    containerWidth: 0,\r\n    containerHeight: 0,\r\n    leftTopEl: handleTyping(),\r\n    rightTopEl: handleTyping(),\r\n    leftBottomEl: handleTyping(),\r\n    rightBottomEl: handleTyping()\r\n  });\r\n\r\n  const circleOffset = () => (isMobile() ? '-6px' : '-4px');\r\n  const canShowHandles = () => editorState.resizeHandlesContainer && props.layer.id === editorState.selectedResizableLayer;\r\n\r\n  const processedLayer = createMemo(() => ({\r\n    position: processPoint(props.layer.position),\r\n    rotation: props.layer.rotation + mediaState.rotation,\r\n    scale: editorState.finalTransform.scale * props.layer.scale\r\n  }));\r\n\r\n\r\n  let container: HTMLDivElement;\r\n\r\n  onMount(() => {\r\n    useResizeHandles({\r\n      container,\r\n      leftBottomEl: () => store.leftBottomEl,\r\n      leftTopEl: () => store.leftTopEl,\r\n      rightBottomEl: () => store.rightBottomEl,\r\n      rightTopEl: () => store.rightTopEl,\r\n\r\n      layer: props.layer,\r\n      diff: store.diff,\r\n      processedLayer\r\n    });\r\n\r\n    useContextMenu({container, layer: props.layer});\r\n\r\n    const unobserve = observeResize(container, () => {\r\n      store.containerWidth = container.clientWidth;\r\n      store.containerHeight = container.clientHeight;\r\n    });\r\n\r\n    onCleanup(() => {\r\n      unobserve();\r\n    });\r\n  });\r\n\r\n  return (\r\n    <div\r\n      class=\"media-editor__resizable-container\"\r\n      style={{\r\n        'left': processedLayer().position[0] + store.diff[0] + 'px',\r\n        'top': processedLayer().position[1] + store.diff[1] + 'px',\r\n        '--rotation': (processedLayer().rotation / Math.PI) * 180 + 'deg',\r\n        '--scale': processedLayer().scale\r\n      }}\r\n      onClick={() => {\r\n        editorState.selectedResizableLayer = props.layer.id;\r\n      }}\r\n      ref={container}\r\n    >\r\n      {props.children}\r\n\r\n      {canShowHandles() && <Portal mount={editorState.resizeHandlesContainer}>\r\n        <div\r\n          class=\"media-editor__resizable-container-handles\"\r\n          style={{\r\n            'left': processedLayer().position[0] + store.diff[0] + 'px',\r\n            'top': processedLayer().position[1] + store.diff[1] + 'px',\r\n            'width': store.containerWidth * processedLayer().scale + 'px',\r\n            'height': store.containerHeight * processedLayer().scale + 'px',\r\n            '--rotation': (processedLayer().rotation / Math.PI) * 180 + 'deg'\r\n          }}\r\n        >\r\n          <div\r\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--vertical\"\r\n            style={{left: 0}}\r\n          />\r\n          <div\r\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--vertical\"\r\n            style={{right: 0}}\r\n          />\r\n          <div\r\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--horizontal\"\r\n            style={{top: 0}}\r\n          />\r\n          <div\r\n            class=\"media-editor__resizable-container-border media-editor__resizable-container-border--horizontal\"\r\n            style={{bottom: 0}}\r\n          />\r\n          <div\r\n            ref={(el) => store.leftTopEl = el}\r\n            class=\"media-editor__resizable-container-circle\"\r\n            style={{left: circleOffset(), top: circleOffset()}}\r\n          />\r\n          <div\r\n            ref={(el) => store.rightTopEl = el}\r\n            class=\"media-editor__resizable-container-circle\"\r\n            style={{right: circleOffset(), top: circleOffset()}}\r\n          />\r\n          <div\r\n            ref={(el) => store.leftBottomEl = el}\r\n            class=\"media-editor__resizable-container-circle\"\r\n            style={{left: circleOffset(), bottom: circleOffset()}}\r\n          />\r\n          <div\r\n            ref={(el) => store.rightBottomEl = el}\r\n            class=\"media-editor__resizable-container-circle\"\r\n            style={{right: circleOffset(), bottom: circleOffset()}}\r\n          />\r\n        </div>\r\n      </Portal>}\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\ntype UseResizeArgs = {\r\n  container: HTMLDivElement;\r\n  leftTopEl: () => HTMLDivElement;\r\n  rightTopEl: () => HTMLDivElement;\r\n  leftBottomEl: () => HTMLDivElement;\r\n  rightBottomEl: () => HTMLDivElement;\r\n\r\n  diff: NumberPair;\r\n  layer: ResizableLayer;\r\n  processedLayer: Accessor<ProcessedLayer>;\r\n};\r\n\r\nfunction useResizeHandles({\r\n  container,\r\n  leftTopEl,\r\n  rightTopEl,\r\n  leftBottomEl,\r\n  rightBottomEl,\r\n  diff,\r\n  layer,\r\n  processedLayer\r\n}: UseResizeArgs) {\r\n  const {editorState, mediaState} = useMediaEditorContext();\r\n\r\n  const normalizePoint = useNormalizePoint();\r\n\r\n\r\n  let firstTarget: EventTarget;\r\n  let swipeStarted = false;\r\n\r\n  const multipliers = [\r\n    {el: leftTopEl, x: -1, y: -1},\r\n    {el: rightTopEl, x: 1, y: -1},\r\n    {el: leftBottomEl, x: -1, y: 1},\r\n    {el: rightBottomEl, x: 1, y: 1}\r\n  ];\r\n\r\n  multipliers.forEach(({el, x, y}) => {\r\n    createEffect(() => {\r\n      const element = el();\r\n      if(!element) return;\r\n\r\n      const swipeHandler = new SwipeHandler({\r\n        element,\r\n        onStart() {\r\n          element.classList.add('media-editor__resizable-container-circle--anti-flicker');\r\n        },\r\n        onSwipe(_, __, _e) {\r\n          const e = getEvent(_e);\r\n\r\n          if(!firstTarget) firstTarget = e.target;\r\n          if(firstTarget !== element) return;\r\n\r\n          const initialVector = [\r\n            (container.clientWidth / 2) * x * editorState.finalTransform.scale,\r\n            (container.clientHeight / 2) * y * editorState.finalTransform.scale\r\n          ];\r\n          const bcr = container.getBoundingClientRect();\r\n          const resizedVector = [bcr.left + bcr.width / 2 - e.clientX, bcr.top + bcr.height / 2 - e.clientY];\r\n\r\n          const rotationFromHorizon =\r\n            Math.atan2(resizedVector[1], resizedVector[0]) - Math.atan2(initialVector[1], initialVector[0]) + Math.PI;\r\n          const scale = Math.hypot(resizedVector[0], resizedVector[1]) / Math.hypot(initialVector[0], initialVector[1]);\r\n\r\n          modifyMutable(layer, produce(s => {\r\n            s.rotation = rotationFromHorizon - mediaState.rotation;\r\n            s.scale = scale;\r\n          }));\r\n        },\r\n        onReset() {\r\n          element.classList.remove('media-editor__resizable-container-circle--anti-flicker');\r\n          firstTarget = undefined;\r\n        }\r\n      });\r\n      onCleanup(() => {\r\n        swipeHandler.removeListeners();\r\n      });\r\n    });\r\n  });\r\n\r\n\r\n  const moveHandler = new SwipeHandler({\r\n    element: container,\r\n    onSwipe(xDiff, yDiff, e) {\r\n      if(!firstTarget) firstTarget = e.target;\r\n      if(multipliers.find(({el}) => el() === firstTarget)) return;\r\n\r\n      if(!swipeStarted) {\r\n        // onStart messes up the typing\r\n        swipeStarted = true;\r\n        editorState.selectedResizableLayer = layer.id;\r\n      }\r\n\r\n      diff.splice(0, 2, xDiff, yDiff);\r\n    },\r\n    onReset() {\r\n      layer.position = normalizePoint([processedLayer().position[0] + diff[0], processedLayer().position[1] + diff[1]]);\r\n      diff.splice(0, 2, 0, 0);\r\n      swipeStarted = false;\r\n      firstTarget = undefined;\r\n    }\r\n  });\r\n\r\n  onCleanup(() => {\r\n    moveHandler.removeListeners();\r\n  });\r\n}\r\n\r\n\r\ntype UseContextMenuArgs = {\r\n  container: HTMLDivElement;\r\n  layer: ResizableLayer;\r\n}\r\n\r\nfunction useContextMenu({container, layer}: UseContextMenuArgs) {\r\n  const {editorState, mediaState, actions} = useMediaEditorContext();\r\n\r\n  function onClick() {\r\n    const layers = mediaState.resizableLayers;\r\n    const idx = layers.findIndex(otherLayer => otherLayer.id === layer.id);\r\n    if(idx < 0) return;\r\n\r\n    batch(() => {\r\n      editorState.selectedResizableLayer = undefined;\r\n      const deletedLayer = layers.splice(idx, 1)[0];\r\n\r\n      actions.pushToHistory({\r\n        path: ['resizableLayers', idx],\r\n        newValue: HistoryItem.RemoveArrayItem,\r\n        oldValue: deletedLayer,\r\n        findBy: {\r\n          id: deletedLayer.id\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  const contextMenu = createContextMenu({\r\n    buttons: [\r\n      {\r\n        icon: 'delete',\r\n        className: 'danger',\r\n        text: 'Delete',\r\n        onClick\r\n      }\r\n    ],\r\n    listenTo: container,\r\n    onElementReady: (element) => {\r\n      element.classList.add('night');\r\n    }\r\n  });\r\n\r\n  onCleanup(() => {\r\n    contextMenu.destroy();\r\n  });\r\n}\r\n","import {modifyMutable, produce} from 'solid-js/store'\r\n\r\nimport {animateValue, lerp, lerpArray, snapToViewport} from '../utils';\r\nimport {useMediaEditorContext} from '../context';\r\nimport {NumberPair} from '../types';\r\n\r\nimport {useCropOffset} from './useCropOffset';\r\n\r\nexport function animateToNewRotationOrRatio(newRotation: number) {\r\n  const {editorState, mediaState} = useMediaEditorContext();\r\n  if(!editorState.imageSize) return;\r\n\r\n  const cropOffset = useCropOffset();\r\n\r\n  const [w, h] = editorState.imageSize;\r\n\r\n  const snappedRotation90 = Math.round((newRotation / Math.PI) * 2);\r\n  const isReversedRatio = Math.abs(snappedRotation90) & 1;\r\n  const snappedRotation = (snappedRotation90 * Math.PI) / 2;\r\n\r\n  let ratio: number;\r\n\r\n  if(editorState.fixedImageRatioKey?.includes('x')) {\r\n    const parts = editorState.fixedImageRatioKey.split('x');\r\n    ratio = parseInt(parts[0]) / parseInt(parts[1]);\r\n  } else {\r\n    ratio = isReversedRatio ? h / w : w / h;\r\n  }\r\n\r\n  const originalRatio = w / h;\r\n\r\n  const [w1, h1] = snapToViewport(originalRatio, cropOffset().width, cropOffset().height);\r\n  const [w2, h2] = snapToViewport(ratio, cropOffset().width, cropOffset().height);\r\n\r\n  const initialScale = mediaState.scale;\r\n  const initialTranslation = mediaState.translation;\r\n  const initialRotation = mediaState.rotation;\r\n  const targetScale = isReversedRatio ? Math.max(w2 / h1, h2 / w1) : Math.max(w2 / w1, h2 / h1);\r\n  const targetTranslation = [0, 0];\r\n  const targetRotation = snappedRotation;\r\n\r\n  mediaState.currentImageRatio = ratio;\r\n  editorState.isMoving = true;\r\n\r\n  animateValue(\r\n    0,\r\n    1,\r\n    200,\r\n    (progress) => {\r\n      modifyMutable(mediaState, produce((state) => {\r\n        state.scale = lerp(initialScale, targetScale, progress);\r\n        state.translation = lerpArray(initialTranslation, targetTranslation, progress) as NumberPair;\r\n        state.rotation = lerp(initialRotation, targetRotation, progress);\r\n      }));\r\n    },\r\n    {\r\n      onEnd: () => {\r\n        editorState.isMoving = false;\r\n        mediaState.rotation = mediaState.rotation % (Math.PI * 2);\r\n      }\r\n    }\r\n  );\r\n}\r\n","import {batch, createEffect, createSignal, on, onCleanup, onMount} from 'solid-js';\r\nimport {modifyMutable, produce} from 'solid-js/store';\r\n\r\nimport clamp from '../../../helpers/number/clamp';\r\n\r\nimport {ButtonIconTsx} from '../../buttonIconTsx';\r\nimport SwipeHandler from '../../swipeHandler';\r\n\r\nimport {animateValue, lerp, withCurrentOwner} from '../utils';\r\nimport {useMediaEditorContext} from '../context';\r\nimport {NumberPair} from '../types';\r\n\r\nimport {animateToNewRotationOrRatio} from './animateToNewRotationOrRatio';\r\nimport getConvenientPositioning from './getConvenientPositioning';\r\n\r\nconst DEGREE_DIST_PX = 42;\r\nconst DEGREE_STEP = 15;\r\nconst TOTAL_DEGREES_SIDE = 90;\r\nconst MAX_DEGREES_DIST_PX = (TOTAL_DEGREES_SIDE / DEGREE_STEP) * DEGREE_DIST_PX;\r\nconst SNAP_DIST_PX = 40;\r\n\r\nfunction rotationFromMove(amount: number) {\r\n  return ((amount / DEGREE_DIST_PX) * DEGREE_STEP * Math.PI) / 180;\r\n}\r\n\r\nexport default function RotationWheel() {\r\n  const {editorState, mediaState, actions} = useMediaEditorContext();\r\n\r\n  const isCropping = () => editorState.currentTab === 'crop';\r\n\r\n  const [moved, setMoved] = createSignal(0);\r\n  const [movedDiff, setMovedDiff] = createSignal(0);\r\n\r\n  let swiperEl: HTMLDivElement;\r\n\r\n  onMount(() => {\r\n    const snappedRotation = (Math.round((mediaState.rotation / Math.PI) * 2) * Math.PI) / 2;\r\n    setMoved((((snappedRotation - mediaState.rotation) * 180) / Math.PI / DEGREE_STEP) * DEGREE_DIST_PX);\r\n    prevRotation = rotationFromMove(moved());\r\n\r\n    let currentDiff: number;\r\n    let targetDiff: number;\r\n    let prevShouldSnap = getShouldSnap();\r\n    let isAnimating = false;\r\n    let isSnapped = false;\r\n    let cancelAnimation: () => void;\r\n    let timeoutId: number;\r\n\r\n    function getShouldSnap() {\r\n      return Math.abs(moved() + currentDiff || 0) < SNAP_DIST_PX\r\n    }\r\n\r\n    function handleDiffChange(diff: number) {\r\n      setMovedDiff(diff);\r\n      onSwipe();\r\n    }\r\n\r\n    function removeSnapAfterTimeout() {\r\n      timeoutId = window.setTimeout(() => {\r\n        isSnapped = false;\r\n        isAnimating = true;\r\n\r\n        const initialDiff = movedDiff();\r\n        cancelAnimation?.();\r\n        cancelAnimation = animateValue(0, 1, 200, (progress) => {\r\n          handleDiffChange(lerp(initialDiff, currentDiff, progress));\r\n        }, {\r\n          onEnd: () => {\r\n            isAnimating = false\r\n          }\r\n        });\r\n      }, 750);\r\n    }\r\n\r\n    const swipeHandler = new SwipeHandler({\r\n      element: swiperEl,\r\n      onStart() {\r\n        initialScale = mediaState.scale;\r\n        currentDiff = movedDiff();\r\n        targetDiff = currentDiff;\r\n        isAnimating = false;\r\n        isSnapped = false;\r\n        prevShouldSnap = getShouldSnap();\r\n        editorState.isMoving = true;\r\n      },\r\n      onSwipe(xDiff) {\r\n        targetDiff = currentDiff = clamp(moved() + xDiff, -MAX_DEGREES_DIST_PX, MAX_DEGREES_DIST_PX) - moved();\r\n        const shouldSnap = getShouldSnap();\r\n        if(shouldSnap) targetDiff = -moved();\r\n\r\n        if(prevShouldSnap !== shouldSnap) {\r\n          window.clearTimeout(timeoutId);\r\n          timeoutId = window.setTimeout(() => {\r\n            const shouldSnapAfterTimeout = getShouldSnap();\r\n            if(shouldSnapAfterTimeout !== shouldSnap) return;\r\n            isAnimating = true;\r\n            const initialDiff = movedDiff();\r\n            cancelAnimation?.();\r\n            cancelAnimation = animateValue(0, 1, 200, (progress) => {\r\n              handleDiffChange(lerp(initialDiff, targetDiff, progress));\r\n            }, {\r\n              onEnd: () => {\r\n                isAnimating = false;\r\n                isSnapped = getShouldSnap();\r\n\r\n                if(!isSnapped) return;\r\n                removeSnapAfterTimeout();\r\n              }\r\n            });\r\n          }, 200);\r\n        }\r\n\r\n        prevShouldSnap = shouldSnap;\r\n\r\n        if(isAnimating || isSnapped) return;\r\n        handleDiffChange(currentDiff);\r\n      },\r\n      onReset() {\r\n        let newMoved = moved() + movedDiff();\r\n        if(Math.abs(newMoved) === MAX_DEGREES_DIST_PX) {\r\n          newMoved = 0;\r\n          prevRotation = 0;\r\n          prevShouldSnap = false;\r\n          isAnimating = false;\r\n        }\r\n        cancelAnimation?.();\r\n        window.clearTimeout(timeoutId);\r\n        batch(() => {\r\n          setMoved(newMoved);\r\n          setMovedDiff(0);\r\n          editorState.isMoving = false;\r\n          mediaState.rotation = mediaState.rotation % (Math.PI * 2)\r\n        });\r\n      }\r\n    });\r\n\r\n    onCleanup(() => {\r\n      swipeHandler.removeListeners();\r\n    });\r\n  });\r\n\r\n  let prevRotation = 0;\r\n  let initialScale = 0;\r\n\r\n  const onSwipe = withCurrentOwner(() => {\r\n    const rotationFromSwiper = rotationFromMove(moved() + movedDiff());\r\n    const rotationDiff = rotationFromSwiper - prevRotation;\r\n\r\n    const targetRotation = mediaState.rotation - rotationDiff;\r\n\r\n    const r = [Math.cos(rotationDiff), Math.sin(rotationDiff)];\r\n\r\n    const targetTranslation: NumberPair = [\r\n      mediaState.translation[0] * r[0] + mediaState.translation[1] * r[1],\r\n      mediaState.translation[1] * r[0] - mediaState.translation[0] * r[1]\r\n    ];\r\n\r\n    prevRotation = rotationFromSwiper;\r\n\r\n    if(!initialScale) return;\r\n    const {cropMinX, cropMaxX, cropMinY, cropMaxY, imageMinX, imageMaxX, imageMinY, imageMaxY} =\r\n      getConvenientPositioning({\r\n        scale: initialScale,\r\n        rotation: targetRotation,\r\n        translation: targetTranslation\r\n      });\r\n\r\n    const halfImageWidth = (imageMaxX - imageMinX) / 2,\r\n      halfImageHeight = (imageMaxY - imageMinY) / 2;\r\n    const imageCenter = [imageMinX + halfImageWidth, imageMinY + halfImageHeight];\r\n\r\n    let additionalScale = 1;\r\n\r\n    if(imageMinX > cropMinX) additionalScale = Math.max((imageCenter[0] - cropMinX) / halfImageWidth, additionalScale);\r\n    if(imageMaxX < cropMaxX) additionalScale = Math.max((cropMaxX - imageCenter[0]) / halfImageWidth, additionalScale);\r\n    if(imageMinY > cropMinY)\r\n      additionalScale = Math.max((imageCenter[1] - cropMinY) / halfImageHeight, additionalScale);\r\n    if(imageMaxY < cropMaxY)\r\n      additionalScale = Math.max((cropMaxY - imageCenter[1]) / halfImageHeight, additionalScale);\r\n\r\n\r\n    modifyMutable(mediaState, produce(s => {\r\n      s.rotation = targetRotation;\r\n      s.translation = targetTranslation;\r\n      if(additionalScale > 1) {\r\n        s.scale = initialScale * additionalScale;\r\n      }\r\n    }));\r\n  });\r\n\r\n  function resetWheelWithAnimation() {\r\n    prevRotation = 0;\r\n    animateValue([moved(), movedDiff()], [0, 0], 200, (values) => {\r\n      batch(() => {\r\n        setMoved(values[0]);\r\n        setMovedDiff(values[1]);\r\n      });\r\n    });\r\n  }\r\n\r\n  actions.resetRotationWheel = () => resetWheelWithAnimation();\r\n  onCleanup(() => {\r\n    actions.resetRotationWheel = () => {}\r\n  });\r\n\r\n  let isFirstEffect = true;\r\n  createEffect(\r\n    on(() => editorState.fixedImageRatioKey, () => {\r\n      if(isFirstEffect) {\r\n        isFirstEffect = false;\r\n        return;\r\n      }\r\n      resetWheelWithAnimation();\r\n    })\r\n  );\r\n\r\n  function rotateLeft() {\r\n    const newRotation = (Math.round((mediaState.rotation / Math.PI) * 2) * Math.PI) / 2 - Math.PI / 2;\r\n\r\n    animateToNewRotationOrRatio(newRotation);\r\n\r\n    resetWheelWithAnimation();\r\n  }\r\n\r\n  function flipImage() {\r\n    editorState.isMoving = true;\r\n    const isReversedRatio = Math.abs(Math.round((mediaState.rotation / Math.PI) * 2)) & 1;\r\n    const snapTo1 = (value: number) => value < 0 ? -1 : 1;\r\n    const targetFlip: NumberPair = [\r\n      snapTo1(mediaState.flip[0]) * (isReversedRatio ? 1 : -1),\r\n      snapTo1(mediaState.flip[1]) * (isReversedRatio ? -1 : 1)\r\n    ];\r\n    animateValue(mediaState.flip, targetFlip, 200, (value) => void (mediaState.flip = value), {\r\n      onEnd: () => void (editorState.isMoving = false)\r\n    });\r\n  }\r\n\r\n  const value = () =>\r\n    ((-(moved() + movedDiff()) / DEGREE_DIST_PX) * DEGREE_STEP)\r\n    .toFixed(1)\r\n    .replace(/\\.0$/, '')\r\n    .replace(/^-0$/, '0');\r\n\r\n  return (\r\n    <div class=\"media-editor__rotation-wheel\" style={{display: isCropping() ? undefined : 'none'}}>\r\n      <ButtonIconTsx onClick={withCurrentOwner(rotateLeft)} class=\"media-editor__rotation-wheel-button\" icon=\"rotate\" />\r\n      <div class=\"media-editor__rotation-wheel-swiper-wrapper\">\r\n        <div\r\n          ref={swiperEl}\r\n          style={{['--moved']: moved() + movedDiff() + 'px'}}\r\n          class=\"media-editor__rotation-wheel-swiper\"\r\n        >\r\n          <div class=\"media-editor__rotation-wheel-labels\">\r\n            {new Array(13).fill(null).map((_, i) => (\r\n              <div class=\"media-editor__rotation-wheel-label\">\r\n                <div class=\"media-editor__rotation-wheel-label-number\">{i * 15 - 90}</div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n          <div class=\"media-editor__rotation-wheel-dots\">\r\n            {new Array(97).fill(null).map(() => (\r\n              <div class=\"media-editor__rotation-wheel-dot\" />\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"media-editor__rotation-wheel-value\">\r\n        <div class=\"media-editor__rotation-wheel-value-number\">{value()}</div>\r\n      </div>\r\n      <ArrowUp />\r\n      <ButtonIconTsx onClick={flipImage} class=\"media-editor__rotation-wheel-button\" icon=\"flip_image_horizontal\" />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ArrowUp() {\r\n  return (\r\n    <svg\r\n      class=\"media-editor__rotation-wheel-arrow\"\r\n      width=\"6\"\r\n      height=\"4\"\r\n      viewBox=\"0 0 6 4\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <path\r\n        d=\"M2.29289 0.707106L0.28033 2.71967C-0.192143 3.19214 0.142482 4 0.81066 4H5.18934C5.85752 4 6.19214 3.19214 5.71967 2.71967L3.70711 0.707107C3.31658 0.316583 2.68342 0.316582 2.29289 0.707106Z\"\r\n        fill=\"white\"\r\n      />\r\n    </svg>\r\n  );\r\n}\r\n","import {batch, createEffect, createMemo, createSignal, on, onCleanup} from 'solid-js';\r\nimport {modifyMutable, produce} from 'solid-js/store';\r\n\r\nimport {animateValue, getSnappedViewportsScale, lerp, lerpArray} from '../utils';\r\nimport {useMediaEditorContext} from '../context';\r\nimport {NumberPair} from '../types';\r\n\r\nimport {useCropOffset} from './useCropOffset';\r\n\r\nexport type FinalTransform = {\r\n  flip: NumberPair;\r\n  translation: NumberPair;\r\n  rotation: number;\r\n  scale: number;\r\n};\r\n\r\nexport default function useFinalTransform() {\r\n  const {editorState, mediaState} = useMediaEditorContext();\r\n\r\n  const cropOffset = useCropOffset();\r\n\r\n  const isCropping = createMemo(() => editorState.currentTab === 'crop');\r\n\r\n  const [cropTabAnimationProgress, setCropTabAnimationProgress] = createSignal(0);\r\n\r\n  let isFirstEffect = true;\r\n  createEffect(\r\n    on(isCropping, () => {\r\n      if(isFirstEffect) {\r\n        isFirstEffect = false;\r\n        return;\r\n      }\r\n\r\n      editorState.isMoving = true;\r\n\r\n      const cancel = animateValue(cropTabAnimationProgress(), isCropping() ? 1 : 0, 200, setCropTabAnimationProgress, {\r\n        onEnd: () => editorState.isMoving = false\r\n      });\r\n\r\n      onCleanup(cancel);\r\n    })\r\n  );\r\n\r\n  const [prevCanvasSize, setPrevCanvasSize] = createSignal<NumberPair>();\r\n  const [prevCropTranslation, setPrevCropTranslation] = createSignal<NumberPair>();\r\n  const [prevAdditionalScale, setPrevAdditionalScale] = createSignal<number>();\r\n\r\n  const additionalImageScales = createMemo(() => {\r\n    const payload = editorState.renderingPayload;\r\n    if(!payload || !editorState.canvasSize) return;\r\n\r\n    const [w, h] = editorState.canvasSize;\r\n\r\n    const imageRatio = payload.media.width / payload.media.height;\r\n\r\n    const toCropScale = getSnappedViewportsScale(imageRatio, cropOffset().width, cropOffset().height, w, h);\r\n    const fromCroppedScale =\r\n      1 / getSnappedViewportsScale(mediaState.currentImageRatio, cropOffset().width, cropOffset().height, w, h);\r\n\r\n    const snappedImageScale = Math.min(w / payload.media.width, h / payload.media.height);\r\n\r\n    return {\r\n      toCropScale,\r\n      fromCroppedScale,\r\n      snappedImageScale\r\n    };\r\n  });\r\n\r\n  const cropTrnsl = createMemo(() => {\r\n    if(!editorState.canvasSize || !additionalImageScales()) return;\r\n    const {fromCroppedScale} = additionalImageScales();\r\n\r\n    return mediaState.translation.map((x) => x * fromCroppedScale - x) as NumberPair;\r\n  });\r\n\r\n  const cropTranslation = createMemo(() => {\r\n    if(!editorState.canvasSize || !additionalImageScales()) return;\r\n    const [, h] = editorState.canvasSize;\r\n    const {fromCroppedScale} = additionalImageScales();\r\n\r\n    return lerpArray(\r\n      mediaState.translation.map((x) => x * fromCroppedScale - x),\r\n      [0, cropOffset().left + cropOffset().height / 2 - h / 2],\r\n      cropTabAnimationProgress()\r\n    ) as NumberPair;\r\n  });\r\n\r\n  let prevScale: number;\r\n  let prevTranslation: NumberPair;\r\n\r\n  function updatePrevValues() {\r\n    if(!additionalImageScales() || !cropTrnsl()) return;\r\n    const {toCropScale, fromCroppedScale, snappedImageScale} = additionalImageScales();\r\n    prevScale = toCropScale * snappedImageScale * fromCroppedScale;\r\n    prevTranslation = cropTrnsl();\r\n  }\r\n\r\n  createEffect(\r\n    on(cropTabAnimationProgress, () => {\r\n      if([0, 1].includes(cropTabAnimationProgress())) updatePrevValues();\r\n    })\r\n  );\r\n  createEffect(\r\n    on(() => mediaState.currentImageRatio, () => {\r\n      updatePrevValues();\r\n    })\r\n  );\r\n\r\n  createEffect(\r\n    on(() => editorState.canvasSize, () => {\r\n      if(!editorState.canvasSize || !additionalImageScales()) return;\r\n      const prevSize = editorState.canvasSize;\r\n      const {toCropScale, fromCroppedScale, snappedImageScale} = additionalImageScales();\r\n      prevScale = toCropScale * snappedImageScale * fromCroppedScale;\r\n      prevTranslation = cropTrnsl();\r\n\r\n      onCleanup(() => {\r\n        batch(() => {\r\n          setPrevCanvasSize(prevSize);\r\n          setPrevAdditionalScale(prevScale);\r\n          setPrevCropTranslation(prevTranslation);\r\n        });\r\n      });\r\n    })\r\n  );\r\n\r\n  createEffect(\r\n    on(prevCanvasSize, () => {\r\n      if(!prevCanvasSize || !prevAdditionalScale()) return;\r\n      const currentSize = editorState.canvasSize;\r\n      const {toCropScale, fromCroppedScale, snappedImageScale} = additionalImageScales();\r\n      const currentAdditionalScale = toCropScale * snappedImageScale * fromCroppedScale;\r\n\r\n      const scaleToChange = getSnappedViewportsScale(\r\n        mediaState.currentImageRatio,\r\n        currentSize[0],\r\n        currentSize[1],\r\n        prevCanvasSize()[0],\r\n        prevCanvasSize()[1]\r\n      );\r\n      const counterScale = prevAdditionalScale() / currentAdditionalScale;\r\n\r\n      const totalScale = scaleToChange * counterScale;\r\n\r\n      // const translationDiff = [\r\n      //   prevCropTranslation()[0] - cropTrnsl()[0],\r\n      //   prevCropTranslation()[1] - cropTrnsl()[1]\r\n      // ];\r\n      // console.log('translationDiff', translationDiff)\r\n\r\n      modifyMutable(mediaState, produce((state) => {\r\n        state.scale = state.scale * totalScale,\r\n        state.translation = state.translation.map((v) => v * totalScale) as NumberPair\r\n      }));\r\n    })\r\n  );\r\n\r\n  createEffect(() => {\r\n    const payload = editorState.renderingPayload;\r\n    if(!payload) return;\r\n\r\n    let {fromCroppedScale, toCropScale, snappedImageScale} = additionalImageScales();\r\n\r\n    toCropScale *= lerp(fromCroppedScale, 1, cropTabAnimationProgress());\r\n\r\n    // const cropTranslation = lerpArray(\r\n    //   translation().map((x) => x * fromCroppedScale - x),\r\n    //   [0, cropOffset().left + cropOffset().height / 2 - h / 2],\r\n    //   cropTabAnimationProgress()\r\n    // );\r\n    // console.log('cropTranslation', cropTranslation)\r\n\r\n    modifyMutable(editorState.finalTransform, produce(t => {\r\n      t.flip = mediaState.flip,\r\n      t.rotation = mediaState.rotation,\r\n      t.scale = mediaState.scale * editorState.pixelRatio * snappedImageScale * toCropScale;\r\n      t.translation = [cropTranslation()[0] + mediaState.translation[0], cropTranslation()[1] + mediaState.translation[1]].map(\r\n        (v) => v * editorState.pixelRatio\r\n      ) as NumberPair\r\n    }));\r\n  });\r\n}\r\n","import {onCleanup} from 'solid-js';\r\n\r\ntype PossibleEvent = DocumentEventMap[keyof DocumentEventMap];\r\n\r\ntype EventsMapValue = {\r\n  callbacks: Array<(e: PossibleEvent) => void>;\r\n  listener: (e: PossibleEvent) => void;\r\n};\r\n\r\nconst eventsMap = new Map<keyof DocumentEventMap, EventsMapValue>;\r\n\r\nexport function registerGlobalDocumentEvent<Key extends keyof DocumentEventMap>(eventName: Key, callback: (e: DocumentEventMap[Key]) => void) {\r\n  const value: EventsMapValue = eventsMap.get(eventName) || {\r\n    callbacks: [],\r\n    listener: (e) => {\r\n      value.callbacks.forEach(clb => clb(e));\r\n    }\r\n  };\r\n\r\n  if(!eventsMap.has(eventName)) {\r\n    eventsMap.set(eventName, value);\r\n    document.addEventListener(eventName, value.listener);\r\n  }\r\n\r\n  value.callbacks.push(callback as (e: PossibleEvent) => void);\r\n\r\n  return {\r\n    cleanup: () => {\r\n      value.callbacks = value.callbacks.filter(clb => clb !== callback);\r\n      if(value.callbacks.length) return;\r\n\r\n      eventsMap.delete(eventName);\r\n      document.removeEventListener(eventName, value.listener);\r\n    }\r\n  }\r\n}\r\n\r\nexport default function useGlobalDocumentEvent<Key extends keyof DocumentEventMap>(eventName: Key, callback: (e: DocumentEventMap[Key]) => void) {\r\n  const {cleanup} = registerGlobalDocumentEvent(eventName, callback);\r\n\r\n  onCleanup(cleanup);\r\n};\r\n","import {StandardLonghandPropertiesHyphen} from 'csstype';\r\nimport {Accessor, onCleanup} from 'solid-js';\r\nimport useGlobalDocumentEvent from './useGlobalDocumentEvent';\r\n\r\n\r\nexport type SwipeDirectiveArgs = {\r\n  globalCursor?: Accessor<StandardLonghandPropertiesHyphen['cursor']>;\r\n  onStart?: (e: PointerEvent | TouchEvent) => void;\r\n  onMove?: (xDiff: number, yDiff: number, e: PointerEvent | TouchEvent) => void;\r\n  onEnd?: (xDiff: number, yDiff: number, e: PointerEvent | TouchEvent) => void;\r\n};\r\n\r\ndeclare module 'solid-js' {\r\n  namespace JSX {\r\n    interface Directives {\r\n      swipe: SwipeDirectiveArgs;\r\n    }\r\n  }\r\n}\r\n\r\nexport default function swipe(element: HTMLElement, args: Accessor<SwipeDirectiveArgs>) {\r\n  let isDragging = false;\r\n  let initialX: number, initialY: number;\r\n\r\n  const getDiffPointer = (e: PointerEvent) => [\r\n    e.clientX - initialX,\r\n    e.clientY - initialY\r\n  ] as const;\r\n\r\n  const getDiffTouch = (e: TouchEvent) => [\r\n    e.changedTouches[0].clientX - initialX,\r\n    e.changedTouches[0].clientY - initialY\r\n  ] as const;\r\n\r\n  function handleStart(e: PointerEvent | TouchEvent, x: number, y: number) {\r\n    if(isDragging) return;\r\n    isDragging = true;\r\n    initialX = x;\r\n    initialY = y;\r\n\r\n    const {onStart, globalCursor} = args();\r\n    onStart?.(e);\r\n\r\n    if(globalCursor) {\r\n      document.body.style.setProperty('cursor', globalCursor(), 'important');\r\n      element.style.setProperty('cursor', globalCursor(), 'important');\r\n    }\r\n  }\r\n\r\n  function handleMove(e: PointerEvent | TouchEvent, diff: readonly [number, number]) {\r\n    if(!isDragging) return;\r\n\r\n    const {onMove} = args();\r\n    onMove?.(...diff, e);\r\n  }\r\n\r\n  function handleEnd(e: PointerEvent | TouchEvent, diff: readonly [number, number]) {\r\n    if(!isDragging) return;\r\n\r\n    const {onEnd, globalCursor} = args();\r\n    onEnd?.(...diff, e);\r\n    if(globalCursor) {\r\n      document.body.style.removeProperty('cursor');\r\n      element.style.removeProperty('cursor');\r\n    }\r\n\r\n    isDragging = false;\r\n    initialX = initialY = undefined;\r\n  }\r\n\r\n  element.addEventListener('pointerdown', (e) => {\r\n    handleStart(e, e.clientX, e.clientY);\r\n  });\r\n\r\n  element.addEventListener('touchstart', (e) => {\r\n    handleStart(e, e.changedTouches[0].clientX, e.changedTouches[0].clientY);\r\n  });\r\n\r\n  useGlobalDocumentEvent('pointermove', (e) => {\r\n    handleMove(e, getDiffPointer(e));\r\n  });\r\n\r\n  useGlobalDocumentEvent('touchmove', (e) => {\r\n    handleMove(e, getDiffTouch(e));\r\n  });\r\n\r\n  useGlobalDocumentEvent('pointermove', (e) => {\r\n    handleMove(e, getDiffPointer(e));\r\n  });\r\n\r\n  useGlobalDocumentEvent('pointerup', (e) => {\r\n    handleEnd(e, getDiffPointer(e));\r\n  });\r\n\r\n  useGlobalDocumentEvent('touchend', (e) => {\r\n    handleEnd(e, getDiffTouch(e));\r\n  });\r\n}\r\n","import {createEffect, onCleanup} from 'solid-js';\r\nimport deferredPromise from '../../../helpers/cancellablePromise';\r\nimport createMiddleware from '../../../helpers/solid/createMiddleware';\r\nimport {useMediaEditorContext} from '../context';\r\nimport {snapToViewport} from '../utils';\r\nimport createVideoForDrawing from './createVideoForDrawing';\r\nimport styles from './videoControls.module.scss';\r\n\r\ntype Args = {\r\n  getCanvas: () => HTMLCanvasElement;\r\n  size: {\r\n    width: number;\r\n    height: number;\r\n  };\r\n};\r\n\r\nexport default function useVideoControlsCanvas({getCanvas, size}: Args) {\r\n  const {editorState, mediaSrc} = useMediaEditorContext();\r\n\r\n  createEffect(() => {\r\n    const media = editorState.renderingPayload?.media;\r\n    const canvas = getCanvas();\r\n    if(!media || !canvas || !size.width || !size.height) return;\r\n\r\n    const ratio = media.width / media.height;\r\n\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    let\r\n      deferred = deferredPromise<void>(),\r\n      cleaned = false\r\n    ;\r\n\r\n    onCleanup(() => {\r\n      cleaned = true;\r\n      deferred?.resolve();\r\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    });\r\n\r\n    const middleware = createMiddleware().get();\r\n\r\n    (async() => {\r\n      const video = await createVideoForDrawing(mediaSrc, {currentTime: 0, middleware});\r\n      // (window as any).myWeakRef = new WeakRef(video); // works\r\n\r\n      if(cleaned) return;\r\n\r\n      video.addEventListener('seeked', () => {\r\n        deferred?.resolve();\r\n      });\r\n\r\n      const [chunkWidth, chunkHeight] = snapToViewport(ratio, size.width, size.height);\r\n\r\n      for(let x = 0; x < size.width; x += chunkWidth) {\r\n        deferred = deferredPromise();\r\n        video.currentTime = x / size.width * video.duration;\r\n\r\n        await deferred;\r\n        if(cleaned) return;\r\n\r\n        ctx.drawImage(video, x, 0, chunkWidth, chunkHeight);\r\n\r\n        const fade = document.createElement('div');\r\n\r\n        fade.classList.add(styles.FrameFade);\r\n        fade.style.top = '0px';\r\n        fade.style.left = x + 'px';\r\n        fade.style.width = chunkWidth + 0.5 + 'px'; // add a few px to prevent unexpected borders\r\n        fade.style.height = chunkHeight + 'px';\r\n\r\n        canvas.after(fade);\r\n\r\n        fade.animate({opacity: [1, 0]}, {duration: 500, easing: 'ease-in-out'}).finished\r\n        .then(() => fade.remove());\r\n      }\r\n    })();\r\n  });\r\n}\r\n","import {batch, Component, createMemo, createSignal} from 'solid-js';\r\n\r\nimport clamp from '../../../helpers/number/clamp';\r\nimport swipe, {SwipeDirectiveArgs} from '../../../helpers/useSwipe'; swipe; // keep\r\nimport useElementSize from '../../../hooks/useElementSize';\r\nimport {i18n} from '../../../lib/langPack';\r\n\r\nimport {IconTsx} from '../../iconTsx';\r\nimport ripple from '../../ripple'; ripple; // keep\r\nimport showTooltip from '../../tooltip';\r\n\r\nimport {SetVideoTimeFlags, useMediaEditorContext} from '../context';\r\n\r\nimport useVideoControlsCanvas from './useVideoControlsCanvas';\r\n\r\nimport styles from './videoControls.module.scss';\r\n\r\n\r\nconst HANDLE_WIDTH_PX = 9;\r\nconst MOVE_ACTIVATION_THRESHOLD_PX = 2;\r\n\r\nconst VideoControls: Component<{}> = () => {\r\n  const {editorState, mediaState, actions} = useMediaEditorContext();\r\n\r\n  const [cropper, setCropper] = createSignal<HTMLDivElement>();\r\n  const [isDraggingSomething, setIsDraggingSomething] = createSignal(false);\r\n\r\n  const cropperSize = useElementSize(cropper);\r\n  const strippedWidth = () => cropperSize.width - 2 * HANDLE_WIDTH_PX;\r\n\r\n  const shouldShowTime = () => isDraggingSomething() && (swiping === 'left' || swiping === 'right');\r\n\r\n  const formattedResultingTime = createMemo(() => {\r\n    if(!shouldShowTime()) return '';\r\n    const video = editorState.renderingPayload?.media?.video;\r\n    if(!video) return '';\r\n\r\n    const totalSeconds = mediaState.videoCropLength * video.duration;\r\n    let ts = totalSeconds;\r\n\r\n    const hh = (Math.floor(ts / 3600) + '').padStart(2, '0');\r\n    ts -= +hh * 3600;\r\n    const mm = (Math.floor(ts / 60) + '').padStart(2, '0');\r\n    ts -= +mm * 60;\r\n    const ss = (Math.floor(ts) + '').padStart(2, '0');\r\n    ts -= +ss;\r\n    const decimal = (Math.floor(ts * 4) * 25 + '').replace(/0$/, '');\r\n\r\n    return (+hh ? `${hh}:` : '') + `${mm}:${ss}` + (decimal && totalSeconds < 10 ? `.${decimal}` : '');\r\n  });\r\n\r\n  const minLength = createMemo(() => {\r\n    const duration = editorState.renderingPayload?.media?.video?.duration;\r\n    if(!duration) return 0;\r\n    return Math.min(1, 0.5 / duration);\r\n  });\r\n\r\n  let\r\n    canvas: HTMLCanvasElement,\r\n    initialStart: number,\r\n    initialLength: number,\r\n    swiping: 'left' | 'middle' | 'right' | 'cursor';\r\n  ;\r\n\r\n  useVideoControlsCanvas({\r\n    getCanvas: () => canvas,\r\n    size: cropperSize\r\n  });\r\n\r\n  const leftHandleSwipeArgs: SwipeDirectiveArgs = {\r\n    globalCursor: () => 'ew-resize',\r\n    onStart: () => {\r\n      swiping = 'left';\r\n      initialStart = mediaState.videoCropStart;\r\n      initialLength = mediaState.videoCropLength;\r\n\r\n      batch(() => {\r\n        setIsDraggingSomething(true);\r\n        editorState.isPlaying = false;\r\n      });\r\n    },\r\n    onMove: (xDiff) => void batch(() => {\r\n      if(swiping !== 'left') return;\r\n      const diff = clamp(initialStart + xDiff / strippedWidth(), 0, Math.max(0, initialStart + initialLength - minLength())) - initialStart;\r\n      batch(() => {\r\n        mediaState.videoCropStart = (initialStart + diff);\r\n        mediaState.videoCropLength = (initialLength - diff);\r\n        actions.setVideoTime(mediaState.videoCropStart);\r\n      });\r\n    }),\r\n    onEnd: () => void setIsDraggingSomething(false)\r\n  };\r\n\r\n  const rightHandleSwipeArgs: SwipeDirectiveArgs = {\r\n    globalCursor: () => 'ew-resize',\r\n    onStart: () => {\r\n      swiping = 'right';\r\n      initialLength = mediaState.videoCropLength;\r\n\r\n      batch(() => {\r\n        setIsDraggingSomething(true);\r\n        editorState.isPlaying = false;\r\n      });\r\n    },\r\n    onMove: (xDiff) => void batch(() => {\r\n      if(swiping !== 'right') return;\r\n      const maxLength = 1 - mediaState.videoCropStart;\r\n      mediaState.videoCropLength = (clamp(initialLength + xDiff / strippedWidth(), Math.min(minLength(), maxLength), maxLength));\r\n      actions.setVideoTime(mediaState.videoCropStart + mediaState.videoCropLength);\r\n    }),\r\n    onEnd: () => void setIsDraggingSomething(false)\r\n  };\r\n\r\n  let canMove = false;\r\n\r\n  const middleSwipeArgs: SwipeDirectiveArgs = {\r\n    globalCursor: () => initialLength === 1 ? 'col-resize' : 'grabbing',\r\n    onStart: (e) => {\r\n      swiping = 'middle';\r\n      initialStart = mediaState.videoCropStart;\r\n      initialLength = mediaState.videoCropLength;\r\n      canMove = false;\r\n\r\n      if(initialLength === 1) {\r\n        setIsDraggingSomething(true);\r\n        canMove = true;\r\n        handleCursorMove(e);\r\n      }\r\n    },\r\n    onMove: (xDiff, _, e) => void batch((): void => {\r\n      if(swiping !== 'middle') return;\r\n      if(initialLength === 1) return void handleCursorMove(e);\r\n\r\n      if(Math.abs(xDiff) > MOVE_ACTIVATION_THRESHOLD_PX) canMove = true;\r\n      if(!canMove) return;\r\n\r\n      const startDiff = clamp(initialStart + xDiff / strippedWidth(), 0, Math.max(0, 1 - Math.max(initialLength, minLength()))) - initialStart;\r\n      batch(() => {\r\n        setIsDraggingSomething(true);\r\n        editorState.isPlaying = false;\r\n\r\n        mediaState.videoCropStart = initialStart + startDiff;\r\n        // mediaState.videoCropLength = clamp(initialLength - startDiff + xDiff / strippedWidth(), Math.min(1, minLength()), 1 - mediaState.videoCropStart);\r\n\r\n        actions.setVideoTime(mediaState.videoCropStart);\r\n      });\r\n    }),\r\n    onEnd: () => {\r\n      self.setTimeout(() => {\r\n        setIsDraggingSomething(false);\r\n      }, 0); // prevent trigger click after finishing dragging\r\n    }\r\n  };\r\n\r\n  const cursorSwipeArgs: SwipeDirectiveArgs = {\r\n    globalCursor: () => 'col-resize',\r\n    onStart: () => {\r\n      swiping = 'cursor';\r\n      setIsDraggingSomething(true);\r\n    },\r\n    onMove: (xDiff, __, e) => {\r\n      if(swiping !== 'cursor') return;\r\n      // if(Math.abs(xDiff) > MOVE_ACTIVATION_THRESHOLD_PX)\r\n      editorState.isPlaying = false;\r\n      handleCursorMove(e);\r\n    },\r\n    onEnd: () => void setIsDraggingSomething(false)\r\n  };\r\n\r\n  const handleCursorMove = (e: PointerEvent | TouchEvent) => {\r\n    editorState.isPlaying = false;\r\n    actions.setVideoTime(clamp(getPositionInCropper(e, cropper()), mediaState.videoCropStart, mediaState.videoCropStart + mediaState.videoCropLength));\r\n  };\r\n\r\n  const onMiddlePartClick = (e: MouseEvent) => {\r\n    if(!cropper() || isDraggingSomething()) return;\r\n\r\n    actions.setVideoTime(clamp(getPositionInCropper(e, cropper()), mediaState.videoCropStart, mediaState.videoCropStart + mediaState.videoCropLength));\r\n  };\r\n\r\n  const showMutedTooltip = (el: HTMLElement) => showTooltip({\r\n    element: el,\r\n    mountOn: el.parentElement.parentElement.parentElement,\r\n    vertical: 'top',\r\n    textElement: i18n('MediaEditor.VideoMutedTooltip'),\r\n    lighter: true,\r\n    auto: true\r\n  });\r\n\r\n  let closeTooltip: () => void;\r\n\r\n  return (\r\n    <div\r\n      class={styles.Container}\r\n      classList={{\r\n        [styles.hidden]: editorState.currentTab !== 'adjustments',\r\n        [styles.changed]: mediaState.videoCropLength !== 1\r\n      }}\r\n      style={{\r\n        '--start': mediaState.videoCropStart,\r\n        '--length': mediaState.videoCropLength,\r\n        '--current-time': mediaState.currentVideoTime\r\n      }}\r\n    >\r\n      <div class={styles.InnerContainer}>\r\n        <button\r\n          use:ripple\r\n          class={`btn-icon ${styles.IconButton} ${styles.MuteButton}`}\r\n          classList={{\r\n            [styles.muted]: mediaState.videoMuted\r\n          }}\r\n          onClick={(e) => {\r\n            mediaState.videoMuted = !mediaState.videoMuted;\r\n            closeTooltip?.();\r\n            if(mediaState.videoMuted) closeTooltip = showMutedTooltip(e.currentTarget).close;\r\n          }}\r\n          tabIndex={-1}\r\n        >\r\n          <IconTsx icon={mediaState.videoMuted ? 'volume_off' : 'volume_up'} />\r\n        </button>\r\n\r\n        <div class={styles.Frames}>\r\n          <div ref={setCropper} class={styles.Cropper}>\r\n            <canvas ref={canvas} class={styles.Images} width={cropperSize.width} height={cropperSize.height} />\r\n\r\n            <div class={`${styles.CropperBg} ${styles.CropperBgLeft}`} />\r\n            <div class={`${styles.CropperBg} ${styles.CropperBgRight}`} />\r\n\r\n            <div\r\n              class={styles.CropperHorizontalBorder}\r\n              classList={{\r\n                [styles.dragging]: isDraggingSomething()\r\n              }}\r\n              use:swipe={middleSwipeArgs}\r\n              onClick={onMiddlePartClick}\r\n            />\r\n\r\n            <div class={`${styles.CropperHandle} ${styles.CropperHandleLeft}`} use:swipe={leftHandleSwipeArgs} />\r\n            <div class={`${styles.CropperHandle} ${styles.CropperHandleRight}`} use:swipe={rightHandleSwipeArgs} />\r\n          </div>\r\n\r\n          <TimeStick swipe={cursorSwipeArgs} />\r\n          <ThumbnailTrack\r\n            cropper={cropper()}\r\n            isDraggingSomething={isDraggingSomething()}\r\n            hidden={shouldShowTime()}\r\n          />\r\n          <div class={styles.CroppedTime} classList={{[styles.visible]: shouldShowTime()}}>\r\n            {formattedResultingTime()}\r\n          </div>\r\n\r\n        </div>\r\n\r\n        <button\r\n          use:ripple\r\n          class={`btn-icon ${styles.IconButton} ${styles.PlayButton}`}\r\n          onClick={() => {\r\n            editorState.isPlaying = !editorState.isPlaying;\r\n          }}\r\n          tabIndex={-1}\r\n        >\r\n          <span class={styles.PlayButtonInner}> {/* <span> prevents duplicating the svg on hot reload */}\r\n            <PausePlay paused={!editorState.isPlaying} />\r\n          </span>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst ThumbnailTrack: Component<{\r\n  cropper: HTMLDivElement;\r\n  isDraggingSomething: boolean;\r\n  hidden: boolean;\r\n}> = (props) => {\r\n  const {actions, editorState, mediaState} = useMediaEditorContext();\r\n\r\n  const [ghostThumbnailPosition, setGhostThumbnailPosition] = createSignal<number>();\r\n\r\n  const [isDragging, setIsDragging] = createSignal(false);\r\n\r\n  const isGhostThumbnailVisible = createMemo(() => !props.isDraggingSomething && !isDragging() && !isNaN(ghostThumbnailPosition()));\r\n\r\n  const onClick = (e: MouseEvent) => {\r\n    if(!props.cropper) return;\r\n\r\n    mediaState.videoThumbnailPosition = getPositionInCropper(e, props.cropper);\r\n  };\r\n\r\n  let canPreviewFrame = false, previewFrameTimeout: number;\r\n\r\n  const onPointerMove = (e: PointerEvent | TouchEvent) => {\r\n    if(!props.cropper || editorState.isPlaying || props.isDraggingSomething) return;\r\n\r\n    if(!previewFrameTimeout) previewFrameTimeout = self.setTimeout(() => {\r\n      canPreviewFrame = true;\r\n    }, 200);\r\n\r\n    const position = getPositionInCropper(e, props.cropper);\r\n\r\n    setGhostThumbnailPosition(position);\r\n\r\n    if(canPreviewFrame) actions.setVideoTime(position, SetVideoTimeFlags.UpdateVideo | SetVideoTimeFlags.Redraw);\r\n  };\r\n\r\n  const onPointerOut = () => {\r\n    if(canPreviewFrame) actions.setVideoTime(mediaState.currentVideoTime, SetVideoTimeFlags.UpdateVideo | SetVideoTimeFlags.Redraw);\r\n\r\n    setGhostThumbnailPosition();\r\n    canPreviewFrame = false;\r\n    self.clearTimeout(previewFrameTimeout);\r\n    previewFrameTimeout = undefined;\r\n  };\r\n\r\n  const swipeArgs: SwipeDirectiveArgs = {\r\n    globalCursor: () => 'grabbing',\r\n    onStart: (e) => {\r\n      void setIsDragging(true);\r\n      if(!props.cropper) return;\r\n      mediaState.videoThumbnailPosition = getPositionInCropper(e, props.cropper);\r\n    },\r\n    onMove: (_, __, e) => {\r\n      if(!props.cropper) return;\r\n      mediaState.videoThumbnailPosition = getPositionInCropper(e, props.cropper);\r\n    },\r\n    onEnd: () => void setIsDragging(false)\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <ThumbnailMark position={mediaState.videoThumbnailPosition} visible={!props.hidden} withTransition />\r\n      <ThumbnailMark position={ghostThumbnailPosition() || 0} ghost visible={!props.hidden && isGhostThumbnailVisible()} />\r\n\r\n      <div\r\n        class={styles.ThumbnailTrack}\r\n        classList={{\r\n          [styles.disabled]: props.isDraggingSomething\r\n        }}\r\n        use:swipe={swipeArgs}\r\n        onPointerMove={onPointerMove}\r\n        onTouchMove={onPointerMove}\r\n        onPointerOut={onPointerOut}\r\n        onTouchEnd={onPointerOut}\r\n        onClick={onClick}\r\n      />\r\n    </>\r\n  )\r\n};\r\n\r\nconst ThumbnailMark: Component<{\r\n  position: number;\r\n  visible: boolean;\r\n  ghost?: boolean;\r\n  withTransition?: boolean;\r\n}> = (props) => {\r\n  return (\r\n    <svg\r\n      class={styles.ThumbnailMark}\r\n      classList={{\r\n        [styles.ghost]: props.ghost,\r\n        [styles.visible]: props.visible,\r\n        [styles.withTransition]: props.withTransition\r\n      }}\r\n      style={{\r\n        '--position': props.position\r\n      }}\r\n      width=\"20\"\r\n      height=\"25\"\r\n      viewBox=\"0 0 20 25\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <path d=\"M0 10V10.9952C0 14.8798 2.58024 18.2044 5.87746 20.2583C7.46104 21.2448 8.92659 22.4551 9.61717 23.8212C9.70992 24.0047 10.2901 24.0047 10.3828 23.8212C11.0734 22.4551 12.539 21.2448 14.1225 20.2583C17.4198 18.2044 20 14.8798 20 10.9952V10C20 4.47715 15.5228 0 10 0C4.47715 0 0 4.47715 0 10Z\" fill=\"white\"/>\r\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8.45844 4.4165H8.48341H11.5167H11.5417C12.1739 4.4165 12.6838 4.41649 13.0968 4.45023C13.522 4.48497 13.8954 4.55836 14.2409 4.7344C14.7897 5.01403 15.2359 5.46023 15.5155 6.00903C15.6915 6.35454 15.7649 6.72798 15.7997 7.15314C15.8334 7.56605 15.8334 8.07595 15.8334 8.70813V8.73317V11.7665V11.7915C15.8334 12.4237 15.8334 12.9336 15.7997 13.3465C15.7649 13.7717 15.6915 14.1452 15.5155 14.4907C15.2359 15.0395 14.7897 15.4857 14.2409 15.7653C13.8954 15.9413 13.522 16.0147 13.0968 16.0495C12.6839 16.0832 12.174 16.0832 11.5418 16.0832H11.5167H8.48341H8.45843C7.82626 16.0832 7.3163 16.0832 6.90339 16.0495C6.47822 16.0147 6.10478 15.9413 5.75928 15.7653C5.21047 15.4857 4.76427 15.0395 4.48465 14.4907C4.3086 14.1452 4.23521 13.7717 4.20048 13.3465C4.16674 12.9336 4.16674 12.4237 4.16675 11.7915V11.7665V8.73317V8.7082C4.16674 8.07599 4.16674 7.56607 4.20048 7.15314C4.23521 6.72798 4.3086 6.35454 4.48465 6.00903C4.76427 5.46023 5.21047 5.01403 5.75928 4.7344C6.10478 4.55836 6.47822 4.48497 6.90339 4.45023C7.31631 4.41649 7.82624 4.4165 8.45844 4.4165ZM6.99839 5.61303C6.64537 5.64187 6.44255 5.69563 6.28893 5.77391C5.95965 5.94169 5.69193 6.2094 5.52415 6.53869C5.44588 6.69231 5.39211 6.89513 5.36327 7.24814C5.33387 7.60797 5.33341 8.07015 5.33341 8.73317V11.7665C5.33341 12.4295 5.33387 12.8917 5.36327 13.2516C5.36613 13.2866 5.36925 13.3203 5.37261 13.3525L6.26742 11.8925L6.28131 11.8699C6.46683 11.5672 6.62664 11.3064 6.77319 11.11C6.92275 10.9096 7.11058 10.7022 7.37928 10.5859C7.74882 10.4259 8.16801 10.4259 8.53755 10.5859C8.80625 10.7022 8.99406 10.9096 9.14363 11.11C9.26806 11.2767 9.40199 11.4898 9.55313 11.7356L10.3508 10.4342L10.3647 10.4115C10.5502 10.1088 10.7099 9.84804 10.8565 9.65169C11.0061 9.45131 11.1939 9.24382 11.4626 9.12756C11.8322 8.96764 12.2513 8.96764 12.6209 9.12756C12.8896 9.24382 13.0774 9.45131 13.227 9.65169C13.3736 9.84804 13.5333 10.1088 13.7188 10.4115L13.7327 10.4342L14.6667 11.958L14.6667 11.7665V8.73317C14.6667 8.07015 14.6663 7.60797 14.6369 7.24814C14.6081 6.89513 14.5543 6.69231 14.476 6.53869C14.3082 6.2094 14.0405 5.94169 13.7112 5.77391C13.5576 5.69563 13.3548 5.64187 13.0018 5.61303C12.6419 5.58363 12.1798 5.58317 11.5167 5.58317H8.48341C7.82039 5.58317 7.35821 5.58363 6.99839 5.61303ZM10.2374 12.8518L11.5028 14.9165H11.5167C12.1798 14.9165 12.6419 14.916 13.0018 14.8866C13.3548 14.8578 13.5576 14.804 13.7112 14.7258C14.0405 14.558 14.3082 14.2903 14.476 13.961C14.4835 13.9462 14.4908 13.931 14.4979 13.9152L12.738 11.0439C12.5347 10.7121 12.4027 10.4978 12.292 10.3495C12.2036 10.231 12.1614 10.2013 12.1553 10.1973C12.0827 10.1666 12.0008 10.1666 11.9282 10.1973C11.922 10.2013 11.8799 10.231 11.7915 10.3495C11.6808 10.4978 11.5488 10.7121 11.3455 11.0439L10.2374 12.8518ZM10.1344 14.9165L8.6547 12.5022C8.45134 12.1704 8.31936 11.9561 8.20867 11.8079C8.12021 11.6893 8.07814 11.6596 8.07199 11.6556C7.99939 11.6249 7.91744 11.6249 7.84484 11.6556C7.83869 11.6596 7.79662 11.6893 7.70816 11.8079C7.59747 11.9561 7.46548 12.1704 7.26212 12.5022L6.00854 14.5475C6.09569 14.6153 6.1895 14.6751 6.28893 14.7258C6.44255 14.804 6.64537 14.8578 6.99839 14.8866C7.35821 14.916 7.82039 14.9165 8.48341 14.9165H10.1344Z\" fill=\"#212121\"/>\r\n    </svg>\r\n  );\r\n}\r\n\r\nconst TimeStick = (props: {swipe: SwipeDirectiveArgs}) => {\r\n  return (\r\n    <svg class={styles.TimeStick} use:swipe={props.swipe} width=\"6\" height=\"60\" viewBox=\"0 0 6 60\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <path d=\"M4 0.75C4.69036 0.75 5.25 1.30964 5.25 2V3.29297C5.24998 3.812 5.04377 4.30975 4.67676 4.67676C4.40352 4.95 4.25002 5.32061 4.25 5.70703V54.293C4.25002 54.6794 4.40352 55.05 4.67676 55.3232C5.04377 55.6903 5.24998 56.188 5.25 56.707V58C5.25 58.6904 4.69036 59.25 4 59.25H2C1.30964 59.25 0.75 58.6904 0.75 58V56.707C0.75002 56.188 0.956231 55.6903 1.32324 55.3232C1.59648 55.05 1.74998 54.6794 1.75 54.293V5.70703C1.74998 5.32061 1.59648 4.95 1.32324 4.67676C0.956231 4.30975 0.75002 3.812 0.75 3.29297V2C0.75 1.30964 1.30964 0.75 2 0.75H4Z\" fill=\"white\" stroke=\"#212121\" stroke-width=\"0.5\"/>\r\n    </svg>\r\n  )\r\n};\r\n\r\nexport const PausePlay: Component<{\r\n  paused: boolean;\r\n}> = (props) => {\r\n  return (\r\n    <svg\r\n      class={styles.PausePlaySvg}\r\n      classList={{\r\n        [styles.paused]: props.paused\r\n      }}\r\n      width=\"24\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <clipPath id=\"playSymbolClipPath\">\r\n        <path class={styles.PausePlaySvgPlay} d=\"M5 19.9138V4.0862C5 2.83455 6.44254 2.13342 7.42673 2.90672L17.4988 10.8205C18.2632 11.4211 18.2632 12.5789 17.4988 13.1795L7.42673 21.0933C6.44254 21.8666 5 21.1655 5 19.9138Z\" fill=\"black\" /* transform=\"translate(8, 12) scale(1.4) translate(-8, -12)\" */ />\r\n      </clipPath>\r\n\r\n      <g class={styles.PausePlaySvgPause} id=\"pauseSymbol\" clip-path='url(#playSymbolClipPath)'>\r\n        <path class={styles.PausePlaySvgPauseLeft} d=\"M8.5 3H5C4.44772 3 4 3.44772 4 4V20C4 20.5523 4.44772 21 5 21H8.5C9.05228 21 9.5 20.5523 9.5 20V4C9.5 3.44772 9.05228 3 8.5 3Z\" fill=\"white\" />\r\n        <path class={styles.PausePlaySvgPauseRight} d=\"M19 3H15.5C14.9477 3 14.5 3.44772 14.5 4V20C14.5 20.5523 14.9477 21 15.5 21H19C19.5523 21 20 20.5523 20 20V4C20 3.44772 19.5523 3 19 3Z\" fill=\"white\" />\r\n      </g>\r\n    </svg>\r\n  );\r\n};\r\n\r\nfunction getPositionInCropper(e: PointerEvent | MouseEvent | TouchEvent, cropper: HTMLDivElement) {\r\n  const clientX = e instanceof TouchEvent ? e.changedTouches[0].clientX : e.clientX;\r\n\r\n  const bcr = cropper.getBoundingClientRect();\r\n  const x = clientX - bcr.left - HANDLE_WIDTH_PX;\r\n  const pos = x / (bcr.width - 2 * HANDLE_WIDTH_PX);\r\n\r\n  return clamp(pos, 0, 1);\r\n}\r\n\r\nexport default VideoControls;\r\n","import {onCleanup, onMount, Show, JSX} from 'solid-js';\r\nimport {Transition} from 'solid-transition-group';\r\n\r\nimport {useMediaEditorContext} from '../context';\r\n\r\nimport BrushCanvas from './brushCanvas';\r\nimport CropHandles from './cropHandles';\r\nimport ImageCanvas from './imageCanvas';\r\nimport PreviewBrushSize from './previewBrushSize';\r\nimport ResizableLayers from './resizableLayers';\r\nimport RotationWheel from './rotationWheel';\r\nimport useFinalTransform from './useFinalTransform';\r\nimport VideoControls from './videoControls';\r\n\r\n\r\nexport default function MainCanvas() {\r\n  let container: HTMLDivElement;\r\n  const {editorState, mediaType} = useMediaEditorContext();\r\n\r\n  useFinalTransform();\r\n\r\n  onMount(() => {\r\n    const listener = () => {\r\n      const bcr = container.getBoundingClientRect();\r\n      editorState.canvasSize = [bcr.width, bcr.height];\r\n    };\r\n    listener();\r\n    window.addEventListener('resize', listener);\r\n    onCleanup(() => {\r\n      window.removeEventListener('resize', listener);\r\n    });\r\n  });\r\n\r\n  return (\r\n    <div ref={container} class=\"media-editor__main-canvas\">\r\n      <Show when={editorState.canvasSize}>\r\n        <ImageCanvas />\r\n        <Show when={editorState.isReady}>\r\n          <BrushCanvas />\r\n          <ResizableLayers />\r\n          <PreviewBrushSize />\r\n          {/* WTF ref causes infinite loop when passed without callback */}\r\n          <div ref={(el) => void (editorState.resizeHandlesContainer = el)} class=\"media-editor__resize-handles-overlay\" />\r\n          <CropHandles />\r\n          <RotationWheel />\r\n          <Show when={mediaType === 'video' && !!editorState.renderingPayload}>\r\n            <VideoControls />\r\n          </Show>\r\n        </Show>\r\n      </Show>\r\n    </div>\r\n  );\r\n}\r\n","import {snapToViewport} from '../utils';\r\nimport {defaultCodec, highResCodec} from './calcCodecAndBitrate';\r\n\r\nconst SIDE_MAX = 2560;\r\nconst SIDE_MIN = 240;\r\n\r\n\r\ntype Args = {\r\n  videoType: 'video' | 'gif';\r\n  imageWidth: number;\r\n  imageRatio: number;\r\n  cropOffset: { width: number; height: number; };\r\n  newRatio: number;\r\n  scale: number;\r\n  quality?: number;\r\n};\r\n\r\nexport default function getResultSize({imageWidth, cropOffset, imageRatio, newRatio, scale, videoType, quality}: Args) {\r\n  const [w] = snapToViewport(imageRatio, cropOffset.width, cropOffset.height);\r\n  const [cw] = snapToViewport(newRatio, cropOffset.width, cropOffset.height);\r\n\r\n  let scaledWidth = cw / (w * scale) * imageWidth,\r\n    scaledHeight = scaledWidth / newRatio;\r\n\r\n  const willResultInVideo = !!videoType;\r\n\r\n  if(Math.max(scaledWidth, scaledHeight) < SIDE_MIN) {\r\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, SIDE_MIN, SIDE_MIN);\r\n  }\r\n  if(videoType === 'gif' && (scaledWidth > defaultCodec.width || scaledHeight > defaultCodec.height)) {\r\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, defaultCodec.width, defaultCodec.height);\r\n  }\r\n  if(videoType === 'video' && (scaledWidth > highResCodec.width || scaledHeight > highResCodec.height)) {\r\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, highResCodec.width, highResCodec.height);\r\n  }\r\n  if(!willResultInVideo && Math.max(scaledWidth, scaledHeight) > SIDE_MAX) {\r\n    [scaledWidth, scaledHeight] = snapToViewport(newRatio, SIDE_MAX, SIDE_MAX);\r\n  }\r\n\r\n  if(quality) {\r\n    scaledHeight = quality;\r\n    scaledWidth = quality * newRatio;\r\n  }\r\n\r\n  scaledWidth = Math.floor(scaledWidth);\r\n  scaledHeight = Math.floor(scaledHeight);\r\n  scaledWidth = scaledWidth % 2 == 0 ? scaledWidth : scaledWidth - 1;\r\n  scaledHeight = scaledHeight % 2 == 0 ? scaledHeight : scaledHeight - 1;\r\n\r\n  return [scaledWidth, scaledHeight];\r\n}\r\n","import {FinalTransform} from '../canvas/useFinalTransform';\r\nimport {useCropOffset} from '../canvas/useCropOffset';\r\nimport {MediaEditorContextValue} from '../context';\r\nimport {getSnappedViewportsScale} from '../utils';\r\n\r\nexport type GetResultTransformArgs = {\r\n  context: MediaEditorContextValue;\r\n  scaledWidth: number;\r\n  scaledHeight: number;\r\n  imageWidth: number;\r\n  imageHeight: number;\r\n  cropOffset: ReturnType<typeof useCropOffset>;\r\n};\r\n\r\nexport default function getResultTransform({\r\n  context,\r\n  scaledWidth,\r\n  scaledHeight,\r\n  imageWidth,\r\n  imageHeight,\r\n  cropOffset\r\n}: GetResultTransformArgs): FinalTransform {\r\n  const {\r\n    editorState: {canvasSize},\r\n    mediaState: {scale, translation, rotation, flip, currentImageRatio}\r\n  } = context;\r\n\r\n  const initialCanvasWidth = canvasSize[0];\r\n  const initialCanvasHeight = canvasSize[1];\r\n\r\n  const imageRatio = imageWidth / imageHeight;\r\n\r\n  const canvasRatio = initialCanvasWidth / initialCanvasHeight;\r\n  let snappedCanvasWidth = scaledWidth,\r\n    snappedCanvasHeight = scaledHeight;\r\n  if(scaledWidth / canvasRatio < scaledHeight) snappedCanvasWidth = scaledHeight * canvasRatio;\r\n  else snappedCanvasHeight = scaledWidth / canvasRatio;\r\n\r\n  let toCropScale = getSnappedViewportsScale(\r\n    imageRatio,\r\n    cropOffset().width,\r\n    cropOffset().height,\r\n    snappedCanvasWidth,\r\n    snappedCanvasHeight\r\n  );\r\n  const fromCroppedScale =\r\n    1 /\r\n    getSnappedViewportsScale(\r\n      currentImageRatio,\r\n      cropOffset().width,\r\n      cropOffset().height,\r\n      snappedCanvasWidth,\r\n      snappedCanvasHeight\r\n    );\r\n\r\n  toCropScale *= fromCroppedScale;\r\n\r\n  const snappedImageScale = Math.min(snappedCanvasWidth / imageWidth, snappedCanvasHeight / imageHeight);\r\n\r\n  const cropTranslation = translation.map((x) => x * fromCroppedScale - x);\r\n\r\n  return {\r\n    flip: flip,\r\n    rotation: rotation,\r\n    scale: scale * snappedImageScale * toCropScale,\r\n    translation: [cropTranslation[0] + translation[0], cropTranslation[1] + translation[1]]\r\n  };\r\n}\r\n","import {unwrap} from 'solid-js/store';\r\n\r\nimport {FinalTransform} from '../canvas/useFinalTransform';\r\nimport {MediaEditorContextValue} from '../context';\r\nimport {NumberPair} from '../types';\r\n\r\nexport type ScaledLayersAndLines = ReturnType<typeof getScaledLayersAndLines>;\r\n\r\nexport default function getScaledLayersAndLines(\r\n  context: MediaEditorContextValue,\r\n  finalTransform: FinalTransform,\r\n  width: number,\r\n  height: number\r\n) {\r\n  const {mediaState: {resizableLayers, brushDrawnLines}, editorState: {pixelRatio}} = context;\r\n\r\n  function processPoint(point: NumberPair) {\r\n    const r = [Math.sin(-finalTransform.rotation), Math.cos(-finalTransform.rotation)];\r\n    point = [point[0] * r[1] + point[1] * r[0], point[1] * r[1] - point[0] * r[0]];\r\n    point = [\r\n      point[0] * finalTransform.scale + width / 2 + finalTransform.translation[0],\r\n      point[1] * finalTransform.scale + height / 2 + finalTransform.translation[1]\r\n    ];\r\n    return point;\r\n  }\r\n\r\n  const scaledLines = brushDrawnLines.map(({size, points, ...line}) => ({\r\n    ...line,\r\n    size: size * finalTransform.scale,\r\n    points: points.map(processPoint)\r\n  }));\r\n  const scaledLayers = resizableLayers.map((layerStore) => {\r\n    const layer = {...unwrap(layerStore)};\r\n\r\n    layer.position = processPoint(layer.position);\r\n    layer.rotation += finalTransform.rotation;\r\n    layer.scale *= finalTransform.scale;\r\n\r\n    if(layer.textInfo) {\r\n      layer.textInfo = {...layer.textInfo};\r\n      layer.textInfo.size *= layer.scale * pixelRatio;\r\n    }\r\n    return layer;\r\n  });\r\n\r\n  return {scaledLines, scaledLayers};\r\n}\r\n","export const FRAMES_PER_SECOND = 60;\r\nexport const STICKER_SIZE = 200;\r\n","import {MediaEditorContextValue} from '../context';\r\nimport {snapToViewport} from '../utils';\r\nimport {ResizableLayer} from '../types';\r\n\r\nimport {STICKER_SIZE} from './constants';\r\n\r\nexport default function drawStickerLayer(\r\n  context: MediaEditorContextValue,\r\n  ctx: CanvasRenderingContext2D,\r\n  layer: ResizableLayer,\r\n  source: CanvasImageSource,\r\n  ratio: number,\r\n  densityAware = true\r\n) {\r\n  const {editorState: {stickersLayersInfo, pixelRatio}} = context;\r\n\r\n  const {container} = stickersLayersInfo[layer.id];\r\n  const stickerChild = container?.lastElementChild;\r\n  if(!stickerChild) return;\r\n\r\n  const size = STICKER_SIZE * layer.scale * (densityAware ? pixelRatio : 1);\r\n\r\n  ctx.save();\r\n  ctx.translate(layer.position[0], layer.position[1]);\r\n  ctx.rotate(layer.rotation);\r\n\r\n  const [w, h] = snapToViewport(ratio, size, size);\r\n\r\n  ctx.drawImage(source, -size / 2 + (size - w) / 2, -size / 2 + (size - h) / 2, w, h);\r\n\r\n  ctx.restore();\r\n}\r\n","import {MediaEditorContextValue} from '../context';\r\nimport {fontInfoMap, getContrastColor} from '../utils';\r\nimport {ResizableLayer} from '../types';\r\n\r\nexport default function drawTextLayer(\r\n  context: MediaEditorContextValue,\r\n  ctx: CanvasRenderingContext2D,\r\n  layer: ResizableLayer,\r\n  densityAware = true\r\n) {\r\n  if(layer.type !== 'text') return;\r\n\r\n  const {editorState: {pixelRatio}} = context;\r\n\r\n  const renderingInfo = {...layer.textRenderingInfo};\r\n  const scale = layer.scale * (densityAware ? pixelRatio : 1);\r\n  renderingInfo.height *= scale;\r\n  renderingInfo.width *= scale;\r\n  renderingInfo.lines = renderingInfo.lines.map((line) => ({\r\n    ...line,\r\n    height: line.height * scale,\r\n    left: line.left * scale,\r\n    right: line.right * scale\r\n  }));\r\n\r\n  if(renderingInfo.path) {\r\n    const newPath = [...renderingInfo.path];\r\n    function multiply(i: number) {\r\n      newPath[i] = (newPath[i] as number) * scale;\r\n    }\r\n    newPath.forEach((part, i) => {\r\n      if(part === 'M' || part === 'L') {\r\n        multiply(i + 1);\r\n        multiply(i + 2);\r\n      } else if(part === 'A') {\r\n        multiply(i + 1);\r\n        multiply(i + 2);\r\n        multiply(i + 6);\r\n        multiply(i + 7);\r\n      }\r\n    });\r\n    renderingInfo.path = newPath;\r\n  }\r\n\r\n  ctx.save();\r\n  ctx.translate(layer.position[0], layer.position[1]);\r\n  ctx.rotate(layer.rotation);\r\n\r\n  let prevY = -renderingInfo.height / 2;\r\n  const boxLeft = -renderingInfo.width / 2;\r\n  const fontInfo = fontInfoMap[layer.textInfo.font];\r\n\r\n  if(layer.textInfo.style === 'background') {\r\n    ctx.translate(boxLeft, prevY);\r\n\r\n    ctx.fillStyle = layer.textInfo.color;\r\n    const path = new Path2D(renderingInfo.path.join(' '));\r\n\r\n    ctx.fill(path);\r\n    ctx.translate(-boxLeft, -prevY);\r\n  }\r\n\r\n  renderingInfo.lines.forEach((line) => {\r\n    const yOffset = line.height * fontInfo.baseline;\r\n    let xOffset = 0.2 * layer.textInfo.size;\r\n    if(layer.textInfo.style === 'background') xOffset = 0.3 * layer.textInfo.size;\r\n\r\n    ctx.font = `${fontInfo.fontWeight} ${layer.textInfo.size}px ${fontInfo.fontFamily}`;\r\n\r\n    const x = boxLeft + xOffset + line.left,\r\n      y = prevY + yOffset;\r\n\r\n    if(layer.textInfo.style === 'outline') {\r\n      ctx.lineWidth = layer.textInfo.size * 0.15;\r\n      ctx.strokeStyle = layer.textInfo.color;\r\n      ctx.strokeText(line.content, x, y);\r\n      ctx.fillStyle = getContrastColor(layer.textInfo.color);\r\n      ctx.fillText(line.content, x, y);\r\n    } else if(layer.textInfo.style === 'background') {\r\n      ctx.fillStyle = getContrastColor(layer.textInfo.color);\r\n      ctx.fillText(line.content, x, y);\r\n    } else {\r\n      ctx.fillStyle = layer.textInfo.color;\r\n      ctx.fillText(line.content, x, y);\r\n    }\r\n    prevY += line.height;\r\n  });\r\n\r\n  ctx.restore();\r\n}\r\n","import {unwrap} from 'solid-js/store';\r\nimport {useCropOffset} from '../canvas/useCropOffset';\r\nimport useProcessPoint from '../canvas/useProcessPoint';\r\nimport {useMediaEditorContext} from '../context';\r\nimport {snapToViewport} from '../utils';\r\nimport drawStickerLayer from './drawStickerLayer';\r\nimport drawTextLayer from './drawTextLayer';\r\n\r\n\r\ntype Args = {\r\n  scaledWidth: number;\r\n  scaledHeight: number;\r\n};\r\n\r\nexport async function generateVideoPreview({scaledWidth, scaledHeight}: Args) {\r\n  const context = useMediaEditorContext();\r\n\r\n  const {\r\n    editorState: {\r\n      canvasSize: [cw, ch], imageCanvas, brushCanvas, currentTab, stickersLayersInfo, finalTransform: {scale}\r\n    },\r\n    mediaState: {\r\n      resizableLayers, rotation\r\n    }\r\n  } = context;\r\n\r\n  const processPoint = useProcessPoint(false);\r\n  const cropOffset = useCropOffset();\r\n\r\n  const isCropping = currentTab === 'crop';\r\n\r\n  const ratio = scaledWidth / scaledHeight;\r\n\r\n  const [previewWidth, previewHeight] = snapToViewport(ratio, isCropping ? cropOffset().width : cw, isCropping ? cropOffset().height : ch);\r\n\r\n  const mirrorCanvas = document.createElement('canvas');\r\n  [mirrorCanvas.width, mirrorCanvas.height] = [cw, ch];\r\n\r\n  const previewCanvas = document.createElement('canvas');\r\n  [previewCanvas.width, previewCanvas.height] = [previewWidth, previewHeight];\r\n\r\n\r\n  const previewCtx = previewCanvas.getContext('2d');\r\n  const mirrorCtx = mirrorCanvas.getContext('2d');\r\n\r\n  mirrorCtx.drawImage(imageCanvas, 0, 0, cw, ch);\r\n  mirrorCtx.drawImage(brushCanvas, 0, 0, cw, ch);\r\n\r\n  const processedLayers = unwrap(resizableLayers).map(layer => ({\r\n    ...layer,\r\n    position: processPoint(layer.position),\r\n    rotation: layer.rotation + rotation,\r\n    scale: layer.scale * scale,\r\n    textInfo: layer.textInfo ? {\r\n      ...layer.textInfo,\r\n      size: layer.textInfo.size * layer.scale * scale\r\n    } : undefined\r\n  }));\r\n\r\n  processedLayers.forEach((layer) => {\r\n    if(layer.type === 'text') drawTextLayer(context, mirrorCtx, layer, false);\r\n\r\n    if(layer.type === 'sticker') {\r\n      const {container} = stickersLayersInfo[layer.id];\r\n      const stickerChild = container?.lastElementChild;\r\n\r\n      let ratio: number;\r\n\r\n      if(stickerChild instanceof HTMLImageElement)\r\n        ratio = stickerChild.naturalWidth / stickerChild.naturalHeight;\r\n      else if(stickerChild instanceof HTMLCanvasElement)\r\n        ratio = 1;\r\n      else if(stickerChild instanceof HTMLVideoElement)\r\n        ratio = stickerChild.videoWidth / stickerChild.videoHeight;\r\n      else return;\r\n\r\n      drawStickerLayer(context, mirrorCtx, layer, stickerChild, ratio, false);\r\n    }\r\n  });\r\n\r\n  if(isCropping) {\r\n    previewCtx.drawImage(\r\n      mirrorCanvas,\r\n      cropOffset().left + (cropOffset().width - previewWidth) / 2, cropOffset().top + (cropOffset().height - previewHeight) / 2, previewWidth, previewHeight,\r\n      0, 0, previewWidth, previewHeight\r\n    );\r\n  } else {\r\n    previewCtx.drawImage(\r\n      mirrorCanvas,\r\n      (cw - previewWidth) / 2, (ch - previewHeight) / 2, previewWidth, previewHeight,\r\n      0, 0, previewWidth, previewHeight\r\n    );\r\n  }\r\n\r\n  const previewBlob = await new Promise<Blob>((resolve) => previewCanvas.toBlob(resolve));\r\n\r\n  return previewBlob;\r\n}\r\n","import deferredPromise, {CancellablePromise} from '../../../helpers/cancellablePromise';\r\nimport appDownloadManager from '../../../lib/appManagers/appDownloadManager';\r\nimport {Document} from '../../../layer';\r\n\r\nimport {StickerFrameByFrameRenderer} from './types';\r\n\r\nexport default class ImageStickerFrameByFrameRenderer implements StickerFrameByFrameRenderer {\r\n  private image: HTMLImageElement;\r\n\r\n  async init(doc: Document.document) {\r\n    const blob = await appDownloadManager.downloadMedia({\r\n      media: doc\r\n    });\r\n\r\n    const image = (this.image = new Image());\r\n    image.src = URL.createObjectURL(blob);\r\n\r\n    const deferred = deferredPromise<void>();\r\n\r\n    image.addEventListener('load', () => {\r\n      deferred.resolve();\r\n    });\r\n\r\n    await deferred;\r\n  }\r\n\r\n  getTotalFrames() {\r\n    return 1;\r\n  }\r\n\r\n  getRatio() {\r\n    return this.image.naturalWidth / this.image.naturalHeight;\r\n  }\r\n\r\n  async renderFrame() {}\r\n\r\n  getRenderedFrame() {\r\n    return this.image;\r\n  }\r\n\r\n  destroy() {\r\n    this.image = null;\r\n  }\r\n}\r\n","import deferredPromise, {CancellablePromise} from '../../../helpers/cancellablePromise';\r\nimport RLottiePlayer from '../../../lib/rlottie/rlottiePlayer';\r\nimport appDownloadManager from '../../../lib/appManagers/appDownloadManager';\r\nimport lottieLoader from '../../../lib/rlottie/lottieLoader';\r\nimport {Document} from '../../../layer';\r\n\r\nimport {StickerFrameByFrameRenderer} from './types';\r\n\r\nexport default class LottieStickerFrameByFrameRenderer implements StickerFrameByFrameRenderer {\r\n  private frameCount: number = 0;\r\n  private currentDeferredFrame: CancellablePromise<void>;\r\n  private container: HTMLDivElement;\r\n  private animation: RLottiePlayer;\r\n\r\n  async init(doc: Document.document, size: number) {\r\n    const blob = await appDownloadManager.downloadMedia({\r\n      media: doc\r\n    });\r\n    const container = (this.container = document.createElement('div'));\r\n    container.style.width = size + 'px';\r\n    container.style.height = size + 'px';\r\n    container.style.position = 'absolute';\r\n    container.style.opacity = '0';\r\n    container.style.pointerEvents = 'none';\r\n\r\n    document.body.append(container);\r\n    const animation = (this.animation = await lottieLoader.loadAnimationWorker({\r\n      container: container,\r\n      autoplay: false,\r\n      animationData: blob,\r\n      width: size,\r\n      height: size,\r\n      name: 'doc' + doc.id\r\n    }));\r\n\r\n    const deferred = deferredPromise<void>();\r\n\r\n    animation.addEventListener('ready', () => {\r\n      this.frameCount = animation.maxFrame + 1;\r\n      deferred.resolve();\r\n    });\r\n\r\n    animation.addEventListener('enterFrame', () => {\r\n      this.currentDeferredFrame?.resolve();\r\n    });\r\n\r\n    await deferred;\r\n  }\r\n\r\n  getTotalFrames() {\r\n    return this.frameCount;\r\n  }\r\n\r\n  getRatio() {\r\n    return 1 / 1;\r\n  }\r\n\r\n  async renderFrame(frame: number) {\r\n    this.currentDeferredFrame = deferredPromise<void>();\r\n    this.animation.requestFrame(frame);\r\n    await this.currentDeferredFrame;\r\n  }\r\n\r\n  getRenderedFrame() {\r\n    return this.animation.canvas[0];\r\n  }\r\n\r\n  destroy() {\r\n    this.container.remove();\r\n    this.animation.remove();\r\n  }\r\n}\r\n","import deferredPromise, {CancellablePromise} from '../../../helpers/cancellablePromise';\r\nimport appDownloadManager from '../../../lib/appManagers/appDownloadManager';\r\nimport {getMiddleware} from '../../../helpers/middleware';\r\nimport {Document} from '../../../layer';\r\nimport createVideo from '../../../helpers/dom/createVideo';\r\nimport onMediaLoad from '../../../helpers/onMediaLoad';\r\nimport apiManagerProxy from '../../../lib/mtproto/mtprotoworker';\r\nimport handleVideoLeak from '../../../helpers/dom/handleVideoLeak';\r\nimport {IS_FIREFOX} from '../../../environment/userAgent';\r\n\r\nimport {delay} from '../utils';\r\n\r\nimport {StickerFrameByFrameRenderer} from './types';\r\nimport {FRAMES_PER_SECOND} from './constants';\r\n\r\nexport default class VideoStickerFrameByFrameRenderer implements StickerFrameByFrameRenderer {\r\n  private duration: number = 0;\r\n  private currentDeferredFrame: CancellablePromise<void>;\r\n  private video: HTMLVideoElement;\r\n\r\n  private middleware = getMiddleware();\r\n\r\n  async init(doc: Document.document) {\r\n    const blob = await appDownloadManager.downloadMedia({\r\n      media: doc\r\n    });\r\n\r\n    const video = (this.video = createVideo({middleware: this.middleware.get()}));\r\n    video.src = await apiManagerProxy.invoke('createObjectURL', blob);\r\n    // video.autoplay = true;\r\n    video.controls = false;\r\n    video.muted = true;\r\n    // video.loop = true;\r\n    video.preload = 'auto';\r\n\r\n    const promise = onMediaLoad(video as HTMLMediaElement);\r\n    await handleVideoLeak(video, promise);\r\n    await delay(100); // Necessary\r\n    this.duration = video.duration;\r\n\r\n    video.addEventListener('seeked', () => {\r\n      this.currentDeferredFrame?.resolve();\r\n    });\r\n  }\r\n\r\n  getTotalFrames() {\r\n    return IS_FIREFOX ? 1 : Math.floor(this.duration * FRAMES_PER_SECOND);\r\n  }\r\n\r\n  async renderFrame(frame: number) {\r\n    if(IS_FIREFOX) return;\r\n    this.currentDeferredFrame = deferredPromise<void>();\r\n    this.video.currentTime = (1 / FRAMES_PER_SECOND) * frame;\r\n    await this.currentDeferredFrame;\r\n  }\r\n\r\n  getRatio() {\r\n    return this.video.videoWidth / this.video.videoHeight;\r\n  }\r\n\r\n  getRenderedFrame() {\r\n    return this.video;\r\n  }\r\n\r\n  destroy() {\r\n    this.middleware.destroy();\r\n    this.video = null;\r\n  }\r\n}\r\n","import {createRoot, createSignal, getOwner, runWithOwner} from 'solid-js';\r\nimport {animate} from '../../../helpers/animation';\r\nimport deferredPromise, {CancellablePromise} from '../../../helpers/cancellablePromise';\r\nimport ListenerSetter from '../../../helpers/listenerSetter';\r\nimport {MediaSize} from '../../../helpers/mediaSize';\r\nimport noop from '../../../helpers/noop';\r\nimport clamp from '../../../helpers/number/clamp';\r\nimport {logger} from '../../../lib/logger';\r\nimport {useMediaEditorContext} from '../context';\r\nimport {supportsAudioEncoding} from '../support';\r\nimport {delay, snapToViewport} from '../utils';\r\nimport {RenderingPayload} from '../webgl/initWebGL';\r\nimport calcCodecAndBitrate, {BITRATE_TARGET_FPS} from './calcCodecAndBitrate';\r\nimport {FRAMES_PER_SECOND, STICKER_SIZE} from './constants';\r\nimport {MediaEditorFinalResultPayload} from './createFinalResult';\r\nimport drawStickerLayer from './drawStickerLayer';\r\nimport drawTextLayer from './drawTextLayer';\r\nimport {generateVideoPreview} from './generateVideoPreview';\r\nimport {ScaledLayersAndLines} from './getScaledLayersAndLines';\r\nimport ImageStickerFrameByFrameRenderer from './imageStickerFrameByFrameRenderer';\r\nimport LottieStickerFrameByFrameRenderer from './lottieStickerFrameByFrameRenderer';\r\nimport {StickerFrameByFrameRenderer} from './types';\r\nimport VideoStickerFrameByFrameRenderer from './videoStickerFrameByFrameRenderer';\r\nimport StickerType from '../../../config/stickerType';\r\n\r\n\r\ntype Args = {\r\n  renderingPayload: RenderingPayload;\r\n  hasAnimatedStickers: boolean;\r\n  scaledLayers: ScaledLayersAndLines['scaledLayers'];\r\n  scaledWidth: number;\r\n  scaledHeight: number;\r\n  ctx: CanvasRenderingContext2D;\r\n  imageCanvasGL: WebGLRenderingContext;\r\n  imageCanvas: HTMLCanvasElement;\r\n  drawToImageCanvas: () => void;\r\n  brushCanvas: HTMLCanvasElement;\r\n  resultCanvas: HTMLCanvasElement;\r\n};\r\n\r\nconst EXPECTED_FPS = 30;\r\nconst VIDEO_COMPARISON_ERROR = 0.0001;\r\n\r\nconst THUMBNAIL_MAX_SIZE = 720;\r\n\r\nconst log = logger('MediaEditor.createFinalResult.renderToActualVideo');\r\n\r\nexport default async function renderToActualVideo({\r\n  renderingPayload,\r\n  hasAnimatedStickers,\r\n  scaledWidth,\r\n  scaledHeight,\r\n  scaledLayers,\r\n  ctx,\r\n  imageCanvasGL: gl,\r\n  imageCanvas,\r\n  drawToImageCanvas,\r\n  brushCanvas,\r\n  resultCanvas\r\n}: Args) {\r\n  const context = useMediaEditorContext();\r\n\r\n  const {\r\n    editorState: {pixelRatio},\r\n    mediaState: {videoCropStart, videoCropLength, videoMuted, videoThumbnailPosition},\r\n    mediaBlob\r\n  } = context;\r\n\r\n  const {media: {video}} = renderingPayload;\r\n\r\n  const owner = getOwner();\r\n\r\n  video.muted = true;\r\n  const startTime = video.duration * videoCropStart;\r\n  const endTime = video.duration * (videoCropStart + videoCropLength);\r\n\r\n  const creationProgress = createRoot(dispose => {\r\n    const signal = createSignal(0);\r\n    return {signal, dispose};\r\n  });\r\n\r\n  const [progress, setProgress] = creationProgress.signal;\r\n\r\n  const renderers = new Map<number, StickerFrameByFrameRenderer>();\r\n\r\n  const thumbnailCanvas = document.createElement('canvas');\r\n  [thumbnailCanvas.width, thumbnailCanvas.height] = snapToViewport(scaledWidth / scaledHeight, Math.min(scaledWidth, THUMBNAIL_MAX_SIZE), Math.min(scaledHeight, THUMBNAIL_MAX_SIZE));\r\n  const thumbnailCtx = thumbnailCanvas.getContext('2d');\r\n\r\n  const thumbnailTime = videoThumbnailPosition * video.duration;\r\n\r\n  let\r\n    currentVideoFrameDeferred: CancellablePromise<number>,\r\n    encodingPausedDeferred: CancellablePromise<void>,\r\n    lastTime = 0,\r\n    frameCallbackId: number,\r\n    drewThumbnail = false,\r\n    canceled = false,\r\n    progressRAF = 0\r\n  ;\r\n\r\n  const listenerSetter = new ListenerSetter;\r\n\r\n  listenerSetter.add(window)('focus', () => {\r\n    log('window focus changed', 'focused');\r\n    encodingPausedDeferred?.resolve?.();\r\n    encodingPausedDeferred = undefined;\r\n  });\r\n\r\n  listenerSetter.add(window)('blur', () => {\r\n    log('window focus changed', 'blurred');\r\n    encodingPausedDeferred = deferredPromise();\r\n    currentVideoFrameDeferred?.reject(ThrowReason.EncodingPaused);\r\n  });\r\n\r\n  async function initMuxerAndEncoder() {\r\n    const {Muxer, ArrayBufferTarget} = await import('mp4-muxer');\r\n\r\n    let audioBuffer: AudioBuffer;\r\n\r\n    if(!videoMuted && await supportsAudioEncoding()) try {\r\n      audioBuffer = await extractAudioFragment(mediaBlob, startTime, endTime);\r\n    } catch{}\r\n\r\n    const muxer = new Muxer({\r\n      target: new ArrayBufferTarget(),\r\n      video: {\r\n        codec: 'avc',\r\n        width: scaledWidth,\r\n        height: scaledHeight\r\n      },\r\n      audio: audioBuffer ? {\r\n        codec: 'opus',\r\n        sampleRate: audioBuffer.sampleRate,\r\n        numberOfChannels: audioBuffer.numberOfChannels\r\n      } : undefined,\r\n      fastStart: 'in-memory'\r\n    });\r\n\r\n    const encoder = new VideoEncoder({\r\n      output: (chunk, meta) => muxer.addVideoChunk(chunk, meta),\r\n      error: (e) => console.error(e)\r\n    });\r\n\r\n    encoder.configure({\r\n      width: scaledWidth,\r\n      height: scaledHeight,\r\n      ...calcCodecAndBitrate(scaledWidth, scaledHeight, BITRATE_TARGET_FPS)\r\n    });\r\n\r\n    return {muxer, encoder, audioBuffer};\r\n  }\r\n\r\n  function drawToTexture() {\r\n    gl.bindTexture(gl.TEXTURE_2D, renderingPayload.texture);\r\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, video);\r\n  }\r\n\r\n  async function initStickerRenderers() {\r\n    await Promise.all(\r\n      scaledLayers.map(async(layer) => {\r\n        if(!layer.sticker) return;\r\n\r\n        const stickerType = layer.sticker?.sticker;\r\n        let renderer: StickerFrameByFrameRenderer;\r\n\r\n        if(stickerType === StickerType.Static) renderer = new ImageStickerFrameByFrameRenderer();\r\n        if(stickerType === StickerType.Lottie) renderer = new LottieStickerFrameByFrameRenderer();\r\n        if(stickerType === StickerType.WebM) renderer = new VideoStickerFrameByFrameRenderer();\r\n        if(!renderer) return;\r\n\r\n        renderers.set(layer.id, renderer);\r\n        await renderer.init(layer.sticker!, STICKER_SIZE * layer.scale * pixelRatio);\r\n      })\r\n    );\r\n  }\r\n\r\n  enum ThrowReason {\r\n    EncodingPaused,\r\n    TimeLoopback\r\n  };\r\n\r\n  async function prepareAndRenderFrame(encoder: VideoEncoder, frameNo: number) {\r\n    currentVideoFrameDeferred = deferredPromise();\r\n\r\n    const callback = (mediaTime: number) => {\r\n      drawToTexture();\r\n      video.pause();\r\n\r\n      currentVideoFrameDeferred.resolve(mediaTime);\r\n    };\r\n\r\n    if(frameNo === 0) callback(0);\r\n    else {\r\n      frameCallbackId = video.requestVideoFrameCallback((_, {mediaTime}) => void callback(mediaTime));\r\n      if(video.paused) await video.play();\r\n    }\r\n\r\n    let mediaTime: number;\r\n    try {\r\n      mediaTime = await currentVideoFrameDeferred;\r\n    } catch(e: unknown) {\r\n      video.pause();\r\n      if(e === ThrowReason.EncodingPaused && encodingPausedDeferred) {\r\n        await encodingPausedDeferred;\r\n        log('paused case was playing', lastTime + startTime);\r\n        const deferred = deferredPromise<void>();\r\n\r\n        listenerSetter.add(video)('seeked', () => {\r\n          deferred.resolve();\r\n        }, {once: true});\r\n\r\n        video.currentTime = lastTime + startTime;\r\n\r\n        await deferred;\r\n      }\r\n      throw e;\r\n    }\r\n\r\n    const currentTime = frameNo === 0 ? 0 : mediaTime - startTime;\r\n    if(currentTime < lastTime) throw ThrowReason.TimeLoopback;\r\n\r\n    // Fill static frame with stickers frames\r\n    if(hasAnimatedStickers) {\r\n      const untilFrame = Math.round(currentTime * EXPECTED_FPS);\r\n      for(let frame = Math.round(lastTime * EXPECTED_FPS) + 1; frame < untilFrame; frame++) {\r\n        await renderFrame({\r\n          frameNo: frame / EXPECTED_FPS * FRAMES_PER_SECOND | 0,\r\n          timestamp: frame / EXPECTED_FPS * 1e6 | 0,\r\n          appendToMuxer: true,\r\n          encoder\r\n        });\r\n      }\r\n    }\r\n\r\n    lastTime = currentTime;\r\n\r\n    await renderFrame({\r\n      frameNo: currentTime * FRAMES_PER_SECOND | 0,\r\n      timestamp: currentTime * 1e6 | 0,\r\n      appendToMuxer: true,\r\n      encoder\r\n    });\r\n\r\n    // Save the thumbnail if it's more or less in the same frame as the current time\r\n    if(!drewThumbnail && thumbnailTime - 0.5 / EXPECTED_FPS <= currentTime && currentTime <= thumbnailTime + 0.5 / EXPECTED_FPS) {\r\n      drewThumbnail = true;\r\n      thumbnailCtx.drawImage(resultCanvas, 0, 0, thumbnailCanvas.width, thumbnailCanvas.height);\r\n    }\r\n  }\r\n\r\n  type RenderFrameArgs = {\r\n    frameNo: number;\r\n    timestamp: number;\r\n    appendToMuxer: boolean;\r\n    encoder: VideoEncoder;\r\n  };\r\n\r\n  async function renderFrame({frameNo, timestamp, appendToMuxer, encoder}: RenderFrameArgs) {\r\n    const promises = Array.from(renderers.values()).map((renderer) =>\r\n      renderer.renderFrame(frameNo % (renderer.getTotalFrames()))\r\n    );\r\n\r\n    await Promise.all(promises);\r\n\r\n    drawToImageCanvas();\r\n\r\n    ctx.clearRect(0, 0, scaledWidth, scaledHeight);\r\n    ctx.drawImage(imageCanvas, 0, 0);\r\n    ctx.drawImage(brushCanvas, 0, 0);\r\n\r\n    scaledLayers.forEach((layer) => {\r\n      if(layer.type === 'text') drawTextLayer(context, ctx, layer);\r\n      if(layer.type === 'sticker' && renderers.has(layer.id)) {\r\n        const renderer = renderers.get(layer.id);\r\n        drawStickerLayer(context, ctx, layer, renderer.getRenderedFrame(), renderer.getRatio());\r\n      }\r\n    });\r\n\r\n    if(!appendToMuxer) return;\r\n\r\n    const videoFrame = new VideoFrame(resultCanvas, {timestamp});\r\n\r\n    encoder.encode(videoFrame);\r\n    videoFrame.close();\r\n  }\r\n\r\n  function updateProgress(targetProgress: number) {\r\n    const speed = 0.05;\r\n    const currentProgress = progress();\r\n\r\n    const delta = targetProgress - currentProgress;\r\n\r\n    if(delta < 0.0025) { // fourth of a percent\r\n      setProgress(targetProgress);\r\n      return;\r\n    }\r\n\r\n    setProgress(currentProgress + delta * speed);\r\n\r\n    progressRAF = requestAnimationFrame(() => updateProgress(targetProgress));\r\n  }\r\n\r\n  function cleanup(encoder: VideoEncoder) {\r\n    encoder.close();\r\n    Array.from(renderers.values()).forEach((renderer) => renderer.destroy());\r\n    listenerSetter.removeAll();\r\n    cancelAnimationFrame(progressRAF);\r\n    video.src = '';\r\n    video.load();\r\n  }\r\n\r\n  setProgress(0);\r\n\r\n  const preview = await runWithOwner(owner, () => generateVideoPreview({scaledWidth, scaledHeight}));\r\n\r\n  const resultPromise = new Promise<MediaEditorFinalResultPayload>(async(resolve, reject) => {\r\n    const firstFrameSeekDeferred = deferredPromise<void>();\r\n    video.currentTime = video.duration * videoCropStart;\r\n    video.addEventListener('seeked', () => void firstFrameSeekDeferred.resolve(), {once: true});\r\n\r\n    const [{muxer, encoder, audioBuffer}] = await Promise.all([\r\n      initMuxerAndEncoder(),\r\n      delay(200),\r\n      firstFrameSeekDeferred,\r\n      initStickerRenderers()\r\n    ]);\r\n\r\n    let frameNo = 0;\r\n\r\n    let done = false;\r\n\r\n    animate(() => {\r\n      if(encodingPausedDeferred) return true;\r\n\r\n      if(video.currentTime >= endTime - VIDEO_COMPARISON_ERROR) {\r\n        done = true;\r\n        currentVideoFrameDeferred.resolve(endTime);\r\n      }\r\n      return !done;\r\n    });\r\n\r\n    // let avg = 0, cnt = 0;\r\n\r\n    // const startrendering = performance.now();\r\n\r\n    while(video.currentTime < endTime - VIDEO_COMPARISON_ERROR) {\r\n      if(canceled) {\r\n        reject();\r\n\r\n        done = true;\r\n        video.pause();\r\n\r\n        cleanup(encoder);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        // const start = performance.now();\r\n        log('prepareAndRenderFrame', frameNo);\r\n        if(encodingPausedDeferred) {\r\n          log('paused case was paused', lastTime + startTime);\r\n          await encodingPausedDeferred;\r\n        }\r\n        await prepareAndRenderFrame(encoder, frameNo);\r\n        // const end = performance.now();\r\n        // const time = end - start;\r\n        // cnt++;\r\n        // avg += (time - avg) / cnt;\r\n      } catch(e: unknown) {\r\n        if(typeof e !== 'number') break;\r\n\r\n        if(e === ThrowReason.EncodingPaused) await encodingPausedDeferred;\r\n        else if(e === ThrowReason.TimeLoopback) break;\r\n      }\r\n\r\n      updateProgress(clamp((video.currentTime - startTime) / (endTime - startTime), 0, 1));\r\n      frameNo++;\r\n    }\r\n\r\n    done = true;\r\n    video.cancelVideoFrameCallback(frameCallbackId);\r\n    video.pause();\r\n\r\n    // const endrendering = performance.now();\r\n\r\n    if(!drewThumbnail) {\r\n      const deferred = deferredPromise<void>();\r\n\r\n      video.addEventListener('seeked', () => {\r\n        deferred.resolve();\r\n      }, {once: true});\r\n      video.currentTime = thumbnailTime;\r\n\r\n      await Promise.race([deferred, delay(2_000)]); // just in case you know\r\n\r\n      drawToTexture();\r\n      await renderFrame({frameNo: 0, timestamp: 0, appendToMuxer: false, encoder});\r\n\r\n      thumbnailCtx.drawImage(resultCanvas, 0, 0, thumbnailCanvas.width, thumbnailCanvas.height);\r\n    }\r\n\r\n    if(audioBuffer) await encodeAndMuxAudio(audioBuffer, (chunk) => muxer.addAudioChunk(chunk));\r\n\r\n    await encoder.flush();\r\n\r\n    muxer.finalize();\r\n\r\n    cleanup(encoder);\r\n\r\n    const {buffer} = muxer.target;\r\n\r\n    setProgress(1);\r\n\r\n    const thumbBlob = await new Promise<Blob>(resolve => thumbnailCanvas.toBlob(resolve));\r\n\r\n    resolve({\r\n      blob: new Blob([buffer], {type: 'video/mp4'}),\r\n      hasSound: !!audioBuffer,\r\n      thumb: {\r\n        blob: thumbBlob,\r\n        size: new MediaSize(thumbnailCanvas.width, thumbnailCanvas.height)\r\n      }\r\n    });\r\n\r\n    // alert(JSON.stringify({\r\n    //   avg,\r\n    //   total: endrendering - startrendering,\r\n    //   frameNo,\r\n    //   duration: video.duration\r\n    // }, null, 2));\r\n  });\r\n\r\n  let result: MediaEditorFinalResultPayload;\r\n\r\n  resultPromise.then((value) => (result = value)).catch(noop);\r\n\r\n  return {\r\n    preview,\r\n    isVideo: true,\r\n    getResult: () => {\r\n      return result ?? resultPromise;\r\n    },\r\n    cancel: () => {\r\n      canceled = true;\r\n    },\r\n    creationProgress\r\n  };\r\n\r\n  // const div = document.createElement('div')\r\n  // div.style.position = 'fixed';\r\n  // div.style.zIndex = '1000';\r\n  // div.style.top = '50%';\r\n  // div.style.left = '50%';\r\n  // div.style.transform = 'translate(-50%, -50%)';\r\n  // const img = document.createElement('video')\r\n  // img.src = URL.createObjectURL(blob)\r\n  // img.controls = true\r\n  // img.autoplay = true\r\n  // img.loop = true\r\n  // img.style.maxWidth = '450px'\r\n  // div.append(img)\r\n  // document.body.append(div)\r\n}\r\n\r\nasync function extractAudioFragment(blob: Blob, startTime: number, endTime: number) {\r\n  const audioContext: AudioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n  const arrayBuffer = await blob.arrayBuffer();\r\n  const fullAudioBuffer = await audioContext.decodeAudioData(arrayBuffer);\r\n\r\n  const sampleRate = fullAudioBuffer.sampleRate;\r\n  const startSample = Math.floor(startTime * sampleRate);\r\n  const endSample = Math.floor(endTime * sampleRate);\r\n  const frameCount = endSample - startSample;\r\n\r\n  const numChannels = fullAudioBuffer.numberOfChannels;\r\n\r\n  const fragmentBuffer = audioContext.createBuffer(numChannels, frameCount, sampleRate);\r\n\r\n  for(let ch = 0; ch < numChannels; ch++) {\r\n    const fullData = fullAudioBuffer.getChannelData(ch);\r\n    fragmentBuffer.copyToChannel(fullData.subarray(startSample, endSample), ch);\r\n  }\r\n\r\n  return fragmentBuffer;\r\n}\r\n\r\nasync function encodeAndMuxAudio(audioBuffer: AudioBuffer, onChunk: (ch: EncodedAudioChunk) => void) {\r\n  const sampleRate = audioBuffer.sampleRate;\r\n  const numChannels = audioBuffer.numberOfChannels;\r\n  const totalFrames = audioBuffer.length;\r\n\r\n\r\n  // Interleave audio for WebCodecs\r\n  const interleaved = new Float32Array(totalFrames * numChannels);\r\n  for(let ch = 0; ch < numChannels; ch++) {\r\n    const channelData = audioBuffer.getChannelData(ch);\r\n    for(let i = 0; i < totalFrames; i++) {\r\n      interleaved[i * numChannels + ch] = channelData[i];\r\n    }\r\n  }\r\n\r\n  const encoder = new AudioEncoder({\r\n    output: onChunk,\r\n    error: (e) => console.error('AudioEncoder error:', e)\r\n  });\r\n\r\n  encoder.configure({\r\n    codec: 'opus',\r\n    sampleRate,\r\n    numberOfChannels: audioBuffer.numberOfChannels,\r\n    bitrate: 128000\r\n  });\r\n\r\n  const audioData = new AudioData({\r\n    format: 'f32',\r\n    sampleRate,\r\n    numberOfFrames: audioBuffer.duration * audioBuffer.sampleRate,\r\n    numberOfChannels: audioBuffer.numberOfChannels,\r\n    timestamp: 0,\r\n    data: interleaved\r\n  });\r\n\r\n  encoder.encode(audioData);\r\n  audioData.close();\r\n\r\n  await encoder.flush();\r\n  encoder.close();\r\n}\r\n","import StickerType from '../../../config/stickerType';\r\nimport {MediaEditorContextValue} from '../context';\r\nimport {MediaEditorFinalResultPayload} from './createFinalResult';\r\n\r\nimport drawStickerLayer from './drawStickerLayer';\r\nimport drawTextLayer from './drawTextLayer';\r\nimport {ScaledLayersAndLines} from './getScaledLayersAndLines';\r\n\r\nexport type RenderToImageArgs = {\r\n  context: MediaEditorContextValue;\r\n  scaledLayers: ScaledLayersAndLines['scaledLayers'];\r\n  ctx: CanvasRenderingContext2D;\r\n  imageCanvas: HTMLCanvasElement;\r\n  brushCanvas: HTMLCanvasElement;\r\n  resultCanvas: HTMLCanvasElement;\r\n};\r\n\r\nexport default async function renderToImage({\r\n  context,\r\n  scaledLayers,\r\n  ctx,\r\n  imageCanvas,\r\n  brushCanvas,\r\n  resultCanvas\r\n}: RenderToImageArgs) {\r\n  const {editorState: {stickersLayersInfo}} = context;\r\n\r\n  ctx.drawImage(imageCanvas, 0, 0);\r\n  ctx.drawImage(brushCanvas, 0, 0);\r\n\r\n  scaledLayers.forEach((layer) => {\r\n    if(layer.type === 'text') drawTextLayer(context, ctx, layer);\r\n    if(layer.type === 'sticker' && layer.sticker?.sticker === StickerType.Static) {\r\n      const {container} = stickersLayersInfo[layer.id];\r\n      const stickerChild = container?.lastElementChild;\r\n      if(!(stickerChild instanceof HTMLImageElement)) return;\r\n      const ratio = stickerChild.naturalWidth / stickerChild.naturalHeight;\r\n      drawStickerLayer(context, ctx, layer, stickerChild, ratio);\r\n    }\r\n  });\r\n\r\n  const result = await new Promise<MediaEditorFinalResultPayload>((resolve) =>\r\n    resultCanvas.toBlob(blob => resolve({\r\n      blob,\r\n      hasSound: false\r\n    }))\r\n  );\r\n\r\n  return {\r\n    preview: result.blob,\r\n    isVideo: false,\r\n    getResult: () => result\r\n  };\r\n}\r\n","import {createRoot, createSignal, getOwner, runWithOwner} from 'solid-js';\r\n\r\nimport noop from '../../../helpers/noop';\r\n\r\nimport {useMediaEditorContext} from '../context';\r\nimport {delay} from '../utils';\r\n\r\nimport {FRAMES_PER_SECOND, STICKER_SIZE} from './constants';\r\nimport {MediaEditorFinalResultPayload} from './createFinalResult';\r\nimport drawStickerLayer from './drawStickerLayer';\r\nimport drawTextLayer from './drawTextLayer';\r\nimport {generateVideoPreview} from './generateVideoPreview';\r\nimport {ScaledLayersAndLines} from './getScaledLayersAndLines';\r\nimport ImageStickerFrameByFrameRenderer from './imageStickerFrameByFrameRenderer';\r\nimport LottieStickerFrameByFrameRenderer from './lottieStickerFrameByFrameRenderer';\r\nimport {StickerFrameByFrameRenderer} from './types';\r\nimport VideoStickerFrameByFrameRenderer from './videoStickerFrameByFrameRenderer';\r\nimport calcCodecAndBitrate, {BITRATE_TARGET_FPS} from './calcCodecAndBitrate';\r\nimport StickerType from '../../../config/stickerType';\r\n\r\ntype Args = {\r\n  scaledLayers: ScaledLayersAndLines['scaledLayers'];\r\n  scaledWidth: number;\r\n  scaledHeight: number;\r\n  ctx: CanvasRenderingContext2D;\r\n  imageCanvas: HTMLCanvasElement;\r\n  brushCanvas: HTMLCanvasElement;\r\n  resultCanvas: HTMLCanvasElement;\r\n};\r\n\r\nexport default async function renderToVideoGIF({\r\n  scaledWidth,\r\n  scaledHeight,\r\n  scaledLayers,\r\n  ctx,\r\n  imageCanvas,\r\n  brushCanvas,\r\n  resultCanvas\r\n}: Args) {\r\n  const owner = getOwner();\r\n  const context = useMediaEditorContext();\r\n\r\n  const {editorState: {pixelRatio}} = context;\r\n\r\n  const creationProgress = createRoot(dispose => {\r\n    const signal = createSignal(0);\r\n    return {signal, dispose};\r\n  });\r\n\r\n  const [, setProgress] = creationProgress.signal;\r\n\r\n  const renderers = new Map<number, StickerFrameByFrameRenderer>();\r\n\r\n  let canceled = false;\r\n\r\n  async function renderFrame(encoder: VideoEncoder, frameNo: number) {\r\n    const promises = Array.from(renderers.values()).map((renderer) =>\r\n      renderer.renderFrame(frameNo % (renderer.getTotalFrames() + 1))\r\n    );\r\n    await Promise.all(promises);\r\n\r\n    ctx.clearRect(0, 0, scaledWidth, scaledHeight);\r\n    ctx.drawImage(imageCanvas, 0, 0);\r\n    ctx.drawImage(brushCanvas, 0, 0);\r\n\r\n    scaledLayers.forEach((layer) => {\r\n      if(layer.type === 'text') drawTextLayer(context, ctx, layer);\r\n      if(layer.type === 'sticker' && renderers.has(layer.id)) {\r\n        const renderer = renderers.get(layer.id);\r\n        drawStickerLayer(context, ctx, layer, renderer.getRenderedFrame(), renderer.getRatio());\r\n      }\r\n    });\r\n\r\n    const videoFrame = new VideoFrame(resultCanvas, {\r\n      timestamp: (frameNo * 1e6) / FRAMES_PER_SECOND,\r\n      duration: 1e6 / FRAMES_PER_SECOND\r\n    });\r\n    encoder.encode(videoFrame);\r\n    videoFrame.close();\r\n  }\r\n\r\n  function cleanup(encoder: VideoEncoder) {\r\n    encoder.close();\r\n    Array.from(renderers.values()).forEach((renderer) => renderer.destroy());\r\n  }\r\n\r\n  const resultPromise = new Promise<MediaEditorFinalResultPayload>(async(resolve, reject) => {\r\n    let maxFrames = 0;\r\n\r\n    const [{ArrayBufferTarget, Muxer}] = await Promise.all([\r\n      import('mp4-muxer'),\r\n      ...scaledLayers.map(async(layer) => {\r\n        if(!layer.sticker) return;\r\n\r\n        const stickerType = layer.sticker?.sticker;\r\n        let renderer: StickerFrameByFrameRenderer;\r\n\r\n        if(stickerType === StickerType.Static) renderer = new ImageStickerFrameByFrameRenderer();\r\n        if(stickerType === StickerType.Lottie) renderer = new LottieStickerFrameByFrameRenderer();\r\n        if(stickerType === StickerType.WebM) renderer = new VideoStickerFrameByFrameRenderer();\r\n        if(!renderer) return;\r\n\r\n        renderers.set(layer.id, renderer);\r\n        await renderer.init(layer.sticker!, STICKER_SIZE * layer.scale * pixelRatio);\r\n        maxFrames = Math.max(maxFrames, renderer.getTotalFrames());\r\n      }),\r\n      delay(200)\r\n    ]);\r\n\r\n    const muxer = new Muxer({\r\n      target: new ArrayBufferTarget(),\r\n      video: {\r\n        codec: 'avc',\r\n        width: scaledWidth,\r\n        height: scaledHeight,\r\n        frameRate: FRAMES_PER_SECOND\r\n      },\r\n      fastStart: 'in-memory'\r\n    });\r\n\r\n    const encoder = new VideoEncoder({\r\n      output: (chunk, meta) => muxer.addVideoChunk(chunk, meta),\r\n      error: (e) => console.error(e)\r\n    });\r\n\r\n    encoder.configure({\r\n      width: scaledWidth,\r\n      height: scaledHeight,\r\n      ...calcCodecAndBitrate(scaledWidth, scaledHeight, BITRATE_TARGET_FPS)\r\n    });\r\n\r\n    for(let frameNo = 0; frameNo <= maxFrames; frameNo++) {\r\n      if(canceled) {\r\n        reject();\r\n        cleanup(encoder);\r\n      }\r\n\r\n      await renderFrame(encoder, frameNo);\r\n      setProgress(frameNo / maxFrames);\r\n    }\r\n\r\n    await encoder.flush();\r\n    muxer.finalize();\r\n\r\n    cleanup(encoder);\r\n\r\n    const {buffer} = muxer.target;\r\n    resolve({\r\n      blob: new Blob([buffer], {type: 'video/mp4'}),\r\n      hasSound: false\r\n    });\r\n  });\r\n\r\n  let result: MediaEditorFinalResultPayload;\r\n\r\n  resultPromise.then((value) => (result = value)).catch(noop);\r\n\r\n  return {\r\n    preview: await runWithOwner(owner, () => generateVideoPreview({scaledWidth, scaledHeight})),\r\n    isVideo: true,\r\n    getResult: () => {\r\n      return result ?? resultPromise;\r\n    },\r\n    cancel: () => {\r\n      canceled = true;\r\n    },\r\n    creationProgress\r\n  };\r\n\r\n  // const div = document.createElement('div')\r\n  // div.style.position = 'fixed';\r\n  // div.style.zIndex = '1000';\r\n  // div.style.top = '50%';\r\n  // div.style.left = '50%';\r\n  // div.style.transform = 'translate(-50%, -50%)';\r\n  // const img = document.createElement('video')\r\n  // img.src = URL.createObjectURL(blob)\r\n  // img.controls = true\r\n  // img.autoplay = true\r\n  // img.loop = true\r\n  // img.style.maxWidth = '450px'\r\n  // div.append(img)\r\n  // document.body.append(div)\r\n}\r\n","import apiManagerProxy from '../../../lib/mtproto/mtprotoworker';\r\nimport deferredPromise from '../../../helpers/cancellablePromise';\r\n\r\nimport {MediaEditorContextValue} from '../context';\r\nimport {useCropOffset} from '../canvas/useCropOffset';\r\nimport {delay, snapToViewport} from '../utils';\r\n\r\n\r\ntype SpawnAnimatedPreviewOptions = {\r\n  context: MediaEditorContextValue;\r\n  cropOffset: ReturnType<typeof useCropOffset>;\r\n  scaledWidth: number;\r\n  scaledHeight: number;\r\n  previewBlob: Blob;\r\n}\r\n\r\nexport default async function spawnAnimatedPreview({\r\n  context,\r\n  cropOffset,\r\n  scaledWidth,\r\n  scaledHeight,\r\n  previewBlob\r\n}: SpawnAnimatedPreviewOptions) {\r\n  const {editorState: {currentTab, imageCanvas}} = context;\r\n\r\n  const isCropping = currentTab === 'crop';\r\n\r\n  const bcr = imageCanvas.getBoundingClientRect();\r\n  const animatedImg = new Image();\r\n  animatedImg.src = await apiManagerProxy.invoke('createObjectURL', previewBlob);\r\n  animatedImg.style.position = 'fixed';\r\n  const left = bcr.left + (isCropping ? cropOffset().left + cropOffset().width / 2 : bcr.width / 2),\r\n    top = bcr.top + (isCropping ? cropOffset().top + cropOffset().height / 2 : bcr.height / 2);\r\n\r\n  const [width, height] = snapToViewport(\r\n    scaledWidth / scaledHeight,\r\n    isCropping ? cropOffset().width : bcr.width,\r\n    isCropping ? cropOffset().height : bcr.height\r\n  );\r\n  animatedImg.style.left = left + 'px';\r\n  animatedImg.style.top = top + 'px';\r\n  animatedImg.style.width = width + 'px';\r\n  animatedImg.style.height = height + 'px';\r\n  animatedImg.style.transform = 'translate(-50%, -50%)';\r\n  animatedImg.style.objectFit = 'cover';\r\n  animatedImg.style.zIndex = '1000';\r\n\r\n  document.body.append(animatedImg);\r\n\r\n  const deferred = deferredPromise<void>();\r\n\r\n  animatedImg.addEventListener('load', () => deferred.resolve())\r\n\r\n  await Promise.race([delay(500), deferred]);\r\n\r\n  return animatedImg;\r\n}\r\n","import {getOwner, runWithOwner} from 'solid-js';\r\nimport {unwrap} from 'solid-js/store';\r\nimport {MediaSize} from '../../../helpers/mediaSize';\r\nimport noop from '../../../helpers/noop';\r\nimport {logger} from '../../../lib/logger';\r\nimport {adjustmentsConfig, AdjustmentsConfig} from '../adjustments';\r\nimport BrushPainter from '../canvas/brushPainter';\r\nimport {useCropOffset} from '../canvas/useCropOffset';\r\nimport {EditingMediaState, useMediaEditorContext} from '../context';\r\nimport {NumberPair, StandaloneSignal} from '../types';\r\nimport {checkIfHasAnimatedStickers, cleanupWebGl, snapToAvailableQuality} from '../utils';\r\nimport {draw} from '../webgl/draw';\r\nimport {initWebGL} from '../webgl/initWebGL';\r\nimport getResultSize from './getResultSize';\r\nimport getResultTransform from './getResultTransform';\r\nimport getScaledLayersAndLines from './getScaledLayersAndLines';\r\nimport renderToActualVideo from './renderToActualVideo';\r\nimport renderToImage from './renderToImage';\r\nimport renderToVideoGIF from './renderToVideoGIF';\r\nimport spawnAnimatedPreview from './spawnAnimatedPreview';\r\n\r\n\r\nexport type MediaEditorFinalResultPayload = {\r\n  blob: Blob;\r\n  hasSound: boolean;\r\n  thumb?: {\r\n    blob: Blob;\r\n    size: MediaSize;\r\n  }\r\n};\r\n\r\nexport type MediaEditorFinalResult = {\r\n  preview: Blob;\r\n  getResult: () => MediaEditorFinalResultPayload | Promise<MediaEditorFinalResultPayload>;\r\n  cancel?: () => void;\r\n  isVideo: boolean;\r\n  width: number;\r\n  height: number;\r\n  originalSrc: string;\r\n  originalSize?: NumberPair;\r\n  editingMediaState: EditingMediaState;\r\n  animatedPreview?: HTMLImageElement;\r\n  creationProgress?: StandaloneSignal<number>;\r\n};\r\n\r\nconst log = logger('MediaEditor.createFinalResult');\r\n\r\nexport async function createFinalResult(): Promise<MediaEditorFinalResult> {\r\n  const context = useMediaEditorContext();\r\n  const {editorState, mediaState, mediaSrc, mediaType, imageRatio} = context;\r\n  const {resizableLayers, adjustments} = mediaState;\r\n\r\n  const owner = getOwner();\r\n\r\n  const cropOffset = useCropOffset();\r\n\r\n  const hasAnimatedStickers = checkIfHasAnimatedStickers(resizableLayers);\r\n\r\n  const willResultInVideo = hasAnimatedStickers || mediaType === 'video';\r\n\r\n  const videoType = mediaType === 'video' ? 'video' : hasAnimatedStickers ? 'gif' : undefined;\r\n\r\n  const [, maxHeight] = getResultSize({\r\n    imageWidth: editorState.renderingPayload?.media.width,\r\n    newRatio: mediaState.currentImageRatio,\r\n    scale: mediaState.scale,\r\n    videoType,\r\n    imageRatio: imageRatio,\r\n    cropOffset: cropOffset()\r\n  });\r\n\r\n  const maxQuality = snapToAvailableQuality(maxHeight);\r\n\r\n  const [scaledWidth, scaledHeight] = getResultSize({\r\n    imageWidth: editorState.renderingPayload?.media.width,\r\n    newRatio: mediaState.currentImageRatio,\r\n    scale: mediaState.scale,\r\n    videoType,\r\n    imageRatio,\r\n    cropOffset: cropOffset(),\r\n    quality: willResultInVideo ? Math.min(maxQuality, mediaState.videoQuality) : undefined\r\n  });\r\n\r\n  const imageCanvas = document.createElement('canvas');\r\n  imageCanvas.width = scaledWidth;\r\n  imageCanvas.height = scaledHeight;\r\n\r\n  const gl = imageCanvas.getContext('webgl', {\r\n    preserveDrawingBuffer: true\r\n  });\r\n\r\n  const payload = await initWebGL({gl, mediaSrc, mediaType, videoTime: mediaState.videoCropStart, waitToSeek: false});\r\n\r\n  const finalTransform = getResultTransform({\r\n    context,\r\n    scaledWidth,\r\n    scaledHeight,\r\n    imageWidth: payload.media.width,\r\n    imageHeight: payload.media.height,\r\n    cropOffset\r\n  });\r\n\r\n  const drawToImageCanvas = () => {\r\n    draw(gl, payload, {\r\n      ...finalTransform,\r\n      imageSize: [payload.media.width, payload.media.height],\r\n      ...(Object.fromEntries(\r\n        adjustmentsConfig.map(({key, to100}) => {\r\n          const value = adjustments[key];\r\n          return [key, value / (to100 ? 100 : 50)];\r\n        })\r\n      ) as Record<AdjustmentsConfig[number]['key'], number>)\r\n    });\r\n  };\r\n\r\n  if(mediaType === 'image') drawToImageCanvas();\r\n\r\n  const {scaledLayers, scaledLines} = getScaledLayersAndLines(context, finalTransform, scaledWidth, scaledHeight);\r\n\r\n  const brushCanvas = document.createElement('canvas');\r\n  brushCanvas.width = scaledWidth;\r\n  brushCanvas.height = scaledHeight;\r\n\r\n  const brushPainter = new BrushPainter({targetCanvas: brushCanvas, imageCanvas});\r\n  brushPainter.saveLastLine();\r\n  scaledLines.forEach((line) => brushPainter.drawLine(line));\r\n\r\n  const resultCanvas = document.createElement('canvas');\r\n  resultCanvas.width = scaledWidth;\r\n  resultCanvas.height = scaledHeight;\r\n  const ctx = resultCanvas.getContext('2d', {willReadFrequently: true});\r\n\r\n  const renderPromise = (() => {\r\n    if(mediaType === 'video')\r\n      return runWithOwner(owner, () => renderToActualVideo({\r\n        renderingPayload: payload,\r\n        hasAnimatedStickers,\r\n        scaledWidth,\r\n        scaledHeight,\r\n        scaledLayers,\r\n        imageCanvasGL: gl,\r\n        imageCanvas,\r\n        drawToImageCanvas,\r\n        resultCanvas,\r\n        brushCanvas,\r\n        ctx\r\n      }));\r\n\r\n    if(hasAnimatedStickers)\r\n      return runWithOwner(owner, () => renderToVideoGIF({\r\n        scaledWidth,\r\n        scaledHeight,\r\n        scaledLayers,\r\n        imageCanvas,\r\n        resultCanvas,\r\n        brushCanvas,\r\n        ctx\r\n      }));\r\n\r\n    return renderToImage({\r\n      context,\r\n      scaledLayers,\r\n      imageCanvas,\r\n      resultCanvas,\r\n      brushCanvas,\r\n      ctx\r\n    });\r\n  })();\r\n\r\n  const renderResult = await renderPromise;\r\n\r\n  const animatedPreview = await spawnAnimatedPreview({\r\n    context,\r\n    cropOffset,\r\n    scaledWidth,\r\n    scaledHeight,\r\n    previewBlob: renderResult.preview\r\n  });\r\n\r\n  Promise.resolve(renderResult.getResult())?.catch(noop)?.finally(() => {\r\n    cleanupWebGl(gl);\r\n    log('cleaning up webgl')\r\n  });\r\n\r\n  return {\r\n    ...renderResult,\r\n    animatedPreview,\r\n    width: scaledWidth,\r\n    height: scaledHeight,\r\n    originalSrc: context.mediaSrc,\r\n    originalSize: [payload.media.width, payload.media.height],\r\n    editingMediaState: structuredClone(unwrap(mediaState))\r\n  };\r\n}\r\n","import {onMount} from 'solid-js';\r\n\r\nimport ripple from '../ripple';\r\n\r\nimport {useMediaEditorContext} from './context';\r\n\r\n\r\nexport default function FinishButton(props: {onClick: () => void}) {\r\n  let container: HTMLDivElement;\r\n  const {hasModifications} = useMediaEditorContext();\r\n\r\n  onMount(() => {\r\n    ripple(container);\r\n  });\r\n\r\n  return (\r\n    <div\r\n      ref={container}\r\n      onClick={props.onClick}\r\n      class=\"media-editor__finish-button\"\r\n      classList={{\r\n        'media-editor__finish-button--hidden': !hasModifications()\r\n      }}\r\n    >\r\n      <svg width=\"18\" height=\"16\" viewBox=\"0 0 18 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n        <path d=\"M2 9L6.5 14L16 2\" stroke=\"white\" stroke-width=\"2.66\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />\r\n      </svg>\r\n    </div>\r\n  );\r\n}\r\n","import {createMemo, JSX} from 'solid-js';\r\n\r\nimport clamp from '../../helpers/number/clamp';\r\nimport {hexaToHsla} from '../../helpers/color';\r\nimport nMap from '../../helpers/number/nMap';\r\n\r\nexport default function RangeInput(props: {\r\n  ref?: (el: HTMLDivElement) => void;\r\n  style?: JSX.CSSProperties;\r\n  label: JSX.Element;\r\n  value: number;\r\n  min: number;\r\n  max: number;\r\n  onChange: (value: number) => void;\r\n  onChangeFinish?: (prevValue: number, currentValue: number) => void;\r\n  passiveLabel?: boolean;\r\n  color?: string;\r\n}) {\r\n  const normalizedValue = () => nMap(props.value, props.min, props.max, 0, 1);\r\n  const mappedCenter = createMemo(() => nMap(0, props.min, props.max, 0, 100));\r\n\r\n  const brightShadow = () => props.color && hexaToHsla(props.color).l < 32;\r\n\r\n  let prevValue: number | null = null;\r\n\r\n  return (\r\n    <div\r\n      ref={props.ref}\r\n      class=\"media-editor__range-input\"\r\n      classList={{\r\n        'media-editor__range-input--passive': props.passiveLabel,\r\n        'media-editor__range-input--has-value': !props.passiveLabel && !!props.value,\r\n        'media-editor__range-input--bright-shadow': brightShadow()\r\n      }}\r\n      style={{\r\n        '--color': props.color,\r\n        '--normalized': normalizedValue(),\r\n        '--w': (Math.abs(props.value - Math.max(0, props.min)) / (props.max - props.min)) * 100 + '%',\r\n        '--bar-left': props.value >= 0 ? Math.max(0, mappedCenter()) + '%' : undefined,\r\n        '--bar-right': props.value < 0 ? mappedCenter() + '%' : undefined,\r\n        ...props.style\r\n      }}\r\n    >\r\n      <div class=\"media-editor__range-input-row\">\r\n        <div class=\"media-editor__range-input-label\">{props.label}</div>\r\n        <div class=\"media-editor__range-input-value\">{props.value}</div>\r\n      </div>\r\n      <div class=\"media-editor__range-input-wrapper\">\r\n        <input\r\n          type=\"range\"\r\n          min={props.min}\r\n          max={props.max}\r\n          step=\"1\"\r\n          value={props.value}\r\n          onInput={(e) => {\r\n            if(prevValue === null) prevValue = props.value;\r\n            const newValue = clamp(e.currentTarget.valueAsNumber, props.min, props.max);\r\n            props.onChange(newValue);\r\n          }}\r\n          onChange={() => {\r\n            props.onChangeFinish?.(prevValue, props.value);\r\n            prevValue = null;\r\n          }}\r\n        />\r\n        <div class=\"media-editor__range-input-thumb media-editor__range-input-thumb--shadow\" />\r\n        <div class=\"media-editor__range-input-progress media-editor__range-input-progress--shadow\" />\r\n        <div class=\"media-editor__range-input-progress-background\" />\r\n        <div class=\"media-editor__range-input-thumb\" />\r\n        <div class=\"media-editor__range-input-progress\" />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import {createMemo, createSelector, For, JSX} from 'solid-js';\r\nimport clamp from '../../helpers/number/clamp';\r\n\r\n\r\nexport type StepInputStep<T = any> = {\r\n  value: T;\r\n  label: JSX.Element;\r\n};\r\n\r\nexport default function StepInput<T = any>(props: {\r\n  label: JSX.Element;\r\n  value: T;\r\n  steps: StepInputStep[];\r\n  onChange: (value: T) => void;\r\n}) {\r\n  const stepIndex = createMemo(() => props.steps.findIndex(step => step.value === props.value));\r\n  const step = createMemo(() => props.steps[stepIndex()]);\r\n\r\n  const isActive = createSelector(stepIndex, (a, b) => a <= b);\r\n  const isSelected = createSelector(stepIndex, (a, b) => a === b);\r\n\r\n  return (\r\n    <div\r\n      class=\"media-editor__step-input\"\r\n    >\r\n      <div class=\"media-editor__range-input-row\">\r\n        <div class=\"media-editor__range-input-label\">{props.label}</div>\r\n        <div class=\"media-editor__range-input-value\">{step().label}</div>\r\n      </div>\r\n\r\n      <div class=\"media-editor__step-input-wrapper\">\r\n        <input\r\n          type=\"range\"\r\n          min={0}\r\n          max={props.steps.length - 1}\r\n          step=\"1\"\r\n          value={stepIndex()}\r\n          onInput={(e) => {\r\n            const newValue = Math.round(clamp(e.currentTarget.valueAsNumber, 0, props.steps.length - 1)); // just in case\r\n            props.onChange(props.steps[newValue].value);\r\n          }}\r\n        />\r\n        <For each={props.steps}>\r\n          {(_, index) => <>\r\n            {index() && <div\r\n              class=\"media-editor__step-input-separator\"\r\n              classList={{\r\n                'media-editor__step-input-separator--active': isActive(index())\r\n              }}\r\n            />}\r\n            <div\r\n              class=\"media-editor__step-input-dot\"\r\n              classList={{\r\n                'media-editor__step-input-dot--active': isActive(index()),\r\n                'media-editor__step-input-dot--selected': isSelected(index())\r\n              }}\r\n            />\r\n          </>}\r\n        </For>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import {createEffect, createMemo, createSignal, on, onCleanup, Show} from 'solid-js';\r\n\r\nimport {i18n} from '../../../lib/langPack';\r\n\r\nimport Space from '../../space';\r\n\r\nimport {adjustmentsConfig} from '../adjustments';\r\nimport {useCropOffset} from '../canvas/useCropOffset';\r\nimport {useMediaEditorContext} from '../context';\r\nimport getResultSize from '../finalRender/getResultSize';\r\nimport RangeInput from '../rangeInput';\r\nimport StepInput, {StepInputStep} from '../stepInput';\r\nimport useIsMobile from '../useIsMobile';\r\nimport {availableQualityHeights, checkIfHasAnimatedStickers, snapToAvailableQuality} from '../utils';\r\n\r\n\r\nconst ADJUST_TIMEOUT = 800;\r\n\r\nexport default function AdjustmentsTab() {\r\n  const {editorState, mediaState, actions, mediaSize, mediaType, imageRatio} = useMediaEditorContext();\r\n\r\n  const isMobile = useIsMobile();\r\n  const cropOffset = useCropOffset();\r\n\r\n  let timeoutId = 0;\r\n  function removeIsAdjusting() {\r\n    window.clearTimeout(timeoutId);\r\n    timeoutId = window.setTimeout(() => {\r\n      editorState.isAdjusting = false;\r\n    }, ADJUST_TIMEOUT);\r\n  }\r\n\r\n  const resultingSize = createMemo(() =>\r\n    getResultSize({\r\n      imageWidth: mediaSize[0],\r\n      scale: mediaState.scale,\r\n      newRatio: mediaState.currentImageRatio || imageRatio,\r\n      videoType: mediaType === 'video' ? 'video' : 'gif',\r\n      imageRatio,\r\n      cropOffset: !cropOffset().width ? {width: 1, height: 1} : cropOffset()\r\n    })\r\n  );\r\n\r\n  createEffect(() => {\r\n    resultingSize();\r\n    (window as any).debugResultingSize && console.log('resultingSize', resultingSize());\r\n  });\r\n\r\n  const maxVideoQuality = createMemo(() => snapToAvailableQuality(resultingSize()[1]));\r\n\r\n  const steps = createMemo((): StepInputStep[] =>\r\n    availableQualityHeights\r\n    .filter(height => height <= maxVideoQuality())\r\n    .map(height => ({value: height, label: height + 'p'}))\r\n  );\r\n\r\n  const canShowQualityInput = createMemo(() => (mediaType === 'video' || checkIfHasAnimatedStickers(mediaState.resizableLayers)) && steps().length > 1);\r\n\r\n  return (\r\n    <>\r\n      <Space amount=\"16px\" />\r\n\r\n      <Show when={canShowQualityInput()}>\r\n        <StepInput\r\n          label={i18n('Quality')}\r\n          steps={steps()}\r\n          value={Math.min(maxVideoQuality(), mediaState.videoQuality)}\r\n          onChange={(value) => void(mediaState.videoQuality = value)}\r\n        />\r\n        <Space amount=\"32px\" />\r\n      </Show>\r\n\r\n      {adjustmentsConfig.map((item) => {\r\n        const [container, setContainer] = createSignal<HTMLDivElement>();\r\n\r\n        const [showGhost, setShowGhost] = createSignal(false);\r\n\r\n        const value = () => mediaState.adjustments[item.key];\r\n        const setValue = (v: number): void => void (mediaState.adjustments[item.key] = v);\r\n\r\n        createEffect(\r\n          on(showGhost, () => {\r\n            if(!container() || !isMobile() || !showGhost()) return;\r\n            const bcr = container().getBoundingClientRect();\r\n            const div = (\r\n              <div\r\n                class=\"night media-editor__inherit-color\"\r\n                style={{\r\n                  'position': 'fixed',\r\n                  'left': bcr.left + 'px',\r\n                  'top': bcr.top + 'px',\r\n                  'width': bcr.width + 'px',\r\n                  'height': bcr.height + 'px',\r\n                  'z-index': 100\r\n                }}\r\n              >\r\n                <RangeInput\r\n                  value={value()}\r\n                  onChange={() => {}}\r\n                  label={item.label()}\r\n                  min={item.to100 ? 0 : -50}\r\n                  max={item.to100 ? 100 : 50}\r\n                />\r\n              </div>\r\n            ) as HTMLDivElement;\r\n            document.body.append(div);\r\n\r\n            onCleanup(() => {\r\n              setTimeout(() => {\r\n                div.remove();\r\n              }, 200);\r\n            });\r\n          })\r\n        );\r\n\r\n        let timeoutId = 0;\r\n        const removeGhost = () => {\r\n          window.clearTimeout(timeoutId);\r\n          timeoutId = window.setTimeout(() => {\r\n            setShowGhost(false);\r\n          }, ADJUST_TIMEOUT);\r\n        };\r\n\r\n        return (\r\n          <>\r\n            <RangeInput\r\n              ref={setContainer}\r\n              value={value()}\r\n              onChange={(v) => {\r\n                setValue(v);\r\n                setShowGhost(true);\r\n                editorState.isAdjusting = true;\r\n                removeGhost();\r\n                removeIsAdjusting();\r\n              }}\r\n              label={item.label()}\r\n              onChangeFinish={(prevValue, currentValue) => {\r\n                setShowGhost(false);\r\n                editorState.isAdjusting = false;\r\n\r\n                actions.pushToHistory({\r\n                  path: ['adjustments', item.key],\r\n                  newValue: currentValue,\r\n                  oldValue: prevValue\r\n                });\r\n              }}\r\n              min={item.to100 ? 0 : -50}\r\n              max={item.to100 ? 100 : 50}\r\n            />\r\n            <Space amount=\"32px\" />\r\n          </>\r\n        );\r\n      })}\r\n    </>\r\n  );\r\n}\r\n","import {ButtonIconTsx} from '../../buttonIconTsx';\r\n\r\nimport {useMediaEditorContext} from '../context';\r\n\r\ntype ConfigItem = {\r\n  icon: Icon;\r\n  key: string;\r\n};\r\n\r\nconst config: ConfigItem[] = [\r\n  {icon: 'equalizer', key: 'adjustments'},\r\n  {icon: 'crop', key: 'crop'},\r\n  {icon: 'text', key: 'text'},\r\n  {icon: 'brush', key: 'brush'},\r\n  {icon: 'smile', key: 'stickers'}\r\n];\r\n\r\nexport const mediaEditorTabsOrder = config.map((item) => item.key);\r\n\r\nexport default function Tabs() {\r\n  const {editorState} = useMediaEditorContext();\r\n\r\n  let container: HTMLDivElement;\r\n  let underline: HTMLDivElement;\r\n\r\n  const tabs = config.map((item) => ({\r\n    ...item,\r\n    element: (\r\n      <div class=\"media-editor__tabs-item\" classList={{'media-editor__tabs-item--active': editorState.currentTab === item.key}}>\r\n        <ButtonIconTsx icon={item.icon} onClick={() => onTabClick(item.key)} />\r\n      </div>\r\n    ) as HTMLElement\r\n  }));\r\n\r\n  function onTabClick(key: string) {\r\n    const target = tabs.find((tab) => tab.key === key).element;\r\n    const containerBR = container.getBoundingClientRect();\r\n    const targetBR = target.getBoundingClientRect();\r\n\r\n    underline.style.setProperty('--left', targetBR.left + targetBR.width / 2 - containerBR.left + 'px');\r\n\r\n    editorState.currentTab = key;\r\n  }\r\n\r\n  return (\r\n    <div ref={container} class=\"media-editor__tabs\">\r\n      {tabs.map((tab) => tab.element)}\r\n      <div ref={underline} class=\"media-editor__tabs-underline\" />\r\n    </div>\r\n  );\r\n}\r\n","import {Accessor, createContext, createEffect, createSignal, JSX, onCleanup, onMount} from 'solid-js';\r\n\r\nimport {doubleRaf} from '../../../helpers/schedulers';\r\nimport Scrollable from '../../scrollable';\r\n\r\nimport {useMediaEditorContext} from '../context';\r\nimport {delay} from '../utils';\r\n\r\nimport {mediaEditorTabsOrder} from './tabs';\r\n\r\ntype TabContentContextValue = {\r\n  container: Accessor<HTMLDivElement>;\r\n  scrollAmount: Accessor<number>;\r\n};\r\nexport const TabContentContext = createContext<TabContentContextValue>();\r\n\r\nexport default function TabContent(props: {\r\n  tabs: Record<string, () => JSX.Element>;\r\n  onContainer: (el: HTMLDivElement) => void;\r\n  onScroll: () => void;\r\n}) {\r\n  const {editorState} = useMediaEditorContext();\r\n\r\n  const [container, setContainer] = createSignal<HTMLDivElement>();\r\n  const [scrollAmount, setScrollAmount] = createSignal(0);\r\n  let prevElement: HTMLDivElement;\r\n  let prevTab = editorState.currentTab;\r\n  let scrollable: Scrollable;\r\n\r\n  createEffect(async() => {\r\n    if(prevTab === editorState.currentTab) return;\r\n\r\n    const toRight = mediaEditorTabsOrder.indexOf(editorState.currentTab) > mediaEditorTabsOrder.indexOf(prevTab);\r\n    prevTab = editorState.currentTab;\r\n\r\n    scrollable.destroy();\r\n    const newElement = (\r\n      <div>\r\n        <div class=\"media-editor__tab-content-scrollable-content\">\r\n          <TabContentContext.Provider value={{container, scrollAmount}}>\r\n            {props.tabs[editorState.currentTab]()}\r\n          </TabContentContext.Provider>\r\n        </div>\r\n      </div>\r\n    ) as HTMLDivElement;\r\n    setScrollable(newElement);\r\n\r\n    const cls = (element: HTMLElement, action: 'add' | 'remove', modifier: string) =>\r\n      element.classList[action]('media-editor__tab-content--' + modifier);\r\n\r\n    cls(prevElement, 'add', 'exit');\r\n\r\n    if(toRight) {\r\n      cls(newElement, 'add', 'go-right');\r\n      container().append(newElement);\r\n      await doubleRaf();\r\n      cls(prevElement, 'add', 'go-left');\r\n      cls(newElement, 'remove', 'go-right');\r\n    } else {\r\n      cls(newElement, 'add', 'go-left');\r\n      container().append(newElement);\r\n      await doubleRaf();\r\n      cls(prevElement, 'add', 'go-right');\r\n      cls(newElement, 'remove', 'go-left');\r\n    }\r\n\r\n    await delay(200);\r\n    prevElement.remove();\r\n\r\n    prevElement = newElement;\r\n  });\r\n\r\n  const initialTab = props.tabs[editorState.currentTab]();\r\n\r\n  function setScrollable(element: HTMLElement) {\r\n    // TODO: Scrollable thumb not showing\r\n    scrollable = new Scrollable(element);\r\n    scrollable.setListeners();\r\n    scrollable.container.addEventListener('scroll', () => {\r\n      props.onScroll();\r\n      setScrollAmount(scrollable.container.scrollTop);\r\n    });\r\n  }\r\n\r\n  onMount(() => {\r\n    setScrollable(prevElement);\r\n  });\r\n\r\n  onCleanup(() => {\r\n    scrollable.destroy();\r\n  });\r\n\r\n  return (\r\n    <div\r\n      ref={(el) => {\r\n        setContainer(el);\r\n        props.onContainer(el);\r\n      }}\r\n      class=\"media-editor__tab-content\"\r\n    >\r\n      <div ref={prevElement}>\r\n        <div class=\"media-editor__tab-content-scrollable-content\">\r\n          <TabContentContext.Provider value={{container, scrollAmount}}>{initialTab}</TabContentContext.Provider>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import {batch, createEffect, createResource, createSignal, For, onCleanup, onMount, Show, useContext} from 'solid-js';\r\n\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport {useHotReloadGuard} from '../../../lib/solidjs/hotReloadGuard';\r\nimport {Document, EmojiGroup, StickerSet} from '../../../layer';\r\nimport {i18n} from '../../../lib/langPack';\r\n\r\nimport SuperStickerRenderer from '../../emoticonsDropdown/tabs/SuperStickerRenderer';\r\nimport createMiddleware from '../../../helpers/solid/createMiddleware';\r\nimport LazyLoadQueue from '../../lazyLoadQueue';\r\nimport {ScrollableX} from '../../scrollable';\r\nimport {IconTsx} from '../../iconTsx';\r\nimport Space from '../../space';\r\n\r\nimport useNormalizePoint from '../canvas/useNormalizePoint';\r\nimport {HistoryItem, useMediaEditorContext} from '../context';\r\nimport {ResizableLayer} from '../types';\r\nimport {delay} from '../utils';\r\n\r\nimport {TabContentContext} from './tabContent';\r\n\r\nexport default function StickersTab() {\r\n  const {wrapStickerSetThumb, EmoticonsSearch} = useHotReloadGuard();\r\n  const context = useMediaEditorContext();\r\n  const {container, scrollAmount} = useContext(TabContentContext);\r\n\r\n  const {managers, editorState, mediaState, actions} = context;\r\n\r\n  const normalizePoint = useNormalizePoint();\r\n\r\n  const [recentStickers] = createResource(() => managers.appStickersManager.getRecentStickersStickers());\r\n  const [stickerSets] = createResource(() => managers.appStickersManager.getAllStickers());\r\n  const [filteredStickers, setFilteredStickers] = createSignal<Document.document[]>();\r\n\r\n  const [search, setSearch] = createSignal('');\r\n  const [group, setGroup] = createSignal<EmojiGroup>();\r\n  const [activeSet, setActiveSet] = createSignal('recent');\r\n  const [scrolling, setScrolling] = createSignal(false);\r\n\r\n  const [intersectionObserver, setIntersectionObserver] = createSignal<IntersectionObserver>();\r\n  const [recentLabel, setRecentLabel] = createSignal<HTMLDivElement>();\r\n\r\n  const lazyLoadQueue = new LazyLoadQueue();\r\n  const stickerRenderer = new SuperStickerRenderer({\r\n    regularLazyLoadQueue: lazyLoadQueue,\r\n    group: 'none',\r\n    managers,\r\n    intersectionObserverInit: {root: container()},\r\n    withLock: false\r\n  });\r\n\r\n  onCleanup(() => {\r\n    stickerRenderer.destroy();\r\n    lazyLoadQueue.clear();\r\n  });\r\n\r\n  async function onStickerSetThumbClick(id: string) {\r\n    setActiveSet(String(id));\r\n    setScrolling(true);\r\n    container()?.querySelector(`[data-set-id=\"${id}\"]`)?.scrollIntoView({\r\n      behavior: 'smooth',\r\n      block: 'start'\r\n    });\r\n    await delay(1000);\r\n    setScrolling(false);\r\n  }\r\n\r\n  function StickerSetThumb(props: {set: StickerSet.stickerSet}) {\r\n    let renderContainer: HTMLDivElement;\r\n\r\n\r\n    onMount(() => {\r\n      const middleware = createMiddleware();\r\n\r\n      wrapStickerSetThumb({\r\n        container: renderContainer,\r\n        group: 'none',\r\n        autoplay: true,\r\n        width: 30,\r\n        height: 30,\r\n        lazyLoadQueue,\r\n        middleware: middleware.get(),\r\n        set: props.set,\r\n        managers,\r\n        textColor: 'white'\r\n      });\r\n    });\r\n\r\n    const isActive = () => String(props.set.id) === activeSet();\r\n\r\n    return (\r\n      <div\r\n        ref={renderContainer}\r\n        class=\"media-editor__stickers-set-thumb\"\r\n        classList={{\r\n          'media-editor__stickers-set-thumb--active': isActive()\r\n        }}\r\n        onClick={() => onStickerSetThumbClick(String(props.set.id))}\r\n      />\r\n    );\r\n  }\r\n\r\n  function Sticker(props: {doc: Document.document}) {\r\n    let container: HTMLDivElement;\r\n\r\n    onMount(() => {\r\n      stickerRenderer.renderSticker(props.doc, container);\r\n      stickerRenderer.observeAnimated(container);\r\n    });\r\n\r\n    function onClick() {\r\n      const id = context.resizableLayersSeed++;\r\n      const transform = editorState.finalTransform;\r\n      const newLayer = {\r\n        id,\r\n        position: normalizePoint([editorState.canvasSize[0] / 2, editorState.canvasSize[1] / 2]),\r\n        rotation: -transform.rotation,\r\n        scale: 1 / transform.scale,\r\n        type: 'sticker',\r\n        sticker: props.doc\r\n      } as ResizableLayer;\r\n\r\n      batch(() => {\r\n        mediaState.resizableLayers.push(newLayer);\r\n        editorState.selectedResizableLayer = id;\r\n\r\n        actions.pushToHistory({\r\n          path: ['resizableLayers', mediaState.resizableLayers.length - 1],\r\n          newValue: newLayer,\r\n          oldValue: HistoryItem.RemoveArrayItem,\r\n          findBy: {\r\n            id: newLayer.id\r\n          }\r\n        })\r\n      });\r\n    }\r\n\r\n    return <div ref={container} class=\"media-editor__stickers-grid-item\" onClick={onClick} />;\r\n  }\r\n\r\n  function StickerSetLabel(props: {set: StickerSet.stickerSet}) {\r\n    let label: HTMLDivElement;\r\n\r\n    createEffect(() => {\r\n      if(intersectionObserver()) {\r\n        intersectionObserver().observe(label);\r\n        onCleanup(() => {\r\n          intersectionObserver()?.unobserve(label);\r\n        });\r\n      }\r\n    });\r\n\r\n    return (\r\n      <div ref={label} data-set-id={props.set.id} class=\"media-editor__label\">\r\n        {wrapEmojiText(props.set.title)}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  function StickerSetSection(props: {set: StickerSet.stickerSet}) {\r\n    const [stickers] = createResource(() => managers.appStickersManager.getStickerSet(props.set));\r\n\r\n    return (\r\n      <Show when={stickers()}>\r\n        <Space amount=\"16px\" />\r\n        <StickerSetLabel set={props.set} />\r\n        <div class=\"media-editor__stickers-grid\">\r\n          <For each={stickers().documents}>{(doc) => <Sticker doc={doc as Document.document} />}</For>\r\n        </div>\r\n      </Show>\r\n    );\r\n  }\r\n\r\n  function ThumbList() {\r\n    let thumbsListScrollable: HTMLDivElement;\r\n\r\n    onMount(() => {\r\n      document.querySelector('.media-editor__tabs')?.append(thumbsListScrollable);\r\n      new ScrollableX(thumbsListScrollable);\r\n    });\r\n    onCleanup(() => {\r\n      thumbsListScrollable.remove();\r\n    });\r\n\r\n    const visible = () => stickerSets() && !filteredStickers();\r\n    <div\r\n      class=\"media-editor__stickers-thumb-list-scrollable\"\r\n      classList={{\r\n        'media-editor__stickers-thumb-list-scrollable--hidden': !visible(),\r\n        'media-editor__stickers-thumb-list-scrollable--has-scroll': scrollAmount() > 8\r\n      }}\r\n      ref={thumbsListScrollable}\r\n    >\r\n      <div class=\"media-editor__stickers-thumb-list\">\r\n        <Show when={recentStickers()?.length}>\r\n          <div\r\n            class=\"media-editor__stickers-recent-button\"\r\n            classList={{\r\n              'media-editor__stickers-recent-button--active': activeSet() === 'recent'\r\n            }}\r\n            onClick={() => onStickerSetThumbClick('recent')}\r\n          >\r\n            <IconTsx icon=\"recent\" />\r\n          </div>\r\n        </Show>\r\n        <For each={stickerSets()?.sets}>{(set) => <StickerSetThumb set={set} />}</For>\r\n      </div>\r\n    </div>;\r\n    return <></>;\r\n  }\r\n\r\n  createEffect(() => {\r\n    setIntersectionObserver(\r\n      new IntersectionObserver(\r\n        (entries) => {\r\n          entries.forEach((entry) => {\r\n            if(!scrolling() && entry.isIntersecting) {\r\n              const id = (entry.target as HTMLDivElement).dataset.setId;\r\n              if(id) setActiveSet(id);\r\n            }\r\n          });\r\n        },\r\n        {\r\n          root: container(),\r\n          rootMargin: `0px 0px -${container().clientHeight - 100}px 0px`\r\n        }\r\n      )\r\n    );\r\n\r\n    onCleanup(() => {\r\n      intersectionObserver()?.disconnect();\r\n    });\r\n  });\r\n\r\n  createEffect(() => {\r\n    if(intersectionObserver() && recentLabel()) {\r\n      intersectionObserver().observe(recentLabel());\r\n      onCleanup(() => {\r\n        intersectionObserver()?.unobserve(recentLabel());\r\n      });\r\n    }\r\n  });\r\n\r\n  createEffect(async() => {\r\n    if(search()) {\r\n      setFilteredStickers(await managers.appStickersManager.searchStickers(search()));\r\n      return;\r\n    }\r\n    if(group()) {\r\n      const g = group();\r\n      if(g._ === 'emojiGroupPremium') {\r\n        setFilteredStickers(await managers.appStickersManager.getPremiumStickers());\r\n        return;\r\n      }\r\n      setFilteredStickers(\r\n        await managers.appStickersManager.getStickersByEmoticon({\r\n          emoticon: g.emoticons,\r\n          includeServerStickers: true\r\n        })\r\n      );\r\n\r\n      return;\r\n    }\r\n    if(!group() && !search()) {\r\n      setFilteredStickers();\r\n    }\r\n  });\r\n\r\n  return (\r\n    <>\r\n      <ThumbList />\r\n\r\n      <Space amount={filteredStickers() ? '0px' : '48px'} />\r\n      <Space amount=\"8px\" />\r\n\r\n      <div class=\"media-editor__sticker-search\">\r\n        <EmoticonsSearch\r\n          type=\"stickers\"\r\n          onValue={(value) => {\r\n            setSearch(value);\r\n          }}\r\n          onGroup={(group) => {\r\n            setGroup(group);\r\n          }}\r\n          categoryColor=\"white\"\r\n          animatedItemGroup=\"none\"\r\n        />\r\n      </div>\r\n\r\n      {/* TODO: Favorties */}\r\n      <Space amount=\"16px\" />\r\n\r\n      <Show when={recentStickers()?.length > 0 && !filteredStickers()}>\r\n        <div ref={setRecentLabel} class=\"media-editor__label\" data-set-id=\"recent\">\r\n          {i18n('MediaEditor.RecentlyUsed')}\r\n        </div>\r\n\r\n        <div class=\"media-editor__stickers-grid\">\r\n          <For each={recentStickers()}>{(doc) => <Sticker doc={doc} />}</For>\r\n        </div>\r\n      </Show>\r\n\r\n      <Show when={filteredStickers()}>\r\n        <div class=\"media-editor__stickers-grid\">\r\n          <For each={filteredStickers()}>{(doc) => <Sticker doc={doc} />}</For>\r\n        </div>\r\n      </Show>\r\n\r\n      <Show when={stickerSets() && !filteredStickers()}>\r\n        <For each={stickerSets().sets}>{(set) => <StickerSetSection set={set} />}</For>\r\n      </Show>\r\n    </>\r\n  );\r\n}\r\n","export function PenBrush() {\r\n  return (\r\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <g clip-path=\"url(#clip0_6102_2542)\">\r\n        <g filter=\"url(#filter0_iiii_6102_2542)\">\r\n          <path\r\n            d=\"M0 15H80L110.2 22.4465C112.048 22.9021 112.971 23.1299 113.185 23.4931C113.369 23.806 113.369 24.194 113.185 24.5069C112.971 24.8701 112.048 25.0979 110.2 25.5535L80 33H0V15Z\"\r\n            fill=\"#3E3F3F\"\r\n          />\r\n        </g>\r\n        <path\r\n          d=\"M112.564 24.9709L103.474 27.2132C103.21 27.2782 102.944 27.121 102.883 26.8566C102.736 26.2146 102.5 25.0296 102.5 24C102.5 22.9705 102.736 21.7855 102.883 21.1434C102.944 20.8791 103.21 20.7219 103.474 20.7868L112.564 23.0291C113.578 23.2792 113.578 24.7208 112.564 24.9709Z\"\r\n          fill=\"currentColor\"\r\n        />\r\n        <rect x=\"76\" y=\"15\" width=\"4\" height=\"18\" rx=\"0.5\" fill=\"currentColor\" />\r\n      </g>\r\n      <defs>\r\n        <filter\r\n          id=\"filter0_iiii_6102_2542\"\r\n          x=\"0\"\r\n          y=\"10\"\r\n          width=\"116.323\"\r\n          height=\"28\"\r\n          filterUnits=\"userSpaceOnUse\"\r\n          color-interpolation-filters=\"sRGB\"\r\n        >\r\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\r\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"5\" />\r\n          <feGaussianBlur stdDeviation=\"3\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2542\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"3\" dy=\"-5\" />\r\n          <feGaussianBlur stdDeviation=\"3\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2542\" result=\"effect2_innerShadow_6102_2542\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"-1\" />\r\n          <feGaussianBlur stdDeviation=\"0.5\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2542\" result=\"effect3_innerShadow_6102_2542\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"1\" />\r\n          <feGaussianBlur stdDeviation=\"0.5\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2542\" result=\"effect4_innerShadow_6102_2542\" />\r\n        </filter>\r\n        <clipPath id=\"clip0_6102_2542\">\r\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\r\n        </clipPath>\r\n      </defs>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function ArrowBrush() {\r\n  return (\r\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <g clip-path=\"url(#clip0_6102_2543)\">\r\n        <path\r\n          d=\"M94 24H110M110 24L104 18M110 24L104 30\"\r\n          stroke=\"url(#paint0_linear_6102_2543)\"\r\n          stroke-width=\"3\"\r\n          stroke-linecap=\"round\"\r\n          stroke-linejoin=\"round\"\r\n        />\r\n        <g filter=\"url(#filter0_iiii_6102_2543)\">\r\n          <path d=\"M0 15H92C94.2091 15 96 16.7909 96 19V29C96 31.2091 94.2091 33 92 33H0V15Z\" fill=\"#3E3F3F\" />\r\n        </g>\r\n        <path d=\"M92 15V15C94.2091 15 96 16.7909 96 19V29C96 31.2091 94.2091 33 92 33V33V15Z\" fill=\"currentColor\" />\r\n      </g>\r\n      <defs>\r\n        <filter\r\n          id=\"filter0_iiii_6102_2543\"\r\n          x=\"0\"\r\n          y=\"10\"\r\n          width=\"99\"\r\n          height=\"28\"\r\n          filterUnits=\"userSpaceOnUse\"\r\n          color-interpolation-filters=\"sRGB\"\r\n        >\r\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\r\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"5\" />\r\n          <feGaussianBlur stdDeviation=\"3\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2543\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"3\" dy=\"-5\" />\r\n          <feGaussianBlur stdDeviation=\"3\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2543\" result=\"effect2_innerShadow_6102_2543\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"-1\" />\r\n          <feGaussianBlur stdDeviation=\"0.5\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2543\" result=\"effect3_innerShadow_6102_2543\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"1\" />\r\n          <feGaussianBlur stdDeviation=\"0.5\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2543\" result=\"effect4_innerShadow_6102_2543\" />\r\n        </filter>\r\n        <linearGradient id=\"paint0_linear_6102_2543\" x1=\"110\" y1=\"24\" x2=\"94\" y2=\"24\" gradientUnits=\"userSpaceOnUse\">\r\n          <stop offset=\"0.755\" stop-color=\"currentColor\" />\r\n          <stop offset=\"1\" stop-color=\"currentColor\" stop-opacity=\"0\" />\r\n        </linearGradient>\r\n        <clipPath id=\"clip0_6102_2543\">\r\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\r\n        </clipPath>\r\n      </defs>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function MarkerBrush() {\r\n  return (\r\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <g clip-path=\"url(#clip0_6102_2546)\">\r\n        <g filter=\"url(#filter0_iiii_6102_2546)\">\r\n          <path\r\n            d=\"M0 15H82.3579C83.4414 15 84.5135 15.2201 85.5093 15.6468L91 18H101C101.552 18 102 18.4477 102 19V29C102 29.5523 101.552 30 101 30H91L85.5093 32.3532C84.5135 32.7799 83.4414 33 82.3579 33H0V15Z\"\r\n            fill=\"#3E3F3F\"\r\n          />\r\n        </g>\r\n        <rect x=\"76\" y=\"15\" width=\"4\" height=\"18\" rx=\"0.5\" fill=\"currentColor\" />\r\n        <path\r\n          d=\"M102 19H106.434C106.785 19 107.111 19.1843 107.291 19.4855L112.091 27.4855C112.491 28.152 112.011 29 111.234 29H102V19Z\"\r\n          fill=\"currentColor\"\r\n        />\r\n      </g>\r\n      <defs>\r\n        <filter\r\n          id=\"filter0_iiii_6102_2546\"\r\n          x=\"0\"\r\n          y=\"10\"\r\n          width=\"105\"\r\n          height=\"28\"\r\n          filterUnits=\"userSpaceOnUse\"\r\n          color-interpolation-filters=\"sRGB\"\r\n        >\r\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\r\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"5\" />\r\n          <feGaussianBlur stdDeviation=\"3\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2546\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"3\" dy=\"-5\" />\r\n          <feGaussianBlur stdDeviation=\"3\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2546\" result=\"effect2_innerShadow_6102_2546\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"-1\" />\r\n          <feGaussianBlur stdDeviation=\"0.5\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2546\" result=\"effect3_innerShadow_6102_2546\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"1\" />\r\n          <feGaussianBlur stdDeviation=\"0.5\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2546\" result=\"effect4_innerShadow_6102_2546\" />\r\n        </filter>\r\n        <clipPath id=\"clip0_6102_2546\">\r\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\r\n        </clipPath>\r\n      </defs>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function NeonBrush() {\r\n  return (\r\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <g clip-path=\"url(#clip0_6102_2547)\">\r\n        <g filter=\"url(#filter0_f_6102_2547)\">\r\n          <path\r\n            d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\r\n            fill=\"currentColor\"\r\n          />\r\n        </g>\r\n        <g filter=\"url(#filter1_f_6102_2547)\">\r\n          <path\r\n            d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\r\n            fill=\"currentColor\"\r\n          />\r\n        </g>\r\n        <g filter=\"url(#filter2_f_6102_2547)\">\r\n          <path\r\n            d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\r\n            fill=\"currentColor\"\r\n          />\r\n        </g>\r\n        <g filter=\"url(#filter3_iiii_6102_2547)\">\r\n          <path\r\n            d=\"M0 15H82.3579C83.4414 15 84.5135 15.2201 85.5093 15.6468L91 18H101C101.552 18 102 18.4477 102 19V29C102 29.5523 101.552 30 101 30H91L85.5093 32.3532C84.5135 32.7799 83.4414 33 82.3579 33H0V15Z\"\r\n            fill=\"#3E3F3F\"\r\n          />\r\n        </g>\r\n        <rect x=\"76\" y=\"15\" width=\"4\" height=\"18\" rx=\"0.5\" fill=\"currentCOlor\" />\r\n        <path\r\n          d=\"M102 19H107.146C108.282 19 109.323 19.6487 109.601 20.7506C109.813 21.593 110 22.703 110 24C110 25.297 109.813 26.407 109.601 27.2494C109.323 28.3513 108.282 29 107.146 29H102V19Z\"\r\n          fill=\"currentCOlor\"\r\n        />\r\n      </g>\r\n      <defs>\r\n        <filter\r\n          id=\"filter0_f_6102_2547\"\r\n          x=\"96\"\r\n          y=\"13\"\r\n          width=\"20\"\r\n          height=\"22\"\r\n          filterUnits=\"userSpaceOnUse\"\r\n          color-interpolation-filters=\"sRGB\"\r\n        >\r\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\r\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\r\n          <feGaussianBlur stdDeviation=\"3\" result=\"effect1_foregroundBlur_6102_2547\" />\r\n        </filter>\r\n        <filter\r\n          id=\"filter1_f_6102_2547\"\r\n          x=\"96\"\r\n          y=\"13\"\r\n          width=\"20\"\r\n          height=\"22\"\r\n          filterUnits=\"userSpaceOnUse\"\r\n          color-interpolation-filters=\"sRGB\"\r\n        >\r\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\r\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\r\n          <feGaussianBlur stdDeviation=\"3\" result=\"effect1_foregroundBlur_6102_2547\" />\r\n        </filter>\r\n        <filter\r\n          id=\"filter2_f_6102_2547\"\r\n          x=\"96\"\r\n          y=\"13\"\r\n          width=\"20\"\r\n          height=\"22\"\r\n          filterUnits=\"userSpaceOnUse\"\r\n          color-interpolation-filters=\"sRGB\"\r\n        >\r\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\r\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\r\n          <feGaussianBlur stdDeviation=\"3\" result=\"effect1_foregroundBlur_6102_2547\" />\r\n        </filter>\r\n        <filter\r\n          id=\"filter3_iiii_6102_2547\"\r\n          x=\"0\"\r\n          y=\"10\"\r\n          width=\"105\"\r\n          height=\"28\"\r\n          filterUnits=\"userSpaceOnUse\"\r\n          color-interpolation-filters=\"sRGB\"\r\n        >\r\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\r\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"5\" />\r\n          <feGaussianBlur stdDeviation=\"3\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2547\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"3\" dy=\"-5\" />\r\n          <feGaussianBlur stdDeviation=\"3\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2547\" result=\"effect2_innerShadow_6102_2547\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"-1\" />\r\n          <feGaussianBlur stdDeviation=\"0.5\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2547\" result=\"effect3_innerShadow_6102_2547\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"1\" />\r\n          <feGaussianBlur stdDeviation=\"0.5\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2547\" result=\"effect4_innerShadow_6102_2547\" />\r\n        </filter>\r\n        <clipPath id=\"clip0_6102_2547\">\r\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\r\n        </clipPath>\r\n      </defs>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function EraserBrush() {\r\n  return (\r\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <g clip-path=\"url(#clip0_6102_2544)\">\r\n        <g filter=\"url(#filter0_i_6102_2544)\">\r\n          <path d=\"M95 15H108C110.209 15 112 16.7909 112 19V29C112 31.2091 110.209 33 108 33H95V15Z\" fill=\"#D9D9D9\" />\r\n          <path d=\"M95 15H108C110.209 15 112 16.7909 112 19V29C112 31.2091 110.209 33 108 33H95V15Z\" fill=\"#F09B99\" />\r\n        </g>\r\n        <g filter=\"url(#filter1_iiii_6102_2544)\">\r\n          <path\r\n            d=\"M0 15H77.6464C77.8728 15 78.0899 14.9101 78.25 14.75V14.75C78.4101 14.5899 78.6272 14.5 78.8536 14.5H96C97.1046 14.5 98 15.3954 98 16.5V31.5C98 32.6046 97.1046 33.5 96 33.5H78.8536C78.6272 33.5 78.4101 33.4101 78.25 33.25V33.25C78.0899 33.0899 77.8728 33 77.6464 33H0V15Z\"\r\n            fill=\"#3E3F3F\"\r\n          />\r\n        </g>\r\n        <path d=\"M79 33.5V14.5H78V33.5H79Z\" fill=\"black\" fill-opacity=\"0.33\" />\r\n      </g>\r\n      <defs>\r\n        <filter\r\n          id=\"filter0_i_6102_2544\"\r\n          x=\"95\"\r\n          y=\"13\"\r\n          width=\"19\"\r\n          height=\"20\"\r\n          filterUnits=\"userSpaceOnUse\"\r\n          color-interpolation-filters=\"sRGB\"\r\n        >\r\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\r\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"2\" dy=\"-2\" />\r\n          <feGaussianBlur stdDeviation=\"2\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.33 0\" />\r\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2544\" />\r\n        </filter>\r\n        <filter\r\n          id=\"filter1_iiii_6102_2544\"\r\n          x=\"0\"\r\n          y=\"9.5\"\r\n          width=\"101\"\r\n          height=\"29\"\r\n          filterUnits=\"userSpaceOnUse\"\r\n          color-interpolation-filters=\"sRGB\"\r\n        >\r\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\r\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"5\" />\r\n          <feGaussianBlur stdDeviation=\"3\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2544\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"3\" dy=\"-5\" />\r\n          <feGaussianBlur stdDeviation=\"3\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2544\" result=\"effect2_innerShadow_6102_2544\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"-1\" />\r\n          <feGaussianBlur stdDeviation=\"0.5\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2544\" result=\"effect3_innerShadow_6102_2544\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"1\" />\r\n          <feGaussianBlur stdDeviation=\"0.5\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2544\" result=\"effect4_innerShadow_6102_2544\" />\r\n        </filter>\r\n        <clipPath id=\"clip0_6102_2544\">\r\n          <rect width=\"20\" height=\"120\" fill=\"white\" transform=\"matrix(0 1 -1 0 120 14)\" />\r\n        </clipPath>\r\n      </defs>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function BlurBrush() {\r\n  return (\r\n    <svg width=\"120\" height=\"48\" viewBox=\"0 0 120 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <g clip-path=\"url(#clip0_6102_2545)\">\r\n        <image href=\"assets/img/media-editor-blurred-color-wheel.png\" x=\"91\" y=\"12\" width=\"26\" height=\"24\" />\r\n        <image href=\"assets/img/media-editor-blurred-color-wheel.png\" x=\"91\" y=\"12\" width=\"26\" height=\"24\" />\r\n        <g filter=\"url(#filter3_iiii_6102_2545)\">\r\n          <path\r\n            d=\"M-2 15H75.441C75.7836 15 76.0968 15.1936 76.25 15.5V15.5C76.4032 15.8064 76.7164 16 77.059 16H92.941C93.2836 16 93.5968 15.8064 93.75 15.5V15.5C93.9032 15.1936 94.2164 15 94.559 15H98C99.1046 15 100 15.8954 100 17V31C100 32.1046 99.1046 33 98 33H94.559C94.2164 33 93.9032 32.8064 93.75 32.5V32.5C93.5968 32.1936 93.2836 32 92.941 32H77.059C76.7164 32 76.4032 32.1936 76.25 32.5V32.5C76.0968 32.8064 75.7836 33 75.441 33H-2V15Z\"\r\n            fill=\"#3E3F3F\"\r\n          />\r\n        </g>\r\n        <mask\r\n          id=\"mask0_6102_2545\"\r\n          style=\"mask-type:alpha\"\r\n          maskUnits=\"userSpaceOnUse\"\r\n          x=\"0\"\r\n          y=\"15\"\r\n          width=\"100\"\r\n          height=\"18\"\r\n        >\r\n          <path\r\n            d=\"M0 15H75.441C75.7836 15 76.0968 15.1936 76.25 15.5V15.5C76.4032 15.8064 76.7164 16 77.059 16H92.941C93.2836 16 93.5968 15.8064 93.75 15.5V15.5C93.9032 15.1936 94.2164 15 94.559 15H98C99.1046 15 100 15.8954 100 17V31C100 32.1046 99.1046 33 98 33H94.559C94.2164 33 93.9032 32.8064 93.75 32.5V32.5C93.5968 32.1936 93.2836 32 92.941 32H77.059C76.7164 32 76.4032 32.1936 76.25 32.5V32.5C76.0968 32.8064 75.7836 33 75.441 33H0V15Z\"\r\n            fill=\"#3E3F3F\"\r\n          />\r\n        </mask>\r\n        <image\r\n          opacity=\"1\"\r\n          href=\"assets/img/media-editor-blurred-color-wheel.png\"\r\n          x=\"91\"\r\n          y=\"12\"\r\n          width=\"26\"\r\n          height=\"24\"\r\n        />\r\n      </g>\r\n      <defs>\r\n        <filter\r\n          id=\"filter3_iiii_6102_2545\"\r\n          x=\"-2\"\r\n          y=\"10\"\r\n          width=\"105\"\r\n          height=\"28\"\r\n          filterUnits=\"userSpaceOnUse\"\r\n          color-interpolation-filters=\"sRGB\"\r\n        >\r\n          <feFlood flood-opacity=\"0\" result=\"BackgroundImageFix\" />\r\n          <feBlend mode=\"normal\" in=\"SourceGraphic\" in2=\"BackgroundImageFix\" result=\"shape\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"5\" />\r\n          <feGaussianBlur stdDeviation=\"3\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"shape\" result=\"effect1_innerShadow_6102_2545\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"3\" dy=\"-5\" />\r\n          <feGaussianBlur stdDeviation=\"3\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.137255 0 0 0 0 0.145098 0 0 0 0 0.14902 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect1_innerShadow_6102_2545\" result=\"effect2_innerShadow_6102_2545\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"-1\" />\r\n          <feGaussianBlur stdDeviation=\"0.5\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect2_innerShadow_6102_2545\" result=\"effect3_innerShadow_6102_2545\" />\r\n          <feColorMatrix\r\n            in=\"SourceAlpha\"\r\n            type=\"matrix\"\r\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\r\n            result=\"hardAlpha\"\r\n          />\r\n          <feOffset dx=\"1\" dy=\"1\" />\r\n          <feGaussianBlur stdDeviation=\"0.5\" />\r\n          <feComposite in2=\"hardAlpha\" operator=\"arithmetic\" k2=\"-1\" k3=\"1\" />\r\n          <feColorMatrix type=\"matrix\" values=\"0 0 0 0 0.242217 0 0 0 0 0.247242 0 0 0 0 0.247101 0 0 0 1 0\" />\r\n          <feBlend mode=\"normal\" in2=\"effect3_innerShadow_6102_2545\" result=\"effect4_innerShadow_6102_2545\" />\r\n        </filter>\r\n        <clipPath id=\"clip0_6102_2545\">\r\n          <rect width=\"120\" height=\"48\" fill=\"white\" />\r\n        </clipPath>\r\n      </defs>\r\n    </svg>\r\n  );\r\n}\r\n","import {createEffect, createMemo, createSignal, on, onCleanup, onMount} from 'solid-js';\r\n\r\nimport {doubleRaf} from '../../helpers/schedulers';\r\nimport {hexToRgb} from '../../helpers/color';\r\nimport _ColorPicker from '../colorPicker';\r\nimport ripple from '../ripple';\r\n\r\nimport {useMediaEditorContext} from './context';\r\nimport {delay} from './utils';\r\n\r\n\r\nexport const colorPickerSwatches = [\r\n  '#ffffff',\r\n  '#fe4438',\r\n  '#ff8901',\r\n  '#ffd60a',\r\n  '#33c759',\r\n  '#62e5e0',\r\n  '#0a84ff',\r\n  '#bd5cf3'\r\n];\r\n\r\nconst PICKER_WIDTH_PX = 200;\r\nconst PICKER_HEIGHT_PX = 120;\r\nconst SLIDER_WIDTH_PX = 304;\r\nconst DEFAULT_SIZE_PX = 384;\r\n\r\n\r\nexport default function ColorPicker(props: {\r\n  value: string;\r\n  onChange: (value: string) => void;\r\n  colorKey?: string; // Just for reaction, not used to access anything\r\n  previousColor?: string;\r\n}) {\r\n  const {actions} = useMediaEditorContext();\r\n\r\n  const [collapsed, setCollapsed] = createSignal(colorPickerSwatches.includes(props.value));\r\n  const [collapsing, setCollapsing] = createSignal(false);\r\n\r\n  const [containerSize, setContainerSize] = createSignal(DEFAULT_SIZE_PX);\r\n\r\n  let sizeContainer: HTMLDivElement;\r\n\r\n  const swatch = (hexColor: string, i: number) => (\r\n    <div\r\n      class=\"media-editor__color-picker-swatch\"\r\n      classList={{'media-editor__color-picker-swatch--active': props.value === hexColor && collapsed()}}\r\n      style={{\r\n        '--color-rgb': hexToRgb(hexColor).join(' '),\r\n        '--i': i\r\n      }}\r\n      onClick={() => props.onChange(hexColor)}\r\n    >\r\n      <div class=\"media-editor__color-picker-swatch-color\" />\r\n    </div>\r\n  );\r\n\r\n  const onCollapseToggle = async() => {\r\n    setCollapsed((prev) => !prev);\r\n    if(collapsed()) {\r\n      setCollapsing(true);\r\n      props.onChange(props.previousColor || colorPickerSwatches[0]);\r\n      await delay(200);\r\n      setCollapsing(false);\r\n    }\r\n  };\r\n\r\n  // let colorPicker: _ColorPicker;\r\n\r\n  const colorPicker = createMemo(\r\n    on(containerSize, () => {\r\n      const colorPicker = new _ColorPicker({\r\n        buildLayout: (parts) => {\r\n          return (\r\n            <div\r\n              class=\"media-editor__color-picker\"\r\n              classList={{'media-editor__color-picker--collapsed': collapsed()}}\r\n              style={{'--picker-height': PICKER_HEIGHT_PX + 'px'}}\r\n            >\r\n              <div class=\"media-editor__color-picker-swatches\">\r\n                {colorPickerSwatches.map(swatch)}\r\n                <div\r\n                  class=\"media-editor__color-picker-swatch media-editor__color-picker-swatch--gradient\"\r\n                  classList={{'media-editor__color-picker-swatch--active': !collapsed()}}\r\n                  onClick={onCollapseToggle}\r\n                >\r\n                  <div class=\"media-editor__color-picker-swatch-color\" />\r\n                </div>\r\n\r\n                <div class=\"media-editor__color-picker-slider\">{parts.slider}</div>\r\n              </div>\r\n\r\n              <div class=\"media-editor__color-picker-layout-wrapper\">\r\n                <div class=\"media-editor__color-picker-layout\">\r\n                  <div class=\"media-editor__color-picker-box\">{parts.pickerBox}</div>\r\n                  <div class=\"media-editor__color-picker-inputs\">\r\n                    {parts.hexInput}\r\n                    {parts.rgbInput}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) as HTMLDivElement;\r\n        },\r\n        pickerBoxWidth: PICKER_WIDTH_PX + containerSize() - DEFAULT_SIZE_PX,\r\n        pickerBoxHeight: PICKER_HEIGHT_PX,\r\n        sliderWidth: SLIDER_WIDTH_PX + containerSize() - DEFAULT_SIZE_PX,\r\n        thickSlider: true\r\n      });\r\n      colorPicker.onChange = (color) => {\r\n        if(color.hex !== props.value) props.onChange(color.hex);\r\n        actions.abortDrawerSlide();\r\n      };\r\n      colorPicker.container.querySelectorAll('.media-editor__color-picker-swatch').forEach((element) => {\r\n        ripple(element as HTMLElement);\r\n      });\r\n\r\n      return colorPicker;\r\n    })\r\n  );\r\n\r\n  onMount(() => {\r\n    setContainerSize(sizeContainer.clientWidth);\r\n\r\n    const observer = new ResizeObserver(() => {\r\n      setContainerSize(sizeContainer.clientWidth);\r\n    });\r\n\r\n    observer.observe(sizeContainer);\r\n\r\n    onCleanup(() => {\r\n      observer.disconnect();\r\n    });\r\n  });\r\n\r\n  createEffect(\r\n    on(\r\n      () => props.colorKey,\r\n      async() => {\r\n        await delay(0);\r\n        const newCollapsed = colorPickerSwatches.includes(props.value);\r\n        if(newCollapsed !== collapsed()) {\r\n          setCollapsed(newCollapsed);\r\n          if(newCollapsed) {\r\n            setCollapsing(true);\r\n            delay(200).then(() => setCollapsing(false));\r\n          }\r\n        }\r\n      }\r\n    )\r\n  );\r\n\r\n  createEffect(\r\n    on(\r\n      () => [collapsing(), colorPicker(), props.value],\r\n      async() => {\r\n        await doubleRaf();\r\n        if(!collapsing() && props.value !== colorPicker().getCurrentColor().hex) {\r\n          colorPicker().setColor(props.value);\r\n        }\r\n      }\r\n    )\r\n  );\r\n\r\n  return <div ref={sizeContainer}>{colorPicker().container}</div>;\r\n}\r\n","import {createSignal} from 'solid-js';\r\n\r\nimport {colorPickerSwatches} from './colorPicker';\r\n\r\nexport function createStoredColor(key: string, defaultColor: string) {\r\n  // (1 - use swatch, 2 - use picker color), (color from swatch), (color from picker)\r\n  type SavedColor = [1 | 2, string, string];\r\n\r\n  const [savedColor, setSavedColor] = createSignal<SavedColor>(\r\n    (() => {\r\n      const fallback = () => {\r\n        const value = [colorPickerSwatches.includes(defaultColor) ? 1 : 2, defaultColor, defaultColor] as SavedColor;\r\n        localStorage.setItem(key, JSON.stringify(value));\r\n        return value;\r\n      };\r\n      try {\r\n        const value: SavedColor = JSON.parse(localStorage.getItem(key));\r\n        if(\r\n          !(value instanceof Array) ||\r\n          typeof value[0] !== 'number' ||\r\n          typeof value[1] !== 'string' ||\r\n          typeof value[2] !== 'string'\r\n        ) {\r\n          return fallback();\r\n        }\r\n        return value;\r\n      } catch{}\r\n      return fallback();\r\n    })()\r\n  );\r\n\r\n  function setColor(color: string) {\r\n    let value: SavedColor;\r\n    if(colorPickerSwatches.includes(color)) {\r\n      value = [1, color, color];\r\n    } else {\r\n      value = [2, savedColor()[1], color];\r\n    }\r\n    setSavedColor(value);\r\n    localStorage.setItem(key, JSON.stringify(value));\r\n  }\r\n\r\n  return [\r\n    () => ({\r\n      value: savedColor()[savedColor()[0]],\r\n      previous: savedColor()[1]\r\n    }),\r\n    setColor\r\n  ] as const;\r\n}\r\n","import {JSX, onMount} from 'solid-js';\r\n\r\nimport ripple from '../ripple';\r\n\r\nexport type MediaEditorLargeButtonProps = JSX.HTMLAttributes<HTMLDivElement> & {\r\n  active?: boolean;\r\n};\r\n\r\nexport default function LargeButton(props: MediaEditorLargeButtonProps) {\r\n  let element: HTMLDivElement;\r\n\r\n  onMount(() => {\r\n    ripple(element);\r\n  });\r\n\r\n  return (\r\n    <div\r\n      {...props}\r\n      ref={element}\r\n      class=\"media-editor__large-button\"\r\n      classList={{\r\n        'media-editor__large-button--active': props.active,\r\n        [props.class]: !!props.class\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import {createEffect, JSX} from 'solid-js';\r\n\r\nimport {i18n} from '../../../lib/langPack';\r\n\r\nimport Space from '../../space';\r\n\r\nimport {ArrowBrush, BlurBrush, EraserBrush, MarkerBrush, NeonBrush, PenBrush} from '../brushesSvg';\r\nimport {createStoredColor} from '../createStoredColor';\r\nimport {useMediaEditorContext} from '../context';\r\nimport ColorPicker from '../colorPicker';\r\nimport LargeButton from '../largeButton';\r\nimport RangeInput from '../rangeInput';\r\n\r\nexport default function BrushTab() {\r\n  const {editorState, mediaType} = useMediaEditorContext();\r\n\r\n  const savedBrushColors = {\r\n    pen: createStoredColor('media-editor-pen-color', '#fe4438'),\r\n    arrow: createStoredColor('media-editor-arrow-color', '#ffd60a'),\r\n    brush: createStoredColor('media-editor-brush-color', '#ff8901'),\r\n    neon: createStoredColor('media-editor-neon-color', '#62e5e0')\r\n  };\r\n\r\n  function savedBrushSignal(brush: string) {\r\n    return savedBrushColors[brush as keyof typeof savedBrushColors];\r\n  }\r\n\r\n  function updateCurrentBrush() {\r\n    const [savedColor] = savedBrushSignal(editorState.currentBrush.brush) || [];\r\n    if(!savedColor || editorState.currentBrush.color === savedColor().value) return;\r\n\r\n    editorState.currentBrush.color = savedColor().value;\r\n  }\r\n\r\n  updateCurrentBrush(); // Change the brush before the ColorPicker is rendered\r\n  createEffect(() => {\r\n    updateCurrentBrush();\r\n  });\r\n\r\n  function setColor(color: string) {\r\n    const brush = editorState.currentBrush.brush;\r\n    const [, setSavedColor] = savedBrushSignal(brush) || [];\r\n    setSavedColor?.(color);\r\n  }\r\n\r\n  const brushButton = (text: JSX.Element, brushSvg: JSX.Element, brush: string) => (\r\n    <LargeButton\r\n      active={editorState.currentBrush.brush === brush}\r\n      onClick={() => void (editorState.currentBrush.brush = brush)}\r\n      class={`media-editor__brush-button`}\r\n    >\r\n      <div\r\n        class=\"media-editor__brush-button-svg-wrapper\"\r\n        style={{\r\n          color: savedBrushSignal(brush)?.[0]().value\r\n        }}\r\n      >\r\n        {brushSvg}\r\n      </div>\r\n      {text}\r\n    </LargeButton>\r\n  );\r\n\r\n  const hasColor = () => editorState.currentBrush.brush in savedBrushColors;\r\n\r\n  let timeoutId = 0;\r\n  function removeSizePreview() {\r\n    window.clearTimeout(timeoutId);\r\n    timeoutId = window.setTimeout(() => {\r\n      editorState.previewBrushSize = undefined;\r\n    }, 1000);\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div\r\n        style={{\r\n          transition: 'opacity .2s',\r\n          ...(!hasColor() ?\r\n            {\r\n              'opacity': 0.25,\r\n              'pointer-events': 'none'\r\n            } :\r\n            undefined\r\n          )\r\n        }\r\n        }\r\n      >\r\n        <ColorPicker\r\n          value={editorState.currentBrush.color}\r\n          onChange={setColor}\r\n          colorKey={editorState.currentBrush.brush}\r\n          previousColor={savedBrushSignal(editorState.currentBrush.brush)?.[0]().previous}\r\n        />\r\n      </div>\r\n      <Space amount=\"16px\" />\r\n      <RangeInput\r\n        label={i18n('MediaEditor.Size')}\r\n        min={2}\r\n        max={32}\r\n        value={editorState.currentBrush.size}\r\n        onChange={(size) => {\r\n          editorState.currentBrush.size = size;\r\n          editorState.previewBrushSize = size;\r\n          removeSizePreview();\r\n        }}\r\n        onChangeFinish={() => {\r\n          editorState.previewBrushSize = undefined;\r\n        }}\r\n        passiveLabel\r\n        color={hasColor() ? editorState.currentBrush.color : undefined}\r\n      />\r\n      <Space amount=\"16px\" />\r\n      <div class=\"media-editor__label\">{i18n('MediaEditor.Tool')}</div>\r\n      {brushButton(i18n('MediaEditor.Brushes.Pen'), <PenBrush />, 'pen')}\r\n      {brushButton(i18n('MediaEditor.Brushes.Arrow'), <ArrowBrush />, 'arrow')}\r\n      {brushButton(i18n('MediaEditor.Brushes.Brush'), <MarkerBrush />, 'brush')}\r\n      {brushButton(i18n('MediaEditor.Brushes.Neon'), <NeonBrush />, 'neon')}\r\n      {mediaType === 'image' && brushButton(i18n('MediaEditor.Brushes.Blur'), <BlurBrush />, 'blur')}\r\n      {brushButton(i18n('MediaEditor.Brushes.Eraser'), <EraserBrush />, 'eraser')}\r\n    </>\r\n  );\r\n}\r\n","import {JSX, splitProps} from 'solid-js';\r\n\r\nimport {i18n} from '../../../lib/langPack';\r\nimport {IconTsx} from '../../iconTsx';\r\n\r\nimport {animateToNewRotationOrRatio} from '../canvas/animateToNewRotationOrRatio';\r\nimport LargeButton, {MediaEditorLargeButtonProps} from '../largeButton';\r\nimport {useMediaEditorContext} from '../context';\r\nimport {withCurrentOwner} from '../utils';\r\n\r\nconst ratioRects = {\r\n  '1x1': () => <rect x=\"4\" y=\"4\" width=\"16\" height=\"16\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\r\n  '3x2': () => <rect x=\"3\" y=\"6\" width=\"18\" height=\"12\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\r\n  '4x3': () => <rect x=\"3\" y=\"5\" width=\"18\" height=\"14\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\r\n  '5x4': () => <rect x=\"3\" y=\"4.5\" width=\"18\" height=\"15\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\r\n  '7x5': () => <rect x=\"3\" y=\"4\" width=\"18\" height=\"16\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />,\r\n  '16x9': () => <rect x=\"2.5\" y=\"6.5\" width=\"19\" height=\"11\" rx=\"2\" stroke=\"white\" stroke-width=\"1.66\" />\r\n};\r\n\r\nconst ratioIcon = (ratio: keyof typeof ratioRects, rotated?: boolean) => (\r\n  <svg\r\n    classList={{'media-editor__crop-item-icon--rotated': rotated}}\r\n    width=\"24\"\r\n    height=\"24\"\r\n    viewBox=\"0 0 24 24\"\r\n    fill=\"none\"\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n  >\r\n    {ratioRects[ratio]()}\r\n  </svg>\r\n);\r\n\r\nfunction Item(\r\n  inProps: MediaEditorLargeButtonProps & {\r\n    icon: JSX.Element;\r\n    text: JSX.Element;\r\n  }\r\n) {\r\n  const [props, buttonProps] = splitProps(inProps, ['icon', 'text']);\r\n\r\n  return (\r\n    <LargeButton {...buttonProps} class=\"media-editor__crop-item\">\r\n      {props.icon}\r\n      {props.text}\r\n    </LargeButton>\r\n  );\r\n}\r\n\r\nexport default function CropTab() {\r\n  const {editorState, mediaState, actions} = useMediaEditorContext();\r\n\r\n  const isActive = (what?: string) => editorState.fixedImageRatioKey === what;\r\n\r\n  const onRatioClick = withCurrentOwner((ratio?: string) => {\r\n    editorState.fixedImageRatioKey = ratio;\r\n    animateToNewRotationOrRatio(mediaState.rotation);\r\n    actions.resetRotationWheel();\r\n  });\r\n\r\n  return (\r\n    <>\r\n      <div class=\"media-editor__label\">{i18n('MediaEditor.AspectRatio')}</div>\r\n\r\n      <Item\r\n        icon={<IconTsx icon=\"free_transform\" />}\r\n        text={i18n('MediaEditor.Free')}\r\n        active={isActive()}\r\n        onClick={() => onRatioClick()}\r\n      />\r\n      <Item\r\n        icon={<IconTsx icon=\"image_original\" />}\r\n        text={i18n('MediaEditor.Original')}\r\n        active={isActive('original')}\r\n        onClick={() => onRatioClick('original')}\r\n      />\r\n      <Item\r\n        icon={ratioIcon('1x1')}\r\n        text={i18n('MediaEditor.Square')}\r\n        active={isActive('1x1')}\r\n        onClick={() => onRatioClick('1x1')}\r\n      />\r\n\r\n      <div class=\"media-editor__crop-grid\">\r\n        <Item icon={ratioIcon('3x2')} text=\"3:2\" active={isActive('3x2')} onClick={() => onRatioClick('3x2')} />\r\n        <Item icon={ratioIcon('3x2', true)} text=\"2:3\" active={isActive('2x3')} onClick={() => onRatioClick('2x3')} />\r\n\r\n        <Item icon={ratioIcon('4x3')} text=\"4:3\" active={isActive('4x3')} onClick={() => onRatioClick('4x3')} />\r\n        <Item icon={ratioIcon('4x3', true)} text=\"3:4\" active={isActive('3x4')} onClick={() => onRatioClick('3x4')} />\r\n\r\n        <Item icon={ratioIcon('5x4')} text=\"5:4\" active={isActive('5x4')} onClick={() => onRatioClick('5x4')} />\r\n        <Item icon={ratioIcon('5x4', true)} text=\"4:5\" active={isActive('4x5')} onClick={() => onRatioClick('4x5')} />\r\n\r\n        <Item icon={ratioIcon('7x5')} text=\"7:5\" active={isActive('7x5')} onClick={() => onRatioClick('7x5')} />\r\n        <Item icon={ratioIcon('7x5', true)} text=\"5:7\" active={isActive('5x7')} onClick={() => onRatioClick('5x7')} />\r\n\r\n        <Item icon={ratioIcon('16x9')} text=\"16:9\" active={isActive('16x9')} onClick={() => onRatioClick('16x9')} />\r\n        <Item\r\n          icon={ratioIcon('16x9', true)}\r\n          text=\"9:16\"\r\n          active={isActive('9x16')}\r\n          onClick={() => onRatioClick('9x16')}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import {onMount, Accessor, JSX, createEffect, untrack} from 'solid-js';\r\n\r\nimport {i18n} from '../../../lib/langPack';\r\n\r\nimport ripple from '../../ripple';\r\nimport {IconTsx} from '../../iconTsx';\r\nimport Space from '../../space';\r\n\r\nimport {createStoredColor} from '../createStoredColor';\r\nimport {useMediaEditorContext} from '../context';\r\nimport ColorPicker from '../colorPicker';\r\nimport LargeButton from '../largeButton';\r\nimport RangeInput from '../rangeInput';\r\nimport {fontInfoMap} from '../utils';\r\nimport {FontKey} from '../types';\r\n\r\nexport default function TextTab() {\r\n  const {editorState} = useMediaEditorContext();\r\n\r\n  const [savedColor, setSavedColor] = createStoredColor('media-editor-text-color', '#ffffff');\r\n\r\n  editorState.currentTextLayerInfo.color = savedColor().value;\r\n  createEffect(() => {\r\n    untrack(() => editorState.currentTextLayerInfo).color = savedColor().value;\r\n  });\r\n\r\n\r\n  function setSize(value: number) {\r\n    editorState.currentTextLayerInfo.size = value;\r\n  }\r\n  function setAlignment(value: string) {\r\n    editorState.currentTextLayerInfo.alignment = value;\r\n  }\r\n  function setStyle(value: string) {\r\n    editorState.currentTextLayerInfo.style = value;\r\n  }\r\n\r\n  const toggleButton = (\r\n    icon: Icon,\r\n    value: string,\r\n    currentValue: Accessor<string>,\r\n    setValue: (value: string) => void\r\n  ) => (\r\n    <div\r\n      class=\"media-editor__toggle-button\"\r\n      classList={{'media-editor__toggle-button--active': value === currentValue()}}\r\n      onClick={() => setValue(value)}\r\n    >\r\n      <IconTsx icon={icon} />\r\n    </div>\r\n  );\r\n\r\n  onMount(() => {\r\n    document.querySelectorAll('.media-editor__toggle-button').forEach((element) => {\r\n      ripple(element as HTMLElement);\r\n    });\r\n  });\r\n\r\n  const fontButton = (text: JSX.Element, textFont: FontKey) => (\r\n    <LargeButton\r\n      active={editorState.currentTextLayerInfo.font === textFont}\r\n      onClick={() => void (editorState.currentTextLayerInfo.font = textFont)}\r\n      style={{\r\n        'font-family': fontInfoMap[textFont].fontFamily,\r\n        'font-weight': fontInfoMap[textFont].fontWeight\r\n      }}\r\n    >\r\n      {text}\r\n    </LargeButton>\r\n  );\r\n\r\n  return (\r\n    <>\r\n      <ColorPicker\r\n        value={editorState.currentTextLayerInfo.color}\r\n        onChange={setSavedColor}\r\n        previousColor={savedColor().previous}\r\n        colorKey={(editorState.selectedResizableLayer ?? '') + ''}\r\n      />\r\n\r\n      <div class=\"media-editor__toggle-group-row\">\r\n        <div class=\"media-editor__toggle-group\">\r\n          {toggleButton('align_left', 'left', () => editorState.currentTextLayerInfo.alignment, setAlignment)}\r\n          {toggleButton('align_center', 'center', () => editorState.currentTextLayerInfo.alignment, setAlignment)}\r\n          {toggleButton('align_right', 'right', () => editorState.currentTextLayerInfo.alignment, setAlignment)}\r\n        </div>\r\n\r\n        <div class=\"media-editor__toggle-group\">\r\n          {toggleButton('fontframe', 'normal', () => editorState.currentTextLayerInfo.style, setStyle)}\r\n          {toggleButton('fontframe_outline', 'outline', () => editorState.currentTextLayerInfo.style, setStyle)}\r\n          {toggleButton('fontframe_bg', 'background', () => editorState.currentTextLayerInfo.style, setStyle)}\r\n        </div>\r\n      </div>\r\n\r\n      <RangeInput\r\n        label={i18n('MediaEditor.Size')}\r\n        min={16}\r\n        max={64}\r\n        value={editorState.currentTextLayerInfo.size}\r\n        onChange={setSize}\r\n        passiveLabel\r\n        color={editorState.currentTextLayerInfo.color}\r\n      />\r\n\r\n      <Space amount=\"16px\" />\r\n\r\n      <div class=\"media-editor__label\">{i18n('MediaEditor.Font')}</div>\r\n\r\n      {fontButton(i18n('MediaEditor.Fonts.Roboto'), 'roboto')}\r\n      {fontButton(i18n('MediaEditor.Fonts.SuezOne'), 'suez')}\r\n      {fontButton(i18n('MediaEditor.Fonts.FugazOne'), 'fugaz')}\r\n      {fontButton(i18n('MediaEditor.Fonts.CourierPrime'), 'courier')}\r\n      {fontButton(i18n('MediaEditor.Fonts.Chewy'), 'chewy')}\r\n      {fontButton(i18n('MediaEditor.Fonts.Sedan'), 'sedan')}\r\n      {fontButton(i18n('MediaEditor.Fonts.RubikBubbles'), 'bubbles')}\r\n      {fontButton(i18n('MediaEditor.Fonts.Playwrite'), 'playwrite')}\r\n    </>\r\n  );\r\n}\r\n","import {batch, onCleanup, onMount} from 'solid-js';\r\n\r\nimport {addShortcutListener} from '../../helpers/shortcutListener';\r\nimport {i18n} from '../../lib/langPack';\r\nimport {ButtonIconTsx} from '../buttonIconTsx';\r\nimport ripple from '../ripple';\r\n\r\nimport {HistoryItem, useMediaEditorContext} from './context';\r\nimport {processHistoryItem} from './utils';\r\n\r\nexport default function Topbar(props: {onClose: () => void; onFinish: () => void}) {\r\n  const {hasModifications, mediaState, editorState} = useMediaEditorContext();\r\n\r\n  let doneButton: HTMLDivElement;\r\n\r\n\r\n  function processHistory(history: HistoryItem[], otherHistory: HistoryItem[]) {\r\n    batch(() => {\r\n      const item = history.pop();\r\n      if(!item) return;\r\n\r\n      otherHistory.push({\r\n        ...item,\r\n        path: item.path,\r\n        newValue: item.oldValue,\r\n        oldValue: item.newValue\r\n      });\r\n\r\n      processHistoryItem(item, mediaState);\r\n\r\n      editorState.selectedResizableLayer = undefined;\r\n    });\r\n  }\r\n\r\n  function onUndo() {\r\n    processHistory(mediaState.history, mediaState.redoHistory);\r\n  }\r\n\r\n  function onRedo() {\r\n    processHistory(mediaState.redoHistory, mediaState.history);\r\n  }\r\n\r\n  onMount(() => {\r\n    ripple(doneButton);\r\n\r\n    const removeListener = addShortcutListener(['Ctrl+KeyZ', 'Ctrl+Shift+KeyZ', 'Ctrl+KeyY'], (combo) => {\r\n      if(combo === 'Ctrl+KeyZ') {\r\n        onUndo();\r\n      } else {\r\n        onRedo();\r\n      }\r\n    });\r\n\r\n    onCleanup(() => removeListener());\r\n  });\r\n\r\n  return (\r\n    <div class=\"media-editor__topbar\">\r\n      <ButtonIconTsx icon=\"cross\" onClick={props.onClose} />\r\n      <div class=\"media-editor__topbar-title\">{i18n('Edit')}</div>\r\n      <div class=\"media-editor__topbar-history-controls\">\r\n        <ButtonIconTsx disabled={!mediaState.history.length} onClick={onUndo} icon=\"undo\" />\r\n        <ButtonIconTsx disabled={!mediaState.redoHistory.length} onClick={onRedo} icon=\"redo\" />\r\n      </div>\r\n      <div\r\n        ref={doneButton}\r\n        class=\"media-editor__topbar-done\"\r\n        classList={{\r\n          'media-editor__topbar-done--disabled': !hasModifications()\r\n        }}\r\n        onClick={() => {\r\n          if(hasModifications()) props.onFinish();\r\n        }}\r\n      >\r\n        {i18n('Done')}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import {batch, createEffect, createMemo, createSignal, JSX, on, onCleanup, onMount} from 'solid-js';\r\n\r\nimport {doubleRaf} from '../../helpers/schedulers';\r\n\r\nimport AdjustmentsTab from './tabs/adjustmentsTab';\r\nimport {animateValue, delay, lerp} from './utils';\r\nimport {useMediaEditorContext} from './context';\r\nimport StickersTab from './tabs/stickersTab';\r\nimport TabContent from './tabs/tabContent';\r\nimport useIsMobile from './useIsMobile';\r\nimport BrushTab from './tabs/brushTab';\r\nimport CropTab from './tabs/cropTab';\r\nimport TextTab from './tabs/textTab';\r\nimport Tabs from './tabs/tabs';\r\nimport Topbar from './topbar';\r\n\r\n\r\nexport default function Toolbar(props: {onFinish: () => void; onClose: () => void}) {\r\n  let toolbar: HTMLDivElement;\r\n\r\n  const {editorState, actions} = useMediaEditorContext();\r\n\r\n  const [move, setMove] = createSignal(0);\r\n  const [isCollapsed, setIsCollapsed] = createSignal(false);\r\n  const [container, setContainer] = createSignal<HTMLDivElement>();\r\n  const [containerHeight, setContainerHeight] = createSignal(0);\r\n  const [extraMove, setExtraMove] = createSignal(0);\r\n\r\n  const isMobile = useIsMobile();\r\n\r\n  const [shouldHide, setShouldHide] = createSignal(isMobile());\r\n\r\n  let startY = 0;\r\n  let isAborted = true;\r\n  let isResetting = false;\r\n  let canMove = false;\r\n\r\n  function resetMove() {\r\n    if(isResetting) return;\r\n    isResetting = true;\r\n\r\n    startY = 0;\r\n    isAborted = true;\r\n    animateValue(move(), 0, 200, setMove);\r\n    setTimeout(() => {\r\n      isResetting = false;\r\n    }, 200);\r\n  }\r\n  actions.abortDrawerSlide = () => resetMove();\r\n\r\n  onMount(() => {\r\n    function startDrag(y: number) {\r\n      if(!isMobile()) return;\r\n      startY = y;\r\n      isAborted = false;\r\n      canMove = false;\r\n      setTimeout(() => {\r\n        canMove = true;\r\n      }, 100); // wait for scroll to trigger first\r\n    }\r\n    function dragMove(y: number) {\r\n      if(!isMobile()) return;\r\n      if(isAborted) return;\r\n      if(!canMove) return;\r\n      const diff = y - startY;\r\n      if(isCollapsed()) setMove(Math.min(Math.max(-containerHeight(), diff), 0));\r\n      else setMove(Math.max(Math.min(containerHeight(), diff), 0));\r\n    }\r\n    function dragEnd() {\r\n      if(!isMobile()) return;\r\n      if(isAborted) return;\r\n      isAborted = true;\r\n      if(Math.abs(move()) > 100) {\r\n        setIsCollapsed((prev) => !prev);\r\n      } else {\r\n        resetMove();\r\n      }\r\n    }\r\n\r\n    container().addEventListener('input', () => {\r\n      resetMove();\r\n    });\r\n\r\n    toolbar.addEventListener('touchstart', (e) => {\r\n      startDrag(e.touches[0].clientY);\r\n    });\r\n    toolbar.addEventListener('touchmove', (e) => {\r\n      dragMove(e.touches[0].clientY);\r\n    });\r\n    toolbar.addEventListener('touchend', (e) => {\r\n      dragEnd();\r\n    });\r\n    toolbar.addEventListener('mousedown', (e) => {\r\n      startDrag(e.clientY);\r\n    });\r\n    toolbar.addEventListener('mousemove', (e) => {\r\n      dragMove(e.clientY);\r\n    });\r\n    toolbar.addEventListener('mouseup', (e) => {\r\n      dragEnd();\r\n    });\r\n    toolbar.addEventListener('mouseout', (e) => {\r\n      dragEnd();\r\n    });\r\n  });\r\n\r\n  createEffect(() => {\r\n    const observer = new ResizeObserver(() => {\r\n      setContainerHeight(container()?.clientHeight || 0);\r\n    });\r\n    observer.observe(container());\r\n    onCleanup(() => observer.disconnect());\r\n  });\r\n\r\n  createEffect(\r\n    on(isCollapsed, () => {\r\n      const initialMove = move();\r\n      const initialExtraMove = extraMove();\r\n      const targetExtraMove = isCollapsed() ? containerHeight() : 0;\r\n      animateValue(0, 1, 200, (progress) => {\r\n        batch(() => {\r\n          setMove(lerp(initialMove, 0, progress));\r\n          setExtraMove(lerp(initialExtraMove, targetExtraMove, progress));\r\n        });\r\n      });\r\n    })\r\n  );\r\n\r\n  createEffect(() => {\r\n    if(editorState.currentTab !== 'crop') setIsCollapsed(false);\r\n  });\r\n\r\n  createEffect(() => {\r\n    if(editorState.renderingPayload && shouldHide()) {\r\n      (async() => {\r\n        toolbar.style.transition = '.2s';\r\n        await doubleRaf();\r\n        setShouldHide(false);\r\n        await delay(200);\r\n        toolbar.style.removeProperty('transition');\r\n      })();\r\n    }\r\n  });\r\n\r\n  const totalMove = () => extraMove() + move();\r\n\r\n  const style = createMemo((): JSX.CSSProperties => {\r\n    if(isMobile()) return {\r\n      'opacity': editorState.isAdjusting ? 0 : 1,\r\n      'transform': shouldHide() ?\r\n        'translate(-50%, 100%)' :\r\n        `translate(-50%, ${totalMove()}px)`\r\n    };\r\n  });\r\n\r\n  return (\r\n    <div\r\n      ref={toolbar}\r\n      class=\"media-editor__toolbar\"\r\n      style={style()}\r\n    >\r\n      <div class=\"media-editor__toolbar-draggable\" />\r\n      <Topbar onClose={() => props.onClose()} onFinish={props.onFinish} />\r\n      <Tabs />\r\n      <TabContent\r\n        onContainer={setContainer}\r\n        onScroll={() => {\r\n          resetMove();\r\n        }}\r\n        tabs={{\r\n          adjustments: () => <AdjustmentsTab />,\r\n          crop: () => <CropTab />,\r\n          text: () => <TextTab />,\r\n          brush: () => <BrushTab />,\r\n          stickers: () => <StickersTab />\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import {createEffect, onCleanup, onMount} from 'solid-js';\r\nimport {render} from 'solid-js/web';\r\n\r\nimport {doubleRaf} from '../../helpers/schedulers';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport {i18n} from '../../lib/langPack';\r\nimport type SolidJSHotReloadGuardProvider from '../../lib/solidjs/hotReloadGuardProvider';\r\n\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport confirmationPopup from '../confirmationPopup';\r\n\r\nimport MainCanvas from './canvas/mainCanvas';\r\nimport MediaEditorContext, {createContextValue, EditingMediaState} from './context';\r\nimport {createFinalResult, MediaEditorFinalResult} from './finalRender/createFinalResult';\r\nimport FinishButton from './finishButton';\r\nimport Toolbar from './toolbar';\r\nimport {MediaType, NumberPair} from './types';\r\nimport {delay, withCurrentOwner} from './utils';\r\n\r\nimport './mediaEditor.scss';\r\n\r\n\r\nexport type MediaEditorProps = {\r\n  onClose: (hasGif: boolean) => void;\r\n  managers: AppManagers;\r\n  onEditFinish: (result: MediaEditorFinalResult) => void;\r\n  onCanvasReady: (canvas: HTMLCanvasElement) => Promise<void>;\r\n  onImageRendered: () => void;\r\n  mediaSrc: string;\r\n  mediaType: MediaType;\r\n  mediaBlob: Blob;\r\n  mediaSize: NumberPair;\r\n  editingMediaState?: EditingMediaState\r\n};\r\n\r\nexport function MediaEditor(props: MediaEditorProps) {\r\n  const contextValue = createContextValue(props);\r\n\r\n  const {editorState, hasModifications} = contextValue;\r\n\r\n  let overlay: HTMLDivElement;\r\n\r\n  onMount(() => {\r\n    (async() => {\r\n      overlay.classList.add('media-editor__overlay--hidden');\r\n      await doubleRaf();\r\n      overlay.classList.remove('media-editor__overlay--hidden');\r\n    })();\r\n\r\n    const navigationItem: NavigationItem = {\r\n      type: 'popup',\r\n      onPop: () => handleClose()\r\n    };\r\n    appNavigationController.pushItem(navigationItem);\r\n\r\n    overlay.focus();\r\n\r\n    onCleanup(() => {\r\n      appNavigationController.removeItem(navigationItem);\r\n    });\r\n  });\r\n\r\n  createEffect(() => {\r\n    if(!editorState.imageCanvas) return;\r\n\r\n    (async() =>{\r\n      await props.onCanvasReady(editorState.imageCanvas);\r\n      editorState.isReady = true;\r\n    })();\r\n  });\r\n\r\n  createEffect(() => {\r\n    if(!editorState.renderingPayload) return;\r\n    props.onImageRendered();\r\n  });\r\n\r\n  async function performClose(hasGif = false) {\r\n    overlay.classList.add('media-editor__overlay--hidden');\r\n    await delay(200);\r\n    props.onClose(hasGif);\r\n  }\r\n\r\n  function handleClose(finished = false, hasGif = false) {\r\n    if(finished || !hasModifications()) {\r\n      performClose(hasGif);\r\n      return;\r\n    }\r\n\r\n    confirmationPopup({\r\n      title: i18n('MediaEditor.DiscardChanges'),\r\n      description: i18n('MediaEditor.DiscardWarning'),\r\n      button: {\r\n        text: i18n('Discard')\r\n      }\r\n    }).then(() => performClose(), () => {});\r\n\r\n    return false;\r\n  }\r\n\r\n  let isFinishing = false;\r\n\r\n  return (\r\n    <MediaEditorContext.Provider value={contextValue}>\r\n      <div ref={overlay} class=\"media-editor__overlay night\">\r\n        <div class=\"media-editor__container\">\r\n          {(() => {\r\n            // Need to be inside context\r\n            const handleFinish = withCurrentOwner(async() => {\r\n              if(isFinishing) return;\r\n              isFinishing = true;\r\n\r\n              const result = await createFinalResult()\r\n              .finally(() => { isFinishing = false; });\r\n\r\n              props.onEditFinish(result);\r\n              handleClose(true, result.isVideo);\r\n            });\r\n\r\n            return (\r\n              <>\r\n                <MainCanvas />\r\n                <Toolbar onClose={handleClose} onFinish={handleFinish} />\r\n                <FinishButton onClick={handleFinish} />\r\n              </>\r\n            );\r\n          })()}\r\n        </div>\r\n      </div>\r\n    </MediaEditorContext.Provider>\r\n  );\r\n}\r\n\r\nexport function openMediaEditor(props: MediaEditorProps, HotReloadGuardProvider: typeof SolidJSHotReloadGuardProvider) {\r\n  const element = document.createElement('div');\r\n  document.body.append(element);\r\n\r\n  const dispose = render(() => (\r\n    <HotReloadGuardProvider>\r\n      <MediaEditor {...props} onClose={onClose} />\r\n    </HotReloadGuardProvider>\r\n  ), element);\r\n\r\n  function onClose(hasGif: boolean) {\r\n    props.onClose(hasGif);\r\n    dispose();\r\n    element.remove();\r\n  }\r\n}\r\n","import deferredPromise from '../../helpers/cancellablePromise';\r\nimport {doubleRaf} from '../../helpers/schedulers';\r\nimport type {AppManagers} from '../../lib/appManagers/managers';\r\nimport SolidJSHotReloadGuardProvider from '../../lib/solidjs/hotReloadGuardProvider';\r\nimport {EditingMediaState} from './context';\r\nimport {MediaEditorFinalResult} from './finalRender/createFinalResult';\r\nimport {openMediaEditor} from './mediaEditor';\r\nimport {MediaType, NumberPair} from './types';\r\nimport {animateValue, delay, lerp, snapToViewport} from './utils';\r\n\r\n\r\ntype Args = {\r\n  source: CanvasImageSource;\r\n  element: HTMLElement;\r\n  managers: AppManagers;\r\n\r\n  mediaType: MediaType;\r\n  mediaSrc: string;\r\n  mediaBlob: Blob;\r\n  mediaSize: NumberPair;\r\n\r\n  size: NumberPair;\r\n\r\n  editingMediaState: EditingMediaState;\r\n  onEditFinish: (result: MediaEditorFinalResult) => void;\r\n  onClose: (hasGif: boolean) => void;\r\n};\r\n\r\nexport function openMediaEditorFromMedia({\r\n  source,\r\n  element,\r\n  managers,\r\n  mediaType,\r\n  mediaSrc,\r\n  mediaBlob,\r\n  mediaSize,\r\n  size,\r\n  editingMediaState,\r\n  onEditFinish,\r\n  onClose\r\n}: Args) {\r\n  const animatedCanvas = document.createElement('canvas');\r\n  const [sourceWidth, sourceHeight] = [animatedCanvas.width, animatedCanvas.height] = size;\r\n\r\n  const ctx = animatedCanvas.getContext('2d');\r\n  ctx.drawImage(source, 0, 0, animatedCanvas.width, animatedCanvas.height);\r\n\r\n  const bcr = element.getBoundingClientRect();\r\n  animatedCanvas.style.position = 'fixed';\r\n\r\n  const left = bcr.left + bcr.width / 2, top = bcr.top + bcr.height / 2, width = bcr.width, height = bcr.height;\r\n\r\n  animatedCanvas.style.left = left + 'px';\r\n  animatedCanvas.style.top = top + 'px';\r\n  animatedCanvas.style.width = width + 'px';\r\n  animatedCanvas.style.height = height + 'px';\r\n  animatedCanvas.style.transform = 'translate(-50%, -50%)';\r\n  animatedCanvas.style.objectFit = 'cover';\r\n  animatedCanvas.style.zIndex = '1000';\r\n\r\n  document.body.append(animatedCanvas);\r\n\r\n  openMediaEditor({\r\n    mediaType,\r\n    mediaSrc,\r\n    mediaBlob,\r\n    managers,\r\n    mediaSize,\r\n    onEditFinish,\r\n\r\n    onCanvasReady: (canvas) => {\r\n      const canvasBcr = canvas.getBoundingClientRect();\r\n      const leftDiff = (canvasBcr.left + canvasBcr.width / 2) - left;\r\n      const topDiff = (canvasBcr.top + canvasBcr.height / 2) - top;\r\n      const [scaledWidth, scaledHeight] = snapToViewport(sourceWidth / sourceHeight, canvasBcr.width, canvasBcr.height);\r\n\r\n      const deferred = deferredPromise<void>();\r\n\r\n      animateValue(\r\n        0, 1, 200,\r\n        (progress) => {\r\n          animatedCanvas.style.transform = `translate(calc(${\r\n            progress * leftDiff\r\n          }px - 50%), calc(${\r\n            progress * topDiff\r\n          }px - 50%))`;\r\n          animatedCanvas.style.width = lerp(width, scaledWidth, progress) + 'px';\r\n          animatedCanvas.style.height = lerp(height, scaledHeight, progress) + 'px';\r\n        },\r\n        {\r\n          onEnd: () => deferred.resolve()\r\n        }\r\n      );\r\n\r\n      return deferred;\r\n    },\r\n\r\n    onImageRendered: async() => {\r\n      animatedCanvas.style.opacity = '1';\r\n      animatedCanvas.style.transition = '.12s';\r\n      await doubleRaf();\r\n      animatedCanvas.style.opacity = '0';\r\n      await delay(120);\r\n      animatedCanvas.remove();\r\n    },\r\n\r\n    editingMediaState: editingMediaState,\r\n    onClose\r\n  }, SolidJSHotReloadGuardProvider);\r\n}\r\n"],"file":"index-r3IrRpu2.js"}