import{c as E,ah as Q,b as n,bR as G,V as L,a7 as q,aQ as y,a4 as B,E as O,i as g,a2 as p,a as d,a5 as K,bQ as j,aa as V,t as w,dI as U,af as J,aS as X,b$ as Y,aU as Z}from"./index-2-uzhe-z.js";import{I as R,B as H}from"./emailSetup-DQrQRIaN.js";import{S as ee}from"./scrollable2-BioPPquU.js";import{S as T}from"./index-BFicqJ6g.js";import{S as x}from"./space-4p_4g0gX.js";import{N as z}from"./appDialogsManager-DCp1JlZM.js";import{I as te}from"./iconTsx-B6n407bi.js";import{T as ne}from"./transition-Dd6dvHkW.js";const ie=(i=new Set)=>E(i,{equals:(h,r)=>h.size===r.size&&[...h].every(A=>r.has(A))}),re=32,N=240,oe=i=>{const[h,r]=E(0),A=()=>r(e=>e+1),k=()=>r(e=>e-1);return Q(()=>{i.onRunningAnimations&&i.onRunningAnimations(h())}),n(ne,{onBeforeEnter:A,onAfterEnter:k,onBeforeExit:A,onAfterExit:k,onEnter:async(e,o)=>{const s=e;s.style.height="0px",s.style.opacity="0",G(()=>{const _=s.scrollHeight;s.animate([{height:"0px",opacity:0,...i.scale&&{transform:"scale(0.95)",transformOrigin:"75% center"}},{height:`${_}px`,opacity:1,...i.scale&&{transform:"scale(1)"}}],{duration:L.isAvailable("animations")?N:0,easing:"ease-in-out"}).finished.then(()=>{s.style.removeProperty("height"),s.style.removeProperty("opacity"),o()})})},onExit:async(e,o)=>{G(()=>{e.animate([{height:`${e.scrollHeight}px`,opacity:1},{height:"0px",opacity:0}],{duration:L.isAvailable("animations")?N:0,fill:"forwards",easing:"ease-in-out"}).finished.then(o)})},get children(){return i.children}})},se="_Row_1klcf_1",le="_RowCheckbox_1klcf_9",ce="_RowCheckboxWrapper_1klcf_14",ae="_RowCheckboxCickArea_1klcf_19",de="_RowSeparator_1klcf_23",me="_RowLabel_1klcf_29",ge="_RowOffset_1klcf_38",ue="_Count_1klcf_42",he="_CountArrow_1klcf_49",Ae="_toggled_1klcf_52",fe="_ExpandedItems_1klcf_56",m={Row:se,RowCheckbox:le,RowCheckboxWrapper:ce,RowCheckboxCickArea:ae,RowSeparator:de,RowLabel:me,RowOffset:ge,Count:ue,CountArrow:he,toggled:Ae,ExpandedItems:fe},_e=w("<div><div><div></div></div><div></div><div><div>/"),Fe=w("<div>"),ke=w("<div><div></div><div></div><div>"),W=i=>{const[h,r]=E(!1),A=y(()=>i.items.every(e=>e.checked())),k=e=>{e.stopPropagation(),i.onMainCheckboxClick()};return[(()=>{const e=_e(),o=e.firstChild,s=o.firstChild,_=o.nextSibling,f=_.nextSibling,u=f.firstChild,a=u.firstChild;return e.$$click=()=>r(!h()),B(O,e,()=>!0),o.$$click=k,g(o,n(z,{get class(){return m.RowCheckbox},get checked(){return A()}}),s),g(f,()=>i.mainLabel,u),g(u,()=>i.checkedCount,a),g(u,()=>i.items.length,null),g(u,n(te,{get class(){return m.CountArrow},get classList(){return{[m.toggled]:h()}},icon:"arrowhead"}),null),p(c=>{const C=`${m.Row} hover-effect rp`,b=m.RowCheckboxWrapper,F=m.RowCheckboxClickArea,$=m.RowSeparator,M=m.RowLabel,P=m.Count;return C!==c._v$&&d(e,c._v$=C),b!==c._v$2&&d(o,c._v$2=b),F!==c._v$3&&d(s,c._v$3=F),$!==c._v$4&&d(_,c._v$4=$),M!==c._v$5&&d(f,c._v$5=M),P!==c._v$6&&d(u,c._v$6=P),c},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0}),e})(),n(oe,{get children(){return n(K,{get when(){return h()},get children(){const e=Fe();return g(e,n(j,{get each(){return i.items},children:o=>(()=>{const s=ke(),_=s.firstChild,f=_.nextSibling,u=f.nextSibling;return V(s,"click",o.onClick,!0),B(O,s,()=>!0),g(f,n(z,{get class(){return m.RowCheckbox},get checked(){return o.checked()}})),g(u,()=>o.label),p(a=>{const c=`${m.Row} hover-effect rp`,C=m.RowOffset,b=m.RowCheckboxWrapper,F=m.RowLabel;return c!==a._v$7&&d(s,a._v$7=c),C!==a._v$8&&d(_,a._v$8=C),b!==a._v$9&&d(f,a._v$9=b),F!==a._v$10&&d(u,a._v$10=F),a},{_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0}),s})()})),p(()=>d(e,m.ExpandedItems)),e}})}})]};q(["click"]);const Ce="_SectionTitle_1lrbr_1",Re="_Footer_1lrbr_7",ve="_Button_1lrbr_16",pe="_Search_1lrbr_22",be="_Scrollable_1lrbr_26",v={SectionTitle:Ce,Footer:Re,Button:ve,Search:pe,Scrollable:be},Se=w("<form>"),I=w("<div>"),Ne=i=>{const{PeerTitleTsx:h}=U(),r=()=>i.filtersControls,A=()=>{i.onCommit(r().getCommittedReady())},k=e=>{e.preventDefault(),A()};return[n(K,{get when(){return i.hasSearch},get children(){return[n(x,{amount:"2px"}),(()=>{const e=Se();return e.addEventListener("submit",k),g(e,n(T,{get value(){return r().search()},get onChange(){return r().onSearchChange},get children(){return[n(T.Label,{get children(){return n(R,{key:"Search"})}}),n(T.Input,{ref(o){const s=i.inputRef;typeof s=="function"?s(o):i.inputRef=o}})]}})),p(()=>d(e,v.Search)),e})(),n(x,{amount:"1rem"})]}}),n(ee,{get class(){return v.Scrollable},withBorders:"both",relative:!0,get children(){return[(()=>{const e=I();return g(e,n(R,{key:"AdminRecentActionsFilters.ByType"})),p(()=>d(e,v.SectionTitle)),e})(),n(j,{get each(){return r().filterGroupsConfig()},children:e=>n(W,{get mainLabel(){return n(R,{get key(){return e.i18nKey}})},get checkedCount(){return r().flagGroupCheckCount(e)},onMainCheckboxClick:()=>r().onFlagGroupClick(e),get items(){return e.items.map(o=>({checked:()=>r().isFlagSelected(o.pFlag),label:n(R,{get key(){return o.i18nKey}}),onClick:()=>r().onFlagClick(o.pFlag)}))}})}),n(x,{amount:"1rem"}),(()=>{const e=I();return g(e,n(R,{key:"AdminRecentActionsFilters.ByAdmin"})),p(()=>d(e,v.SectionTitle)),e})(),n(K,{get when(){return r().adminIds().length},get children(){return n(W,{get mainLabel(){return n(R,{key:"AdminRecentActionsFilters.ShowAllAdminActions"})},get checkedCount(){return r().selectedAdminIds().size},get onMainCheckboxClick(){return r().onAllAdminsClick},get items(){return r().adminIds().map(e=>({checked:()=>r().isAdminIdSelected(e.toPeerId()),label:n(h,{get peerId(){return e.toPeerId()},limitSymbols:re}),onClick:()=>r().onAdminClick(e.toPeerId())}))}})}}),n(K,{get when(){return r().notShowingAdmins()},get children(){const e=I();return g(e,n(R,{key:"AdminRecentActionsFilters.NotShowingAdmins",get args(){return[r().notShowingAdmins()+""]}})),p(()=>d(e,v.SectionTitle)),e}})]}}),n(x,{amount:"1rem"}),(()=>{const e=I();return g(e,n(H,{get class(){return v.Button},primary:!0,get onClick(){return i.onReset},get children(){return n(R,{key:"AdminRecentActionsFilters.ResetFilters"})}}),null),g(e,n(H,{get class(){return v.Button},primaryFilled:!0,onClick:A,get children(){return n(R,{key:"AdminRecentActionsFilters.ApplyFilters"})}}),null),p(()=>d(e,v.Footer)),e})()]};function ye({isBroadcast:i}){return[{i18nKey:"AdminRecentActionsFilters.MembersAndAdmins",items:[{pFlag:"join",i18nKey:"AdminRecentActionsFilters.NewMembers"},{pFlag:"leave",i18nKey:i?"AdminRecentActionsFilters.MembersLeftChannel":"AdminRecentActionsFilters.MembersLeftGroup"},{pFlag:"invite",i18nKey:"AdminRecentActionsFilters.InvitedMembers"},{pFlag:"ban",i18nKey:"AdminRecentActionsFilters.BannedMembers"},{pFlag:"unban",i18nKey:"AdminRecentActionsFilters.UnbannedMembers"},{pFlag:"kick",i18nKey:"AdminRecentActionsFilters.RemovedMembers"},{pFlag:"unkick",i18nKey:"AdminRecentActionsFilters.UnkickedMembers"},{pFlag:"promote",i18nKey:"AdminRecentActionsFilters.NewAdminRights"},{pFlag:"demote",i18nKey:"AdminRecentActionsFilters.RemovedAdminRights"}]},{i18nKey:i?"AdminRecentActionsFilters.ChannelSettings":"AdminRecentActionsFilters.GroupSettings",items:[{pFlag:"info",i18nKey:i?"AdminRecentActionsFilters.ChannelInfo":"AdminRecentActionsFilters.GroupInfo"},{pFlag:"settings",i18nKey:i?"AdminRecentActionsFilters.ChannelSettings":"AdminRecentActionsFilters.GroupSettings"},{pFlag:"invites",i18nKey:"AdminRecentActionsFilters.InviteLinks"},{pFlag:"group_call",i18nKey:"AdminRecentActionsFilters.GroupCall"},{pFlag:"forums",i18nKey:"AdminRecentActionsFilters.Forums"},{pFlag:"sub_extend",i18nKey:"AdminRecentActionsFilters.SubscriptionExtensions"}]},{i18nKey:"AdminRecentActionsFilters.Messages",items:[{pFlag:"send",i18nKey:"AdminRecentActionsFilters.SentMessages"},{pFlag:"delete",i18nKey:"AdminRecentActionsFilters.DeletedMessages"},{pFlag:"edit",i18nKey:"AdminRecentActionsFilters.EditedMessages"},{pFlag:"pinned",i18nKey:"AdminRecentActionsFilters.PinnedMessages"}]}]}const we=40;function We({channelId:i,isBroadcast:h}){const{rootScope:r}=U(),A=y(()=>ye({isBroadcast:h()})),k=()=>A().flatMap(t=>t.items.map(l=>l.pFlag)),e=()=>{const t=k();return Object.fromEntries(t.map(l=>[l,!0]))},[o]=J(i,t=>r.managers.appProfileManager.getChannelParticipants({id:t,filter:{_:"channelParticipantsAdmins"},offset:0,limit:we})),[s,_]=E(""),[f,u]=X(e()),[a,c]=ie(),C=y(()=>o()?.participants?.filter(t=>"user_id"in t).map(t=>t.user_id)||[]),b=y(()=>{if(!o())return null;const t=C().length,l=o().count||t;return l-t>0?l-t:null}),F=y(()=>C().map(t=>t.toPeerId())),$=Y(a,(t,l)=>l.has(t.toPeerId()));return{filterGroupsConfig:A,adminIds:C,notShowingAdmins:b,setFromCommittedFilters:t=>{_(t?.search||""),u(Z(t?.flags||e())),c(new Set(t?.admins||F()))},getCommittedReady:()=>{const t=Object.entries(f).filter(([,D])=>D),l=t.length&&t.length<k().length?Object.fromEntries(t):void 0,S=a().size<F().length?Array.from(a()):void 0;return!s()&&!l&&!S?null:{search:s()||void 0,flags:l,admins:S}},search:s,selectedAdminIds:a,onSearchChange:_,onFlagClick:t=>{u(t,l=>!l)},onFlagGroupClick:t=>{const l=t.items.every(S=>f[S.pFlag]);u(t.items.map(S=>S.pFlag),!l)},onAllAdminsClick:()=>{const t=a().size===F().length;c(t?new Set:new Set(F()))},onAdminClick:t=>{const l=new Set(a());l.has(t.toPeerId())?l.delete(t.toPeerId()):l.add(t.toPeerId()),c(l)},isFlagSelected:t=>f[t],isAdminIdSelected:$,flagGroupCheckCount:t=>t.items.filter(l=>f[l.pFlag]).length}}export{Ne as F,oe as H,ie as c,re as l,We as u};
//# sourceMappingURL=useFlagFilters-nkuuSZDh.js.map
