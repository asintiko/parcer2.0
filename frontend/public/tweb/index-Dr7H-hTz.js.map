{"version":3,"file":"index-Dr7H-hTz.js","sources":["../src/components/chat/suggestPostPopup/content.tsx","../src/components/chat/suggestPostPopup/index.ts"],"sourcesContent":["import {createSignal, Show} from 'solid-js';\r\nimport numberThousandSplitter from '../../../helpers/number/numberThousandSplitter';\r\nimport {attachHotClassName} from '../../../helpers/solid/classname';\r\nimport {I18nTsx} from '../../../helpers/solid/i18n';\r\nimport defineSolidElement, {PassedProps} from '../../../lib/solidjs/defineSolidElement';\r\nimport currencyStarIcon from '../../currencyStarIcon';\r\nimport ripple from '../../ripple';\r\nimport useAppConfig from '../../sidebarLeft/tabs/privacy/messages/useAppConfig';\r\nimport useStarsCommissionAndWithdrawalPrice from '../../sidebarLeft/tabs/privacy/messages/useStarsCommissionAndWithdrawalPrice';\r\nimport SimpleFormField from '../../simpleFormField';\r\nimport Space from '../../space';\r\nimport commonStyles from './commonStyles.module.scss';\r\nimport PublishTimeField from './publishTimeField';\r\nimport styles from './styles.module.scss';\r\nripple;\r\n\r\nif(import.meta.hot) import.meta.hot.accept();\r\n\r\n\r\nexport type SuggestPostPopupContentProps = {\r\n  initialStars?: number;\r\n  initialTimestamp?: number;\r\n  onFinish: (payload: FinishPayload) => void;\r\n};\r\n\r\nexport type FinishPayload = {\r\n  stars: number;\r\n  timestamp: number;\r\n};\r\n\r\nconst MIN_STARS = 5;\r\nconst MAX_STARS = 100_000;\r\n\r\nconst SUGGEST_CHANGE_MIN_DELAY_MINUTES = 1; // avoid suggesting in the past if the user has the popup open for too long\r\n\r\nconst SuggestPostPopupContent = defineSolidElement({\r\n  name: 'suggested-post-popup-content',\r\n  component: (props: PassedProps<SuggestPostPopupContentProps>) => {\r\n    attachHotClassName(props.element, styles.Container);\r\n\r\n    const [stars, setStars] = createSignal(props.initialStars ? props.initialStars + '' : '');\r\n    const [publishingTimestamp, setPublishingTimestamp] = createSignal<number>(\r\n      props.initialTimestamp && props.initialTimestamp * 1000 > Date.now() + SUGGEST_CHANGE_MIN_DELAY_MINUTES * 60 * 1000 ?\r\n        props.initialTimestamp :\r\n        undefined\r\n    );\r\n\r\n    const [appConfig] = useAppConfig();\r\n\r\n    const {willReceiveDollars} = useStarsCommissionAndWithdrawalPrice(() => +stars() || 0, {\r\n      commissionKey: 'stars_suggested_post_commission_permille'\r\n    });\r\n\r\n    const minStars = () => appConfig()?.stars_suggested_post_amount_min || MIN_STARS;\r\n    const maxStars = () => appConfig()?.stars_suggested_post_amount_max || MAX_STARS;\r\n\r\n    const isBadPrice = () => +stars() && +stars() < minStars();\r\n\r\n    const hasErrors = () => isBadPrice();\r\n\r\n    const onChange = (value: string) => {\r\n      setStars(!value ? value : '' + Math.min(maxStars(), +(value.replace(/\\D/g, '')) || 0));\r\n    };\r\n\r\n    const onFinish = () => {\r\n      if(hasErrors()) return;\r\n\r\n      props.onFinish({\r\n        stars: +stars() || undefined,\r\n        timestamp: publishingTimestamp() || undefined\r\n      });\r\n    };\r\n\r\n    return <>\r\n      <SimpleFormField\r\n        value={stars()}\r\n        onChange={onChange}\r\n        isError={isBadPrice()}\r\n      >\r\n        <SimpleFormField.SideContent first>\r\n          {currencyStarIcon({class: commonStyles.Icon})}\r\n        </SimpleFormField.SideContent>\r\n        <SimpleFormField.Input type='number' forceFieldValue />\r\n        <SimpleFormField.Label forceOffset={44}>\r\n          <I18nTsx\r\n            key={!isBadPrice() ? 'SuggestedPosts.EnterPrice.Label' : 'SuggestedPosts.EnterPrice.MinOffer'}\r\n            args={isBadPrice() ? [minStars() + ''] : undefined}\r\n          />\r\n        </SimpleFormField.Label>\r\n        <SimpleFormField.SideContent last>\r\n          <Show when={willReceiveDollars()}>\r\n            ~{numberThousandSplitter(willReceiveDollars(), ',')}$\r\n          </Show>\r\n        </SimpleFormField.SideContent>\r\n      </SimpleFormField>\r\n\r\n      <div class={styles.Caption}>\r\n        <I18nTsx key='SuggestedPosts.EnterPrice.Description' />\r\n      </div>\r\n\r\n      <Space amount='2rem' />\r\n\r\n      <PublishTimeField\r\n        noTimeLangKey='SuggestedPosts.PublishingTime.Anytime'\r\n        value={publishingTimestamp()}\r\n        onChange={setPublishingTimestamp}\r\n      />\r\n\r\n      <div class={styles.Caption}>\r\n        <I18nTsx key='SuggestedPosts.PublishingTime.Description' />\r\n      </div>\r\n\r\n      <Space amount='2rem' />\r\n\r\n      <button\r\n        use:ripple\r\n        class=\"btn-primary btn-color-primary btn-large\"\r\n        disabled={hasErrors()}\r\n        onClick={onFinish}\r\n      >\r\n        <I18nTsx key='SuggestedPosts.MakeAnOffer' />\r\n      </button>\r\n    </>;\r\n  }\r\n});\r\n\r\nexport default SuggestPostPopupContent;\r\n","import type SolidJSHotReloadGuardProvider from '../../../lib/solidjs/hotReloadGuardProvider';\r\nimport PopupElement from '../../popups';\r\nimport SuggestPostPopupContent, {SuggestPostPopupContentProps} from './content';\r\n\r\ntype Args = SuggestPostPopupContentProps & {\r\n  HotReloadGuard: typeof SolidJSHotReloadGuardProvider;\r\n  suggestChange?: boolean;\r\n};\r\n\r\nexport default class SuggestPostPopup extends PopupElement {\r\n  constructor({HotReloadGuard, suggestChange, onFinish, ...rest}: Args) {\r\n    super('suggested-post-popup', {\r\n      overlayClosable: true,\r\n      closable: true,\r\n      body: true,\r\n      title: suggestChange ? 'SuggestedPosts.SuggestAChange' : 'SuggestedPosts.SuggestAPost'\r\n    });\r\n\r\n    const content = new SuggestPostPopupContent;\r\n    content.HotReloadGuard = HotReloadGuard;\r\n    content.feedProps({\r\n      ...rest,\r\n      onFinish: (payload) => {\r\n        onFinish(payload);\r\n        this.hide();\r\n      }\r\n    });\r\n\r\n    this.body.append(content);\r\n  }\r\n}\r\n"],"names":["MIN_STARS","MAX_STARS","SUGGEST_CHANGE_MIN_DELAY_MINUTES","SuggestPostPopupContent","defineSolidElement","name","component","props","element","styles","Container","stars","setStars","createSignal","initialStars","publishingTimestamp","setPublishingTimestamp","initialTimestamp","Date","now","undefined","appConfig","useAppConfig","willReceiveDollars","useStarsCommissionAndWithdrawalPrice","commissionKey","minStars","stars_suggested_post_amount_min","maxStars","stars_suggested_post_amount_max","isBadPrice","hasErrors","onChange","value","Math","min","replace","onFinish","timestamp","_$createComponent","SimpleFormField","isError","children","SideContent","first","currencyStarIcon","class","commonStyles","Icon","Input","type","forceFieldValue","Label","forceOffset","I18nTsx","key","args","_$memo","last","Show","when","numberThousandSplitter","_el$","_tmpl$","_$effect","_$className","Caption","Space","amount","PublishTimeField","noTimeLangKey","_el$2","_el$3","_tmpl$2","$$click","ripple","disabled","SuggestPostPopupContent$1","_$delegateEvents","SuggestPostPopup","PopupElement","HotReloadGuard","suggestChange","rest","content","payload"],"mappings":"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"}