{"version":3,"file":"topicName-D6-3Pjph.js","sources":["../src/lib/appManagers/utils/chats/isBannedParticipant.ts","../src/lib/appManagers/utils/chats/removeChatBannedRightsFromParticipant.ts","../src/components/sidebarRight/tabs/adminRecentActions/adminRightsI18nResolver.ts","../src/lib/appManagers/utils/chats/isParticipantAdmin.ts","../src/components/sidebarRight/tabs/adminRecentActions/utils.ts","../src/components/sidebarRight/tabs/adminRecentActions/participantRightsMap.ts","../src/components/sidebarRight/tabs/adminRecentActions/topicName.tsx"],"sourcesContent":["import {ChannelParticipant, ChatParticipant} from '../../../../layer';\r\n\r\nexport const isBannedParticipant = (participant: ChatParticipant | ChannelParticipant | undefined) =>\r\n  participant?._ === 'channelParticipantBanned' && participant.pFlags?.left;\r\n;\r\n","import {ChatBannedRights, Chat} from '../../../../layer';\r\n\r\nexport default function removeChatBannedRightsFromParticipant(chat: Chat.channel, rights: ChatBannedRights) {\r\n  if(chat.default_banned_rights && rights?.pFlags) {\r\n    rights = structuredClone(rights);\r\n\r\n    const defaultBannedRights = chat.default_banned_rights.pFlags;\r\n\r\n    for(const key in defaultBannedRights) {\r\n      const flagKey = key as keyof ChatBannedRights['pFlags'];\r\n      if(defaultBannedRights[flagKey]) delete rights.pFlags[flagKey];\r\n    }\r\n  }\r\n\r\n  return rights;\r\n}\r\n","import {ChatAdminRights} from '../../../../layer';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\n\r\ntype Args = { isBroadcast: boolean };\r\n\r\nconst adminRightToI18n: Record<keyof ChatAdminRights.chatAdminRights['pFlags'], (a: Args) => LangPackKey> = {\r\n  other: () => 'AdminRights.Other',\r\n  manage_call: () => 'Channel.EditAdmin.ManageCalls',\r\n  manage_direct_messages: () => 'Channel.EditAdmin.ManageDirectMessages',\r\n\r\n  change_info: ({isBroadcast}) =>\r\n    isBroadcast ? 'EditAdminChangeChannelInfo' : 'EditAdminChangeGroupInfo',\r\n\r\n  post_messages: () => 'EditAdminPostMessages',\r\n  edit_messages: () => 'EditAdminEditMessages',\r\n  delete_messages: ({isBroadcast}) =>\r\n    isBroadcast ? 'EditAdminDeleteMessages' : 'EditAdminGroupDeleteMessages',\r\n\r\n  ban_users: () => 'EditAdminBanUsers',\r\n  pin_messages: () => 'EditAdminPinMessages',\r\n  add_admins: () => 'EditAdminAddAdmins',\r\n  anonymous: () => 'EditAdminSendAnonymously',\r\n  manage_topics: () => 'ManageTopicsPermission',\r\n\r\n  invite_users: ({isBroadcast}) =>\r\n    isBroadcast ?\r\n      'Channel.EditAdmin.PermissionInviteSubscribers' :\r\n      'EditAdminAddUsersViaLink',\r\n\r\n  post_stories: () => 'AdminRights.PostStories',\r\n  edit_stories: () => 'AdminRights.EditStories',\r\n  delete_stories: () => 'AdminRights.DeleteStories'\r\n};\r\n\r\nexport function resolveAdminRightFlagI18n(flag: keyof ChatAdminRights.chatAdminRights['pFlags'], args: Args) {\r\n  const resolver = adminRightToI18n[flag];\r\n  return resolver(args);\r\n}\r\n","import {ChannelParticipant, ChatParticipant} from '../../../../layer';\r\n\r\nexport const isParticipantAdmin = (participant: ChatParticipant | ChannelParticipant | undefined) =>\r\n  participant?._ === 'channelParticipantCreator' ||\r\n  participant?._ === 'channelParticipantAdmin' ||\r\n  participant?._ === 'chatParticipantAdmin' ||\r\n  participant?._ === 'chatParticipantCreator'\r\n;\r\n","import pause from '../../../../helpers/schedulers/pause';\r\nimport {wrapAsyncClickHandler} from '../../../../helpers/wrapAsyncClickHandler';\r\nimport {Message} from '../../../../layer';\r\nimport {isParticipantAdmin} from '../../../../lib/appManagers/utils/chats/isParticipantAdmin';\r\nimport {useHotReloadGuard} from '../../../../lib/solidjs/hotReloadGuard';\r\nimport {useSuperTab} from '../../../solidJsTabs/superTabProvider';\r\nimport {AppAdminRecentActionsTab} from '../../../solidJsTabs/tabs';\r\nimport {toastNew} from '../../../toast';\r\n\r\n\r\nexport const getPhoto = (message: Message) => {\r\n  if(message?._ !== 'message' || message?.media?._ !== 'messageMediaPhoto' || message?.media?.photo?._ !== 'photo') return;\r\n  return message.media.photo;\r\n};\r\n\r\nexport function diffFlags<T extends Record<string, true>>(\r\n  prev: T | undefined,\r\n  next: T | undefined\r\n) {\r\n  const prevNorm = (prev ?? {}) as Required<T>;\r\n  const nextNorm = (next ?? {}) as Required<T>;\r\n\r\n  const newFlags: (keyof T)[] = [];\r\n  const oldFlags: (keyof T)[] = [];\r\n\r\n  const allKeys = new Set<keyof T>([\r\n    ...Object.keys(prevNorm) as (keyof T)[],\r\n    ...Object.keys(nextNorm) as (keyof T)[]\r\n  ]);\r\n\r\n  for(const key of allKeys) {\r\n    const was = prevNorm[key];\r\n    const isNow = nextNorm[key];\r\n\r\n    if(!was && isNow) {\r\n      newFlags.push(key);\r\n    } else if(was && !isNow) {\r\n      oldFlags.push(key);\r\n    }\r\n  }\r\n\r\n  return {new: newFlags, old: oldFlags};\r\n}\r\n\r\nexport function useParticipantClickHandler(peerId: PeerId) {\r\n  const {rootScope} = useHotReloadGuard();\r\n  const [tab, allTabs] = useSuperTab<typeof AppAdminRecentActionsTab>();\r\n\r\n  return wrapAsyncClickHandler(async() => {\r\n    try {\r\n      const participant = await rootScope.managers.appProfileManager.getParticipant(tab.payload.channelId, peerId);\r\n\r\n      allTabs.AppUserPermissionsTab.openTab(\r\n        tab.slider,\r\n        tab.payload.channelId, participant, isParticipantAdmin(participant)\r\n      );\r\n\r\n      await pause(200); // wait the open animation too\r\n    } catch{\r\n      toastNew({\r\n        langPackKey: 'AdminRecentActions.UserNotMemberAnymore'\r\n      });\r\n    }\r\n  });\r\n}\r\n","import {ChatBannedRights} from '../../../../layer';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\nexport const participantRightsMap: Record<keyof ChatBannedRights.chatBannedRights['pFlags'], LangPackKey | null> = {\r\n  send_plain:        'UserRestrictionsSend',\r\n  send_media:        'UserRestrictionsSendMedia',\r\n  invite_users:      'UserRestrictionsInviteUsers',\r\n  pin_messages:      'UserRestrictionsPinMessages',\r\n  manage_topics:     'CreateTopicsPermission',\r\n  change_info:       'UserRestrictionsChangeInfo',\r\n  send_photos:       'UserRestrictionsSendPhotos',\r\n  send_videos:       'UserRestrictionsSendVideos',\r\n  send_stickers:     'UserRestrictionsSendStickersOnly',\r\n  send_gifs:         'UserRestrictionsSendGIFsOnly',\r\n  send_audios:       'UserRestrictionsSendMusic',\r\n  send_docs:         'UserRestrictionsSendFiles',\r\n  send_voices:       'UserRestrictionsSendVoices',\r\n  send_roundvideos:  'UserRestrictionsSendRound',\r\n  embed_links:       'UserRestrictionsEmbedLinks',\r\n  send_polls:        'UserRestrictionsSendPolls',\r\n  view_messages:     null,\r\n  send_messages:     null,\r\n  send_games:        null,\r\n  send_inline:       null\r\n};\r\n","import {createResource, Show} from 'solid-js';\r\nimport createMiddleware from '../../../../helpers/solid/createMiddleware';\r\nimport {ForumTopic} from '../../../../layer';\r\nimport {useHotReloadGuard} from '../../../../lib/solidjs/hotReloadGuard';\r\nimport styles from './topicName.module.scss';\r\n\r\n\r\nexport const TopicName = (props: {\r\n  topic: ForumTopic;\r\n}) => {\r\n  const {wrapTopicIcon} = useHotReloadGuard();\r\n\r\n  const topic = () => props.topic._ === 'forumTopic' ? props.topic : null;\r\n\r\n  const [icon] = createResource(topic, (topic) => {\r\n    if(!topic) return null;\r\n    const middleware = createMiddleware().get();\r\n    return wrapTopicIcon({\r\n      topic,\r\n      middleware\r\n    });\r\n  });\r\n\r\n  return (\r\n    <Show when={topic()}>\r\n      <div class={styles.Container}>\r\n        {icon()} {topic().title}\r\n      </div>\r\n    </Show>\r\n  );\r\n}\r\n"],"names":["isBannedParticipant","participant","removeChatBannedRightsFromParticipant","chat","rights","defaultBannedRights","key","flagKey","adminRightToI18n","isBroadcast","resolveAdminRightFlagI18n","flag","args","resolver","isParticipantAdmin","getPhoto","message","diffFlags","prev","next","prevNorm","nextNorm","newFlags","oldFlags","allKeys","was","isNow","useParticipantClickHandler","peerId","rootScope","useHotReloadGuard","tab","allTabs","useSuperTab","wrapAsyncClickHandler","pause","toastNew","participantRightsMap","TopicName","props","wrapTopicIcon","topic","_","icon","createResource","middleware","createMiddleware","get","_$createComponent","Show","when","children","_el$","_tmpl$","_el$2","firstChild","_$insert","title","_$effect","_$className","styles","Container"],"mappings":"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"}